/*! CommunityAllyWebApp 2023-03-10 */
!function(e){function t(e,t){this.$http=e,this.$q=t,this.isLoading=!1,this.includeAddresses=!1}t.prototype.$onInit=function(){this.refreshAddresses()},t.prototype.getPolyInfo=function(e,t){var i=this,n=this.$q.defer();return this.isLoading=!0,this.$http.get(e).then(function(e){i.isLoading=!1;e=e.data;_.each(e,function(e){"Group"==(e.polyType=t)&&(e.oneLiner=e.shortName+", "+e.appName)}),$.merge(i.addresses,e),n.resolve(i.addresses)},function(e){i.isLoading=!1;e=e.data.exceptionMessage||e.data;alert("Failed to retrieve addresses: "+e),n.reject()}),n.promise},t.prototype.getGroupBoundPolys=function(){return this.getPolyInfo("/api/AdminMap/GetGroupBounds?filter="+this.filterAddresses,"Group")},t.prototype.getAddressPolys=function(){return this.getPolyInfo("/api/AdminMap/GetAll?filter="+this.filterAddresses,"Address")},t.prototype.refreshAddresses=function(){function e(e){t.addressPoints=[],_.each(e,function(e){e.gpsPos&&(e.gpsPos.fullAddress=e.oneLiner,t.addressPoints.push(e.gpsPos))})}var t=this;this.isLoading=!0,this.addresses=[];(this.includeAddresses?this.getAddressPolys().then(function(){return t.getGroupBoundPolys()}):this.getGroupBoundPolys()).then(e)},t.prototype.onSavePoly=function(){var e=this,t=(this.isLoading=!0,{vertices:this.selectedAddress.gpsBounds.vertices}),i="Address"===this.selectedAddress.polyType?"/api/AdminMap/UpdateAddress/"+this.selectedAddress.addressId:"/api/AdminMap/UpdateGroup/"+this.selectedAddress.groupId;this.$http.put(i,t).then(function(){e.isLoading=!1},function(){e.isLoading=!1})},t.prototype.onAddressSelected=function(e){this.selectedAddress=e,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&e.gpsPos&&(e.gpsBounds.vertices=[{lat:e.gpsPos.lat,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon+.001},{lat:e.gpsPos.lat,lon:e.gpsPos.lon+.001}]),this.selectedGpsPoly=e.gpsBounds},t.$inject=["$http","$q"],e.ManageAddressPolysController=t}(Ally=Ally||{}),CA.angularApp.component("manageAddressPolys",{templateUrl:"/ngApp/admin/manage-address-polys.html",controller:Ally.ManageAddressPolysController}),function(e){var i=function(){};function t(e,t){this.$http=e,this.siteInfo=t,this.newAssociation=new i,this.changeShortNameData={appName:"Condo"},this.sendTestFromInmail=!1,this.noReplyEmailInfo={to:"",subject:"",body:""},this.retrieveGroups=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Association/AdminList").then(function(e){t.isLoading=!1,t.groups=e.data,_.each(t.groups,function(e){0===e.appName?(e.appNameString="Condo",e.baseUrl="https://"+e.shortName+".CondoAlly.com/"):1===e.appName?(e.appNameString="NeighborhoodWatch",e.baseUrl="https://"+e.shortName+".WatchAlly.com/"):2===e.appName?(e.appNameString="Home",e.baseUrl="https://"+e.shortName+".HomeAlly.org/"):3===e.appName?(e.appNameString="Hoa",e.baseUrl="https://"+e.shortName+".HoaAlly.org/"):4===e.appName?(e.appNameString="Neighborhood",e.baseUrl="https://"+e.shortName+".NeighborhoodAlly.org/"):5===e.appName?(e.appNameString="PTA",e.baseUrl="https://"+e.shortName+".PTAAlly.org/"):6===e.appName&&(e.appNameString="BlockClub",e.baseUrl="https://"+e.shortName+".BlockClubAlly.org/")})},function(){t.isLoading=!1,alert("Failed to retrieve groups")})}}t.prototype.$onInit=function(){this.curGroupApiUri=this.siteInfo.publicSiteInfo.baseApiUrl,this.curGroupId=this.curGroupApiUri.substring("https://".length,this.curGroupApiUri.indexOf(".")),this.curGroupCreationDate=this.siteInfo.privateSiteInfo.creationDate,this.premiumUpdateGroupId=parseInt(this.curGroupId),"hoa"===AppConfig.appShortName&&(this.changeShortNameData.appName="Hoa"),this.changeShortNameData.old=this.siteInfo.publicSiteInfo.shortName,this.newAllyPaymentEntry={paymentId:0,groupId:parseInt(this.curGroupId),amount:0,netAmount:null,description:"Annual Premium Plan",entryDateUtc:new Date,paymentDateUtc:new Date,paymentMethod:"Check",paymentMethodId:"",status:"Complete"}},t.prototype.changeShortName=function(){var t=this;this.changeShortNameResult=null,/[^a-zA-Z0-9]/.test(this.changeShortNameData.newShortName)?alert("The new short name must be alphanumeric"):this.changeShortNameData.newShortName!==this.changeShortNameData.newShortName.toLowerCase()?alert("The new short name must be lower-case"):0===this.changeShortNameData.newShortName.length?alert("New short name must not be empty"):(this.isLoading=!0,this.$http.put("/api/AdminHelper/ChangeShortName?oldShortName="+this.changeShortNameData.old+"&newShortName="+this.changeShortNameData.newShortName+"&appName="+this.changeShortNameData.appName,null).then(function(e){t.isLoading=!1,t.changeShortNameResult="Successfully changed"},function(e){t.isLoading=!1,t.changeShortNameResult="Failed to change: "+e.data.exceptionMessage}))},t.prototype.findAssociationsForUser=function(){var t=this;this.isLoading=!0,this.$http.get("/api/AdminHelper/FindAssociationsForUser?email="+this.findUserAssociationsEmail).then(function(e){t.isLoading=!1,t.foundUserAssociations=e.data,_.forEach(t.foundUserAssociations,function(e){e.viewUrl="https://"+e.shortName+".condoally.com/",3===e.appName&&(e.viewUrl="https://"+e.shortName+".hoaally.org/")})},function(){t.isLoading=!1,alert("Failed to find associations for user")})},t.prototype.deleteAssociation=function(e){var t=this;confirm("Are you sure you want to delete this association?")&&(this.isLoading=!0,this.$http.delete("/api/Association/chtn/"+e.groupId).then(function(){t.isLoading=!1,t.retrieveGroups()},function(e){t.isLoading=!1,console.log(e.data.exceptionMessage),alert("Failed to delete group: "+e.data.exceptionMessage)}))},t.prototype.addAddress=function(){var t=this;this.newAddressId=null,this.isLoading=!0,this.$http.post("/api/AdminHelper/AddAddress?address="+encodeURIComponent(this.newAddress),null).then(function(e){t.isLoading=!1,t.newAddressId=e.data.newAddressId},function(e){t.isLoading=!1,alert("Failed to add address: "+e.data.exceptionMessage)})},t.prototype.onCreateAssociationClick=function(){var e=this;this.isLoading=!0,this.$http.post("/api/Association",this.newAssociation).then(function(){e.isLoading=!1,e.newAssociation=new i,e.retrieveGroups()})},t.prototype.onSendTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendTestEmail?testEmailRecipient="+encodeURIComponent(this.testEmailRecipient)+"&sendFromInmail="+(this.sendTestFromInmail?"true":"false"))},t.prototype.onSendTaylorTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendFromTaylorEmail?testEmailRecipient="+encodeURIComponent(this.testTaylorEmailRecipient))},t.prototype.onSendTaylorBulkUpdateEmail=function(){confirm("Are you sure you want to SEND TO EVERYONE?!?!")&&this.makeHelperRequest("/api/AdminHelper/SendBulkTaylorEmail3")},t.prototype.onSendTestPostmarkEmail=function(){var e=this;this.isLoading=!0,this.$http.get("/api/AdminHelper/SendTestPostmarkEmail?email="+this.testPostmarkEmail).then(function(){e.isLoading=!1,alert("Successfully sent email")},function(){e.isLoading=!1,alert("Failed to send email")})},t.prototype.onSendTestCalendarEmail=function(){var e=this;this.isLoading=!0,this.$http.get("/api/AdminHelper/SendTestCalendarEmail").then(function(){e.isLoading=!1,alert("Successfully sent email")},function(){e.isLoading=!1,alert("Failed to send email")})},t.prototype.onSendNoReplyEmail=function(){var t=this;this.isLoading=!0,this.$http.post("/api/AdminHelper/SendNoReplyPostmarkEmail",this.noReplyEmailInfo).then(function(){t.isLoading=!1,alert("Successfully sent email")},function(e){t.isLoading=!1,alert("Failed to send email: "+e.data.exceptionMessage)})},t.prototype.makeHelperRequest=function(e,t){var i=this;void 0===t&&(t=null),this.isLoadingHelper=!0,(t?this.$http.post(e,t):this.$http.get(e)).then(function(){return i.isLoadingHelper=!1},function(e){i.isLoadingHelper=!1;e=e.data?e.data.exceptionMessage:"";alert("Failed: "+e)})},t.prototype.onTestException=function(){this.makeHelperRequest("/api/AdminHelper/TestException")},t.prototype.onClearElmahLogs=function(){this.makeHelperRequest("/api/AdminHelper/ClearElmah")},t.prototype.onClearCurrentAppGroupCache=function(){this.makeHelperRequest("/api/AdminHelper/ClearCurrentGroupFromCache")},t.prototype.onClearEntireAppGroupCache=function(){this.makeHelperRequest("/api/AdminHelper/ClearGroupCache")},t.prototype.onSendInactiveGroupsMail=function(){var e={shortNameLines:this.inactiveShortNames};this.makeHelperRequest("/api/AdminHelper/SendInactiveGroupsMail",e)},t.prototype.logInAs=function(){var t=this;this.isLoading=!0,this.$http.get("/api/AdminHelper/LogInAs?email="+this.logInAsEmail).then(function(e){t.siteInfo.setAuthToken(e.data),window.location.href="/#!/Home",window.location.reload(!1)},function(e){alert("Failed to perform login: "+e.data.exceptionMessage)}).finally(function(){return t.isLoading=!1})},t.prototype.populateEmptyDocumentUsage=function(){var t=this,e=(this.isLoading=!0,"/api/AdminHelper/FillInMissingDocumentUsage?numGroups=10");this.populateDocUsageGroupId&&(e+="&groupId="+this.populateDocUsageGroupId),this.$http.get(e).then(function(e){t.isLoading=!1,alert("Succeeded: "+e.data)},function(e){t.isLoading=!1,alert("Failed: "+e.data.exceptionMessage)})},t.prototype.refreshCurGroupDocumentUsage=function(){var t=this,e=(this.isLoading=!0,"/api/AdminHelper/RecalcGroupDocumentUsage?groupId="+this.curGroupId);this.$http.get(e).then(function(e){t.isLoading=!1,console.log("Recalc Succeeded",e.data),alert("Succeeded: "+e.data)},function(e){t.isLoading=!1,alert("Failed: "+e.data.exceptionMessage)})},t.prototype.onAddAllyPayment=function(){var t=this;this.isLoading=!0,this.$http.post("/api/AdminHelper/AddAllyPaymentEntry",this.newAllyPaymentEntry).then(function(e){t.isLoading=!1,t.newAllyPaymentEntry.amount=0,t.newAllyPaymentEntry.netAmount=null,t.newAllyPaymentEntry.paymentMethodId="",alert("Succeeded")},function(e){t.isLoading=!1,alert("Failed: "+e.data.exceptionMessage)})},t.prototype.updatePremiumCost=function(){var t=this,e=(this.isLoading=!0,"/api/AdminHelper/SetPremiumCost/"+this.premiumUpdateGroupId+"?cost="+this.premiumNewCost);this.$http.put(e,null).then(function(e){t.isLoading=!1,t.premiumNewCost=0,alert("Succeeded")},function(e){t.isLoading=!1,alert("Failed: "+e.data.exceptionMessage)})},t.prototype.updatePremiumExpiration=function(){var e,t=this;this.premiumNewExpiration?(this.isLoading=!0,e="/api/AdminHelper/SetPremiumExpiration/"+this.premiumUpdateGroupId+"?expirationDate="+encodeURIComponent(this.premiumNewExpiration.toISOString()),this.$http.put(e,null).then(function(e){t.isLoading=!1,t.premiumNewExpiration=null,alert("Succeeded")},function(e){t.isLoading=!1,alert("Failed: "+e.data.exceptionMessage)})):alert("Hey, dummy, enter a date. Ha!")},t.prototype.onDeactivateGroup=function(){var t=this,e=(this.isLoading=!0,"/api/AdminHelper/DeactivateGroups?groupIdsCsv="+this.deactivateGroupIdsCsv);this.$http.get(e).then(function(e){t.isLoading=!1,t.deactivateGroupIdsCsv=null,alert("Deactivate Succeeded: "+e.data)},function(e){t.isLoading=!1,alert("Deactivate Failed: "+e.data.exceptionMessage)})},t.prototype.onReactivateGroup=function(){var t=this,e=(this.isLoading=!0,"/api/AdminHelper/ReactivateGroup?groupId="+this.reactivateGroupId);this.$http.get(e).then(function(e){t.isLoading=!1,t.reactivateGroupId=null,alert("Reactivate Succeeded: "+e.data)},function(e){t.isLoading=!1,alert("Reactivate Failed: "+e.data.exceptionMessage)})},t.$inject=["$http","SiteInfo"],e.ManageGroupsController=t}(Ally=Ally||{}),CA.angularApp.component("manageGroups",{templateUrl:"/ngApp/admin/manage-groups.html",controller:Ally.ManageGroupsController}),function(n){function e(e,t){this.$http=e,this.siteInfo=t,this.isLoading=!1,this.unitToEdit=new n.Unit,this.isEdit=!1,this.isHoaAlly=!1,this.isCondoAlly=!1}e.prototype.$onInit=function(){this.isAdmin=this.siteInfo.userInfo.isAdmin,this.homeName=AppConfig.homeName||"Unit",this.isCondoAlly="condo"===AppConfig.appShortName,this.refresh()},e.prototype.refresh=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Unit?includeAddressData=true").then(function(e){t.isLoading=!1,t.units=e.data},function(e){t.isLoading=!1,alert("Failed to load homes: "+e.data.exceptionMessage)})},e.prototype.onCreateUnitClick=function(){var e,t,i=this;$("#AddUnitForm").validate(),$("#AddUnitForm").valid()&&(this.isLoading=!0,e=function(){i.isLoading=!1,i.isEdit=!1,i.unitToEdit=new n.Unit,i.refresh()},t=function(e){i.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)},(this.isEdit?this.$http.put("/api/Unit",this.unitToEdit):this.$http.post("/api/Unit/AddSingle",this.unitToEdit)).then(e,t))},e.prototype.onEditUnitClick=function(e){this.isEdit=!0,this.unitToEdit=_.clone(e),e.fullAddress&&(this.unitToEdit.streetAddress=e.fullAddress.oneLiner),document.getElementById("unit-edit-panel").scrollIntoView()},e.prototype.onRefreshUnitFromGoogle=function(e){var t=this;this.isLoading=!0,this.$http.put("/api/Unit/ForceRefreshAddressFromGoogle?unitId="+e.unitId,null).then(function(){t.isLoading=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed to refresh: "+e.data.exceptionMessage)})},e.prototype.onDeleteUnitClick=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Unit/"+e.unitId).then(function(){t.isLoading=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)})},e.prototype.onFastAddUnits=function(){var t=this;this.isLoading=!0,this.$http.post("/api/Unit/FastAdd?fastAdd="+this.lastFastAddName,null).then(function(){t.isLoading=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed fast add: "+e.data.exceptionMessage)})},e.prototype.onAddUnitsPerLine=function(){var e=this,t={action:"onePerLine",lines:this.unitNamePerLine};this.isLoading=!0,this.$http.post("/api/Unit/Multiline",t).then(function(){e.isLoading=!1,e.refresh()},function(){e.isLoading=!1,alert("Failed")})},e.prototype.onAddUnitsByAddressPerLine=function(){var t=this,e={action:"onePerLine",lines:this.unitAddressPerLine};this.isLoading=!0,this.$http.post("/api/Unit/FromAddresses",e).then(function(){t.isLoading=!1,t.unitAddressPerLine="",t.refresh()},function(e){t.isLoading=!1,alert("Failed to add: "+e.data.exceptionMessage)})},e.prototype.onDeleteAllClick=function(){var t=this;confirm("This will delete every unit! This should only be used for new sites!")&&(this.isLoading=!0,this.$http.delete("/api/Unit/DeleteAll?deleteAction=all").then(function(){t.isLoading=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed to delete units: "+e.data.exceptionMessage)}))},e.$inject=["$http","SiteInfo"],n.ManageHomesController=e}(Ally=Ally||{}),CA.angularApp.component("manageHomes",{templateUrl:"/ngApp/admin/manage-homes.html",controller:Ally.ManageHomesController}),function(e){function t(e){this.$http=e,this.isLoading=!1,this.shouldHideLoginAndEmailMessages=!1}t.prototype.$onInit=function(){this.shouldHideLoginAndEmailMessages="true"===window.localStorage.activityLog_hideLoginAndEmailMessages,this.retrieveEntries()},t.prototype.onHideLoginAndEmailMessagesChange=function(){window.localStorage.activityLog_hideLoginAndEmailMessages=this.shouldHideLoginAndEmailMessages,this.filterMessages()},t.prototype.retrieveEntries=function(){var t=this;this.isLoading=!0,this.$http.get("/api/ActivityLog").then(function(e){t.isLoading=!1,t.allLogEntries=e.data,_.each(t.allLogEntries,function(e){return e.postDate=moment(e.postDate).toDate()}),t.filterMessages()},function(e){t.isLoading=!1,alert("Failed to load activity log: "+e.data.exceptionMessage)})},t.prototype.filterMessages=function(){this.shouldHideLoginAndEmailMessages?this.filteredLogEntries=_.filter(this.allLogEntries,function(e){return"Logged in"!==e.activityMessage&&0!==e.activityMessage.indexOf("Group email sent")}):this.filteredLogEntries=this.allLogEntries},t.$inject=["$http"],e.ViewActivityLogController=t}(Ally=Ally||{}),CA.angularApp.component("viewActivityLog",{templateUrl:"/ngApp/admin/view-activity-log.html",controller:Ally.ViewActivityLogController}),function(e){function t(e){this.$http=e,this.isLoading=!1}t.prototype.$onInit=function(){this.refreshAddresses()},t.prototype.findCenter=function(e){for(var t={lat:0,lng:0},i=0;i<e.length;++i){var n=e[i];if(n){for(var o={lat:0,lng:0},s=0;s<n.vertices.length;++s){var a=n.vertices[s];o.lat+=a.lat,o.lng+=a.lng}o.lat/=n.vertices.length,o.lng/=n.vertices.length,t.lat+=o.lat,t.lng+=o.lng}}return t.lat/=e.length,t.lng/=e.length,t},t.prototype.refreshAddresses=function(){var t=this,i=(this.isLoading=!0,this.neighborhoodPolys=[],this);this.$http.get("/api/Neighborhood/GetAll").then(function(e){i.isLoading=!1,i.neighborhoods=e.data,i.neighborhoodPolys=_.select(i.neighborhoods,function(e){return e.Bounds}),i.mapCenter=i.findCenter(t.neighborhoodPolys)},function(e){i.isLoading=!1,alert("Failed to retrieve neighborhoods: "+e.data.exceptionMessage)})},t.$inject=["$http","$q"],e.ViewPolysController=t}(Ally=Ally||{}),CA.angularApp.component("viewPolys",{templateUrl:"/ngApp/admin/view-polys.html",controller:Ally.ViewPolysController}),function(e){function t(e){this.$http=e,this.isLoading=!1}t.prototype.$onInit=function(){this.mapCenter={lat:41.99114,lng:-87.690425},this.refreshCells()},t.prototype.addLine=function(e,t,i,n,o){new google.maps.Polyline({path:[{lat:t,lng:i},{lat:n,lng:o}],geodesic:!1,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(e)},t.prototype.onBuildingSelected=function(e){},t.prototype.onCellSelected=function(t){t.gpsBounds.mapShapeObject.setOptions({fillOpacity:.1}),this.selectedCell&&this.selectedCell.gpsBounds.mapShapeObject.setOptions({fillOpacity:.35}),this.selectedCell=t,_.each(this.selectedCell.streets,function(e){0!=e.minLat&&this.addLine(t.gpsBounds.mapShapeObject.map,e.minLat,e.minLon,e.maxLat,e.maxLon)})},t.prototype.refreshCells=function(){this.isLoading=!0;var t=this;this.$http.get("/api/ResearchMap").then(function(e){t.isLoading=!1,t.cells=e.data,t.isLoading=!0,t.$http.get("/api/ResearchMap/Buildings").then(function(e){t.isLoading=!1,t.buildings=e.data,t.buildingPoints=_.map(t.buildings,function(e){var t=e.addressPos;return t.ownerBuilding=e,t.onClick=function(){},t})})},function(e){t.isLoading=!1,alert("Failed to retrieve cells: "+e.data.exceptionMessage)})},t.prototype.onAddressSelected=function(e){this.selectedAddress=e,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&e.gpsPos&&(new google.maps.LatLng(e.gpsPos.lat,e.gpsPos.lon),new google.maps.LatLng(e.gpsPos.lat+.001,e.gpsPos.lon+.001),e.gpsBounds.vertices=[{lat:e.gpsPos.lat,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon+.001},{lat:e.gpsPos.lat,lon:e.gpsPos.lon+.001}]),this.selectedGpsPoly=e.gpsBounds},t.$inject=["$http"],e.ViewResearchController=t}(Ally=Ally||{}),CA.angularApp.component("viewResearch",{templateUrl:"/ngApp/admin/view-research.html",controller:Ally.ViewResearchController});var OverrideBaseApiPath=null,OverrideOriginalUrl=null,StripeApiKey="pk_live_fV2yERkfAyzoO9oWSfORh5iH";function RoutePath(e,t,i,n,o){void 0===o&&(o=null),"/"!==e[0]&&(e="/"+e),this.path=e,this.templateUrl=t,this.controller=i,this.menuTitle=n,this.role=o||Role_Authorized,this.controllerAs="function"==typeof i?"vm":null}function RoutePath_v2(e){"/"!==e.path[0]&&(e.path="/"+e.path),this.path=e.path,this.templateUrl=e.templateUrl,this.templateHtml=e.templateHtml,this.controller=e.controller,this.menuTitle=e.menuTitle,this.role=e.role||Role_Authorized,this.controllerAs="function"==typeof e.controller?"vm":null}CA.angularApp.config(["$routeProvider","$httpProvider","$provide","SiteInfoProvider","$locationProvider",function(i,e,t,n,o){o.hashPrefix("!");for(var s={app:["$q","$http","$rootScope","$sce","$location","xdLocalStorage","appCacheService",function(s,e,t,i,a,n,r){return Ally.SiteInfoHelper.loginInit(s,e,t,i,n).then(function(e){return t=a,e=e,n=r,i=(i=s).defer(),o="/Home"===t.path()||"/Login"===t.path()||AppConfig.isPublicRoute(t.path()),e.userInfo||o?i.resolve():("/Home"===t.path()&&"/Login"===t.path()||(n.set(AppCacheService.Key_AfterLoginRedirect,t.path()),n.set(AppCacheService.Key_WasLoggedIn401,"true")),i.reject(),t.path("/Login")),i.promise;var t,i,n,o})}]},a={app:["$q","$http","$rootScope","$sce","xdLocalStorage",Ally.SiteInfoHelper.loginInit]},r=angular.extend({},i,{when:function(e,t){return t.resolve=t.resolve||{},t.allyRole===Role_All?angular.extend(t.resolve,a):angular.extend(t.resolve,s),i.when(e,t),this}}),l=0;l<AppConfig.menu.length;++l){var d=AppConfig.menu[l],c={controller:d.controller,allyRole:d.role,reloadOnSearch:d.reloadOnSearch};d.templateUrl?c.templateUrl=d.templateUrl:c.template=d.templateHtml,d.controllerAs&&(c.controllerAs=d.controllerAs),r.when(d.path,c)}i.otherwise({redirectTo:"/Home"}),t.factory("http403Interceptor",["$q","$location","$rootScope","appCacheService","$injector",function(s,a,r,l,d){return{response:function(e){return e},responseError:function(e){var t,i,n,o=e.status;if(401===o||403===o){if(403===o&&r.dontHandle403)return s.reject(e);if(403===o&&r.isLoggedIn&&l.set(AppCacheService.Key_WasLoggedIn403,"true"),401===o&&HtmlUtil.isValidString(window.localStorage.rememberMe_Email))return t=d.get("$http"),r.retryLoginDeffered||(r.retryLoginDeffered=s.defer(),i={emailAddress:window.localStorage.rememberMe_Email,password:atob(window.localStorage.rememberMe_Password)},setTimeout(function(){t.post("/api/Login",i).then(function(e){e=e.data;d.get("SiteInfo").setAuthToken(e.authToken),r.retryLoginDeffered.resolve()},function(){var e=r.retryLoginDeffered;r.onLogOut_ClearData(),e.reject()}).finally(function(){r.retryLoginDeffered=null})},1e3)),n=s.defer(),r.retryLoginDeffered.promise.then(function(){n.resolve(t(e.config))},function(){n.reject(e)}),n.promise;"/Home"!==a.path()&&"/Login"!==a.path()&&(l.set(AppCacheService.Key_AfterLoginRedirect,a.path()),l.set(AppCacheService.Key_WasLoggedIn401,"true")),r.onLogOut_ClearData()}return s.reject(e)}}}]),e.interceptors.push("http403Interceptor"),e.defaults.transformResponse.push(function(e){return Ally.HtmlUtil2.isString(e)&&30<e.length||Ally.HtmlUtil2.convertStringsToDates(e),e}),t.factory("apiUriInterceptor",["$rootScope","SiteInfo",function(o,s){return"string"!=typeof o.authToken&&window.localStorage&&(o.authToken=window.localStorage.getItem("ApiAuthToken")),{request:function(e){var t="https://0.webappapi.mycommunityally.org/api/",i="https://0.webappapi.communityally.org/api/",n=HtmlUtil.startsWith(e.url,t)||HtmlUtil.startsWith(e.url,i);return(HtmlUtil.startsWith(e.url,"/api/")||n)&&(HtmlUtil.startsWith(e.url,"http")?n&&!HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)&&(HtmlUtil.startsWith(e.url,t)?e.url=OverrideBaseApiPath+e.url.substr(t.length):HtmlUtil.startsWith(e.url,i)&&(e.url=OverrideBaseApiPath+e.url.substr(i.length))):HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)?s.publicSiteInfo.baseApiUrl&&(e.url=s.publicSiteInfo.baseApiUrl+e.url.substr("/api/".length)):e.url=OverrideBaseApiPath+e.url.substr("/api/".length),e.headers.Authorization="Bearer "+o.authToken,e.headers.ReferrerOverride=OverrideOriginalUrl||window.location.href),e}}}]),e.interceptors.push("apiUriInterceptor")}]),CA.angularApp.run(["$rootScope","$http","$sce","$location","$templateCache","$cacheFactory","xdLocalStorage",function(r,e,t,l,i,n,o){r.bgImagePath="/assets/images/Backgrounds/",r.appConfig=AppConfig,r.isLoggedIn=!1,r.publicSiteInfo={},r.shouldHideMenu=!1,r.isAdmin=!1,r.isSiteManager=!1,r.menuItems=_.where(AppConfig.menu,function(e){return!HtmlUtil.isNullOrWhitespace(e.menuTitle)}),r.mainMenuItems=_.where(r.menuItems,function(e){return e.role===Role_Authorized}),r.manageMenuItems=_.where(r.menuItems,function(e){return e.role===Role_Manager}),r.adminMenuItems=_.where(r.menuItems,function(e){return e.role===Role_Admin}),r.publicMenuItems=null,r.populatePublicPageMenu=function(){var e;r.publicMenuItems=null,r.publicSiteInfo&&r.publicSiteInfo.customPages&&0!=(e=r.publicSiteInfo.customPages).length&&(e.forEach(function(e){return e.path="/Page/"+e.pageSlug}),r.publicMenuItems=e)},HtmlUtil.isLocalStorageAllowed()&&window.localStorage&&(r.publicSiteInfo=angular.fromJson(window.localStorage.getItem("siteInfo")),r.authToken=window.localStorage.getItem("ApiAuthToken"),null!==r.publicSiteInfo&&void 0!==r.publicSiteInfo||(r.publicSiteInfo={}),r.populatePublicPageMenu()),o.init({iframeUrl:"https://www.communityally.org/xd-local-storage.html"}).then(function(){}),r.onLogOut_ClearData=function(){r.userInfo={},r.isLoggedIn=!1,r.isAdmin=!1,r.isSiteManager=!1,r.authToken="",window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null,o.removeItem("allyApiAuthToken"),n.get("$http").removeAll(),window.localStorage&&window.localStorage.removeItem("siteInfo"),l.path("/Login")},r.onLogOut=function(){e.get("/api/Login/Logout").then(r.onLogOut_ClearData,r.onLogOut_ClearData)},r.$on("$routeChangeStart",function(){CA.clearTemplateCacheIfNeeded&&CA.clearTemplateCacheIfNeeded(i)}),r.$on("$routeChangeSuccess",function(e,t,i,n){r.curPath=l.path();var o="",s=l.path(),a=(-1!==s.indexOf("?")&&(o=s.substring(s.indexOf("?"),s.length)),"");n&&n.name&&(a=l.protocol()+"://"+l.host()+"/#"+n.url),analytics.page({path:s,referrer:a,search:o,url:l.absUrl()})})}]),(Ally||(Ally={})).MenuItem_v3=function(){},function(e){function t(e){this.reloadOnSearch=!0,"/"!==e.path[0]&&(e.path="/"+e.path),this.path=e.path,this.templateHtml=e.templateHtml,this.menuTitle=e.menuTitle,this.role=e.role||Role_Authorized,this.reloadOnSearch=void 0!==e.reloadOnSearch&&e.reloadOnSearch}e.RouteOptions_v3=function(){};e.RoutePath_v3=t,n.dwollaPreviewShortNames=["qa","dwollademo","dwollademo1","900wainslie","elingtonvillagepoa"],n.dwollaEnvironmentName="prod";var i=n;function n(){}e.AppConfigInfo=i,e.PeriodicPaymentFrequency=function(){}}(Ally=Ally||{});var Role_Authorized="authorized",Role_All="all",Role_Manager="manager",Role_Admin="admin",PeriodicPaymentFrequencies=[{name:"Monthly",intervalName:"month",id:50,signUpNote:"Billed on the 1st of each month"},{name:"Quarterly",intervalName:"quarter",id:51,signUpNote:"Billed on January 1, April 1, July 1, October 1"},{name:"Semiannually",intervalName:"half-year",id:52,signUpNote:"Billed on January 1 and July 1"},{name:"Annually",intervalName:"year",id:53,signUpNote:"Billed on January 1"}];function FrequencyIdToInfo(e){return isNaN(e)||e<50?null:PeriodicPaymentFrequencies[e-50]}function GetLongPayPeriodNames(e){return"month"===e?["January","February","March","April","May","June","July","August","September","October","November","December"]:"quarter"===e?["Q1","Q2","Q3","Q4"]:"half-year"===e?["First Half","Second Half"]:null}function GetShortPayPeriodNames(e){return"month"===e?["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]:"quarter"===e?["Q1","Q2","Q3","Q4"]:"half-year"===e?["1st Half","2nd Half"]:null}var CondoAllyAppConfig={appShortName:"condo",appName:"Condo Ally",baseTld:"condoally.com",baseUrl:"https://condoally.com/",isChtnSite:!0,homeName:"Unit",memberTypeLabel:"Resident",menu:[new Ally.RoutePath_v3({path:"Home",templateHtml:"<chtn-home></chtn-home>",menuTitle:"Home"}),new Ally.RoutePath_v3({path:"Home/DiscussionThread/:discussionThreadId",templateHtml:"<chtn-home></chtn-home>"}),new Ally.RoutePath_v3({path:"Info/Docs",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info",reloadOnSearch:!1}),new Ally.RoutePath_v3({path:"Info/:viewName",templateHtml:"<association-info></association-info>"}),new Ally.RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",menuTitle:"Calendar"}),new Ally.RoutePath_v3({path:"Map",templateHtml:"<chtn-map></chtn-map>",menuTitle:"Map"}),new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Directory"}),new Ally.RoutePath_v3({path:"Committee/:committeeId/:viewName",templateHtml:"<committee-parent></committee-parent>"}),new Ally.RoutePath_v3({path:"Committee/:committeeId/Home/DiscussionThread/:discussionThreadId",templateHtml:"<committee-parent></committee-parent>"}),new Ally.RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"SignUp",templateHtml:"<condo-sign-up-wizard></condo-sign-up-wizard>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"EmailAbuse/:idValue",templateHtml:"<email-abuse></email-abuse>",role:Role_All}),new Ally.RoutePath_v3({path:"DiscussionManage/:idValue",templateHtml:"<discussion-manage></discussion-manage>"}),new Ally.RoutePath_v3({path:"NeighborSignUp",templateHtml:"<neighbor-sign-up></neighbor-sign-up>",role:Role_All}),new Ally.RoutePath_v3({path:"GroupRedirect/:appName/:shortName",templateHtml:"<group-redirect></group-redirect>",role:Role_All}),new Ally.RoutePath_v3({path:"MemberSignUp",templateHtml:"<pending-member-sign-up></pending-member-sign-up>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Page/:slug",templateHtml:"<custom-page-view></custom-page-view>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManageCommittees",templateHtml:"<manage-committees></manage-committees>",menuTitle:"Committees",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManagePolls",templateHtml:"<manage-polls></manage-polls>",menuTitle:"Polls",role:Role_Manager}),new Ally.RoutePath_v3({path:"Financials/OnlinePayments",templateHtml:"<financial-parent></financial-parent>",menuTitle:"Financials",role:Role_Manager}),new Ally.RoutePath_v3({path:"Mailing/Invoice",templateHtml:"<mailing-parent></mailing-parent>",menuTitle:"Mailing",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManageCustomPages",templateHtml:"<manage-custom-pages></manage-custom-pages>",menuTitle:"Custom Pages",role:Role_Manager}),new Ally.RoutePath_v3({path:"Mailing/:viewName",templateHtml:"<mailing-parent></mailing-parent>",role:Role_Manager}),new Ally.RoutePath_v3({path:"Settings/SiteSettings",templateHtml:"<settings-parent></settings-parent>",menuTitle:"Settings",role:Role_Manager}),new Ally.RoutePath_v3({path:"Settings/:viewName",templateHtml:"<settings-parent></settings-parent>",role:Role_Manager}),new Ally.RoutePath_v3({path:"Financials/:viewName",templateHtml:"<financial-parent></financial-parent>",role:Role_Manager}),new Ally.RoutePath_v3({path:"GroupAmenities",templateHtml:"<group-amenities></group-amenities>",role:Role_Manager}),new Ally.RoutePath_v3({path:"/Admin/ManageGroups",templateHtml:"<manage-groups></manage-groups>",menuTitle:"All Groups",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ManageHomes",templateHtml:"<manage-homes></manage-homes>",menuTitle:"Homes",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"Activity Log",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"View Groups on Map",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewPolys",templateHtml:"<view-polys></view-polys>",menuTitle:"View Polygons",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewResearch",templateHtml:"<view-research></view-research>",menuTitle:"View Research",role:Role_Admin})]},HomeAppConfig={appShortName:"home",appName:"Home Ally",baseTld:"homeally.org",baseUrl:"https://homeally.org/",isChtnSite:!1,homeName:"Home",memberTypeLabel:"User",menu:[new Ally.RoutePath_v3({path:"SignUp",templateHtml:"<home-sign-up></home-sign-up>",role:Role_All}),new Ally.RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"CPView/:slug",templateHtml:"<custom-page-view></custom-page-view>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new Ally.RoutePath_v3({path:"Home",templateHtml:"<home-group-home></home-group-home>",menuTitle:"Home"}),new Ally.RoutePath_v3({path:"Info/Docs",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info"}),new Ally.RoutePath_v3({path:"Info/:viewName",templateHtml:"<association-info></association-info>"}),new Ally.RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",menuTitle:"Calendar"}),new Ally.RoutePath_v3({path:"Users",templateHtml:"<home-users></home-users>",menuTitle:"Users",role:Role_Manager}),new Ally.RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin})]},HOAAppConfig=_.clone(CondoAllyAppConfig),NeighborhoodAppConfig=(HOAAppConfig.appShortName="hoa",HOAAppConfig.appName="HOA Ally",HOAAppConfig.baseTld="hoaally.org",HOAAppConfig.baseUrl="https://hoaally.org/",HOAAppConfig.homeName="Home",HOAAppConfig.menu.push(new Ally.RoutePath_v3({path:"HoaSignUp",templateHtml:"<hoa-sign-up-wizard></hoa-sign-up-wizard>",role:Role_All})),_.clone(CondoAllyAppConfig)),BlockClubAppConfig=(NeighborhoodAppConfig.appShortName="neighborhood",NeighborhoodAppConfig.appName="Neighborhood Ally",NeighborhoodAppConfig.baseTld="neighborhoodally.org",NeighborhoodAppConfig.baseUrl="https://neighborhoodally.org/",NeighborhoodAppConfig.homeName="Home",NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(e){return"Residents"===e.menuTitle||"Directory"===e.menuTitle}),NeighborhoodAppConfig.menu.push(new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"})),NeighborhoodAppConfig.menu.splice(0,0,new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Members",role:Role_Manager})),NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(e){return"Assessment History"===e.menuTitle}),NeighborhoodAppConfig.menu.splice(3,0,new Ally.RoutePath_v3({path:"DuesHistory",menuTitle:"Dues History",templateHtml:"<dues-history></dues-history>",role:Role_Manager})),NeighborhoodAppConfig.menu.push(new Ally.RoutePath_v3({path:"NeighborhoodSignUp",templateHtml:"<neighborhood-sign-up-wizard></neighborhood-sign-up-wizard>",role:Role_All})),_.clone(CondoAllyAppConfig)),PtaAppConfig=(BlockClubAppConfig.appShortName="block-club",BlockClubAppConfig.appName="Block Club Ally",BlockClubAppConfig.baseTld="blockclubally.org",BlockClubAppConfig.baseUrl="https://blockclubally.org/",BlockClubAppConfig.homeName="Home",BlockClubAppConfig.memberTypeLabel="Member",BlockClubAppConfig.menu=_.reject(BlockClubAppConfig.menu,function(e){return"Residents"===e.menuTitle||"Directory"===e.menuTitle}),BlockClubAppConfig.menu.push(new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"})),BlockClubAppConfig.menu.splice(0,0,new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Members",role:Role_Manager})),BlockClubAppConfig.menu=_.reject(BlockClubAppConfig.menu,function(e){return"Assessment History"===e.menuTitle}),BlockClubAppConfig.menu.splice(3,0,new Ally.RoutePath_v3({path:"AssessmentHistory",menuTitle:"Membership Dues History",templateHtml:"<assessment-history></assessment-history>",role:Role_Manager})),BlockClubAppConfig.menu.push(new Ally.RoutePath_v3({path:"NeighborhoodSignUp",templateHtml:"<neighborhood-sign-up-wizard></neighborhood-sign-up-wizard>",role:Role_All})),_.clone(CondoAllyAppConfig)),AppConfig=(PtaAppConfig.appShortName="pta",PtaAppConfig.appName="PTA Ally",PtaAppConfig.baseTld="ptaally.org",PtaAppConfig.baseUrl="https://ptaally.org/",PtaAppConfig.isChtnSite=!1,PtaAppConfig.homeName="Home",PtaAppConfig.memberTypeLabel="Member",PtaAppConfig.menu=[new Ally.RoutePath_v3({path:"Home",templateHtml:"<chtn-home></chtn-home>",menuTitle:"Home"}),new Ally.RoutePath_v3({path:"Info/Docs",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info"}),new Ally.RoutePath_v3({path:"Info/:viewName",templateHtml:"<association-info></association-info>"}),new Ally.RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",menuTitle:"Calendar"}),new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"}),new Ally.RoutePath_v3({path:"Committee/:committeeId/:viewName",templateHtml:"<committee-parent></committee-parent>"}),new Ally.RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"MemberSignUp",templateHtml:"<pending-member-sign-up></pending-member-sign-up>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Members",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManageCommittees",templateHtml:"<manage-committees></manage-committees>",menuTitle:"Committees",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManagePolls",templateHtml:"<manage-polls></manage-polls>",menuTitle:"Polls",role:Role_Manager}),new Ally.RoutePath_v3({path:"AssessmentHistory",templateHtml:"<assessment-history></assessment-history>",menuTitle:"Membership Dues History",role:Role_Manager}),new Ally.RoutePath_v3({path:"Settings",templateHtml:"<chtn-settings></chtn-settings>",menuTitle:"Settings",role:Role_Manager}),new Ally.RoutePath_v3({path:"/Admin/ManageGroups",templateHtml:"<manage-groups></manage-groups>",menuTitle:"All Groups",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"Activity Log",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"View Groups on Map",role:Role_Admin})],null),lowerDomain=document.domain.toLowerCase(),__extends=((lowerDomain=HtmlUtil.isNullOrWhitespace(OverrideOriginalUrl)&&"localhost"!==lowerDomain?lowerDomain:OverrideOriginalUrl)||console.log("Unable to find domain, make sure to set OverrideBaseApiPath and OverrideOriginalUrl at the top of ally-app.ts"),AppConfig=-1!==lowerDomain.indexOf("condo")?CondoAllyAppConfig:-1!==lowerDomain.indexOf("homeally")||-1!==lowerDomain.indexOf("helloathome")?HomeAppConfig:-1!==lowerDomain.indexOf("hoa")?HOAAppConfig:-1!==lowerDomain.indexOf("neighborhoodally")||-1!==lowerDomain.indexOf("helloneighborhood")?NeighborhoodAppConfig:-1!==lowerDomain.indexOf("chicagoblock")||-1!==lowerDomain.indexOf("blockclub")?BlockClubAppConfig:-1!==lowerDomain.indexOf("ptaally")?PtaAppConfig:(console.log("Unknown ally app"),CondoAllyAppConfig),(window.AppConfig=AppConfig).isPublicRoute=function(t){t=t||window.location.hash;var i=-1!==(t=HtmlUtil.startsWith(t,"#!")?t.substr(2):t).indexOf("/",1),e=(i&&(t=t.substr(0,t.indexOf("/",1))),_.find(AppConfig.menu,function(e){e=e.path;return!!e&&(e=i&&-1!==e.indexOf("/",1)?e.substr(0,e.indexOf("/",1)):e)===t}));return!!e&&e.role===Role_All},document.title=AppConfig.appName,$(document).ready(function(){$("header").css("background-image","url(/assets/images/header-img-"+AppConfig.appShortName+".jpg)")}),(Ally||(Ally={})).DuesHistoryController=function(){},CA.angularApp.component("duesHistory",{templateUrl:"/ngApp/chtn/manager/dues-history.html",controller:Ally.DuesHistoryController}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}()),__extends=(!function(t){__extends(n,e=function(){this.isEmptyEntry=!1});var e,i=n;function n(){return null!==e&&e.apply(this,arguments)||this}t.AssessmentPayment=i;var o=function(){};function p(e,t,i,n){this.$http=e,this.$location=t,this.siteInfo=i,this.appCacheService=n,this.LocalStorageKey_ShowPaymentInfo="AssessmentHistory_ShowPaymentInfo",this.LocalStorageKey_ShouldColorCodePayments="AssessmentHistory_ColorCodePayment",this.LocalStorageKey_ShowBalanceCol="AssessmentHistory_ShowBalanceCol",this.numPeriodsVisible=p.ChtnDefaultNumPeriodsVisible,this.shouldShowBalanceCol=!1,this.showRowType="unit",this.isForMemberGroup=!1,this.isSavingPayment=!1,this.shouldColorCodePayments=!1,this.shouldShowFillInSection=!1,this.selectedFillInPeriod=null,this.shouldShowNeedsAssessmentSetup=!1,this.hasAssessments=null}p.prototype.$onInit=function(){var e,t=this;this.baseApiUri=this.siteInfo.publicSiteInfo.baseApiUrl,this.isForMemberGroup="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"pta"===AppConfig.appShortName,this.isForMemberGroup?this.pageTitle="Membership Dues Payment History":this.pageTitle="Assessment Payment History",this.numPeriodsVisible=p.ChtnDefaultNumPeriodsVisible,this.isForMemberGroup&&(this.numPeriodsVisible=p.MemberDefaultNumPeriodsVisible),this.shouldShowBalanceCol&&--this.numPeriodsVisible,this.authToken=window.localStorage.getItem("ApiAuthToken"),this.isForMemberGroup?this.showRowType="member":AppConfig.isChtnSite?this.showRowType="unit":console.log("Unhandled app type for payment history: "+AppConfig.appShortName),this.showPaymentInfo="true"===window.localStorage[this.LocalStorageKey_ShowPaymentInfo],this.shouldColorCodePayments="true"===window.localStorage[this.LocalStorageKey_ShouldColorCodePayments],this.shouldShowBalanceCol="true"===window.localStorage[this.LocalStorageKey_ShowBalanceCol],this.siteInfo.privateSiteInfo.assessmentFrequency?(this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,this.isForMemberGroup&&(this.assessmentFrequency=p.PeriodicPaymentFrequency_Annually),this.payPeriodName="month",this.assessmentFrequency===p.PeriodicPaymentFrequency_Quarterly?this.payPeriodName="quarter":this.assessmentFrequency===p.PeriodicPaymentFrequency_Semiannually?this.payPeriodName="half-year":this.assessmentFrequency===p.PeriodicPaymentFrequency_Annually&&(this.payPeriodName="year"),this.maxPeriodRange=12,this.assessmentFrequency===p.PeriodicPaymentFrequency_Quarterly?this.maxPeriodRange=4:this.assessmentFrequency===p.PeriodicPaymentFrequency_Semiannually?this.maxPeriodRange=2:this.assessmentFrequency===p.PeriodicPaymentFrequency_Annually&&(this.maxPeriodRange=1),this.todaysPayPeriod=this.getTodaysPayPeriod(),e=FrequencyIdToInfo(this.assessmentFrequency),this.periodNames=GetLongPayPeriodNames(e.intervalName),this.shortPeriodNames=GetShortPayPeriodNames(e.intervalName),this.periodNames||(this.periodNames=[""],this.shortPeriodNames=[""]),this.startPeriodValue=(new Date).getMonth()+2,this.startYearValue=(new Date).getFullYear(),this.assessmentFrequency===p.PeriodicPaymentFrequency_Quarterly?this.startPeriodValue=Math.floor((new Date).getMonth()/4)+2:this.assessmentFrequency===p.PeriodicPaymentFrequency_Semiannually?this.startPeriodValue=Math.floor((new Date).getMonth()/6)+2:this.assessmentFrequency===p.PeriodicPaymentFrequency_Annually&&(this.startPeriodValue=1,this.startYearValue=(new Date).getFullYear()+1),this.startPeriodValue>this.maxPeriodRange&&(this.startPeriodValue=1,this.startYearValue+=1),this.isPeriodicPaymentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled,this.retrievePaymentHistory(),window.setTimeout(function(){return t.$http.get("/api/DocumentLink/0").then(function(e){return t.viewExportViewId=e.data.vid})},250),window.setTimeout(function(){return $('[data-toggle="tooltip"]').tooltip()},1e3)):(this.hasAssessments=this.siteInfo.privateSiteInfo.hasAssessments,this.shouldShowNeedsAssessmentSetup=!0)},p.prototype.getTodaysPayPeriod=function(){var e=(new Date).getMonth()+1,t=(new Date).getFullYear();return this.assessmentFrequency===p.PeriodicPaymentFrequency_Quarterly?e=Math.floor((new Date).getMonth()/4)+1:this.assessmentFrequency===p.PeriodicPaymentFrequency_Semiannually?e=Math.floor((new Date).getMonth()/6)+1:this.assessmentFrequency===p.PeriodicPaymentFrequency_Annually&&(e=1,t=(new Date).getFullYear()),{periodValue:e,yearValue:t}},p.prototype.onChangePeriodicPaymentTracking=function(){var e=this;this.isPeriodicPaymentTrackingEnabled!==this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.isPeriodicPaymentTrackingEnabled,this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled=this.isPeriodicPaymentTrackingEnabled,this.isLoading=!0,this.$http.put("/api/Association/updatePeriodicPaymentTracking?isPeriodicPaymentTrackingEnabled="+this.isPeriodicPaymentTrackingEnabled,null).then(function(){e.isLoading=!1},function(){alert("Failed to update the payment tracking"),e.isLoading=!1}))},p.prototype.populateVisiblePaymentsForUnit=function(i){for(var n=null!==i.owners&&0<i.owners.length?i.owners[0].userId:null,o=[],s=this,e=0;e<this.visiblePeriodEntries.length;++e)!function(e){var t=s.visiblePeriodEntries[e],e=void 0;void 0!==(e=t.specialAssessmentId?_.find(i.allPayments,function(e){return e.specialAssessmentId===t.specialAssessmentId}):_.find(i.allPayments,function(e){return e.period===t.periodValue&&e.year===t.year}))&&!e.isEmptyEntry||(e={paymentId:0,isPaid:!1,period:t.periodValue,year:t.year,amount:i.assessment,payerUserId:n,paymentDate:new Date,isEmptyEntry:!0,checkNumber:null,wePayCheckoutId:null,groupId:s.siteInfo.publicSiteInfo.groupId,notes:null,payerNotes:null,paymentsInfoId:null,wePayStatus:null,specialAssessmentId:t.specialAssessmentId,unitId:i.unitId}),o.push(e)}(e);return o},p.prototype.fillInEmptyPaymentsForMember=function(i){for(var n=[],o=this,e=0;e<this.visiblePeriodEntries.length;++e)!function(e){var t=o.visiblePeriodEntries[e],e=void 0;void 0!==(e=t.specialAssessmentId?_.find(i.enteredPayments,function(e){return e.specialAssessmentId===t.specialAssessmentId}):_.find(i.enteredPayments,function(e){return e.period===t.periodValue&&e.year===t.year}))&&!e.isEmptyEntry||(e={isPaid:!1,paymentId:null,period:t.periodValue,year:t.year,amount:0,payerUserId:i.userId,paymentDate:new Date,isEmptyEntry:!0,wePayCheckoutId:null,checkNumber:null,notes:null,payerNotes:null,wePayStatus:null,groupId:null,paymentsInfoId:null,specialAssessmentId:null}),n.push(e)}(e);return n},p.prototype.viewWePayDetails=function(e){this.appCacheService.set("hwpid",e),this.$location.path("/Financials/OnlinePayments")},p.prototype.viewOnlinePaymentDetails=function(e){this.appCacheService.set("onpayid",e.toString()),this.$location.path("/Financials/OnlinePayments")},p.prototype.onSaveSpecialAssessment=function(){var t=this;this.isLoading=!0,(this.editSpecialAssessment.specialAssessmentId?this.$http.put:this.$http.post)("/api/PaymentHistory/SpecialAssessment",this.editSpecialAssessment).then(function(){t.isLoading=!1,t.editSpecialAssessment=null,t.retrievePaymentHistory()},function(e){t.isLoading=!1;e=e.data.exceptionMessage||e.data;alert("Failed to save special assessment: "+e)})},p.prototype.showCreateSpecialAssessment=function(){this.editSpecialAssessment=new o,this.editSpecialAssessment.assessmentDate=new Date,setTimeout(function(){$("#specialAssessmentName").focus()},10)},p.prototype.browsePast=function(){for(this.startPeriodValue=this.startPeriodValue-6;this.startPeriodValue<1;)this.startPeriodValue=this.maxPeriodRange+this.startPeriodValue,--this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},p.prototype.browseFuture=function(){for(this.startPeriodValue=this.startPeriodValue+6;this.startPeriodValue>this.maxPeriodRange;)this.startPeriodValue-=this.maxPeriodRange,++this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},p.prototype.getSpecialAssessmentBetweenDates=function(t,i){var e,n;return this.specialAssessments&&0!==this.specialAssessments.length?(e=!1,i<t&&(n=i,i=t,t=n,e=!0),n=this.specialAssessments.filter(function(e){return e.assessmentDate.getTime()>t.getTime()&&e.assessmentDate.getTime()<i.getTime()}),e&&n.reverse(),n):null},p.prototype.periodToDate=function(e){var t=this.assessmentFrequency===p.PeriodicPaymentFrequency_Quarterly?3*e.periodValue:this.assessmentFrequency===p.PeriodicPaymentFrequency_Semiannually?6*e.periodValue:this.assessmentFrequency===p.PeriodicPaymentFrequency_Annually?0:e.periodValue-1;return new Date(e.year,t,1)},p.prototype.displayPaymentsForRange=function(e,t){for(var i=this,n=(this.startYearValue=e,this.startPeriodValue=t,this.visiblePeriodEntries=[],new h(this.startPeriodValue,this.startYearValue)),o=null,s=0;s<this.numPeriodsVisible;++s){if(n.periodValue<1&&(n.periodValue=this.maxPeriodRange,--n.year),o){var a=this.periodToDate(n),r=this.periodToDate(o),r=this.getSpecialAssessmentBetweenDates(r,a);if(r&&0<r.length)for(var l=0,d=r;l<d.length;l++){var c=d[l],c={name:c.assessmentName,periodValue:p.PeriodValueSpecial,arrayIndex:s++,year:c.assessmentDate.getFullYear(),isTodaysPeriod:!1,specialAssessmentId:c.specialAssessmentId};this.visiblePeriodEntries.push(c)}}a=this.shortPeriodNames[n.periodValue-1],r=(1!==n.periodValue&&n.periodValue!==this.maxPeriodRange||(a+=" "+n.year),{name:a=this.isForMemberGroup?n.year+" - "+(n.year+1):a,periodValue:n.periodValue,arrayIndex:s,year:n.year,isTodaysPeriod:n.year===this.todaysPayPeriod.yearValue&&n.periodValue===this.todaysPayPeriod.periodValue});this.visiblePeriodEntries.push(r),o=new h(n.periodValue,n.year),--n.periodValue}this.visiblePeriodEntries.length>this.numPeriodsVisible&&(this.visiblePeriodEntries=this.visiblePeriodEntries.slice(0,this.numPeriodsVisible)),this.isForMemberGroup?_.each(this.payers,function(e){return e.displayPayments=i.fillInEmptyPaymentsForMember(e)}):this.unitPayments.forEach(function(e){return e.displayPayments=i.populateVisiblePaymentsForUnit(e)})},p.prototype.retrievePaymentHistory=function(){var n=this;this.isLoading=!0,this.$http.get("/api/PaymentHistory?oldestDate=").then(function(e){var i=e.data,e=(n.specialAssessments=e.data.specialAssessments,n.shouldShowFillInSection=n.siteInfo.userInfo.isAdmin||i.payments.length<2&&3<i.units.length,n.unitPayments=new Map,_.each(i.units,function(e){n.unitPayments.set(e.unitId,e);var t=n.unitPayments.get(e.unitId);for(t.displayOwners=_.first(e.owners,2);t.displayOwners.length<2;)t.displayOwners.push({name:""});t.displayPayments=[]}),n.isForMemberGroup&&e.data.payers&&_.each(e.data.payers,function(t){t.enteredPayments=_.filter(i.payments,function(e){return e.payerUserId===t.userId})}),_.each(i.payments,function(e){n.unitPayments.has(e.unitId)&&n.unitPayments.get(e.unitId).displayPayments.push(e)}),_.each(i.units,function(e){e.displayPayments=_.sortBy(e.displayPayments,function(e){return 100*e.year+e.period}),e.displayPayments.reverse(),e.allPayments=e.displayPayments;var t=e.allPayments.find(function(e){return e.isPaid});t?(t=n.getNumMissedPayments(t),e.estBalance=(t=t<=0?0:t)*e.assessment):e.estBalance=void 0}),n.totalEstBalance=i.units.filter(function(e){return void 0!==e.estBalance&&!isNaN(e.estBalance)}).map(function(e){return e.estBalance||0}).reduce(function(e,t){return e+t},0),Array.from(n.unitPayments.values()));n.nameSortedUnitPayments=t.HtmlUtil2.smartSortStreetAddresses(e,"name"),n.payers=_.sortBy(i.payers,function(e){return e.name}),n.displayPaymentsForRange(n.startYearValue,n.startPeriodValue),n.isLoading=!1},function(e){n.isLoading=!1,alert("Failed to retrieve payment history: "+e.data.exceptionMessage)})},p.prototype.getNumMissedPayments=function(e){var t,i=this.getTodaysPayPeriod();return e.year===i.yearValue?i.periodValue-e.period:(t=(i.yearValue-e.year-1)*this.maxPeriodRange,e=this.maxPeriodRange-e.period,i.periodValue+t+e)},p.prototype.getPaymentSumForPayPeriod=function(e){var t=0;if(AppConfig.isChtnSite)for(var i=Array.from(this.unitPayments.keys()),n=0;n<i.length;++n){var o=i[n];(s=this.unitPayments.get(o).displayPayments[e])&&s.isPaid&&(t+=s.amount)}else for(var s,n=0;n<this.payers.length;++n)(s=this.payers[n].displayPayments[e])&&s.isPaid&&(t+=s.amount);return t},p.prototype.onshowPaymentInfo=function(){window.localStorage[this.LocalStorageKey_ShowPaymentInfo]=this.showPaymentInfo,window.localStorage[this.LocalStorageKey_ShouldColorCodePayments]=this.shouldColorCodePayments},p.prototype.onshowBalanceCol=function(){window.localStorage[this.LocalStorageKey_ShowBalanceCol]=this.shouldShowBalanceCol,this.isForMemberGroup?this.numPeriodsVisible=p.MemberDefaultNumPeriodsVisible:this.numPeriodsVisible=p.ChtnDefaultNumPeriodsVisible,this.shouldShowBalanceCol&&--this.numPeriodsVisible,this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},p.prototype.onUnitPaymentCellClick=function(e,t){t.unitId=e.unitId;var i,n="";t.specialAssessmentId?(i=this.specialAssessments.find(function(e){return e.specialAssessmentId===t.specialAssessmentId}))&&(n=i.assessmentName):n=this.periodNames[t.period-1],this.editPayment={unit:e,payment:_.clone(t),periodName:n,filteredPayers:_.filter(this.payers,function(t){return!_.some(e.owners,function(e){return e.userId===t.userId})})},setTimeout(function(){$("#paid-amount-textbox").focus()},10)},p.prototype.onMemberPaymentCellClick=function(e,t){t.payerUserId=e.userId,this.editPayment={unit:null,payment:_.clone(t),periodName:this.periodNames[t.period-1],filteredPayers:null},setTimeout(function(){$("#paid-amount-textbox").focus()},10)},p.prototype.onSavePayment=function(){function e(){i.isSavingPayment=!1,i.editPayment=null,i.retrievePaymentHistory()}function t(e){i.isSavingPayment=!1,alert(e.data.message),i.editPayment=null}var i=this;this.isSavingPayment=!0,(this.editPayment.payment.paymentId?(analytics.track("editAssessmentHistoryPayment"),this.$http.put("/api/PaymentHistory",this.editPayment.payment)):(analytics.track("addAssessmentHistoryPayment"),this.$http.post("/api/PaymentHistory",this.editPayment.payment))).then(e,t)},p.prototype.populatePaidForPeriod=function(){var n=this;if(this.selectedFillInPeriod){for(var o=Array.from(this.unitPayments.keys()),s=(this.isLoading=!0,0),a=this,e=0;e<o.length;++e)!function(e){var e=a.unitPayments.get(o[e]),t=_.find(e.displayPayments,function(e){return e.year===n.selectedFillInPeriod.year&&e.period===n.selectedFillInPeriod.periodValue});if(t&&t.isPaid)return;var i={Year:a.selectedFillInPeriod.year,Period:a.selectedFillInPeriod.periodValue,IsPaid:!0,Amount:e.assessment||0,PaymentDate:new Date,PayerUserId:a.siteInfo.userInfo.userId,Notes:"Auto-marking all entries for "+a.selectedFillInPeriod.name.trim(),unitId:e.unitId};++s,window.setTimeout(function(){return n.$http.post("/api/PaymentHistory",i)},350*s)}(e);window.setTimeout(function(){n.isLoading=!1,n.retrievePaymentHistory()},350*(s+1))}},p.prototype.onExportClick=function(e){var t=this;return window.setTimeout(function(){return t.$http.get("/api/DocumentLink/0").then(function(e){return t.viewExportViewId=e.data.vid})},500),analytics.track("exportAssessment"+e),!0},p.prototype.showBulkSet=function(){this.shouldShowFillInSection=!0,window.scrollTo(0,0)},p.prototype.onPeriodHeaderClick=function(t){t.specialAssessmentId&&(this.editSpecialAssessment=this.specialAssessments.find(function(e){return e.specialAssessmentId===t.specialAssessmentId}),setTimeout(function(){$("#specialAssessmentName").focus()},10))},p.prototype.onDeleteSpecialAssessment=function(){var t=this;this.editSpecialAssessment.specialAssessmentId?confirm("Are you sure you want to delete this special assessment entry? This will delete any associated payment entires and CANNOT BE UNDONE.")&&(this.isLoading=!0,this.$http.delete("/api/PaymentHistory/SpecialAssessment/"+this.editSpecialAssessment.specialAssessmentId).then(function(){t.isLoading=!1,t.editSpecialAssessment=null,t.retrievePaymentHistory()},function(e){t.isLoading=!1;e=e.data.exceptionMessage||e.data;alert("Failed to delete special assessment entry: "+e)})):this.editSpecialAssessment=null},p.$inject=["$http","$location","SiteInfo","appCacheService"],p.PeriodicPaymentFrequency_Monthly=50,p.PeriodicPaymentFrequency_Quarterly=51,p.PeriodicPaymentFrequency_Semiannually=52,p.PeriodicPaymentFrequency_Annually=53,p.PeriodValueSpecial=254,p.ChtnDefaultNumPeriodsVisible=9,p.MemberDefaultNumPeriodsVisible=8,t.AssessmentHistoryController=p;var h=function(e,t){this.periodValue=e,this.year=t}}(Ally=Ally||{}),CA.angularApp.component("assessmentHistory",{templateUrl:"/ngApp/chtn/manager/financial/assessment-history.html",controller:Ally.AssessmentHistoryController}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}()),__extends=(!function(d){function c(e,t,i,n){this.$http=e,this.appCacheService=t,this.uiGridConstants=i,this.$rootScope=n,this.isLoading=!1,this.financialCategoryMap=new Map,this.totalExpense=0,this.totalIncome=0,this.EditAmountTemplate="<div class='ui-grid-cell-contents'><span data-ng-if='row.entity.hasChildren'>{{row.entity.amount | currency}}</span><span data-ng-if='!row.entity.hasChildren'>$<input type='number' style='width: 85%;' data-ng-model='row.entity.amount' data-ng-change='grid.appScope.$ctrl.onAmountChange(row.entity)' /></span></div>"}c.prototype.$onInit=function(){var t=this;this.expenseGridOptions={columnDefs:[{field:"categoryTreeLabel",displayName:"Category",width:"*"},{field:"amount",displayName:"Amount",width:120,type:"number",cellFilter:"currency",cellTemplate:this.EditAmountTemplate}],enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1,enableRowHeaderSelection:!1,showTreeExpandNoChildren:!1,treeIndent:20,enableSorting:!1,enableTreeView:!0,showTreeRowHeader:!0,onRegisterApi:function(e){t.expenseGridApi=e,HtmlUtil.uiGridFixScroll(),t.expenseGridApi.treeBase.on.rowExpanded(t.$rootScope,function(e){})}},this.incomeGridOptions=_.clone(this.expenseGridOptions),this.incomeGridOptions.onRegisterApi=function(e){t.incomeGridApi=e,HtmlUtil.uiGridFixScroll()},this.refreshData()},c.prototype.refreshData=function(){var n=this;this.isLoading=!0,this.$http.get("/api/Budget/PageData").then(function(e){n.isLoading=!1,n.budgets=e.data.budgets,n.rootFinancialCategory=e.data.rootFinancialCategory,n.financialCategoryMap.clear();function i(e){if(n.financialCategoryMap.set(e.financialCategoryId,e),e.childCategories)for(var t=0;t<e.childCategories.length;++t)i(e.childCategories[t])}i(n.rootFinancialCategory)},function(e){n.isLoading=!1,alert("Failed to retrieve data, try refreshing the page. If the problem persists, contact support: "+e.data.exceptionMessage)})},c.prototype.onAmountChange=function(e){if(e)for(var t=e.parentRow;t;)t.amount=_.reduce(t.childRows,function(e,t){return e+t.amount},0),t=t.parentRow;e=_.find(this.curBudget.budgetRows,function(e){return!e.parentRow&&"Income"===e.category.displayName}),this.totalIncome=e.amount,e=this.curBudget.budgetRows.filter(function(e){return!e.parentRow&&"Income"!==e.category.displayName});this.totalExpense=_.reduce(e,function(e,t){return e+t.amount},0)},c.prototype.createBudget=function(){var l=this;this.curBudget=new t,this.curBudget.budgetName="Unnamed",this.curBudget.budgetRows=[];this.expenseGridOptions.columnDefs.find(function(e){return"amount"===e.field}).cellTemplate=this.EditAmountTemplate;var d=function(t,e,i){var n,o,s,a=null!=t.childCategories&&0<t.childCategories.length;if(i=0===e&&"Income"===t.displayName||i,t.displayName&&(s=c.catToTreePrefix(n=i?e-1:e),o=_.find(l.curBudget.budgetRows,function(e){return e.category.financialCategoryId===t.parentFinancialCategoryId}),s={financialCategoryId:t.financialCategoryId,categoryDisplayName:t.displayName,categoryTreeLabel:s+t.displayName,amount:0,$$treeLevel:n,hasChildren:a,category:t,parentRow:o,childRows:[],isIncomeRow:i,parentBudgetRowId:null},o&&s.parentRow.childRows.push(s),l.curBudget.budgetRows.push(s)),a)for(var r=0;r<t.childCategories.length;++r)d(t.childCategories[r],e+1,i)};d(this.rootFinancialCategory,-1,!1),this.refreshGridsFromCurBudget()},c.catToTreePrefix=function(e){return e<1?"":Array(4*(e-1)).join(String.fromCharCode(160))+"|--"},c.prototype.loadBudget=function(e){for(var o,s=this,a=function(e,t){return void 0===t&&(t=0),e&&e.parentFinancialCategoryId&&s.financialCategoryMap.has(e.parentFinancialCategoryId)?a(s.financialCategoryMap.get(e.parentFinancialCategoryId),t+1):t},t=this.expenseGridOptions.columnDefs.find(function(e){return"amount"===e.field}),i=(e.finalizedDateUtc?t.cellTemplate=null:t.cellTemplate=this.EditAmountTemplate,o=e.rows.map(function(e){var t=s.financialCategoryMap.has(e.financialCategoryId)?s.financialCategoryMap.get(e.financialCategoryId):void 0,i=a(t),n=c.catToTreePrefix(i);return{amount:e.amount,categoryDisplayName:e.categoryDisplayName,financialCategoryId:e.financialCategoryId,budgetId:e.budgetId,budgetRowId:e.budgetRowId,$$treeLevel:i,category:t,childRows:[],categoryTreeLabel:n+(t?t.displayName:e.categoryDisplayName),hasChildren:!1,isIncomeRow:!1,parentRow:null,parentBudgetRowId:e.parentBudgetRowId}}),0);i<o.length;++i)!function(e){var t,i=o[e],n=i.category;n?(i.hasChildren=n.childCategories&&0<n.childCategories.length,i.hasChildren&&(t=_.map(n.childCategories,function(e){return e.financialCategoryId}),i.childRows=o.filter(function(e){return 0<=t.indexOf(e.financialCategoryId)})),n.parentFinancialCategoryId&&(i.parentRow=_.find(o,function(e){return e.financialCategoryId===n.parentFinancialCategoryId}))):i.parentBudgetRowId&&(i.parentRow=_.find(o,function(e){return e.budgetRowId===i.parentBudgetRowId}),i.childRows=o.filter(function(e){return e.parentBudgetRowId===i.budgetRowId}))}(i);var n=this.rootFinancialCategory.childCategories.find(function(e){return"Income"===e.displayName}),t=o.find(function(e){return e.financialCategoryId===n.financialCategoryId}),r=function(e){e.isIncomeRow=!0,--e.$$treeLevel,e.categoryTreeLabel=c.catToTreePrefix(e.$$treeLevel)+e.categoryDisplayName,e.childRows&&e.childRows.forEach(function(e){return r(e)})};r(t),this.curBudget={budgetId:e.budgetId,budgetName:e.budgetName,budgetRows:o},this.refreshGridsFromCurBudget()},c.prototype.refreshGridsFromCurBudget=function(){var e=this,t=this.curBudget.budgetRows.filter(function(e){return 0<=e.$$treeLevel&&e.isIncomeRow}),t=(this.incomeGridOptions.data=t,this.incomeGridOptions.minRowsToShow=t.length,this.incomeGridOptions.virtualizationThreshold=t.length,this.curBudget.budgetRows.filter(function(e){return!e.isIncomeRow}));this.expenseGridOptions.data=t,this.expenseGridOptions.minRowsToShow=t.length,this.expenseGridOptions.virtualizationThreshold=t.length,window.setTimeout(function(){e.expenseGridApi.treeBase.expandAllRows(),e.incomeGridApi.treeBase.expandAllRows()},50),this.onAmountChange(null)},c.prototype.closeBudget=function(){this.curBudget=null,this.selectedBudget=null,this.incomeGridOptions.data=[],this.expenseGridOptions.data=[]},c.prototype.saveBudget=function(){this.curBudget.budgetId?this.saveExistingBudget():this.saveNewBudget()},c.prototype.saveExistingBudget=function(t){var i=this,e=(void 0===t&&(t=!0),this.isLoading=!0,{budgetId:this.curBudget.budgetId,budgetName:this.curBudget.budgetName,rows:_.map(this.curBudget.budgetRows,function(e){return{budgetRowId:e.budgetRowId,amount:e.amount,financialCategoryId:e.financialCategoryId}})});return this.$http.put("/api/Budget",e).then(function(e){i.isLoading=!1,t&&i.completeRefresh()},function(e){return i.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage),Promise.reject(null)})},c.prototype.saveNewBudget=function(){var t=this,e=(this.isLoading=!0,{budgetId:0,budgetName:this.curBudget.budgetName,rows:_.map(this.curBudget.budgetRows,function(e){return{budgetRowId:0,amount:e.amount,financialCategoryId:e.financialCategoryId}})});this.$http.post("/api/Budget",e).then(function(e){t.isLoading=!1,t.completeRefresh()},function(e){t.isLoading=!1,alert("Failed to retrieve data, try refreshing the page. If the problem persists, contact support: "+e.data.exceptionMessage)})},c.prototype.onBudgetSelected=function(){this.selectedBudget&&this.loadBudget(this.selectedBudget)},c.prototype.deleteBudget=function(){var t=this;confirm("Are you sure you want to deleted this budget?")&&(this.isLoading=!0,this.$http.delete("/api/Budget/"+this.curBudget.budgetId).then(function(e){t.isLoading=!1,t.completeRefresh()},function(e){t.isLoading=!1,alert("Failed to delete, try refreshing the page. If the problem persists, contact support: "+e.data.exceptionMessage)}))},c.prototype.completeRefresh=function(){this.curBudget=null,this.selectedBudget=null,this.incomeGridOptions.data=[],this.expenseGridOptions.data=[],this.refreshData()},c.prototype.finalizeBudget=function(){var t=this;confirm("This makes the budget permanently read-only. Are you sure you want to finalize the budget?")&&(this.isLoading=!0,this.saveExistingBudget(!1).then(function(){t.$http.put("/api/Budget/Finalize/"+t.curBudget.budgetId,null).then(function(e){t.isLoading=!1,t.curBudget=null,t.selectedBudget=null,t.incomeGridOptions.data=[],t.expenseGridOptions.data=[],t.completeRefresh()},function(e){t.isLoading=!1,alert("Failed to finalize, try refreshing the page. If the problem persists, contact support: "+e.data.exceptionMessage)})},function(e){t.isLoading=!1}))},c.prototype.exportToCsv=function(){for(var e=this.expenseGridOptions.data,t=this.incomeGridOptions.data,i=Math.max(e.length,t.length),n=[],o=(n.push(new p("Budget:",this.curBudget.budgetName)),n.push(new p),n.push(new p("Expenses","","","Income")),function(e){return e.parentRow?o(e.parentRow)+"/"+e.categoryDisplayName:e.categoryDisplayName}),s=0;s<i;++s){var a=new p;s<e.length&&(a.col0=o(e[s]),a.col1=(e[s].amount||0).toString()),s<t.length&&(a.col3=o(t[s]),a.col3.startsWith("Income/")&&(a.col3=a.col3.substring("Income/".length)),a.col4=(t[s].amount||0).toString()),n.push(a)}n.push(new p("Expense Total",this.totalExpense.toString(),"","Income Total",this.totalIncome.toString())),n.push(new p),n.push(new p("","Net",(this.totalIncome-this.totalExpense).toString()));var r=d.createCsvString(n,[{headerText:"",fieldName:"col0"},{headerText:"",fieldName:"col1"},{headerText:"",fieldName:"col2"},{headerText:"",fieldName:"col3"},{headerText:"",fieldName:"col4"}],!1),l="budget-"+d.HtmlUtil2.removeNonAlphanumeric(this.curBudget.budgetName)+".csv";d.HtmlUtil2.downloadCsv(r,l)},c.$inject=["$http","appCacheService","uiGridConstants","$rootScope"],d.BudgetToolController=c;var e,p=function(e,t,i,n,o){void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=""),void 0===o&&(o=""),this.col0=e=void 0===e?"":e,this.col1=t,this.col2=i,this.col3=n,this.col4=o},t=function(){};__extends(i,e=function(){});function i(){return null!==e&&e.apply(this,arguments)||this}}(Ally=Ally||{}),CA.angularApp.component("budgetTool",{bindings:{},templateUrl:"/ngApp/chtn/manager/financial/budget-tool.html",controller:Ally.BudgetToolController}),!function(e){function t(e,t,i,n){this.$http=e,this.siteInfo=t,this.appCacheService=i,this.$rootScope=n,this.isLoading=!1,this.selectedCategory=null,this.newCategoryParent=null,this.deleteCategoryRessignTo=null,this.shouldShowNewCategoryArea=!1,this.shouldShowDeleteCategoryArea=!1,this.didMakeChanges=!1,this.preselectById=null}t.prototype.$onInit=function(){this.refresh()},t.prototype.refresh=function(){var s=this;this.isLoading=!0,this.$http.get("/api/Ledger/FinancialCategories").then(function(e){s.isLoading=!1,s.rootFinancialCategory=e.data,s.flatCategoryList=[];function o(e,t){var i;if(e.displayName&&(i="",1<t&&(i=Array(4*(t-2)).join(String.fromCharCode(160))+"|--"),e.dropDownLabel=i+e.displayName,s.flatCategoryList.push(e)),null!=e.childCategories&&0!=e.childCategories.length)for(var n=0;n<e.childCategories.length;++n)o(e.childCategories[n],t+1)}o(s.rootFinancialCategory,0),s.selectedCategory=s.flatCategoryList[0],s.preselectById&&((e=s.flatCategoryList.filter(function(e){return e.financialCategoryId===s.preselectById}))&&0<e.length&&(s.selectedCategory=e[0]),s.preselectById=null),s.onCategorySelected()},function(e){s.isLoading=!1,alert("Failed to retrieve data, try refreshing the page. If the problem persists, contact support: "+e.data.exceptionMessage)})},t.prototype.onCategorySelected=function(){this.editName=this.selectedCategory?this.selectedCategory.displayName:""},t.prototype.closeManager=function(){this.onClosed({didMakeChanges:this.didMakeChanges})},t.prototype.showNewCategoryArea=function(){this.shouldShowNewCategoryArea=!0,this.shouldShowDeleteCategoryArea=!1,this.newName="",this.newCategoryParent=null},t.prototype.updateCategoryName=function(){var e,t=this;this.editName?(this.isLoading=!0,e="/api/Ledger/FinancialCategory/UpdateName/"+this.selectedCategory.financialCategoryId+"?newName="+encodeURIComponent(this.editName),this.$http.put(e,null).then(function(e){t.isLoading=!1,t.didMakeChanges=!0,t.shouldShowNewCategoryArea=!1,t.newName="",t.preselectById=t.selectedCategory.financialCategoryId,t.refresh()},function(e){t.isLoading=!1,alert("Failed to update: "+e.data.exceptionMessage)})):alert("Please enter a name")},t.prototype.saveNewCategory=function(){var e,t=this;this.newName?(this.isLoading=!0,e="/api/Ledger/FinancialCategory/Add?name="+encodeURIComponent(this.newName),this.newCategoryParent&&(e+="&parentCategoryId="+this.newCategoryParent.financialCategoryId),this.$http.post(e,null).then(function(e){t.isLoading=!1,t.didMakeChanges=!0,t.preselectById=e.data,t.shouldShowNewCategoryArea=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})):alert("Please enter a name")},t.prototype.deleteCategory=function(){var e,t=this;"Income"===this.selectedCategory.displayName?alert("You cannot delete the income category"):(this.isLoading=!0,e="/api/Ledger/FinancialCategory/"+this.selectedCategory.financialCategoryId,this.deleteCategoryRessignTo&&(e+="?reassignToCategoryId="+this.deleteCategoryRessignTo.financialCategoryId),this.$http.delete(e).then(function(e){t.isLoading=!1,t.didMakeChanges=!0,t.shouldShowDeleteCategoryArea=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)}))},t.$inject=["$http","SiteInfo","appCacheService","$rootScope"],e.FinancialCategoryManagerController=t}(Ally=Ally||{}),CA.angularApp.component("financialCategoryManager",{bindings:{onClosed:"&"},templateUrl:"/ngApp/chtn/manager/financial/financial-category-manager.html",controller:Ally.FinancialCategoryManagerController}),!function(e){function t(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.$cacheFactory=n,this.$rootScope=o,this.selectedView=null,this.isLoading=!1}t.prototype.$onInit=function(){HtmlUtil.isValidString(this.$routeParams.viewName)?this.selectedView=this.$routeParams.viewName:this.selectedView="OnlinePayments"},t.$inject=["$http","SiteInfo","$routeParams","$cacheFactory","$rootScope"],e.FinancialParentController=t}(Ally=Ally||{}),CA.angularApp.component("financialParent",{templateUrl:"/ngApp/chtn/manager/financial/financial-parent.html",controller:Ally.FinancialParentController}),!function(e){function t(e,t,i,n){this.$http=e,this.siteInfo=t,this.appCacheService=i,this.$location=n,this.isLoading=!1,this.incomeByCategoryData=null,this.incomeByCategoryLabels=null,this.incomeByCategoryCatIds=null,this.expenseByCategoryData=null,this.expenseByCategoryLabels=null,this.expenseByCategoryCatIds=null}t.prototype.$onInit=function(){window.sessionStorage.getItem("financialReport_startDate")&&(this.startDate=new Date(parseInt(window.sessionStorage.getItem("financialReport_startDate")))),this.startDate&&!isNaN(this.startDate.getTime())||(this.startDate=moment().subtract(1,"year").toDate()),window.sessionStorage.getItem("financialReport_endDate")&&(this.endDate=new Date(parseInt(window.sessionStorage.getItem("financialReport_endDate")))),this.endDate&&!isNaN(this.endDate.getTime())||(this.endDate=moment().toDate());var n=this;this.doughnutChartOptions={onClick:function(e){var t,i=this.getElementAtEvent(e);i.length&&(i=i[0],t=void 0,t=("expense-category-chart"===e.target.id?n.expenseByCategoryCatIds:(console.log("Clicked on income category: "+n.incomeByCategoryLabels[i._index]),n.incomeByCategoryCatIds))[i._index],n.appCacheService.set("ledger_preselect_start",n.startDate.getTime().toString()),n.appCacheService.set("ledger_preselect_end",n.endDate.getTime().toString()),n.appCacheService.set("ledger_preselect_categoryId",t.toString()),window.location.href="/#!/Financials/BankTransactions")}},this.refreshData()},t.prototype.refreshData=function(){var t=this;this.isLoading=!0,this.$http.get("/api/FinancialReports/ChartData?startDate="+encodeURIComponent(this.startDate.toISOString())+"&endDate="+encodeURIComponent(this.endDate.toISOString())).then(function(e){t.isLoading=!1,t.reportData=e.data,t.reportData.incomeByCategory=_.sortBy(t.reportData.incomeByCategory,function(e){return e.amount}),t.incomeByCategoryData=_.map(t.reportData.incomeByCategory,function(e){return Math.abs(e.amount)}),t.incomeByCategoryLabels=_.map(t.reportData.incomeByCategory,function(e){return e.parentFinancialCategoryName}),t.incomeByCategoryCatIds=_.map(t.reportData.incomeByCategory,function(e){return e.parentFinancialCategoryId}),t.reportData.expenseByCategory=_.sortBy(t.reportData.expenseByCategory,function(e){return e.amount}),t.expenseByCategoryData=_.map(t.reportData.expenseByCategory,function(e){return Math.abs(e.amount)}),t.expenseByCategoryLabels=_.map(t.reportData.expenseByCategory,function(e){return e.parentFinancialCategoryName}),t.expenseByCategoryCatIds=_.map(t.reportData.expenseByCategory,function(e){return e.parentFinancialCategoryId}),window.sessionStorage.setItem("financialReport_startDate",t.startDate.getTime().toString()),window.sessionStorage.setItem("financialReport_endDate",t.endDate.getTime().toString())},function(e){t.isLoading=!1,alert("Failed to retrieve report data: "+e.data.exceptionMessage)})},t.prototype.onByCategoryClickChart=function(e,t){var i;e&&0!==e.length&&(i="expense-category-chart"===e[0]._chart.canvas.id,console.log("Clicked",i,e[0],t),i?console.log("Clicked on expense category: "+this.expenseByCategoryLabels[e[0]._index]):console.log("Clicked on income category: "+this.incomeByCategoryLabels[e[0]._index]))},t.$inject=["$http","SiteInfo","appCacheService","$location"],e.FinancialReportsController=t}(Ally=Ally||{}),CA.angularApp.component("financialReports",{templateUrl:"/ngApp/chtn/manager/financial/financial-reports.html",controller:Ally.FinancialReportsController}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}()),PaymentBasicInfoUnitAssessment=(!function(t){function e(e,t,i,n,o,s){this.$http=e,this.siteInfo=t,this.appCacheService=i,this.uiGridConstants=n,this.$rootScope=o,this.$timeout=s,this.isLoading=!1,this.isLoadingEntries=!1,this.shouldExpandPending=!1,this.ledgerAccounts=[],this.accountsNeedingLogin=[],this.shouldShowAddTransaction=!1,this.editAccount=null,this.editingTransaction=null,this.createAccountInfo=null,this.HistoryPageSize=50,this.plaidHandler=null,this.newPlaidAccounts=[],this.hasPlaidAccounts=!1,this.filter=new a,this.isPremiumPlanActive=!1,this.ManageCategoriesDropId=-15,this.shouldShowCategoryEditModal=!1,this.spendingChartData=null,this.spendingChartLabels=null,this.showDonut=!0,this.isSuperAdmin=!1,this.shouldShowImportModal=!1,this.shouldShowOwnerFinanceTxn=!1}e.prototype.$onInit=function(){var o=this,t=(this.isPremiumPlanActive=this.siteInfo.privateSiteInfo.isPremiumPlanActive,this.isSuperAdmin=this.siteInfo.userInfo.isAdmin,this.homeName=AppConfig.homeName||"Unit",this.shouldShowOwnerFinanceTxn=this.siteInfo.privateSiteInfo.shouldShowOwnerFinanceTxn,this.ledgerGridOptions={columnDefs:[{field:"transactionDate",displayName:"Date",width:70,type:"date",cellFilter:"date:'shortDate'",enableFiltering:!1},{field:"accountName",filter:{type:this.uiGridConstants.filter.SELECT,selectOptions:[]},displayName:"Account",enableCellEdit:!1,width:140,enableFiltering:!0},{field:"description",displayName:"Description",enableCellEditOnFocus:!0,enableFiltering:!0,filter:{placeholder:"search"}},{field:"categoryDisplayName",editModelField:"financialCategoryId",displayName:"Category",width:170,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownOptionsArray:[],enableFiltering:!0},{field:"unitGridLabel",editModelField:"associatedUnitId",displayName:this.homeName,width:120,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownOptionsArray:[],enableFiltering:!0},{field:"amount",displayName:"Amount",width:140,type:"number",cellFilter:"currency",enableFiltering:!0,aggregationType:function(){var e=o.ledgerGridApi.grid.rows.filter(function(e){return e.visible&&e.entity&&!isNaN(e.entity.amount)}),t=0;return e.forEach(function(e){return t+=e.entity.amount||0}),t},footerCellTemplate:'<div class="ui-grid-cell-contents">Total: {{col.getAggregationValue() | currency }}</div>'},{field:"id",displayName:"Actions",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,width:90,cellTemplate:'<div class="ui-grid-cell-contents text-center"><img style="cursor: pointer;" data-ng-click="grid.appScope.$ctrl.editEntry( row.entity )" src="/assets/images/pencil-active.png" /><span class="close-x mt-0 mb-0 ml-3" data-ng-click="grid.appScope.$ctrl.deleteEntry( row.entity )" style="color: red;">&times;</span></div>'}],enableFiltering:!0,enableSorting:!0,showColumnFooter:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1,enablePaginationControls:!0,paginationPageSize:this.HistoryPageSize,paginationPageSizes:[this.HistoryPageSize],enableRowHeaderSelection:!1,onRegisterApi:function(e){o.ledgerGridApi=e,HtmlUtil.uiGridFixScroll(),e.edit.on.afterCellEdit(o.$rootScope,function(t,e,i,n){console.log("edited row amount:"+t.amount+" Column",e," newValue:"+i+" oldValue:"+n),n!==i&&("categoryDisplayName"===e.field&&t.financialCategoryId===o.ManageCategoriesDropId?(t.financialCategoryId=n,o.shouldShowCategoryEditModal=!0):(i=o.flatCategoryList.find(function(e){return e.financialCategoryId===t.financialCategoryId}),t.categoryDisplayName=i?i.displayName:null,e=o.unitListEntries.find(function(e){return e.unitId===t.associatedUnitId}),t.unitGridLabel=e?e.unitWithOwnerLast:null,o.$http.put("/api/Ledger/UpdateEntry",t).then(function(){return o.regenerateDateDonutChart()})))})}},this.pendingGridOptions={columnDefs:[{field:"transactionDate",displayName:"Date",width:70,type:"date",cellFilter:"date:'shortDate'",enableFiltering:!1},{field:"accountName",filter:{type:this.uiGridConstants.filter.SELECT,selectOptions:[]},displayName:"Account",enableCellEdit:!1,width:140,enableFiltering:!0},{field:"description",displayName:"Description",enableCellEditOnFocus:!0,enableFiltering:!0,filter:{placeholder:"search"}},{field:"amount",displayName:"Amount",width:140,type:"number",cellFilter:"currency",enableFiltering:!0,aggregationType:this.uiGridConstants.aggregationTypes.sum,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total: {{col.getAggregationValue() | currency }}</div>'}],enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1,enablePaginationControls:!1,enableRowHeaderSelection:!1},this.previewImportGridOptions={columnDefs:[{field:"transactionDate",displayName:"Date",width:70,type:"date",cellFilter:"date:'shortDate'",enableFiltering:!1},{field:"description",displayName:"Description",enableCellEditOnFocus:!0,enableFiltering:!0,filter:{placeholder:"search"}},{field:"categoryDisplayName",editModelField:"financialCategoryId",displayName:"Category",width:170,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownOptionsArray:[],enableFiltering:!0},{field:"unitGridLabel",editModelField:"associatedUnitId",displayName:this.homeName,width:120,editableCellTemplate:"ui-grid/dropdownEditor",editDropdownOptionsArray:[],enableFiltering:!0},{field:"amount",displayName:"Amount",width:140,type:"number",cellFilter:"currency",enableFiltering:!0,aggregationType:this.uiGridConstants.aggregationTypes.sum,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total: {{col.getAggregationValue() | currency }}</div>'},{field:"id",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,width:40,cellTemplate:'<div class="ui-grid-cell-contents text-center"><span class="close-x mt-0 mb-0 ml-3" data-ng-click="grid.appScope.$ctrl.removeImportRow( row.entity )" style="color: red;">&times;</span></div>'}],enableSorting:!0,showColumnFooter:!1,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1},parseInt(this.appCacheService.getAndClear("ledger_preselect_start")));isNaN(t)?(this.filter.startDate=moment().subtract(30,"days").toDate(),this.filter.endDate=moment().toDate(),this.fullRefresh()):window.setTimeout(function(){o.filter.startDate=new Date(t);var e=parseInt(o.appCacheService.getAndClear("ledger_preselect_end"));o.filter.endDate=new Date(e),o.preselectCategoryId=parseInt(o.appCacheService.getAndClear("ledger_preselect_categoryId")),isNaN(o.preselectCategoryId)&&(o.preselectCategoryId=void 0),o.fullRefresh()},100),this.$timeout(function(){return o.loadImportHistory()},1500),this.$http.get("/api/Ledger/OwnerTxNote").then(function(e){return o.ownerFinanceTxNote=e.data.ownerFinanceTxNote},function(e){return console.log("Failed to load owner tx note: "+e.data.exceptionMessage)})},e.prototype.fullRefresh=function(){var r=this,e=(this.isLoading=!0,"/api/Ledger/PageInfo?startDate="+encodeURIComponent(this.filter.startDate.toISOString())+"&endDate="+encodeURIComponent(this.filter.endDate.toISOString()));3<this.filter.description.length&&(e+="&descriptionSearch="+encodeURIComponent(this.filter.description)),this.$http.get(e).then(function(e){r.isLoading=!1;for(var e=e.data,t=(r.ledgerAccounts=e.accounts,_.forEach(r.ledgerAccounts,function(e){return e.shouldShowInGrid=!0}),r.ledgerGridOptions.columnDefs.find(function(e){return"accountName"===e.field})),i=(t&&(t.visible=1<r.ledgerAccounts.length),r.ledgerAccounts.filter(function(e){return e.plaidNeedsRelogin})),n=(r.accountsNeedingLogin=[],0);n<i.length;++n)!function(t){r.accountsNeedingLogin.find(function(e){return e.plaidItemId===i[t].plaidItemId})||r.accountsNeedingLogin.push(i[t])}(n);t.filter.selectOptions=r.ledgerAccounts.map(function(e){return{value:e.accountName,label:e.accountName}}),r.hasPlaidAccounts=_.any(r.ledgerAccounts,function(e){return"plaid"===e.syncType}),r.allEntries=e.entries,r.pendingGridOptions.data=e.pendingEntries,r.flatCategoryList=[];function o(e,t){var i;if(e.displayName&&(i="",1<t&&(i=Array(4*(t-2)).join(String.fromCharCode(160))+"|--"),e.dropDownLabel=i+e.displayName,r.flatCategoryList.push(e)),null!=e.childCategories&&0!=e.childCategories.length)for(var n=0;n<e.childCategories.length;++n)o(e.childCategories[n],t+1)}o(e.rootFinancialCategory,0),r.updateLocalData();var s=[];s.push({id:null,value:""});for(n=0;n<r.flatCategoryList.length;++n)s.push({id:r.flatCategoryList[n].financialCategoryId,value:r.flatCategoryList[n].dropDownLabel});s.push({id:r.ManageCategoriesDropId,value:"Manage Categories..."});r.ledgerGridOptions.columnDefs.find(function(e){return"categoryDisplayName"===e.field}).editDropdownOptionsArray=s,r.preselectCategoryId&&window.setTimeout(function(){var e=r.flatCategoryList.filter(function(e){return e.financialCategoryId===r.preselectCategoryId})[0];r.preselectCategoryId=void 0,r.ledgerGridApi.grid.columns.filter(function(e){return"Category"===e.displayName})[0].filters[0]={term:e.displayName}},100),r.unitListEntries=e.unitListEntries;var a=[];a.push({id:null,value:""});for(n=0;n<r.unitListEntries.length;++n)a.push({id:r.unitListEntries[n].unitId,value:r.unitListEntries[n].unitWithOwnerLast});r.ledgerGridOptions.columnDefs.find(function(e){return"unitGridLabel"===e.field}).editDropdownOptionsArray=a,r.populateGridUnitLabels()},function(e){r.isLoading=!1,alert("Failed to retrieve data, try refreshing the page. If the problem persists, contact support: "+e.data.exceptionMessage)})},e.prototype.populateGridUnitLabels=function(){var i=this;_.each(this.allEntries,function(t){var e;t.isSplit&&(t.categoryDisplayName="(split)"),t.associatedUnitId&&(e=i.unitListEntries.find(function(e){return e.unitId===t.associatedUnitId}),t.unitGridLabel=e?e.unitWithOwnerLast:"UNK")})},e.prototype.refreshEntries=function(){var t=this,e=(this.isLoadingEntries=!0,"/api/Ledger/PageInfo?startDate="+encodeURIComponent(this.filter.startDate.toISOString())+"&endDate="+encodeURIComponent(this.filter.endDate.toISOString()));3<this.filter.description.length&&(e+="&descriptionSearch="+encodeURIComponent(this.filter.description)),this.$http.get(e).then(function(e){t.isLoadingEntries=!1,t.allEntries=e.data.entries,t.updateLocalData(),t.populateGridUnitLabels()})},e.prototype.updateLocalData=function(){var t=this.ledgerAccounts.filter(function(e){return e.shouldShowInGrid}).map(function(e){return e.ledgerAccountId}),e=this.allEntries.filter(function(e){return-1<t.indexOf(e.ledgerAccountId)});this.ledgerGridOptions.data=e,this.ledgerGridOptions.enablePaginationControls=e.length>this.HistoryPageSize,this.ledgerGridOptions.minRowsToShow=Math.min(e.length,this.HistoryPageSize),this.ledgerGridOptions.virtualizationThreshold=this.ledgerGridOptions.minRowsToShow,this.regenerateDateDonutChart()},e.prototype.regenerateDateDonutChart=function(){var i=this;if(this.spendingChartData=null,0!==this.allEntries.length){for(var n=function(t){var e=i.flatCategoryList.filter(function(e){return e.financialCategoryId===t});return e&&0<e.length?e[0].parentFinancialCategoryId?n(e[0].parentFinancialCategoryId):e[0].financialCategoryId:0},e=[],t=0;t<this.allEntries.length;++t)if(this.allEntries[t].isSplit)for(var o=0,s=this.allEntries[t].splitEntries;o<s.length;o++){var a=s[o];e.push(a)}else e.push(this.allEntries[t]);for(var r=_.groupBy(e,function(e){return n(e.financialCategoryId)}),l=[],d=_.keys(r),c=this,t=0;t<d.length;++t)!function(e){for(var t=+d[e],i=r[t],e=c.flatCategoryList.filter(function(e){return e.financialCategoryId===t}),n=null,o=(e&&0<e.length&&(n=e[0]),0),s=0;s<i.length;++s)o+=i[s].amount;e={parentCategoryId:t,parentCategoryDisplayName:n?n.displayName:"Uncategorized",sumTotal:Math.abs(o),numLedgerEntries:i.length};l.push(e)}(t);l=_.sortBy(l,function(e){return e.sumTotal}).reverse(),this.spendingChartData=[],this.spendingChartLabels=[];for(t=0;t<l.length;++t)this.spendingChartData.push(l[t].sumTotal),this.spendingChartLabels.push(l[t].parentCategoryDisplayName);this.showDonut=!1,this.$timeout(function(){return i.showDonut=!0},100)}},e.prototype.onAddTransaction=function(){0===this.ledgerAccounts.length?alert("Please add at least one account first"):(this.editingTransaction=new o,this.editingTransaction.ledgerAccountId=this.ledgerAccounts[0].ledgerAccountId,this.editingTransaction.transactionDate=new Date,window.setTimeout(function(){return document.getElementById("transaction-amount-input").focus()},50))},e.prototype.completePlaidSync=function(e,t,i){var n=this,e=(this.isLoading=!0,this.plaidSuccessProgressMsg="Contacting Plaid server for selected account information",{accessToken:e,updatePlaidItemId:t,selectedAccountIds:i});this.$http.post(t?"/api/Plaid/UpdateAccessToken":"/api/Plaid/ProcessNewAccessToken",e).then(function(e){n.isLoading=!1,n.plaidSuccessProgressMsg="Account information successfully retrieved",n.newPlaidAccounts=e.data,t&&window.location.reload()},function(e){n.isLoading=!1,n.plaidSuccessProgressMsg="Failed to retrieve account information from Plaid: "+e.data.exceptionMessage,alert("Failed to link: "+e.data.exceptionMessage)})},e.prototype.showAddAccount=function(){this.createAccountInfo=new n,this.createAccountInfo.type=null},e.prototype.updateAccountLink=function(i){var n=this;this.isPremiumPlanActive&&(this.isLoading=!0,this.$http.get("/api/Plaid/UpdateLinkToken/"+i.plaidItemId).then(function(e){n.isLoading=!1;e=e.data;e?(n.plaidHandler=Plaid.create({token:e,onSuccess:function(e,t){console.log("Plaid update onSuccess"),n.completePlaidSync(e,i.plaidItemId,null)},onLoad:function(){},onExit:function(e,t){console.log("onExit.err",e,t)},onEvent:function(e,t){console.log("onEvent.eventName",e,t)},receivedRedirectUri:null}),n.plaidHandler.open()):alert("Something went wrong on the server. Please contact support.")},function(e){n.isLoading=!1,alert("Failed to update account link: "+e.data.exceptionMessage)}))},e.prototype.editEntry=function(e){this.editingTransaction=_.clone(e),this.editingTransaction.isSplit&&this.onSplitAmountChange()},e.prototype.deleteEntry=function(e){var t=this;confirm("Are you sure you want to delete this entry? Deletion is permanent.")&&(this.isLoading=!0,this.$http.delete("/api/Ledger/DeleteEntry/"+e.ledgerEntryId).then(function(e){t.isLoading=!1,t.editAccount=null,t.editingTransaction=null,t.fullRefresh()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)}))},e.prototype.onSaveEntry=function(){var t=this;if(this.editingTransaction.isSplit){for(var e=0;e<this.editingTransaction.splitEntries.length;++e)if(!this.editingTransaction.splitEntries[e].amount)return void alert("A non-zero amount is required for all split transaction entries")}else{if(!this.editingTransaction.description)return void alert("Description is required");if(!this.editingTransaction.amount)return void alert("Non-zero amount is required")}this.isLoading=!0;function i(e){t.isLoading=!1,t.editingTransaction=null,t.refreshEntries()}function n(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)}(this.editingTransaction.ledgerEntryId?this.$http.put("/api/Ledger/UpdateEntry",this.editingTransaction):this.$http.post("/api/Ledger/NewManualEntry",this.editingTransaction)).then(i,n)},e.prototype.onSaveNewAccount=function(){var t=this;this.isLoading=!0;this.$http.post("/api/Ledger/NewBankAccount",this.createAccountInfo).then(function(e){t.isLoading=!1,t.createAccountInfo=null,t.fullRefresh()},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},e.prototype.startPlaidFlow=function(){var n=this;this.createAccountInfo&&(this.createAccountInfo.type="plaid"),this.isPremiumPlanActive&&(this.isLoading=!0,this.$http.get("/api/Plaid/NewLinkToken").then(function(e){n.isLoading=!1,e.data&&(e={token:e.data,onSuccess:function(e,t){console.log("Plaid onSuccess",t);var i=null;t&&t.accounts&&0<t.accounts.length&&(i=t.accounts.map(function(e){return e.id})),n.completePlaidSync(e,null,i)},onLoad:function(){},onExit:function(e,t){console.log("update onExit.err",e,t)},onEvent:function(e,t){console.log("update onEvent.eventName",e,t)},receivedRedirectUri:null},n.plaidHandler=Plaid.create(e),n.plaidHandler.open())},function(e){n.isLoading=!1,alert("Failed to start Plaid sign-up: "+e.data.exceptionMessage),n.closeAccountAndReload()}))},e.prototype.openEditAccountModal=function(e){this.editAccount=_.clone(e)},e.prototype.closeAccountAndReload=function(){this.createAccountInfo=null,this.fullRefresh()},e.prototype.onEditAccount=function(){var t=this,e="/api/Ledger/UpdateAccount/"+this.editAccount.ledgerAccountId+"?newName="+encodeURIComponent(this.editAccount.accountName)+"&newType="+encodeURIComponent(this.editAccount.accountType);this.isLoading=!0,this.$http.put(e,null).then(function(e){t.isLoading=!1,t.editAccount=null,t.fullRefresh()},function(e){t.isLoading=!1,alert("Failed to update: "+e.data.exceptionMessage)})},e.prototype.syncPlaidAccounts=function(e){var t=this,e=(this.isLoading=!0,e?"/api/Plaid/SyncRecentTransactions":"/api/Plaid/SyncTwoYearTransactions");this.$http.get(e).then(function(e){t.isLoading=!1,t.refreshEntries()},function(e){t.isLoading=!1,alert("Failed to sync: "+e.data.exceptionMessage),e.data.exceptionMessage&&-1<e.data.exceptionMessage.indexOf("login credentials")&&window.location.reload()})},e.prototype.onFilterDescriptionChange=function(){(2<this.filter.description.length||0==this.filter.description.length)&&this.refreshEntries()},e.prototype.onEditTransactionCategoryChange=function(){},e.prototype.onCategoryManagerClosed=function(e){this.shouldShowCategoryEditModal=!1,e&&this.fullRefresh()},e.prototype.onDeleteAccount=function(){var t=this;confirm("Are you sure you want to remove this account?")&&(this.isLoading=!0,this.$http.delete("/api/Ledger/DeleteAccount/"+this.editAccount.ledgerAccountId).then(function(e){t.isLoading=!1,t.editAccount=null,t.fullRefresh()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)}))},e.prototype.splitTransaction=function(){this.editingTransaction.splitEntries||(this.editingTransaction.splitEntries=[]),this.editingTransaction.splitEntries.push(new o),this.editingTransaction.isSplit=!0},e.prototype.onSplitAmountChange=function(){this.splitAmountTotal=this.editingTransaction.splitEntries.reduce(function(e,t){return e+t.amount},0);var e=Math.round(100*this.splitAmountTotal),t=Math.round(100*this.editingTransaction.amount);this.isSplitAmountEqual=e===t},e.prototype.removeSplit=function(e){this.editingTransaction.splitEntries.splice(this.editingTransaction.splitEntries.indexOf(e),1),this.onSplitAmountChange()},e.prototype.openImportFilePicker=function(){document.getElementById("importTransactionFileInput").click()},e.prototype.openImportModal=function(){this.shouldShowImportModal=!0,this.previewImportGridOptions.data=null},e.prototype.onImportFileSelected=function(e){var t,i,n=this,e=e.target.files[0];e&&(this.isLoading=!0,this.importTxNotes="",(t=new FormData).append("importFile",e),e={headers:{"Content-Type":void 0}},i=document.getElementById("importTransactionFileInput"),this.$http.post("/api/Ledger/PreviewImport",t,e).then(function(e){n.isLoading=!1,i.value="",n.previewImportGridOptions.data=e.data;for(var t=0;t<n.previewImportGridOptions.data.length;++t)!function(e){var t=n.previewImportGridOptions.data[e],e=(t.ledgerEntryId=e,n.unitListEntries.find(function(e){return e.unitId===t.associatedUnitId})),e=(e&&(t.unitGridLabel=e.unitWithOwnerLast),n.flatCategoryList.find(function(e){return e.financialCategoryId===t.financialCategoryId}));t.categoryDisplayName=e?e.displayName:null}(t);n.previewImportGridOptions.minRowsToShow=e.data.length,n.previewImportGridOptions.virtualizationThreshold=n.previewImportGridOptions.minRowsToShow},function(e){n.isLoading=!1,i.value="",alert("Failed to upload document: "+e.data.exceptionMessage)}))},e.prototype.selectManualAccount=function(){this.createAccountInfo.type="manual",setTimeout(function(){return document.getElementById("new-account-name-field").focus()},100)},e.prototype.importPreviewTransactions=function(){var t=this;if(this.bulkImportAccountId){this.isLoading=!0;for(var e=this.previewImportGridOptions.data,i=0;i<e.length;++i)e[i].ledgerAccountId=this.bulkImportAccountId;var n={notes:this.importTxNotes,entries:this.previewImportGridOptions.data};this.$http.post("/api/Ledger/BulkImport",n).then(function(e){t.previewImportGridOptions.data=null,t.shouldShowImportModal=!1,t.isLoading=!1,t.refreshEntries(),t.$timeout(function(){return t.loadImportHistory()},1e3)},function(e){t.isLoading=!1,alert("Failed to import: "+e.data.exceptionMessage)})}else alert("Please select the account into which these transactions will be imported using the drop-down above the grid.")},e.prototype.removeImportRow=function(e){var t=this.previewImportGridOptions.data;t.splice(e.ledgerEntryId,1);for(var i=0;i<t.length;++i)t[i].ledgerEntryId=i},e.prototype.exportTransactionsCsv=function(){var e=[{headerText:"Date",fieldName:"transactionDate",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD"):""}},{headerText:"Description",fieldName:"description"},{headerText:"Category",fieldName:"categoryDisplayName"},{headerText:AppConfig.homeName,fieldName:"unitGridLabel"},{headerText:"Amount",fieldName:"amount"},{headerText:"Account",fieldName:"accountName"}],e=t.createCsvString(this.ledgerGridOptions.data,e);t.HtmlUtil2.downloadCsv(e,"Transactions.csv")},e.prototype.onShowOwnerTxnsChange=function(){var t=this,e=(this.isLoading=!0,"/api/Ledger/SetOwnerTxnViewing?shouldAllow="+this.shouldShowOwnerFinanceTxn);this.$http.put(e,null).then(function(e){t.isLoading=!1,t.siteInfo.privateSiteInfo.shouldShowOwnerFinanceTxn=t.shouldShowOwnerFinanceTxn},function(e){t.isLoading=!1,alert("Failed to change setting: "+e.data.exceptionMessage)})},e.prototype.loadImportHistory=function(){var t=this;this.$http.get("/api/Ledger/TxImportHistory").then(function(e){t.importHistoryEntries=e.data},function(e){console.log("Failed to retrieve tx history: "+e.data.exceptionMessage)})},e.prototype.saveOwnerTxNote=function(){var t=this,e={ownerFinanceTxNote:this.ownerFinanceTxNote};this.isLoading=!0,this.$http.put("/api/Ledger/OwnerTxNote",e).then(function(){t.isLoading=!1},function(e){t.isLoading=!1,alert("Failed to save note: "+e.data.exceptionMessage)})},e.$inject=["$http","SiteInfo","appCacheService","uiGridConstants","$rootScope","$timeout"],t.LedgerController=e;var i,n=function(){},o=function(){};t.LedgerEntry=o,__extends(s,i=o);function s(){return null!==i&&i.apply(this,arguments)||this}var a=function(){this.description="",this.startDate=new Date,this.endDate=new Date,this.category=""};t.FinancialCategory=function(){}}(Ally=Ally||{}),CA.angularApp.component("ledger",{templateUrl:"/ngApp/chtn/manager/financial/ledger.html",controller:Ally.LedgerController}),!function(n){n.ElectronicPayment=function(){};function e(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.appCacheService=i,this.uiGridConstants=n,this.$scope=o,this.PaymentHistory=[],this.errorMessage="",this.showPaymentPage=!0,this.periodicPaymentFrequencies=PeriodicPaymentFrequencies,this.AssociationPaysAch=!0,this.AssociationPaysCC=!1,this.lateFeeInfo={},this.hasLoadedPage=!1,this.isLoading=!1,this.isLoadingUnits=!1,this.isLoadingPayment=!1,this.isLoadingLateFee=!1,this.isLoadingCheckoutDetails=!1,this.allowNewWePaySignUp=!1,this.shouldShowDwollaAddAccountModal=!1,this.shouldShowDwollaModalClose=!1,this.isDwollaIavDone=!1,this.shouldShowMicroDepositModal=!1,this.shouldShowPlaidTestSignUpButton=!1,this.shouldShowCustomInstructions=!1,this.HistoryPageSize=50}e.prototype.$onInit=function(){this.homeName=AppConfig.homeName,this.highlightWePayCheckoutId=this.appCacheService.getAndClear("hwpid");var e=this.appCacheService.getAndClear("onpayid");HtmlUtil.isNumericString(e)&&(this.highlightPaymentsInfoId=parseInt(e)),this.isAssessmentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled;this.allowNewWePaySignUp=-1<["tigertrace","7mthope","qa"].indexOf(this.siteInfo.publicSiteInfo.shortName),this.payments=[{Date:"",Unit:"",Resident:"",Amount:"",Status:""}],this.testFee={amount:200},this.signUpStep=0,this.signUpInfo={hasAssessments:null,assessmentFrequency:PeriodicPaymentFrequencies[0].name,frequencyIndex:0,allPayTheSame:!0,allPayTheSameAmount:0,units:[]},this.paymentsGridOptions={columnDefs:[{field:"submitDateUtc",displayName:"Date",width:140,type:"date",cellFilter:"date:'short'"},{field:"unitName",displayName:this.homeName,width:80},{field:"resident",displayName:"Resident",width:160},{field:"amount",displayName:"Amount",width:100,type:"number",cellFilter:"currency"},{field:"status",displayName:"Status",width:110},{field:"notes",displayName:"Notes"},{field:"id",displayName:"",width:140,cellTemplate:'<div class="ui-grid-cell-contents"><span class="text-link" data-ng-if="row.entity.wePayCheckoutId" data-ng-click="grid.appScope.$ctrl.showWePayCheckoutInfo( row.entity.wePayCheckoutId )">WePay Details</span><span class="text-link" data-ng-if="row.entity.payPalCheckoutId" data-ng-click="grid.appScope.$ctrl.showPayPalCheckoutInfo( row.entity.payPalCheckoutId )">PayPal Details</span><span class="text-link" data-ng-if="row.entity.paragonReferenceNumber" data-ng-click="grid.appScope.$ctrl.showParagonCheckoutInfo( row.entity.paragonReferenceNumber )">Paragon Details</span><span class="text-link" data-ng-if="row.entity.dwollaTransferUri" data-ng-click="grid.appScope.$ctrl.showDwollaTransferInfo( row.entity )">Dwolla Details</span></div>'}],enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1,enablePaginationControls:!0,paginationPageSize:this.HistoryPageSize,paginationPageSizes:[this.HistoryPageSize],enableRowHeaderSelection:!1,onRegisterApi:function(){HtmlUtil.uiGridFixScroll()}},this.refresh()},e.prototype.refresh=function(){var i=this;this.isLoading=!0,this.$http.get("/api/OnlinePayment").then(function(e){i.isLoading=!1,i.hasLoadedPage=!0,i.hasAssessments=i.siteInfo.privateSiteInfo.hasAssessments,i.hasAssessments&&(t=PeriodicPaymentFrequencies.find(function(e){return e.id===i.siteInfo.privateSiteInfo.assessmentFrequency}))&&(i.assessmentFrequencyLabel=t.name);var t=e.data;i.paymentInfo=t,i.paymentsGridOptions.data=i.paymentInfo.electronicPayments,i.paymentsGridOptions.enablePaginationControls=i.paymentInfo.electronicPayments.length>i.HistoryPageSize,i.paymentsGridOptions.minRowsToShow=Math.min(i.paymentInfo.electronicPayments.length,i.HistoryPageSize),i.paymentsGridOptions.virtualizationThreshold=i.paymentsGridOptions.minRowsToShow,n.HtmlUtil2.isValidString(i.paymentInfo.customFinancialInstructions)&&i.showCustomInstructionsEditor(),i.lateFeeInfo={lateFeeDayOfMonth:t.lateFeeDayOfMonth,lateFeeAmount:t.lateFeeAmount},HtmlUtil.isNullOrWhitespace(i.lateFeeInfo.lateFeeAmount)||HtmlUtil.endsWith(i.lateFeeInfo.lateFeeAmount,"%")||(i.lateFeeInfo.lateFeeAmount="$"+i.lateFeeInfo.lateFeeAmount),i.refreshUnits(),i.updateTestFee(),i.highlightPaymentsInfoId&&((e=t.electronicPayments.filter(function(e){return e.paymentId===i.highlightPaymentsInfoId}))&&0<e.length&&(e[0].wePayCheckoutId?i.showWePayCheckoutInfo(e[0].wePayCheckoutId):e[0].paragonReferenceNumber?i.showParagonCheckoutInfo(e[0].paragonReferenceNumber):e[0].dwollaTransferUri&&i.showDwollaTransferInfo(e[0])),i.highlightPaymentsInfoId=null)},function(e){i.isLoading=!1,alert("Failed to load page, please contact technical support. ("+e.data.exceptionMessage+")")})},e.prototype.refreshUnits=function(){var t=this;this.isLoadingUnits=!0,this.$http.get("/api/Unit").then(function(e){t.units=e.data,_.each(t.units,function(e){null===e.adjustedAssessment&&(e.adjustedAssessment=e.assessment)}),t.assessmentSum=_.reduce(t.units,function(e,t){return e+t.assessment},0),t.adjustedAssessmentSum=_.reduce(t.units,function(e,t){return e+(t.adjustedAssessment||0)},0),t.isLoadingUnits=!1},function(e){t.isLoading=!1,alert("Failed to load units, please contact technical support. ("+e.data.exceptionMessage+")")})},e.prototype.getLateFeeDateSuper=function(){var e=this.lateFeeInfo.lateFeeDayOfMonth;if("string"==typeof e){if(HtmlUtil.isNullOrWhitespace(e))return"";e=parseInt(e),this.lateFeeInfo.lateFeeDayOfMonth=e}return isNaN(e)||e<1||31<e?"":10<=e&&e<=20?"th":1==(e=e%10)?"st":2==e?"nd":3==e?"rd":"th"},e.prototype.updatePayPalCredentials=function(){this.isUpdatingPayPalCredentials=!0,this.payPalSignUpClientSecret="",this.payPalSignUpErrorMessage=""},e.prototype.saveAllowSetting=function(){var t=this;this.isLoading=!0,this.$http.put("/api/OnlinePayment/SaveAllow?allowPayments="+this.paymentInfo.areOnlinePaymentsAllowed,null).then(function(){window.location.reload()},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},e.prototype.enablePayPal=function(){var t=this,e=(this.isLoading=!0,this.payPalSignUpErrorMessage=null,{clientId:this.payPalSignUpClientId,clientSecret:this.payPalSignUpClientSecret});this.$http.put("/api/OnlinePayment/EnablePayPal",e).then(function(){t.payPalSignUpClientId="",t.payPalSignUpClientSecret="",window.location.reload()},function(e){t.isLoading=!1,t.payPalSignUpErrorMessage=e.data.exceptionMessage})},e.prototype.selectText=function(){setTimeout(function(){$(".editable-input").select()},50)},e.prototype.onWithdrawalClick=function(){var t=this;this.errorMessage="",this.$http.get("/api/OnlinePayment/PerformAction?action=withdrawal").then(function(e){e=e.data;e.redirectUri?window.location.href=e.redirectUri:t.errorMessage=e.message},function(e){e.data&&e.data.exceptionMessage&&(t.errorMessage=e.data.exceptionMessage)})},e.prototype.onUnitAssessmentChanged=function(e){var t=this,e=(this.isLoadingUnits=!0,"string"==typeof e.adjustedAssessment&&(e.adjustedAssessment=parseFloat(e.adjustedAssessment)),{unitId:e.unitId,assessment:e.adjustedAssessment,assessmentNote:e.adjustedAssessmentReason});this.$http.put("/api/Unit/UpdateAssessment",e).then(function(){t.isLoadingUnits=!1,t.assessmentSum=_.reduce(t.units,function(e,t){return e+t.assessment},0),t.adjustedAssessmentSum=_.reduce(t.units,function(e,t){return e+(t.adjustedAssessment||0)},0)},function(e){alert("Failed to update: "+e.data.exceptionMessage)})},e.prototype.setAllUnitAssessments=function(){var e,t=this;!this.setAllAssessmentAmount||isNaN(this.setAllAssessmentAmount)||this.setAllAssessmentAmount<0?alert("Enter a valid assessment amount"):(this.isLoadingUnits=!0,e={unitId:-1,assessment:this.setAllAssessmentAmount,assessmentNote:null},this.$http.put("/api/Unit/SetAllAssessments",e).then(function(){t.isLoadingUnits=!1,t.refreshUnits()},function(e){alert("Failed to update: "+e.data.exceptionMessage)}))},e.prototype.onChangeFeePayerInfo=function(e){var t=this,i=!1,n=!1;if(this.paymentInfo.usersWithAutoPay&&0<this.paymentInfo.usersWithAutoPay.length){var o=[];if("ach"===e?o=_.where(this.paymentInfo.usersWithAutoPay,function(e){return"ACH"===e.wePayAutoPayFundingSource}):"cc"===e&&(o=_.where(this.paymentInfo.usersWithAutoPay,function(e){return"Credit Card"===e.wePayAutoPayFundingSource})),0<o.length){var n=void 0!==_.find(o,function(e){return e.userId===t.siteInfo.userInfo.userId}),i=!0,s="Adjusting the fee payer type will cause the follow units to have their auto-pay canceled and they will be informed by email:\n";if(_.each(o,function(e){return s+=e.ownerName+"\n"}),s+="\nDo you want to continue?",!confirm(s))return void("ach"===e?this.paymentInfo.payerPaysAchFee=!this.paymentInfo.payerPaysAchFee:this.paymentInfo.payerPaysCCFee=!this.paymentInfo.payerPaysCCFee)}}this.isLoadingPayment=!0,this.$http.put("/api/OnlinePayment",this.paymentInfo).then(function(){n?window.location.reload():(t.isLoadingPayment=!1,i&&t.refresh())},function(e){alert("Failed to update: "+e.data.exceptionMessage)}),this.updateTestFee()},e.prototype.getSignUpSum=function(){return _.reduce(this.signUpInfo.units,function(e,t){return e+parseFloat(t.assessment)},0)},e.prototype.signUp_HasAssessments=function(e){var t=this;this.signUpInfo.hasAssessments=e,this.signUpInfo.hasAssessments?(this.signUpInfo.units=[],_.each(this.units,function(e){t.signUpInfo.units.push({unitId:e.unitId,name:e.name,assessment:0})}),this.signUpStep=1):this.signUp_Commit()},e.prototype.signUp_AssessmentFrequency=function(e){this.signUpInfo.frequencyIndex=e,this.signUpInfo.assessmentFrequency=PeriodicPaymentFrequencies[e].name,this.signUpStep=2},e.prototype.saveLateFee=function(){var t=this;this.isLoadingLateFee=!0,this.$http.put("/api/OnlinePayment/LateFee?dayOfMonth="+this.lateFeeInfo.lateFeeDayOfMonth+"&lateFeeAmount="+this.lateFeeInfo.lateFeeAmount,null).then(function(e){t.isLoadingLateFee=!1;e=e.data;e&&e.feeAmount&&0!==e.feeType?(t.lateFeeInfo.lateFeeAmount=e.feeAmount,1===e.feeType?t.lateFeeInfo.lateFeeAmount="$"+t.lateFeeInfo.lateFeeAmount:2===e.feeType&&(t.lateFeeInfo.lateFeeAmount=t.lateFeeInfo.lateFeeAmount+"%")):(""!==t.lateFeeInfo.lateFeeDayOfMonth&&alert("Failed to save the late fee. Please enter only a number for the date (ex. 5) and an amount (ex. 12.34) or percent (ex. 5%) for the fee. To disable late fees, clear the date field and hit save."),t.lateFeeInfo.lateFeeDayOfMonth="",t.lateFeeInfo.lateFeeAmount=null)},function(e){t.isLoadingLateFee=!1;e=e.data.exceptionMessage||e.data;alert("Failed to update late fee: "+e)})},e.prototype.showPayPalCheckoutInfo=function(e){var t=this;this.viewingPayPalCheckoutId=e,this.viewingPayPalCheckoutId&&(this.isLoadingCheckoutDetails=!0,this.checkoutInfo={},this.$http.get("/api/OnlinePayment/PayPalCheckoutInfo?checkoutId="+e,{cache:!0}).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1,alert("Failed to retrieve checkout details: "+e.data.exceptionMessage)}))},e.prototype.showWePayCheckoutInfo=function(e){var t=this;this.viewingWePayCheckoutId=e,this.viewingWePayCheckoutId&&(this.isLoadingCheckoutDetails=!0,this.checkoutInfo={},this.$http.get("/api/OnlinePayment/WePayCheckoutInfo?checkoutId="+e,{cache:!0}).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1,alert("Failed to retrieve checkout details: "+e.data.exceptionMessage)}))},e.prototype.showParagonCheckoutInfo=function(e){var t=this;this.viewingParagonReferenceNumber=e,this.viewingParagonReferenceNumber&&(this.isLoadingCheckoutDetails=!0,this.checkoutInfo={},this.$http.get("/api/OnlinePayment/ParagonCheckoutInfo?paymentReferenceNumber="+e,{cache:!0}).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1,alert("Failed to retrieve checkout details: "+e.data.exceptionMessage)}))},e.prototype.showDwollaTransferInfo=function(e){var t=this;this.viewingDwollaEntry=e,this.viewingDwollaEntry&&(this.isLoadingCheckoutDetails=!0,this.checkoutInfo={},this.$http.get("/api/OnlinePayment/DwollaCheckoutInfo/"+e.paymentId).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1,alert("Failed to retrieve checkout details: "+e.data.exceptionMessage)}))},e.prototype.cancelDwollaTransfer=function(){var t=this;this.viewingDwollaEntry&&(this.isLoadingCheckoutDetails=!0,this.checkoutInfo={},this.$http.get("/api/Dwolla/CancelTransfer/"+this.viewingDwollaEntry.paymentId).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1,alert("Failed to cancel transfer: "+e.data.exceptionMessage)}))},e.prototype.signUp_Commit=function(){var t=this;this.isLoading=!0,this.$http.post("/api/OnlinePayment/BasicInfo",this.signUpInfo).then(function(){t.refreshUnits(),t.hasAssessments=t.signUpInfo.hasAssessments,t.siteInfo.privateSiteInfo.hasAssessments=t.hasAssessments,window.location.reload()},function(e){t.isLoading=!1,e.data&&e.data.exceptionMessage&&(t.errorMessage=e.data.exceptionMessage)})},e.prototype.updateTestFee=function(){var e=parseFloat(this.testFee.amount),t=(this.paymentInfo.payerPaysAchFee?(this.testFee.achResidentPays=e+1.5,this.testFee.achAssociationReceives=e):(this.testFee.achResidentPays=e,this.testFee.achAssociationReceives=e-1.5),1.3+.029*e);this.paymentInfo.payerPaysCCFee?(this.testFee.ccResidentPays=e+t,this.testFee.ccAssociationReceives=e):(this.testFee.ccResidentPays=e,this.testFee.ccAssociationReceives=e-t)},e.prototype.clearWePayAccessToken=function(){var t=this;this.isLoading=!0,this.$http.get("/api/OnlinePayment/ClearWePayAuthToken").then(function(){window.location.reload()},function(e){t.isLoading=!1,alert("Failed to disable WePay: "+e.data.exceptionMessage)})},e.prototype.showDwollaSignUpModal=function(){this.shouldShowDwollaAddAccountModal=!0,window.setTimeout(function(){grecaptcha.render("recaptcha-check-elem")},200)},e.prototype.startDwollaSignUp=function(){var i=this,e=grecaptcha.getResponse();HtmlUtil.isNullOrWhitespace(e)?alert("Please complete the reCAPTCHA field"):(this.shouldShowDwollaModalClose=!1,this.isDwollaIavDone=!1,this.isLoading=!0,this.$http.get("/api/Dwolla/GroupIavToken?token="+encodeURIComponent(e)).then(function(e){i.isLoading=!1,i.dwollaIavToken=e.data.iavToken,e=i.dwollaIavToken,dwolla.configure(n.AppConfigInfo.dwollaEnvironmentName),dwolla.iav.start(e,{container:"dwolla-iav-container",stylesheets:["https://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext"],microDeposits:!0,fallbackToMicroDeposits:!0},function(e,t){console.log("Error: "+JSON.stringify(e)+" -- Response: "+JSON.stringify(t)),t&&t._links&&t._links["funding-source"]&&t._links["funding-source"].href&&(e=t._links["funding-source"].href,i.$http.put("/api/Dwolla/SetGroupFundingSourceUri",{fundingSourceUri:e}).then(function(){i.isDwollaIavDone=!0},function(e){i.isLoading=!1,i.shouldShowDwollaModalClose=!0,alert("Failed to complete sign-up: "+e.data.exceptionMessage)}))})},function(e){i.isLoading=!1,i.shouldShowDwollaAddAccountModal=!1,grecaptcha.reset(),alert("Failed to start instant account verification: "+e.data.exceptionMessage)}))},e.prototype.hideDwollaAddAccountModal=function(){this.shouldShowDwollaAddAccountModal=!1,this.dwollaIavToken=null,this.isDwollaIavDone&&(this.isLoading=!0,window.location.reload())},e.prototype.disconnectDwolla=function(){var t=this;confirm("Are you sure you want to disconnect the bank account? Residents will no longer be able to make payments.")&&(this.isLoading=!0,this.$http.put("/api/Dwolla/DisconnectGroupFundingSource",null).then(function(){window.location.reload()},function(e){t.isLoading=!1,alert("Failed to disconnect account"+e.data.exceptionMessage)}))},e.prototype.showMicroDepositModal=function(){this.shouldShowMicroDepositModal=!0,this.dwollaMicroDepositAmount1String="0.01",this.dwollaMicroDepositAmount2String="0.01"},e.prototype.submitDwollaMicroDepositAmounts=function(){var t=this,e=(this.isLoading=!0,{amount1String:this.dwollaMicroDepositAmount1String,amount2String:this.dwollaMicroDepositAmount2String,isForGroup:!0});this.$http.post("/api/Dwolla/VerifyMicroDeposit",e).then(function(){window.location.reload()},function(e){t.isLoading=!1,alert("Failed to verify: "+e.data.exceptionMessage)})},e.prototype.addDwollaAccountViaPlaid=function(){var t=this;this.isLoading=!0,this.$http.post("/api/Dwolla/SignUpGroupFromPlaid/81",null).then(function(){window.location.reload()},function(e){t.isLoading=!1,alert("Failed to use Plaid account: "+e.data.exceptionMessage)})},e.prototype.showCustomInstructionsEditor=function(){var t=this;this.shouldShowCustomInstructions=!0,window.setTimeout(function(){n.HtmlUtil2.initTinyMce("tiny-mce-editor",220,{menubar:!1}).then(function(e){t.pageContentTinyMce=e,t.pageContentTinyMce.setContent(t.paymentInfo.customFinancialInstructions||"")})},25)},e.prototype.saveCustomInstructions=function(){var t=this,e=(this.isLoading=!0,{newInstructions:this.pageContentTinyMce.getContent()});this.$http.put("/api/OnlinePayment/UpdateCustomFinancialInstructions",e).then(function(){t.isLoading=!1,e.newInstructions||(t.shouldShowCustomInstructions=!1),t.siteInfo.privateSiteInfo.customFinancialInstructions=e.newInstructions},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},e.$inject=["$http","SiteInfo","appCacheService","uiGridConstants","$scope"],n.ManagePaymentsController=e}(Ally=Ally||{}),CA.angularApp.component("managePayments",{templateUrl:"/ngApp/chtn/manager/financial/manage-payments.html",controller:Ally.ManagePaymentsController}),function(){}),PaymentBasicInfo=function(){},__extends=(!function(e){var t=function(){this.isPrivate=!1},i=(e.Committee=t,n.prototype.$onInit=function(){this.retrieveCommittees()},n.prototype.startEditCommittee=function(e){this.editCommittee=e},n.prototype.showCreateModal=function(){this.editCommittee=new t,this.editCommittee.committeeType="Ongoing"},n.prototype.toggleCommitteeActive=function(e){var t=this,e=(this.isLoading=!0,(e.deactivationDateUtc?"/api/Committee/Reactivate/":"/api/Committee/Deactivate/")+e.committeeId);this.$http.put(e,null).then(function(){t.isLoading=!1,t.retrieveCommittees()},function(e){t.isLoading=!1,alert("Failed to retrieve the modify committee: "+e.data.exceptionMessage)})},n.prototype.retrieveCommittees=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Committee?includeInactive=true").then(function(e){e=e.data;t.isLoading=!1,t.activeCommittees=_.filter(e,function(e){return!e.deactivationDateUtc}),t.inactiveCommittees=_.filter(e,function(e){return!!e.deactivationDateUtc}),t.activeCommittees=_.sortBy(t.activeCommittees,function(e){return e.name.toLowerCase()}),t.inactiveCommittees=_.sortBy(t.inactiveCommittees,function(e){return e.name.toLowerCase()})},function(e){t.isLoading=!1,alert("Failed to retrieve the committee listing: "+e.data.exceptionMessage)})},n.prototype.saveCommittee=function(){var e,t=this;HtmlUtil.isNullOrWhitespace(this.editCommittee.name)?alert("Please enter a name for the new committee."):this.editCommittee.committeeType?(this.isLoading=!0,e="/api/Committee"+(this.editCommittee.committeeId?"/"+this.editCommittee.committeeId.toString():"")+"?name="+encodeURIComponent(this.editCommittee.name)+"&type="+encodeURIComponent(this.editCommittee.committeeType)+"&isPrivate="+this.editCommittee.isPrivate.toString(),(this.editCommittee.committeeId?this.$http.put:this.$http.post)(e,null).then(function(){t.isLoading=!1,t.editCommittee=null,t.retrieveCommittees()},function(e){t.isLoading=!1,alert("Failed to save the committee: "+e.data.exceptionMessage)})):alert("Please select a type for the new committee.")},n.$inject=["$http","SiteInfo","$cacheFactory"],n);function n(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.includeInactive=!1,this.activeCommittees=[],this.inactiveCommittees=[],this.showInactiveCommittees=!1,this.editCommittee=null,this.isLoading=!1}e.ManageCommitteesController=i}(Ally=Ally||{}),CA.angularApp.component("manageCommittees",{templateUrl:"/ngApp/chtn/manager/manage-committees.html",controller:Ally.ManageCommitteesController}),!function(e){function t(e,t,i){this.$http=e,this.siteInfo=t,this.$scope=i,this.isLoading=!1,this.includeInactive=!1,this.allPageListings=[],this.menuPageListings=[],this.selectedPageEntry=null,this.editPage=null,this.selectedLandingPageId=null,this.pageSizeString="0 bytes",this.pageSizeBytes=0,this.groupBaseUrl=this.siteInfo.publicSiteInfo.baseUrl}t.prototype.$onInit=function(){var t=this;this.retrievePages(),e.HtmlUtil2.initTinyMce("tiny-mce-editor",900).then(function(e){t.pageContentTinyMce=e,t.pageContentTinyMce.on("change",function(e){t.$scope.$apply(function(){t.updatePageSizeLabel()})})}),this.$http.get("/api/CustomPage/GroupLandingPage").then(function(e){t.selectedLandingPageId=e.data||null},function(e){console.log("Failed to retrieve current landing page: "+e.data.exceptionMessage)})},t.prototype.updatePageSizeLabel=function(){var e;this.pageContentTinyMce&&(e=this.pageContentTinyMce.getContent()||"",this.pageSizeBytes=e.length,this.pageSizeString=(this.pageSizeBytes/1048576).toFixed(2)+" MB")},t.prototype.retrievePages=function(){var t=this;this.isLoading=!0,this.$http.get("/api/CustomPage/AllPages").then(function(e){t.isLoading=!1,t.allPageListings=e.data,t.menuPageListings=_.clone(e.data);e=new i;e.customPageId=-5,e.title="Add New Page...",t.menuPageListings.push(e)},function(e){t.isLoading=!1,alert("Failed to retrieve the custom pages: "+e.data.exceptionMessage)})},t.prototype.savePage=function(){var t=this;HtmlUtil.isNullOrWhitespace(this.editPage.title)?alert("Please enter a title for the page"):HtmlUtil.isNullOrWhitespace(this.editPage.pageSlug)?alert("Please enter a slug for the page"):(this.editPage.markupHtml=this.pageContentTinyMce.getContent(),this.isLoading=!0,(this.editPage.customPageId?this.$http.put:this.$http.post)("/api/CustomPage",this.editPage).then(function(){t.isLoading=!1,t.selectedPageEntry=null,t.editPage=null,t.pageContentTinyMce.setContent(""),t.updatePageSizeLabel(),t.retrievePages()},function(e){t.isLoading=!1,alert("Failed to save the page: "+e.data.exceptionMessage)}))},t.prototype.deletePage=function(){var t=this;confirm("Are you sure you want to permanently delete this page? This action CANNOT BE UNDONE.")&&(this.isLoading=!0,this.$http.delete("/api/CustomPage/"+this.editPage.customPageId).then(function(){t.isLoading=!1,t.selectedPageEntry=null,t.editPage=null,t.pageContentTinyMce.setContent(""),t.updatePageSizeLabel(),t.retrievePages()},function(e){t.isLoading=!1,alert("Failed to delete the page: "+e.data.exceptionMessage)}))},t.prototype.onTitleBlur=function(){this.editPage&&!this.editPage.pageSlug&&this.editPage.title&&(this.editPage.pageSlug=(this.editPage.title||"").trim(),this.editPage.pageSlug=this.editPage.pageSlug.replace(/[^0-9a-z- ]/gi,""),this.editPage.pageSlug=this.editPage.pageSlug.replace(/ /g,"-"))},t.prototype.onSlugBlur=function(){this.editPage&&(this.editPage.pageSlug=(this.editPage.pageSlug||"").trim(),this.editPage.pageSlug=this.editPage.pageSlug.replace(/ /g,"-"))},t.prototype.onPageSelected=function(){var t=this;0<this.selectedPageEntry.customPageId?(this.isLoading=!0,this.$http.get("/api/CustomPage/"+this.selectedPageEntry.customPageId).then(function(e){t.isLoading=!1,t.editPage=e.data,t.pageContentTinyMce.setContent(t.editPage.markupHtml),t.updatePageSizeLabel()},function(e){t.isLoading=!1,alert("Failed to retrieve custom page: "+e.data.exceptionMessage)})):(this.editPage=new i,this.pageContentTinyMce.setContent(""),this.updatePageSizeLabel())},t.prototype.onLandingPageSelected=function(){var i=this,e="/api/CustomPage/SetGroupLandingPage";this.selectedLandingPageId&&(e+="?customPageId="+this.selectedLandingPageId),this.isLoading=!0,this.$http.put(e,null).then(function(e){var t;i.isLoading=!1,i.selectedLandingPageId?i.siteInfo.publicSiteInfo.customLandingPagePath=null:(t=i.allPageListings.find(function(e){return e.customPageId===i.selectedLandingPageId}))&&(i.siteInfo.publicSiteInfo.customLandingPagePath="#!/Page/"+t.pageSlug)},function(e){i.isLoading=!1,alert("Failed to update landing page: "+e.data.exceptionMessage)})},t.$inject=["$http","SiteInfo","$scope"],e.ManageCustomPagesController=t;var i=function(){};e.PublicCustomPageEntry=function(){}}(Ally=Ally||{}),CA.angularApp.component("manageCustomPages",{templateUrl:"/ngApp/chtn/manager/manage-custom-pages.html",controller:Ally.ManageCustomPagesController}),!function(n){function e(e,t,i){this.$http=e,this.siteInfo=t,this.fellowResidents=i,this.editingItem=new o,this.pollHistory=[],this.isLoading=!1,this.isSuperAdmin=!1,this.shouldAllowMultipleAnswers=!1,this.isPremiumPlanActive=!1}e.prototype.$onInit=function(){var t=this,e=(this.isSuperAdmin=this.siteInfo.userInfo.isAdmin,this.isPremiumPlanActive=this.siteInfo.privateSiteInfo.isPremiumPlanActive,new Date);e.setDate((new Date).getDate()+3),this.defaultPoll=new o,this.defaultPoll.expirationDate=e,this.defaultPoll.votingGroupShortName="everyone",this.defaultPoll.answers=[new i("Yes"),new i("No")],this.editingItem=angular.copy(this.defaultPoll),this.shouldAllowMultipleAnswers=!1,this.isLoading=!0,this.fellowResidents.getGroupEmailObject().then(function(e){t.groupEmails=_.sortBy(e,function(e){return e.displayName.toUpperCase()}),t.retrievePolls()},function(){return t.retrievePolls()})},e.prototype.retrievePolls=function(){var i=this;this.isLoading=!0,this.$http.get("/api/Poll").then(function(e){i.pollHistory=e.data;for(var t=0;t<i.pollHistory.length;++t)i.pollHistory[t].expirationDate=new Date(i.pollHistory[t].expirationDate),i.pollHistory[t].fullResultAnswers=i.pollHistory[t].answers,i.pollHistory[t].answers=_.reject(i.pollHistory[t].answers,function(e){return 101===e.sortOrder});i.isLoading=!1})},e.prototype.addAnswer=function(){var e=this;this.editingItem.answers||(this.editingItem.answers=[]),19<this.editingItem.answers.length?alert("You can only have 20 answers maxiumum per poll."):(this.editingItem.answers.push(new i("")),window.setTimeout(function(){return document.getElementById("poll-answer-textbox-"+(e.editingItem.answers.length-1)).focus()},100))},e.prototype.cancelEdit=function(){this.editingItem=angular.copy(this.defaultPoll),this.shouldAllowMultipleAnswers=!1},e.prototype.onSavePoll=function(){var e,t,i=this;null!==this.editingItem&&(this.isLoading=!0,e=function(){i.isLoading=!1,i.editingItem=angular.copy(i.defaultPoll),i.shouldAllowMultipleAnswers=!1,i.retrievePolls()},t=function(e){i.isLoading=!1,alert("Failed to save poll: "+e.data.exceptionMessage)},("number"==typeof this.editingItem.pollId?(analytics.track("editPoll"),this.$http.put("/api/Poll",this.editingItem)):(analytics.track("addPoll"),this.$http.post("/api/Poll",this.editingItem))).then(e,t))},e.prototype.onEditItem=function(e){this.editingItem=angular.copy(e),window.scrollTo(0,0),this.shouldAllowMultipleAnswers=1<this.editingItem.maxNumResponses},e.prototype.onDeleteItem=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Poll?pollId="+e.pollId).then(function(){t.retrievePolls()},function(e){t.isLoading=!1,403===e.status?alert("You cannot authorized to delete this poll."):alert("Failed to delete: "+e.data.exceptionMessage)})},e.prototype.onViewResults=function(e){if(e){var t=n.FellowResidentsService.pollReponsesToChart(e,this.siteInfo);e.chartData=t.chartData,e.chartLabels=t.chartLabels,e.answerCounts=[];for(var i=0;i<e.chartLabels.length;++i)e.answerCounts.push({label:e.chartLabels[i],count:e.chartData[i]});this.chartLabels=e.chartLabels,this.chartData=e.chartData,this.viewingPollResults=e}else this.viewingPollResults=null},e.prototype.formatVoteGroupName=function(t){var e;return this.groupEmails&&(e=this.groupEmails.find(function(e){return e.recipientTypeName.toLowerCase()===t}))?e.displayName:t},e.prototype.onMultiAnswerChange=function(){this.shouldAllowMultipleAnswers?this.editingItem.maxNumResponses=2:this.editingItem.maxNumResponses=1},e.$inject=["$http","SiteInfo","fellowResidents"],n.ManagePollsController=e;function t(){}var o=function(){this.isAnonymous=!0},i=(n.Poll=o,function(e){this.answerText=e});n.PollAnswer=i;n.PollResponse=t}(Ally=Ally||{}),CA.angularApp.component("managePolls",{templateUrl:"/ngApp/chtn/manager/manage-polls.html",controller:Ally.ManagePollsController}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}()),StripePayNeedsCustomer=(!function(s){function e(){}function t(){}s.Unit=e;s.PayerInfo=t,__extends(o,i=e);var i,n=o;function o(){return null!==i&&i.apply(this,arguments)||this}s.UnitWithOwner=n;__extends(r,a=n);var a,n=r;function r(){return null!==a&&a.apply(this,arguments)||this}s.UnitWithPayment=n;s.HomeEntry=function(){},l=s.HomeEntry,__extends(d,l);var l,n=d;function d(){return null!==l&&l.apply(this,arguments)||this}s.HomeEntryWithName=n;function c(){}s.Member=c,__extends(h,p=c);var p,n=h;function h(){return null!==p&&p.apply(this,arguments)||this}s.MemberWithBoard=n;__extends(m,u=n);var u,n=m;function m(){return null!==u&&u.apply(this,arguments)||this}s.Resident=n;__extends(y,g=n);var g,f=y;function y(){return null!==g&&g.apply(this,arguments)||this}s.UpdateResident=f;var I=function(){},n=(s.PendingMember=function(){},w.prototype.$onInit=function(){var i=this,n=(this.isAdmin=this.siteInfo.userInfo.isAdmin,this.siteLaunchedDateUtc=this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.bulkImportRows=[new I],this.multiselectOptions="",this.allUnits=null,this.homeName=AppConfig.homeName||"Unit",this.showIsRenter="condo"===AppConfig.appShortName||"hoa"===AppConfig.appShortName,this.shouldShowResidentPermissions=this.showIsRenter||"block-club"===AppConfig.appShortName,this.shouldShowHomePicker="pta"!==AppConfig.appShortName,this.showKansasPtaExport="pta"===AppConfig.appShortName&&"KS"===this.siteInfo.privateSiteInfo.groupAddress.state,this.showEmailSettings=!this.siteInfo.privateSiteInfo.isEmailSendingRestricted,this.memberTypeLabel=AppConfig.memberTypeLabel,this.showLaunchSite="pta"!==AppConfig.appShortName,this.showPendingMembers="pta"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"neighborhood"===AppConfig.appShortName,this.hasMemberNotOwnerRenter="pta"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"neighborhood"===AppConfig.appShortName,this.showAddHomeLink=!this.siteInfo.privateSiteInfo.siteLaunchedDateUtc&&moment().isBefore(moment(this.siteInfo.privateSiteInfo.creationDate).add(8,"days")),this.showPendingMembers&&(this.pendingMemberSignUpUrl="https://"+HtmlUtil.getSubdomain()+"."+AppConfig.baseTld+"/#!/MemberSignUp",setTimeout(function(){var e=new Clipboard(".clipboard-button");e.on("success",function(e){s.HtmlUtil2.showTooltip(e.trigger,"Copied!"),e.clearSelection()}),e.on("error",function(e){s.HtmlUtil2.showTooltip(e.trigger,"Auto-copy failed, press CTRL+C now")})},750)),this.boardPositions=s.FellowResidentsService.BoardPositionNames,this.newResident={boardPosition:0,isRenter:!1},this.editUser=null,"residentSort_v2"),e={field:"lastName",direction:this.uiGridConstants.ASC},t=(this.residentSortInfo=e,window.localStorage&&((t=window.localStorage.getItem(n))&&(this.residentSortInfo=JSON.parse(t)),this.residentSortInfo.field||(this.residentSortInfo=e)),"hoa"===AppConfig.appShortName?140:this.showIsRenter?62:175);if(this.residentGridOptions={data:[],enableFiltering:!1,columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first",enableFiltering:!0},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last",enableFiltering:!0},{field:"email",displayName:"Email",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text class="resident-cell-email" data-ng-style="{ \'color\': row.entity.postmarkReportedBadEmailUtc ? \'#F00\' : \'auto\' }">{{ row.entity.email }}</span></div>',enableFiltering:!0},{field:"phoneNumber",displayName:"Cell Phone",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.phoneNumber | tel }}</span></div>',enableFiltering:!0},{field:"unitGridLabel",displayName:"condo"===AppConfig.appShortName?"Unit":"Residence",cellClass:"resident-cell-unit",width:t,visible:AppConfig.isChtnSite,sortingAlgorithm:function(e,t){return i.shouldSortUnitsNumerically?parseInt(e)-parseInt(t):e.toString().localeCompare(t.toString())},enableFiltering:!0},{field:"isRenter",displayName:"Renter",width:80,cellClass:"resident-cell-is-renter",visible:this.showIsRenter,cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isRenter"></div>',enableFiltering:!1},{field:"boardPosition",displayName:"Board",width:125,cellClass:"resident-cell-board",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ grid.appScope.$ctrl.getBoardPositionName(row.entity.boardPosition) }}</span></div>',enableFiltering:!1},{field:"isSiteManager",displayName:"Admin",width:80,cellClass:"resident-cell-site-manager",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isSiteManager"></div>',enableFiltering:!1},{field:"lastLoginDateUtc",displayName:"Last Login",width:140,enableFiltering:!1,visible:!1,type:"date",cellFilter:"date:'short'"},{field:"alternatePhoneNumber",displayName:"Alt Phone",width:140,enableFiltering:!1,visible:!1}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableFullRowSelection:!0,enableColumnMenus:!1,enableGridMenu:!0,enableRowHeaderSelection:!1,onRegisterApi:function(e){(i.gridApi=e).selection.on.rowSelectionChanged(i.$rootScope,function(e){e.isSelected;i.setEdit(e.entity)}),e.core.on.sortChanged(i.$rootScope,function(e,t){t&&0!==t.length&&(i.residentSortInfo={field:t[0].field,direction:t[0].sort.direction},window.localStorage.setItem(n,JSON.stringify(i.residentSortInfo)))}),HtmlUtil.uiGridFixScroll()}},this.residentGridOptions.gridMenuShowHideColumns=!0,this.pendingMemberGridOptions={data:[],columnDefs:[{field:"firstName",displayName:"First Name"},{field:"lastName",displayName:"Last Name"},{field:"email",displayName:"Email"},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.phoneNumber | tel }}</span></div>'}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableFullRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,onRegisterApi:function(e){(i.pendingMemberGridApi=e).selection.on.rowSelectionChanged(i.$rootScope,function(e){i.selectPendingMember(e.entity)}),HtmlUtil.uiGridFixScroll()}},window.innerWidth<769)for(var o=2;o<this.residentGridOptions.columnDefs.length;++o)this.residentGridOptions.columnDefs[o].visible=!1;this.emailHistoryGridOptions={columnDefs:[{field:"senderName",displayName:"Sender",width:150},{field:"recipientGroup",displayName:"Sent To",width:100},{field:"messageSource",displayName:"Source",width:100},{field:"subject",displayName:"Subject"},{field:"sendDateUtc",displayName:"Send Date",width:140,type:"date",cellFilter:"date:'short'"},{field:"numRecipients",displayName:"#Recip.",width:70},{field:"numAttachments",displayName:"#Attach.",width:80}],enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1,enablePaginationControls:!0,paginationPageSize:20,paginationPageSizes:[20],enableRowHeaderSelection:!1,onRegisterApi:function(e){(i.emailHistoryGridApi=e).selection.on.rowSelectionChanged(i.$rootScope,function(e){i.viewingRecentEmailBody=e.entity.messageBody}),HtmlUtil.uiGridFixScroll()}},this.refreshResidents().then(function(){return i.loadSettings()}).then(function(){"true"===i.appCacheService.getAndClear("goToEmailHistory")&&(document.getElementById("toggle-email-history-link").scrollIntoView(),i.toggleEmailHistoryVisible()),i.showPendingMembers&&i.loadPendingMembers()})},w.prototype.getBoardPositionName=function(i){var e;return i&&(e=jQuery.grep(s.FellowResidentsService.BoardPositionNames,function(e,t){return e.id===i})[0])?e.name:""},w.prototype.selectPendingMember=function(e){this.pendingMemberGridApi.selection.clearSelectedRows();var t=new f;t.firstName=e.firstName,t.lastName=e.lastName,t.email=e.email,t.phoneNumber=e.phoneNumber,t.pendingMemberId=e.pendingMemberId,t.boardPosition=0,t.shouldSendWelcomeEmail=!1,this.setEdit(t)},w.prototype.closeViewingEmail=function(){this.viewingRecentEmailBody=null,this.emailHistoryGridApi.selection.clearSelectedRows()},w.prototype.setEdit=function(e){var i=this;this.sentWelcomeEmail=!1,null===e?this.editUser=null:(this.selectedResidentDetailsView="Primary",this.editUserForm.$setPristine(),e=jQuery.extend({},e),this.editUser=e,this.editUser.showAdvancedHomePicker=!!this.allUnits&&20<this.allUnits.length,this.multiselectMulti="single","object"==typeof this.editUser.units&&(0<this.editUser.units.length&&(this.editUser.singleUnitId=this.editUser.units[0].unitId),1<this.editUser.units.length)&&(this.editUser.showAdvancedHomePicker=!0,this.multiselectMulti="multiple"),this.allUnits&&20<this.allUnits.length&&"single"===this.multiselectMulti&&-5!==this.allUnits[0].unitId&&((e=new s.Unit).name="None Selected",e.unitId=-5,this.allUnits.unshift(e)),_.each(this.allUnits,function(t){var e=void 0!==_.find(i.editUser.units,function(e){return e.unitId===t.unitId});t.isSelectedForEditUser=e}),this.editUser.postmarkReportedBadEmailUtc&&s.HtmlUtil2.isValidString(this.editUser.postmarkReportedBadEmailReason)&&(this.editUser.badEmailDate=this.editUser.postmarkReportedBadEmailUtc,"SpamComplaint"===this.editUser.postmarkReportedBadEmailReason||"SpamComplaint"===this.editUser.postmarkReportedBadEmailReason?this.editUser.friendlyBadEmailReason="SpamReport":"InactiveRecipient"===this.editUser.postmarkReportedBadEmailReason?this.editUser.friendlyBadEmailReason="Inactive":"HardBounce"===this.editUser.postmarkReportedBadEmailReason?this.editUser.friendlyBadEmailReason="Bounce":"FailedDuringSend"===this.editUser.postmarkReportedBadEmailReason?this.editUser.friendlyBadEmailReason="FailedSend":this.editUser.friendlyBadEmailReason=this.editUser.postmarkReportedBadEmailReason),this.gridApi.selection.clearSelectedRows(),setTimeout("$( '#edit-user-first-text-box' ).focus();",100))},w.prototype.onSendWelcome=function(){var e=this;this.isSavingUser=!0,this.$http.put("/api/Residents/"+this.editUser.userId+"/SendWelcome",null).then(function(){e.isSavingUser=!1,e.sentWelcomeEmail=!0},function(){e.isSavingUser=!1,alert("Failed to send the welcome email, please contact support if this problem persists.")})},w.prototype.populateGridUnitLabels=function(){_.each(this.residentGridOptions.data,function(e){var t=_.reduce(e.units,function(e,t){return 0<e.length?e+","+t.name:t.name},"");e.unitGridLabel=t})},w.prototype.refreshResidents=function(){var i=this;return this.isLoading=!0,this.$http.get("/api/Residents").then(function(e){i.isLoading=!1;var t,e=e.data;i.residentGridOptions.data=e,i.residentGridOptions.minRowsToShow=e.length,i.residentGridOptions.virtualizationThreshold=e.length,i.residentGridOptions.enableFiltering=15<e.length,i.gridApi.core.notifyDataChange(i.uiGridConstants.dataChange.COLUMN),i.hasOneAdmin=1===_.filter(e,function(e){return e.isSiteManager}).length&&1<e.length,i.residentSortInfo&&(t=_.find(i.gridApi.grid.columns,function(e){return e.field===i.residentSortInfo.field}))&&i.gridApi.grid.sortColumn(t,i.residentSortInfo.direction,!1),_.forEach(e,function(e){e.fullName=e.firstName+" "+e.lastName,"string"==typeof e.email&&-1!==e.email.indexOf("@condoally.com")&&(e.email=""),e.lastLoginDateUtc&&(e.lastLoginDateUtc=moment.utc(e.lastLoginDateUtc).toDate())}),i.populateGridUnitLabels(),!i.allUnits&&AppConfig.isChtnSite&&(i.isLoading=!0,i.$http.get("/api/Unit").then(function(e){i.isLoading=!1,i.allUnits=e.data,i.shouldSortUnitsNumerically=_.every(i.allUnits,function(e){return HtmlUtil.isNumericString(e.name)}),i.shouldSortUnitsNumerically&&(i.allUnits=_.sortBy(i.allUnits,function(e){return parseFloat(e.name)})),i.multiselectOptions=20<i.allUnits.length?"filter":"",i.showAddHomeLink=1===i.allUnits.length},function(){i.isLoading=!1,alert("Failed to retrieve your association's home listing, please contact support.")}))})},w.prototype.loadPendingMembers=function(){var t=this;this.isLoadingPending=!0,this.$http.get("/api/Member/Pending").then(function(e){t.isLoadingPending=!1,t.pendingMemberGridOptions.data=e.data,t.pendingMemberGridOptions.minRowsToShow=e.data.length,t.pendingMemberGridOptions.virtualizationThreshold=e.data.length},function(e){t.isLoadingPending=!1})},w.prototype.enableMultiHomePicker=function(){this.editUser&&(this.editUser.showAdvancedHomePicker=!0),this.multiselectMulti="multiple",this.allUnits&&0<this.allUnits.length&&null===this.allUnits[0].unitId&&this.allUnits.shift()},w.prototype.rejectPendingMember=function(){var t=this;this.editUser.pendingMemberId&&confirm("Are you sure you want to remove this pending member? This action cannot be undone.")&&(this.isLoading=!1,this.$http.put("/api/Member/Pending/Deny/"+this.editUser.pendingMemberId,null).then(function(){t.isLoading=!1,t.editUser=null,t.loadPendingMembers()},function(e){t.isLoading=!1,alert("Failed to reject pending member: "+e.data.exceptionMessage)}))},w.prototype.onSaveResident=function(){var e,i,t,n=this;this.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid())&&(this.editUser.userId!==this.$rootScope.userInfo.userId||!this.siteInfo.userInfo.isSiteManager||this.editUser.isSiteManager||confirm("If you remove yourself as a site admin you won't be able to continue making changes. Are you sure you want to remove yourself as a site admin?"))&&(this.editUser.showAdvancedHomePicker||(this.editUser.singleUnitId?this.editUser.units=[{unitId:this.editUser.singleUnitId,name:null,memberHomeId:null,userId:this.editUser.userId,isRenter:!1}]:this.editUser.units=[]),e=function(e){n.isSavingUser=!1,"string"==typeof e.data.errorMessage?alert("Failed to add resident: "+e.data.errorMessage):(n.editUser.pendingMemberId&&n.loadPendingMembers(),n.editUser=null,n.refreshResidents())},i=!(this.isSavingUser=!0),t=function(e){n.isSavingUser=!1;var t=i?"Failed to add new resident":"Failed to update resident";e&&e.data&&e.data.exceptionMessage&&(t+=": "+e.data.exceptionMessage),alert(t)},(this.editUser.userId?(i=!1,analytics.track("editResident"),this.$http.put("/api/Residents/UpdateUser",this.editUser)):(i=!0,analytics.track("addNewResident"),this.$http.post("/api/Residents",this.editUser))).then(e,t),this.fellowResidents.clearResidentCache())},w.prototype.OnAdminSetPassword=function(){var t=this,e={userName:this.adminSetPass_Username,password:this.adminSetPass_Password};this.$http.post("/api/AdminHelper/SetPassword",e).then(function(e){t.adminSetPass_ResultMessage=e.data},function(e){alert("Failed to set password: "+e.data.exceptionMessage)})},w.prototype.loadSettings=function(){var t=this;this.isLoadingSettings=!0,this.$http.get("/api/Settings").then(function(e){t.isLoadingSettings=!1,t.residentSettings=e.data,t.siteInfo.privateSiteInfo.rentersCanViewDocs=t.residentSettings.rentersCanViewDocs,t.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads=t.residentSettings.whoCanCreateDiscussionThreads},function(e){t.isLoadingSettings=!1,console.log("Failed to retrieve settings: "+e.data.exceptionMessage)})},w.prototype.exportResidentCsv=function(){var t=this;"undefined"!=typeof analytics&&analytics.track("exportResidentCsv");var e=s.createCsvString(this.residentGridOptions.data,[{headerText:"First Name",fieldName:"firstName"},{headerText:"Last Name",fieldName:"lastName"},{headerText:"CellPhone",fieldName:"phoneNumber"},{headerText:"Email",fieldName:"email"},{headerText:"Unit",fieldName:"unitGridLabel"},{headerText:"Is Renter",fieldName:"isRenter"},{headerText:"Is Admin",fieldName:"isSiteManager"},{headerText:"Board Position",fieldName:"boardPosition",dataMapper:function(e){return t.getBoardPositionName(e)}},{headerText:"Alternate Mailing",fieldName:"mailingAddressObject",dataMapper:function(e){return e?e.recipientName?e.recipientName+" "+e.oneLiner:e.oneLiner:""}},{headerText:"Alternate Phone",fieldName:"alternatePhoneNumber"},{headerText:"Manager Notes",fieldName:"managerNotes"},{headerText:"Last Login Date",fieldName:"lastLoginDateUtc",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD HH:mm:00"):"Has not logged-in"}}]);s.HtmlUtil2.downloadCsv(e,"Residents.csv")},w.prototype.exportKansasPtaCsv=function(){if(this.siteInfo.privateSiteInfo.ptaUnitId){"undefined"!=typeof analytics&&analytics.track("exportKansasPtaCsv");for(var e=0,t=_.clone(this.residentGridOptions.data);e<t.length;e++){var i=t[e];i.Local_Unit=this.siteInfo.privateSiteInfo.ptaUnitId.toString(),i.Membership_Name=i.firstName&&"N/A"!==i.firstName?i.firstName:i.lastName,0!==i.boardPosition&&(i.Position=this.getBoardPositionName(i.boardPosition))}var n="data:text/csv;charset=utf-8,"+s.createCsvString(this.residentGridOptions.data,[{headerText:"Local_Unit",fieldName:"Local_Unit"},{headerText:"First_Name",fieldName:"firstName"},{headerText:"Last_Name",fieldName:"lastName"},{headerText:"Number_of_Members",fieldName:"Number_of_Members"},{headerText:"Membership_Name",fieldName:"Membership_Name"},{headerText:"Name_Prefix",fieldName:"Name_Prefix"},{headerText:"Middle_Name",fieldName:"Middle_Name"},{headerText:"Name_Suffix",fieldName:"Name_Suffix"},{headerText:"Email",fieldName:"email"},{headerText:"Address_1",fieldName:"Address_1"},{headerText:"Address_2",fieldName:"Address_2"},{headerText:"Address_3",fieldName:"Address_3"},{headerText:"City",fieldName:"City"},{headerText:"State",fieldName:"State"},{headerText:"Zip",fieldName:"Zip"},{headerText:"Home_Telephone",fieldName:"phoneNumber"},{headerText:"Work_Telephone",fieldName:"Work_Telephone"},{headerText:"Mobile_Number",fieldName:"Mobile_Number"},{headerText:"Position",fieldName:"Position"},{headerText:"Begin_Date",fieldName:"Begin_Date"},{headerText:"End_Date",fieldName:"End_Date"},{headerText:"Second_Name",fieldName:"Second_Name"},{headerText:"Second_Email",fieldName:"Second_Email"},{headerText:"Teacher1",fieldName:"Teacher1"},{headerText:"Teacher2",fieldName:"Teacher2"},{headerText:"Teacher3",fieldName:"Teacher3"},{headerText:"Children_Names",fieldName:"Children_Names"}]),n=encodeURI(n),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download","pta-members.csv"),document.body.appendChild(o),o.click(),setTimeout(function(){return document.body.removeChild(o)},500)}else alert("You must first set your PTA unit ID in Manage -> Settings before you can export in this format.")},w.prototype.saveResidentSettings=function(){var e=this;analytics.track("editResidentSettings"),this.isLoadingSettings=!0,this.$http.put("/api/Settings",this.residentSettings).then(function(){e.isLoadingSettings=!1,e.fellowResidents.clearResidentCache(),e.siteInfo.privateSiteInfo.canHideContactInfo=e.residentSettings.canHideContactInfo,e.siteInfo.privateSiteInfo.isDiscussionEmailGroupEnabled=e.residentSettings.isDiscussionEmailGroupEnabled},function(){e.isLoadingSettings=!1,alert("Failed to update settings, please try again or contact support.")})},w.prototype.onDeleteResident=function(){var e=this;confirm("Are you sure you want to remove this person from your building?")&&(this.siteInfo.userInfo.userId!==this.editUser.userId||confirm("If you remove your own account you won't be able to login anymore. Are you still sure?"))&&(this.isSavingUser=!0,this.$http.delete("/api/Residents?userId="+this.editUser.userId).then(function(){e.isSavingUser=!1,e.editUser=null,e.fellowResidents.clearResidentCache(),e.refreshResidents()},function(){alert("Failed to remove the resident. Please let support know if this continues to happen."),e.isSavingUser=!1,e.editUser=null}))},w.prototype.onSendAllWelcome=function(){var e=this;confirm("This will email all of the residents in your association. Do you want to proceed?")&&(this.isLoading=!0,this.$http.put("/api/Residents/UserAction?userId&action=launchsite",null).then(function(){e.isLoading=!1,e.sentWelcomeEmail=!0,e.allEmailsSent=!0},function(){e.isLoading=!1,alert("Failed to send welcome email, please contact support if this problem persists.")}))},w.prototype.parseBulkCsv=function(){var s=$.csv.toArrays(this.bulkImportCsv),a=(this.bulkImportRows=[],function(e){e=(e=e||"").toLowerCase();return e=(e=(e=(e=(e=(e=(e=(e=e.replace(/0th /g,"0 ").replace(/1st /g,"1 ")).replace(/2nd /g,"2 ").replace(/3rd /g,"3 ")).replace(/4th /g,"4 ").replace(/5th /g,"5 ")).replace(/6th /g,"6 ").replace(/7th /g,"7 ")).replace(/8th /g,"8 ").replace(/9th /g,"9 ")).replace(/\./g,"").replace(/ /g,"")).replace(/street/g,"st").replace(/road/g,"rd").replace(/drive/g,"dr")).replace(/place/g,"pl").replace(/avenue/g,"ave")});if(this.allUnits)for(var e=0;e<this.allUnits.length;++e)this.allUnits[e].csvTestName=a(this.allUnits[e].name);for(var r=this,e=0;e<s.length;++e)!function(e){for(var t=s[e];t.length<10;)t.push("");if("Address/Unit"===t[0]&&"Email"===t[1]&&"First Name"===t[2])return;for(var i=0;i<t.length;++i)HtmlUtil.isNullOrWhitespace(t[i])?t[i]=null:t[i]=t[i].trim();var n,o={unitName:t[0]||null,unitId:void 0,email:t[1],firstName:t[2],lastName:t[3],phoneNumber:t[4],isRenter:!HtmlUtil.isNullOrWhitespace(t[5]),isAdmin:!HtmlUtil.isNullOrWhitespace(t[6]),csvTestName:"",mailingAddress:t[7],alternatePhone:t[8],managerNotes:t[9],emailHasDupe:!1},e=(HtmlUtil.isNullOrWhitespace(o.unitName)?o.unitId=null:(o.csvTestName=a(o.unitName),e=_.find(r.allUnits,function(e){return e.csvTestName===o.csvTestName}),o.unitId=e?e.unitId:void 0),null);o.firstName&&-1!==o.firstName.toLowerCase().indexOf(" & ")&&(o.firstName=o.firstName.replace(" & "," and  ")),o.firstName&&-1!==o.firstName.toLowerCase().indexOf(" and ")&&(e=_.clone(o),n=o.firstName.split(" and "),o.firstName=n[0],e.firstName=n[1],o.email&&-1!==o.email.indexOf(" / ")?(n=o.email.split(" / "),o.email=n[0],e.email=n[1]):e.email="",e.phoneNumber=""),r.bulkParseNormalizeNameCase&&(o.firstName=(n=function(e){return e&&(1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())})(o.firstName),o.lastName=n(o.lastName),e)&&(e.firstName=n(e.firstName),e.lastName=n(e.lastName)),r.bulkImportRows.push(o),e&&r.bulkImportRows.push(e)}(e);for(var i=this,t=0,n=this.bulkImportRows;t<n.length;t++)!function(t){t.emailHasDupe=t.email&&1<i.bulkImportRows.filter(function(e){return e.email===t.email}).length}(n[t])},w.prototype.submitBulkRows=function(){var e=this;this.isLoading=!0,this.$http.post("/api/Residents/BulkLoad",this.bulkImportRows,{timeout:6e5}).then(function(){e.isLoading=!1,e.bulkImportRows=[new I],e.bulkImportCsv="",alert("Success"),e.refreshResidents()},function(){e.isLoading=!1,alert("Bulk upload failed")})},w.prototype.addBulkRow=function(){var t,e,i={unitName:"",unitId:null,email:"",firstName:"",lastName:"",phoneNumber:"",isRenter:!1,isAdmin:!1,csvTestName:void 0,mailingAddress:"",alternatePhone:"",managerNotes:"",emailHasDupe:!1};this.allUnits&&0<this.bulkImportRows.length&&(t=this.bulkImportRows[this.bulkImportRows.length-1].unitId,e=_.findIndex(this.allUnits,function(e){return e.unitId===t}),++e<this.allUnits.length)&&(i.unitName=this.allUnits[e].name,i.unitId=this.allUnits[e].unitId),this.bulkImportRows.push(i)},w.prototype.toggleEmailHistoryVisible=function(){var t=this;this.showEmailHistory=!this.showEmailHistory,this.viewingRecentEmailBody=null,this.showEmailHistory&&!this.emailHistoryGridOptions.data&&(this.isLoadingSettings=!0,this.$http.get("/api/Email/RecentGroupEmails").then(function(e){t.isLoadingSettings=!1,t.emailHistoryGridOptions.data=e.data},function(e){t.isLoadingSettings=!1,alert("Failed to load emails: "+e.data.exceptionMessage)}))},w.prototype.loadMoreRecentEmails=function(){var t=this;this.isLoadingSettings=!0;this.emailHistoryNumMonths+=6,this.emailHistorySinceDate=moment(this.emailHistorySinceDate).subtract(6,"months").toDate(),this.$http.get("/api/Email/RecentGroupEmails?sinceDateUtc="+this.emailHistorySinceDate.toISOString()).then(function(e){t.isLoadingSettings=!1,t.emailHistoryGridOptions.data=t.emailHistoryGridOptions.data.concat(e.data)},function(e){t.isLoadingSettings=!1,alert("Failed to load emails: "+e.data.exceptionMessage)})},w.$inject=["$http","$rootScope","fellowResidents","uiGridConstants","SiteInfo","appCacheService"],w);function w(e,t,i,n,o,s){this.$http=e,this.$rootScope=t,this.fellowResidents=i,this.uiGridConstants=n,this.siteInfo=o,this.appCacheService=s,this.isAdmin=!1,this.showEmailSettings=!0,this.shouldShowHomePicker=!0,this.showKansasPtaExport=!1,this.multiselectMulti="single",this.isSavingUser=!1,this.isLoading=!1,this.isLoadingSettings=!1,this.shouldSortUnitsNumerically=!1,this.showEmailHistory=!1,this.emailHistorySinceDate=new Date,this.emailHistoryNumMonths=6,this.bulkParseNormalizeNameCase=!1,this.showLaunchSite=!0,this.showPendingMembers=!1,this.isLoadingPending=!1,this.selectedResidentDetailsView="Primary",this.showAddHomeLink=!1,this.hasMemberNotOwnerRenter=!1}s.ManageResidentsController=n}(Ally=Ally||{}),CA.angularApp.component("manageResidents",{templateUrl:"/ngApp/chtn/manager/manage-residents.html",controller:Ally.ManageResidentsController}),!function(e){function t(e,t,i){this.$http=e,this.siteInfo=t,this.$location=i,this.isLoading=!1,this.appShortName=AppConfig.appShortName}t.prototype.$onInit=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Association/GroupAmenities").then(function(e){t.isLoading=!1,t.groupAmenities=e.data},function(e){t.isLoading=!1,alert("Failed to retrieve amenity data: "+e.data.exceptionMessage)})},t.prototype.saveForm=function(){var t=this;this.isLoading=!0,this.$http.put("/api/Association/GroupAmenities",this.groupAmenities).then(function(e){t.$location.path("/Home")},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},t.$inject=["$http","SiteInfo","$location"],e.GroupAmenitiesController=t}(Ally=Ally||{}),CA.angularApp.component("groupAmenities",{templateUrl:"/ngApp/chtn/manager/settings/group-amenities.html",controller:Ally.GroupAmenitiesController}),!function(s){function e(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.appCacheService=i,this.$timeout=n,this.$scope=o,this.settings=new s.ChtnSiteSettings,this.isLoading=!1,this.isLoadingUsage=!1,this.shouldShowPremiumPlanSection=!0,this.shouldShowPaymentForm=!1,this.stripeApi=null,this.stripeCardElement=null,this.isActivatingAnnual=!0,this.monthlyDisabled=!1,this.planExpirationColor="red",this.groupEmailChartData=[],this.groupEmailAverage=0,this.genInvoiceNumMonths=1,this.genInvoiceShouldIncludeWireInfo=!1,this.emailUsageChartData=[],this.emailUsageChartLabels=[],this.emailUsageChartOptions={},this.emailUsageAverageNumMonths=0,this.emailUsageAverageSent=0,this.showInvoiceSection=!1,this.paymentType="ach",this.shouldShowPremiumPlanSection="condo"===AppConfig.appShortName||"hoa"===AppConfig.appShortName,this.homeNamePlural=AppConfig.homeName.toLowerCase()+"s",this.showInvoiceSection=t.userInfo.isAdmin;try{this.stripeApi=Stripe(StripeApiKey)}catch(e){console.log(e)}}e.prototype.$onInit=function(){var t=this;this.monthlyDisabled=this.siteInfo.privateSiteInfo.numUnits<=10,this.refreshData(),this.showInvoiceSection&&this.$timeout(function(){return t.$http.get("/api/DocumentLink/0").then(function(e){return t.viewPremiumInvoiceViewId=e.data.vid})},250)},e.prototype.cancelPremiumAutoRenew=function(){var t=this;confirm("Are you sure?")&&(this.isLoading=!0,this.$http.put("/api/Settings/CancelPremium",null).then(function(e){t.isLoading=!1,t.settings.premiumPlanIsAutoRenewed=!1,t.shouldShowPaymentForm=!1,t.refreshData()},function(){t.isLoading=!1,alert("Failed to cancel the premium plan. Refresh the page and try again or contact support if the problem persists.")}))},e.prototype.showStripeError=function(e){var t=document.getElementById("card-errors");HtmlUtil.isNullOrWhitespace(e)?t.textContent=null:t.textContent=e},e.prototype.initStripePayment=function(){var t=this,e=this.stripeApi.elements();this.stripeCardElement=e.create("card",{style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}}),this.stripeCardElement.mount("#stripe-card-element");this.stripeCardElement.on("change",function(e){e.error?t.showStripeError(e.error.message):t.showStripeError(null)})},e.prototype.submitCardToStripe=function(){var t=this;return this.isLoading=!0,this.stripeApi.createPaymentMethod({type:"card",card:this.stripeCardElement}).then(function(e){e.error?(t.isLoading=!1,t.showStripeError(e.error.message)):(e={stripePaymentMethodId:e.paymentMethod.id,shouldPayAnnually:t.isActivatingAnnual},t.$http.put("/api/Settings/ActivatePremium",e).then(function(e){t.isLoading=!1,t.settings.premiumPlanIsAutoRenewed=!0,t.shouldShowPaymentForm=!1,t.refreshData()},function(e){t.isLoading=!1,alert("Failed to activate the premium plan. Refresh the page and try again or contact support if the problem persists: "+e.data.exceptionMessage)})),t.$scope.$apply()})},e.prototype.generateStripeInvoice=function(e,t){var i=this,e="PublicSettings/ViewPremiumInvoice?vid="+this.viewPremiumInvoiceViewId+"&numMonths="+e+"&shouldIncludeWireInfo="+t;window.open(this.siteInfo.publicSiteInfo.baseApiUrl+e,"_blank"),this.$timeout(function(){i.$http.get("/api/DocumentLink/0").then(function(e){return i.viewPremiumInvoiceViewId=e.data.vid})},1250)},e.prototype.activatePremiumRenewal=function(){var e=this;this.shouldShowPaymentForm=!0,this.updateCheckoutDescription(),this.$timeout(function(){return e.initStripePayment()},250)},e.prototype.updateCheckoutDescription=function(){var e,t=moment(this.premiumPlanRenewDate).isBefore();this.isActivatingAnnual?(e=11*this.settings.premiumPlanCostDollars,this.checkoutDescription="You will be charged $"+e+" ",this.checkoutDescription+=t?" today and you will be charged annually on this date thereafter.":" on "+moment(this.premiumPlanRenewDate).format("dddd, MMMM Do YYYY")+" and you will be charged annually on that date thereafter."):(e=this.settings.premiumPlanCostDollars,this.checkoutDescription="You will be charged $"+this.settings.premiumPlanCostDollars+" ",this.checkoutDescription+=t?" today and you will be charged monthly on this date thereafter.":" on "+moment(this.premiumPlanRenewDate).format("dddd, MMMM Do YYYY")+" and you will be charged monthly on that date thereafter."),this.payButtonText=t?"Pay $"+e:"Schedule Payment"},e.prototype.createSubscription=function(e){var t=this;return fetch("/create-subscription",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify({paymentMethodId:e})}).then(function(e){return e.json()}).then(function(e){if(e.error)throw e;return e}).then(function(e){return{paymentMethodId:e.paymentMethodId,priceId:e.priceId,subscription:e.subscription}}).catch(function(e){t.showStripeError(e)})},e.prototype.handlePaymentThatRequiresCustomerAction=function(e){var t,i=this,n=e.subscription,o=e.invoice,s=e.priceId,a=e.paymentMethodId,e=e.isRetry;return(!n||"active"!==n.status)&&("requires_action"===(t=(o||n.latest_invoice).payment_intent).status||!0===e&&"requires_payment_method"===t.status)?this.stripeApi.confirmCardPayment(t.client_secret,{payment_method:a}).then(function(e){if(e.error)throw e;if("succeeded"===e.paymentIntent.status)return{priceId:s,subscription:n,invoice:o,paymentMethodId:a}}).catch(function(e){i.showStripeError(e)}):{subscription:n,priceId:s,paymentMethodId:a}},e.prototype.handleRequiresPaymentMethod=function(e){var t=e.subscription,i=e.paymentMethodId,e=e.priceId;if("active"!==t.status&&"requires_payment_method"===t.latest_invoice.payment_intent.status)throw localStorage.setItem("latestInvoiceId",t.latest_invoice.id),localStorage.setItem("latestInvoicePaymentIntentStatus",t.latest_invoice.payment_intent.status),{error:{message:"Your card was declined."}};return{subscription:t,priceId:e,paymentMethodId:i}},e.prototype.refreshMeteredUsage=function(){var l=this;this.isLoadingUsage=!0,this.$http.get("/api/Settings/MeteredFeaturesUsage").then(function(e){l.isLoadingUsage=!1,l.meteredUsage=e.data,l.meteredUsage.months=_.sortBy(l.meteredUsage.months,function(e){return e.year.toString()+"_"+(9<e.month?"":"0")+e.month}),l.emailUsageChartLabels=[];for(var t=[],i=[],n=0,o=0,s=0;s<e.data.months.length;++s){var a=e.data.months[s],r=moment([a.year,a.month-1,1]).format("MMMM");0===s||s===l.meteredUsage.months.length-1?l.emailUsageChartLabels.push(r+" "+a.year):l.emailUsageChartLabels.push(r),t.push(a.numEmailsSent),i.push(a.numGroupEmailsProcessed),n+=a.numEmailsSent,o+=a.numGroupEmailsProcessed}l.emailUsageChartData=[t],l.groupEmailChartData=[i],l.emailUsageAverageNumMonths=e.data.months.length,1<l.emailUsageAverageNumMonths&&(l.emailUsageAverageSent=Math.round(n/l.emailUsageAverageNumMonths),l.groupEmailAverage=Math.round(o/l.emailUsageAverageNumMonths))}),this.emailUsageChartOptions={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left",ticks:{suggestedMin:0,beginAtZero:!0}}]}}},e.prototype.refreshData=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Settings").then(function(e){t.isLoading=!1,t.settings=e.data,t.isPremiumPlanActive=t.siteInfo.privateSiteInfo.isPremiumPlanActive,t.premiumPlanRenewDate=new Date,t.premiumPlanRenewDate=moment(t.settings.premiumPlanExpirationDate).add(1,"days").toDate(),t.settings.premiumPlanIsAutoRenewed?(t.planExpirationColor="green",t.$http.get("/api/Settings/StripeBillingPortal").then(function(e){return t.stripePortalUrl=e.data.portalUrl})):(e=moment(t.settings.premiumPlanExpirationDate).add(-2,"months"),moment().isBefore(e)?t.planExpirationColor="green":t.planExpirationColor="red"),t.refreshMeteredUsage()})},e.prototype.goToEmailHistory=function(){return this.appCacheService.set("goToEmailHistory","true"),window.location.hash="#!/ManageResidents",!0},e.prototype.startPlaidAchConnection=function(){var i=this;this.isLoading=!0,this.$http.get("/api/Plaid/StripeLinkToken").then(function(e){i.isLoading=!1,e.data?(e={token:e.data,onSuccess:function(e,t){console.log("Plaid StripeLinkToken onSuccess",t),i.completePlaidAchConnection(e,t.account_id)},onLoad:function(){},onExit:function(e,t){console.log("update onExit.err",e,t)},onEvent:function(e,t){console.log("update onEvent.eventName",e,t)},receivedRedirectUri:null},Plaid.create(e).open()):alert("Failed to start Plaid connection. Please contact support.")},function(e){i.isLoading=!1,alert("Failed to start Plaid connection: "+e.data.exceptionMessage)})},e.prototype.completePlaidAchConnection=function(e,t){var i=this,e=(this.isLoading=!0,{accessToken:e,selectedAccountIds:[t]});this.$http.post("/api/Plaid/ProcessStripeAccessToken",e).then(function(e){i.isLoading=!1,i.checkoutDescription="Account successfully linked, reloading...",window.location.reload()},function(e){i.isLoading=!1,alert("Failed to link account: "+e.data.exceptionMessage)})},e.prototype.makeAchStripePayment=function(){var t=this,e=(this.isLoading=!0,{shouldPayAnnually:this.isActivatingAnnual,payViaAch:!0});this.$http.put("/api/Settings/ActivatePremium",e).then(function(e){t.isLoading=!1,t.settings.premiumPlanIsAutoRenewed=!0,t.shouldShowPaymentForm=!1,t.refreshData()},function(e){t.isLoading=!1,alert("Failed to activate the premium plan. Refresh the page and try again or contact support if the problem persists: "+e.data.exceptionMessage)})},e.prototype.onPaymentTypeChange=function(){var e=this;"creditCard"===this.paymentType&&this.$timeout(function(){return e.initStripePayment()},250)},e.$inject=["$http","SiteInfo","appCacheService","$timeout","$scope"],s.PremiumPlanSettingsController=e,s.GroupMonthEmails=function(){}}(Ally=Ally||{}),CA.angularApp.component("premiumPlanSettings",{templateUrl:"/ngApp/chtn/manager/settings/premium-plan-settings.html",controller:Ally.PremiumPlanSettingsController}),function(){}),MeteredFeaturesUsage=function(){},__extends=(!function(e){function t(e,t,i){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.shouldShowPremiumPlanSection=!0,this.selectedView=this.$routeParams.viewName||"SiteSettings",this.shouldShowPremiumPlanSection="condo"===AppConfig.appShortName||"hoa"===AppConfig.appShortName,this.shouldShowPremiumPlanSection||(this.selectedView="SiteSettings")}t.prototype.$onInit=function(){},t.$inject=["$http","SiteInfo","$routeParams"],e.SettingsParentController=t}(Ally=Ally||{}),CA.angularApp.component("settingsParent",{templateUrl:"/ngApp/chtn/manager/settings/settings-parent.html",controller:Ally.SettingsParentController}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}()),MapCtrlMapMgr=(!function(i){function e(){}i.BaseSiteSettings=e,__extends(n,t=e);var t,s=n;function n(){return null!==t&&t.apply(this,arguments)||this}function o(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$timeout=i,this.$scope=n,this.$rootScope=o,this.settings=new s,this.originalSettings=new s,this.isLoading=!1,this.showRightColumnSetting=!0,this.showLocalNewsSetting=!1,this.isPta=!1,this.shouldShowWelcomeTooLongError=!1}i.ChtnSiteSettings=s,o.prototype.$onInit=function(){var e=this;this.frontEndVersion=appVer.toString(),this.defaultBGImage=$(document.documentElement).css("background-image"),this.showQaButton="president@mycondoally.com"===this.siteInfo.userInfo.emailAddress,this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl,this.showRightColumnSetting=this.siteInfo.privateSiteInfo.creationDate<i.SiteInfoService.AlwaysDiscussDate,this.showLocalNewsSetting=!this.showRightColumnSetting,this.isPta="pta"===AppConfig.appShortName,this.$timeout(function(){return e.hookUpLoginImageUpload()},200),this.refreshData()},o.prototype.refreshData=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Settings").then(function(e){t.isLoading=!1,t.settings=e.data,t.originalSettings=_.clone(e.data),t.tinyMceEditor||i.HtmlUtil2.initTinyMce("tiny-mce-editor",400,{menubar:"edit format table",toolbar:"styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | checklist code formatpainter table"}).then(function(e){t.tinyMceEditor=e,t.tinyMceEditor.setContent(t.settings.welcomeMessage),t.tinyMceEditor.on("keyup",function(){t.$scope.$apply(function(){t.onWelcomeMessageEdit()})})})})},o.prototype.removeLoginImage=function(){var t=this;analytics.track("clearLoginImage"),this.isLoading=!0,this.$http.get("/api/Settings/ClearLoginImage").then(function(){t.isLoading=!1,t.siteInfo.publicSiteInfo.loginImageUrl="",t.loginImageUrl=""},function(e){t.isLoading=!1,alert("Failed to remove loading image: "+e.data.exceptionMessage)})},o.prototype.saveAllSettings=function(){var t=this;analytics.track("editSettings"),this.settings.welcomeMessage=this.tinyMceEditor.getContent(),this.isLoading=!0,this.$http.put("/api/Settings",this.settings).then(function(){t.isLoading=!1,t.siteInfo.privateSiteInfo.homeRightColumnType=t.settings.homeRightColumnType,t.siteInfo.privateSiteInfo.welcomeMessage=t.settings.welcomeMessage,t.siteInfo.privateSiteInfo.ptaUnitId=t.settings.ptaUnitId,t.settings.fullName!==t.originalSettings.fullName&&location.reload()},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},o.prototype.onImageClick=function(e){var t=this;this.settings.bgImageFileName=e,this.$http.put("/api/Settings",{BGImageFileName:this.settings.bgImageFileName}).then(function(){$(".test-bg-image").removeClass("test-bg-image-selected"),t.isLoading=!1},function(e){t.isLoading=!1,alert("Failed to save: "+e.data)})},o.prototype.onImageHoverOver=function(e){},o.prototype.onImageHoverOut=function(){},o.prototype.onQaDeleteSite=function(){this.$http.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(e){alert("Failed to delete site: "+e.data.exceptionMessage)})},o.prototype.hookUpLoginImageUpload=function(){var i=this;$(function(){$("#JQLoginImageFileUploader").fileupload({dropZone:null,pasteZone:null,autoUpload:!0,add:function(e,t){i.$scope.$apply(function(){i.isLoading=!0}),analytics.track("setLoginImage"),$("#FileUploadProgressContainer").show(),t.url="api/DocumentUpload/LoginImage",i.siteInfo.publicSiteInfo.baseApiUrl&&(t.url=i.siteInfo.publicSiteInfo.baseApiUrl+"DocumentUpload/LoginImage"),t.submit().done(function(e){i.$scope.$apply(function(){i.isLoading=!1,i.loginImageUrl=e.newUrl+"?cacheBreaker="+(new Date).getTime(),i.siteInfo.publicSiteInfo.loginImageUrl=i.loginImageUrl}),$("#FileUploadProgressContainer").hide()})},beforeSend:function(e){i.siteInfo.publicSiteInfo.baseApiUrl?e.setRequestHeader("Authorization","Bearer "+i.$rootScope.authToken):e.setRequestHeader("ApiAuthToken",i.$rootScope.authToken)},progressall:function(e,t){t=Math.floor(100*t.loaded/t.total);$("#FileUploadProgressBar").css("width",t+"%"),100===t?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(t+"%")}})})},o.prototype.forceRefresh=function(){window.location.reload(!0)},o.prototype.onWelcomeMessageEdit=function(){var e=this.tinyMceEditor.getContent();this.shouldShowWelcomeTooLongError=4e3<e.length},o.$inject=["$http","SiteInfo","$timeout","$scope","$rootScope"],i.ChtnSettingsController=o}(Ally=Ally||{}),CA.angularApp.component("chtnSiteSettings",{templateUrl:"/ngApp/chtn/manager/settings/site-settings.html",controller:Ally.ChtnSettingsController}),!function(e){function t(e,t){this.siteInfo=e,this.$routeParams=t,this.hideDocuments=!1,this.hideVendors=!1,this.showMaintenance=!1,this.showVendors=!0,this.faqMenuText="Info/FAQs","home"===AppConfig.appShortName&&(this.faqMenuText="Notes"),this.frontEndVersion=appVer.toString()}t.prototype.$onInit=function(){this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideVendors="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName,this.showMaintenance="home"===AppConfig.appShortName||"condo"===AppConfig.appShortName||"hoa"===AppConfig.appShortName,this.showVendors="pta"!==AppConfig.appShortName,this.hideDocuments?this.selectedView="Info":this.selectedView="Docs",HtmlUtil.isValidString(this.$routeParams.viewName)&&(this.selectedView=this.$routeParams.viewName)},t.prototype.forceRefresh=function(){window.location.reload(!0)},t.$inject=["SiteInfo","$routeParams"],e.AssociationInfoController=t}(Ally=Ally||{}),CA.condoAllyControllers.directive("contenteditable",["$sce",function(s){return{restrict:"A",require:"?ngModel",link:function(e,t,i,n){function o(){var e=t.html();i.stripBr&&"<br>"===e&&(e=""),n.$setViewValue(e)}n&&(n.$render=function(){t.html(s.getTrustedHtml(n.$viewValue||""))},t.on("blur keyup change",function(){e.$evalAsync(o)}),o())}}}]),CA.angularApp.filter("highlight",["$sce",function(i){return function(e,t){return e=e||"",t&&(e=e.replace(new RegExp("("+t+")","gi"),'<span class="fileSearchHighlight">$1</span>')),i.trustAsHtml(e)}}]),CA.angularApp.component("associationInfo",{templateUrl:"/ngApp/chtn/member/association-info.html",controller:Ally.AssociationInfoController}),!function(i){function e(e,t,i,n,o,s,a){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.$scope=o,this.$routeParams=s,this.$sce=a,this.showDiscussionThreads=!1,this.showLocalNews=!1,this.testPay_ShouldShow=!1,this.testPay_isValid=!1,this.shouldShowOwnerFinanceTxn=!1}e.prototype.$onInit=function(){var t=this,e=(this.testPay_ShouldShow=!1,this.testPay_ShouldShow&&(this.testPay_ReturnUrl=window.location.href,this.testPay_IpnUrl=this.siteInfo.publicSiteInfo.baseUrl+"/api/PayPalIpn",this.testPay_UserFirst=this.siteInfo.userInfo.firstName,this.testPay_UserLast=this.siteInfo.userInfo.lastName,this.testPay_Description="Assessment for "+this.siteInfo.publicSiteInfo.fullName),this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.isWelcomeMessageHtml=this.welcomeMessage&&-1<this.welcomeMessage.indexOf("<"),this.isWelcomeMessageHtml&&(this.welcomeMessage=this.$sce.trustAsHtml(this.welcomeMessage),i.RichTextHelper.makeLinksOpenNewTab("welcome-message-panel")),this.canMakePayment=this.siteInfo.privateSiteInfo.isPaymentEnabled&&!this.siteInfo.userInfo.isRenter,this.shouldShowOwnerFinanceTxn=this.siteInfo.privateSiteInfo.shouldShowOwnerFinanceTxn&&!this.siteInfo.userInfo.isRenter,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.allyAppName=AppConfig.appName,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||""===this.homeRightColumnType||(this.homeRightColumnType="localnews"),this.siteInfo.privateSiteInfo.creationDate>i.SiteInfoService.AlwaysDiscussDate?this.showDiscussionThreads=!0:this.showDiscussionThreads=-1<this.homeRightColumnType.indexOf("chatwall"),this.showLocalNews=-1<this.homeRightColumnType.indexOf("localnews"),this.showDiscussionThreads&&this.$routeParams&&HtmlUtil.isNumericString(this.$routeParams.discussionThreadId)&&(this.autoOpenDiscussionThreadId=parseInt(this.$routeParams.discussionThreadId)),this);this.$scope.$on("homeHasActivePolls",function(){return e.shouldShowAlertSection=!0}),this.$http.get("/api/Committee/MyCommittees",{cache:!0}).then(function(e){t.usersCommittees=e.data,t.usersCommittees&&(t.usersCommittees=_.sortBy(t.usersCommittees,function(e){return e.name.toLowerCase()}))}),"condo"!==AppConfig.appShortName&&"hoa"!==AppConfig.appShortName||this.$timeout(function(){return t.checkForSurveys()},250)},e.prototype.checkForSurveys=function(){var t=this;this.$http.get("/api/AllySurvey/AnySurvey").then(function(e){t.allySurvey=e.data},function(e){console.log("Failed to load ally survey",e.data.exceptionMessage)}),this.allySurvey=null},e.prototype.onTestPayAmtChange=function(){this.testPay_isValid=5<this.testPay_Amt&&this.testPay_Amt<5e3},e.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},e.$inject=["$http","$rootScope","SiteInfo","$timeout","$scope","$routeParams","$sce"],i.ChtnHomeController=e}(Ally=Ally||{}),CA.angularApp.component("chtnHome",{templateUrl:"/ngApp/chtn/member/chtn-home.html",controller:Ally.ChtnHomeController}),!function(e){var s=function(){};function t(e,t,i,n,o){this.$scope=e,this.$timeout=t,this.$http=i,this.siteInfo=n,this.appCacheService=o,this.editingTip=new s,this.hoaHomes=[],this.tips=[],this.isLoading=!1}t.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager;var e=void 0,t=(this.siteInfo.privateSiteInfo.googleGpsPosition&&(e={bounds:new google.maps.Circle({center:this.siteInfo.privateSiteInfo.googleGpsPosition,radius:40234}).getBounds()}),document.getElementById("edit-location-address-text-box")),i=(this.addressAutocomplete=new google.maps.places.Autocomplete(t,e),this),i=(google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var e=i.addressAutocomplete.getPlace();i.editingTip.address=e.formatted_address}),this.retrieveHoaHomes(),this);this.$timeout(function(){return i.getWalkScore()},1e3),MapCtrlMapMgr.Init(this.siteInfo,this.$scope,this)},t.prototype.refresh=function(){var n=this;this.isLoading=!0,this.$http.get("/api/WelcomeTip").then(function(e){n.tips=e.data,MapCtrlMapMgr.ClearAllMarkers(),"condo"===AppConfig.appShortName&&MapCtrlMapMgr.AddMarker(MapCtrlMapMgr._homeGpsPos.lat(),MapCtrlMapMgr._homeGpsPos.lng(),"Home",MapCtrlMapMgr.MarkerNumber_Home,null);for(var t=0;t<n.tips.length;++t){var i=n.tips[t];null!==i.gpsPos&&(i.markerIndex=MapCtrlMapMgr.AddMarker(i.gpsPos.lat,i.gpsPos.lon,i.name,i.markerNumber,null))}_.each(n.hoaHomes,function(t){var e,i;t.fullAddress&&t.fullAddress.gpsPos&&(e=MapCtrlMapMgr.MarkerNumber_Home,i=t.name,_.any(n.siteInfo.userInfo.usersUnits,function(e){return e.unitId===t.unitId})&&(e=MapCtrlMapMgr.MarkerNumber_MyHome,i="Your home: "+i),MapCtrlMapMgr.AddMarker(t.fullAddress.gpsPos.lat,t.fullAddress.gpsPos.lon,i,e,t.unitId))}),MapCtrlMapMgr.OnMarkersReady(),n.isLoading=!1})},t.prototype.onEditTip=function(e){this.editingTip=jQuery.extend({},e),window.scrollTo(0,document.body.scrollHeight)},t.prototype.onMoveMarker=function(e){MapCtrlMapMgr.SetMarkerDraggable(e.markerIndex,!0)},t.prototype.onDeleteTip=function(e){var t=this;confirm("Are you sure you want to delete this item?")&&(this.isLoading=!0,this.$http.delete("/api/WelcomeTip/"+e.itemId).then(function(){t.isLoading=!1,t.refresh()}))},t.prototype.onSaveTip=function(){var e,t,i=this;null!==this.editingTip&&(e=function(){i.isLoading=!1,i.editingTip=new s,i.refresh()},t=function(e){i.isLoading=!1,alert("Failed to save item: "+e.data.exceptionMessage)},this.isLoading=!0,(this.editingTip.itemId?this.$http.put("/api/WelcomeTip",this.editingTip):this.$http.post("/api/WelcomeTip",this.editingTip)).then(e,t))},t.prototype.isLocationTip=function(e){return null!==e.gpsPos},t.prototype.isNotLocationTip=function(e){return null===e.gpsPos},t.prototype.getMarkerIconUrl=function(e){var t="/assets/images/MapMarkers/";return t=t+(1<=e&&e<=10?"green_"+e:-2===e?"MapMarker_Home":-3===e?"MapMarker_Hospital":-4===e?"MapMarker_PostOffice":"green_blank")+".png"},t.prototype.updateItemGpsLocation=function(t,e,i){var e={itemId:_.find(this.tips,function(e){return e.markerIndex===t}).itemId,newLat:e,newLon:i},n=(this.isLoading=!0,this);this.$http.put("/api/WelcomeTip/UpdateGpsLocation",e).then(function(){n.isLoading=!1})},t.prototype.getWalkScore=function(){function e(e){e&&e.data&&"Error"!==e.data?$("#WalkScorePanel").html(e.data):($("#WalkScorePanel").html("Failed to load Walk Score."),$("#WalkScorePanel").hide())}this.$http.get("/api/WelcomeTip/GetWalkScore").then(e,e)},t.prototype.retrieveHoaHomes=function(){var i=this;this.$http.get("/api/BuildingResidents/FullUnits").then(function(e){var t;e.data&&("condo"===AppConfig.appShortName?(t=_.filter(e.data,function(e){return e.addressId&&!!e.fullAddress}),0<(t=_.filter(t,function(e){return e.fullAddress.oneLiner!=i.siteInfo.privateSiteInfo.groupAddress.oneLiner})).length&&(i.hoaHomes=e.data)):"hoa"===AppConfig.appShortName&&(i.hoaHomes=e.data)),i.refresh()},function(){i.refresh()})},t.$inject=["$scope","$timeout","$http","SiteInfo","appCacheService"],e.ChtnMapController=t}(Ally=Ally||{}),CA.angularApp.component("chtnMap",{templateUrl:"/ngApp/chtn/member/chtn-map.html",controller:Ally.ChtnMapController}),function(){function s(){}return s.Init=function(e,t,i){s.ngScope=t,s.mapCtrl=i,"undefined"!=typeof google&&(s._homeGpsPos=e.privateSiteInfo.googleGpsPosition,s._groupGpsBounds=e.privateSiteInfo.gpsBounds,t={center:s._homeGpsPos,zoom:25,mapTypeId:google.maps.MapTypeId.ROADMAP},s._mainMap=new google.maps.Map(document.getElementById("map_canvas"),t),"condo"===AppConfig.appShortName&&s.AddMarker(s._homeGpsPos.lat(),s._homeGpsPos.lng(),"Home",s.MarkerNumber_Home,null),s.OnMapReady())},s.OnMapReady=function(){s._isMapReady=!0,s._areMarkersReady&&s.OnMapAndMarkersReady()},s.OnMarkersReady=function(){s._areMarkersReady=!0,s._isMapReady&&s.OnMapAndMarkersReady()},s.OnMapAndMarkersReady=function(){for(var e,t=0;t<s._tempMarkers.length;++t){var i=s._tempMarkers[t],n=null,n=1<=i.markerNumber&&i.markerNumber<=10?"/assets/images/MapMarkers/green_"+i.markerNumber+".png":i.markerNumber===s.MarkerNumber_Home?"/assets/images/MapMarkers/MapMarker_Home.png":i.markerNumber===s.MarkerNumber_Hospital?"/assets/images/MapMarkers/MapMarker_Hospital.png":i.markerNumber===s.MarkerNumber_PostOffice?"/assets/images/MapMarkers/MapMarker_PostOffice.png":i.markerNumber===s.MarkerNumber_MyHome?"/assets/images/MapMarkers/MapMarker_MyHome.png":"/assets/images/MapMarkers/green_blank.png",n=new google.maps.Marker({position:new google.maps.LatLng(i.lat,i.lon),map:s._mainMap,animation:google.maps.Animation.DROP,title:i.name,icon:n});n.markerIndex=t,google.maps.event.addListener(n,"dragend",function(){var e=this,t=e.getPosition();s.ngScope.$apply(function(){s.mapCtrl.updateItemGpsLocation(e.markerIndex,t.lat(),t.lng())})}),i.unitId&&(n.unitId=i.unitId,n.addListener("click",function(e){return function(){s.mapCtrl.appCacheService.set("scrollToUnitId",e.unitId.toString()),window.location.hash="#!/BuildingResidents"}}(n))),s._markers.push(n)}s._tempMarkers=[],s._groupGpsBounds&&(e=Ally.MapUtil.gpsBoundsToGooglePoly(s._groupGpsBounds),s._groupBoundsShape=new google.maps.Polygon({paths:e,map:s._mainMap,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1})),s.ZoomMapToFitMarkers()},s.ClearAllMarkers=function(){for(var e=0;e<s._markers.length;e++)s._markers[e].setMap(null);s._markers=[]},s.SetMarkerDraggable=function(e,t){s._markers[e].setDraggable(t)},s.AddMarker=function(e,t,i,n,o){return s._tempMarkers.push({lat:e,lon:t,name:i,markerNumber:n,unitId:o}),s._tempMarkers.length-1},s.ZoomMapToFitMarkers=function(){for(var e=new google.maps.LatLngBounds,t=0;t<s._markers.length;++t)e.extend(s._markers[t].getPosition());if(s._groupBoundsShape)for(var i=s._groupBoundsShape.getPath(),n=0;n<i.getLength();++n)e.extend(i.getAt(n));s._mainMap.fitBounds(e)},s._mainMap=null,s._homeGpsPos=null,s._groupGpsBounds=null,s._groupBoundsShape=null,s._markers=[],s.MarkerNumber_Home=-2,s.MarkerNumber_MyHome=-5,s.MarkerNumber_Hospital=-3,s.MarkerNumber_PostOffice=-4,s._isMapReady=!1,s._areMarkersReady=!1,s._tempMarkers=[],s.ngScope=null,s.mapCtrl=null,s}()),__extends=(!function(i){function e(e,t){this.$http=e,this.appCacheService=t,this.isLoading=!1,this.loginInfo=new i.LoginInfo,this.shouldHideControls=!1}e.prototype.$onInit=function(){this.loginInfo.emailAddress=this.appCacheService.getAndClear("forgotEmail")},e.prototype.onSubmitEmail=function(){var t=this;this.isLoading=!0,this.$http.post("/api/Login/Forgot",this.loginInfo).then(function(){t.shouldHideControls=!0,t.isLoading=!1,t.resultText="Please check your email for updated login information.",t.resultTextColor="#00F"},function(e){t.isLoading=!1,t.resultText="Failed to process your request: "+e.data.exceptionMessage,t.resultTextColor="#F00"})},e.$inject=["$http","appCacheService"],i.ForgotPasswordController=e}(Ally=Ally||{}),CA.angularApp.component("forgotPassword",{templateUrl:"/ngApp/chtn/member/forgot-password.html",controller:Ally.ForgotPasswordController}),!function(s){function a(e,t,i,n){this.fellowResidents=e,this.siteInfo=t,this.appCacheService=i,this.$http=n,this.isLoading=!0,this.isLoadingGroupEmails=!1,this.isLoadingSaveEmailGroup=!1,this.emailLists=[],this.customEmailList=[],this.unitPrefix="Unit ",this.groupEmailDomain="",this.shouldShowNewCustomEmailModal=!1,this.allyAppName=AppConfig.appName,this.groupShortName=t.publicSiteInfo.shortName,this.showMemberList="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"pta"===AppConfig.appShortName,this.groupEmailDomain="inmail."+AppConfig.baseTld,this.unitPrefix="condo"===AppConfig.appShortName?"Unit ":""}a.prototype.$onInit=function(){var o=this;this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.fellowResidents.getByUnitsAndResidents().then(function(e){o.isLoading=!1,o.unitList=e.byUnit,o.allResidents=e.residents,o.committees=e.committees,!o.allResidents&&e.ptaMembers&&(o.allResidents=e.ptaMembers),o.showMemberList?o.allResidents=_.sortBy(o.allResidents,function(e){return(e.lastName||"").toLowerCase()}):o.allResidents=_.sortBy(o.allResidents,function(e){return(e.fullName||"").toLowerCase()}),o.boardMembers=_.filter(o.allResidents,function(e){return e.boardPosition!==s.FellowResidentsService.BoardPos_None&&e.boardPosition!==s.FellowResidentsService.BoardPos_PropertyManager}),o.boardPropMgrs=_.filter(o.allResidents,function(e){return e.boardPosition===s.FellowResidentsService.BoardPos_PropertyManager}),o.boardMessageRecipient=null,0<o.boardMembers.length&&_.some(o.boardMembers,function(e){return e.hasEmail})&&(o.boardMessageRecipient={fullName:"Entire Board",firstName:"everyone on the board",hasEmail:!0,userId:a.AllBoardUserId}),"neighborhood"!==AppConfig.appShortName&&"block-club"!==AppConfig.appShortName||(o.allResidents=_.filter(o.allResidents,function(e){return 0===e.boardPosition}));for(var t=0;t<o.boardMembers.length;++t)!function(t){o.boardMembers[t].boardPositionName=_.find(s.FellowResidentsService.BoardPositionNames,function(e){return e.id===o.boardMembers[t].boardPosition}).name}(t);o.boardPropMgrs.forEach(function(t){return t.boardPositionName=_.find(s.FellowResidentsService.BoardPositionNames,function(e){return e.id===t.boardPosition}).name});var i,n=[1,64,16,2,4,8,32],e=(o.boardMembers=_.sortBy(o.boardMembers,function(e){e=_.indexOf(n,e.boardPosition);return e=-1===e?100:e}),o.allOwners=_.reduce(o.unitList,function(e,t){return Array.prototype.push.apply(e,t.owners),e},[]),o.allOwners=_.map(_.groupBy(o.allOwners,function(e){return e.email}),function(e){return e[0]}),o.allOwnerEmails=_.reduce(o.allOwners,function(e,t){return HtmlUtil.isValidString(t.email)&&e.push(t.email),e},[]),o.unitList&&0<o.unitList.length&&(o.unitList=s.HtmlUtil2.smartSortStreetAddresses(o.unitList,"name")),o.committees&&(o.committees=_.sortBy(o.committees,function(e){return e.committeeName.toLowerCase()})),o.appCacheService.getAndClear("scrollToUnitId"));e&&(i="unit-id-"+e,setTimeout(function(){document.getElementById(i).scrollIntoView(),$("#"+i).effect("pulsate",{times:3},2e3)},300)),setTimeout(function(){return o.loadGroupEmails()},500)},function(e){alert("Failed to retrieve group members. Please let tech support know via the contact form in the bottom right."),console.log("Failed to retrieve group members: "+e.data.exceptionMessage)})},a.prototype.updateMemberFilter=function(){(this.memberSearchTerm||"").toLowerCase()},a.prototype.loadGroupEmails=function(){var o=this;this.hasMissingEmails=_.some(this.allResidents,function(e){return!e.hasEmail}),this.groupEmailsLoadError=null,this.isLoadingGroupEmails=!0,this.fellowResidents.getAllGroupEmails().then(function(e){if(o.isLoadingGroupEmails=!1,o.emailLists=e.standardGroups,o.customEmailList=e.customGroups,o.customEmailList)for(var t=0,i=o.customEmailList;t<i.length;t++){var n=i[t];n.usersFullNames=n.members.map(function(t){return o.allResidents.find(function(e){return e.userId===t.userId}).fullName})}setTimeout(function(){var e=new Clipboard(".clipboard-button");e.on("success",function(e){s.HtmlUtil2.showTooltip(e.trigger,"Copied!"),e.clearSelection()}),e.on("error",function(e){s.HtmlUtil2.showTooltip(e.trigger,"Auto-copy failed, press CTRL+C now")})},750)},function(e){o.isLoadingGroupEmails=!1,o.groupEmailsLoadError="Failed to load group email addresses: "+e.data.exceptionMessage})},a.prototype.onAddNewCustomEmailGroup=function(){this.shouldShowNewCustomEmailModal=!0,this.editGroupEmailInfo=new i,this.allResidents.forEach(function(e){return e.isAssociated=!1}),window.setTimeout(function(){return document.getElementById("custom-group-email-short-name-text").focus()},50)},a.prototype.onGroupEmailMemberClicked=function(e){var t=this.editGroupEmailInfo.memberUserIds.indexOf(e.userId);-1===t?this.editGroupEmailInfo.memberUserIds.push(e.userId):this.editGroupEmailInfo.memberUserIds.splice(t,1)},a.prototype.saveGroupEmailInfo=function(){function e(){i.isLoadingSaveEmailGroup=!1,i.shouldShowNewCustomEmailModal=!1,i.editGroupEmailInfo=null,i.fellowResidents.clearResidentCache(),i.loadGroupEmails()}function t(e){i.isLoadingSaveEmailGroup=!1,i.groupEmailSaveError="Failed to process your request: "+e.data.exceptionMessage}var i=this;this.isLoadingSaveEmailGroup=!0,this.groupEmailSaveError=null;(this.editGroupEmailInfo.existingGroupEmailId?this.$http.put("/api/BuildingResidents/EditCustomGroupEmail",this.editGroupEmailInfo):this.$http.post("/api/BuildingResidents/NewCustomGroupEmail",this.editGroupEmailInfo)).then(e,t)},a.prototype.editGroupEmail=function(e){var t=this;this.shouldShowNewCustomEmailModal=!0,this.editGroupEmailInfo=new i,this.editGroupEmailInfo.existingGroupEmailId=e.customGroupEmailId,this.editGroupEmailInfo.description=e.description,this.editGroupEmailInfo.shortName=e.shortName,this.editGroupEmailInfo.memberUserIds=e.members.map(function(e){return e.userId}),this.allResidents.forEach(function(e){return e.isAssociated=-1!==t.editGroupEmailInfo.memberUserIds.indexOf(e.userId)}),window.setTimeout(function(){return document.getElementById("custom-group-email-short-name-text").focus()},50)},a.prototype.deleteGroupEmail=function(e){var t=this;confirm("Are you sure you want to delete this group email address? Emails sent to this address will no longer be delivered.")&&(this.isLoadingGroupEmails=!0,this.$http.delete("/api/BuildingResidents/DeleteCustomGroupEmail/"+e.customGroupEmailId).then(function(){t.isLoadingGroupEmails=!1,t.fellowResidents.clearResidentCache(),t.loadGroupEmails()},function(e){t.isLoadingGroupEmails=!1,t.groupEmailSaveError="Failed to process your request: "+e.data.exceptionMessage}))},a.$inject=["fellowResidents","SiteInfo","appCacheService","$http"],a.AllBoardUserId="af615460-d92f-4878-9dfa-d5e4a9b1f488",s.GroupMembersController=a;var i=function(){this.memberUserIds=[]}}(Ally=Ally||{}),CA.angularApp.component("groupMembers",{templateUrl:"/ngApp/chtn/member/group-members.html",controller:Ally.GroupMembersController}),!function(e){var i=function(){};function t(e,t){this.$http=e,this.siteInfo=t,this.sendInfo=new i,this.isLoading=!1,this.wasMessageSent=!1,this.onSendHelp=function(){var e;$("#help-form").validate(),$("#help-form").valid()&&(this.isLoading=!0,(e=this).$http.post("/api/Help",this.sendInfo).then(function(){e.isLoading=!1,e.sendInfo={},e.wasMessageSent=!0,e.resultStyle.color="#00F",e.sendResult="Your message has been sent. We'll do our best to get back to you within 24 hours."},function(){e.isLoading=!1,e.resultStyle.color="#F00",e.sendResult="Failed to send message."}))},this.resultStyle={"text-align":"center","font-size":"large","font-weight":"bold"}}t.prototype.$onInit=function(){this.siteInfo.isLoggedIn&&(this.sendInfo.emailAddress=this.siteInfo.userInfo.emailAddress)},t.$inject=["$http","SiteInfo"],e.HelpFormController=t}(Ally=Ally||{}),CA.angularApp.component("helpForm",{templateUrl:"/ngApp/chtn/member/help.html",controller:Ally.HelpFormController}),!function(s){function r(e,t,i,n,o,s,a){this.$scope=e,this.$timeout=t,this.$http=i,this.$rootScope=n,this.$q=o,this.fellowResidents=s,this.siteInfo=a,this.showBadNotificationDateWarning=!1,this.isLoadingNews=!1,this.isLoadingLogbookForCalendar=!1,this.isLoadingPolls=!1,this.isLoadingCalendarEvents=!1,this.onlyRefreshCalendarEvents=!1,this.showExpandedCalendarEventModel=!1,this.currentTimeZoneAbbreviation="CT",this.localTimeZoneDiffersFromGroup=!1,this.associatedGroups=[],this.GroupShortNameIndividuals="Individuals",this.clearViewEvent=function(){this.viewEvent=null}}r.prototype.$onInit=function(){var t=this,e=moment(),i=moment.tz.guess(),o=(this.currentTimeZoneAbbreviation=e.tz(i).format("z"),this.siteInfo.privateSiteInfo.groupAddress&&this.siteInfo.privateSiteInfo.groupAddress.timeZoneIana&&(this.groupTimeZoneAbbreviation=e.tz(this.siteInfo.privateSiteInfo.groupAddress.timeZoneIana).format("z"),this.groupTimeZoneAbbreviation!=this.currentTimeZoneAbbreviation)&&(this.localTimeZoneDiffersFromGroup=!0),AppConfig.isChtnSite&&this.fellowResidents.getResidents().then(function(e){t.residents=e,t.residents=_.sortBy(t.residents,function(e){return e.lastName})}),this),n={height:600,editable:!1,header:{left:"prevYear prev next nextYear today",center:"title",right:"month listYear"},viewRender:function(e,t){$(t).css("cursor","pointer")},dayClick:function(e){var t;o.$rootScope.isSiteManager&&(t=moment(moment.utc(e).format(r.DateFormat)).toDate(),o.$scope.$apply(function(){o.setEditEvent({date:t,dateOnly:t,associatedUserIds:[],notificationEmailDaysBefore:null},!1)}))},eventClick:function(e){o.$scope.$apply(function(){e.calendarEventObject&&(o.$rootScope.isSiteManager?o.setEditEvent(e.calendarEventObject,!0):o.viewEvent=e.calendarEventObject)})},eventRender:function(e,t){$(t).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:e.fullDescription,title:e.toolTipTitle}})},eventSources:[{events:function(e,t,i,n){o.getAssociationEvents(e,t,i,n)}},{events:function(e,t,i,n){o.getCalendarEvents(e,t,i,n)}}]};$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(n),$("#calendar-event-time").timepicker({scrollDefault:"10:00am"}),$(".fc-bg td.fc-today").append("<div class='today-note'>Today</div>")}),this.fellowResidents.getGroupEmailObject().then(function(e){t.associatedGroups=e.map(function(e){return{groupShortName:e.recipientType.toUpperCase()===s.FellowResidentsService.CustomRecipientType?"custom:"+e.recipientTypeName:e.recipientType,displayLabel:e.displayName,isAssociated:!1}}),t.associatedGroups.push({displayLabel:t.GroupShortNameIndividuals,groupShortName:t.GroupShortNameIndividuals,isAssociated:!1})})},r.prototype.getAllEvents=function(e,t){var n=this,i=AppConfig.isChtnSite,e=e.format(r.DateFormat),t=t.format(r.DateFormat),o=this.$q.defer(),s=this.$q.defer(),a=this.$q.defer();return o.resolve(),s.resolve(),i?(this.isLoadingPolls=!0,this.$http.get("/api/Poll/DateRange?startDate="+e+"&endDate="+t).then(function(e){e=e.data;n.isLoadingPolls=!1,_.each(e,function(e){var t=e.text,i=(10<t.length&&(t=t.substring(0,10)+"..."),"Posted by: "+e.authorName+"<br><p>"+e.text+"</p>");n.calendarEvents.push({title:"Poll: "+t,start:moment(e.postDate).toDate(),calendarEventObject:null,toolTipTitle:"Poll Added",fullDescription:i,allDay:!1})}),a.resolve()},function(){n.isLoadingPolls=!1,a.resolve()})):a.resolve(),this.$q.all([o.promise,s.promise,a.promise])},r.prototype.getAssociationEvents=function(e,t,i,n){var o=this;this.onlyRefreshCalendarEvents?(this.onlyRefreshCalendarEvents=void 0,n(this.calendarEvents)):(this.calendarEvents=[],this.getAllEvents(e,t).then(function(){n(o.calendarEvents)}))},r.prototype.getCalendarEvents=function(e,t,i,n){var o=this,e=(this.isLoadingCalendarEvents=!0,e.format(r.DateFormat)),t=t.format(r.DateFormat);this.$http.get("/api/CalendarEvent?startDate="+e+"&endDate="+t).then(function(e){var s=[];o.isLoadingCalendarEvents=!1,_.each(e.data,function(e){var t=moment.utc(e.eventDateUtc),i=t.format(r.TimeFormat)==r.NoTime,t=i?(e.timeOnly="",e.dateOnly=new Date(t.year(),t.month(),t.date()),new Date(t.year(),t.month(),t.date())):(t=moment.utc(e.eventDateUtc).local(),e.timeOnly=t.format(r.TimeFormat),e.dateOnly=t.clone().startOf("day").toDate(),t.toDate()),n=e.title,o=(n&&10<n.length&&(n=n.substring(0,10)+"..."),"Posted by: "+e.authorName+"<br><p>"+e.title+"</p>");s.push({title:n,start:t,toolTipTitle:"Event",fullDescription:o,calendarEventObject:e,allDay:i})}),n(s)},function(){o.isLoadingCalendarEvents=!1})},r.prototype.onResidentClicked=function(e){e.hasEmail?_.contains(this.editEvent.associatedUserIds,e.userId)?this.editEvent.associatedUserIds=_.without(this.editEvent.associatedUserIds,e.userId):this.editEvent.associatedUserIds.push(e.userId):(alert("That user cannot be included because they do not have an email address on file."),e.isAssociated=!1)},r.prototype.isDateInPast=function(e){var e=moment(e),t=moment();return e.isBefore(t,"day")||e.isSame(t,"day")},r.prototype.onShouldSendChange=function(){this.editEvent.shouldSendNotification&&this.isDateInPast(this.editEvent.dateOnly)?this.editEvent.shouldSendNotification=!1:this.editEvent.notificationEmailDaysBefore||(this.editEvent.notificationEmailDaysBefore=1)},r.prototype.onChangeEmailDaysBefore=function(){var e=moment(this.editEvent.dateOnly).subtract(this.editEvent.notificationEmailDaysBefore,"day"),t=moment();this.showBadNotificationDateWarning=e.isBefore(t,"day")||e.isSame(t,"day"),this.showBadNotificationDateWarning&&(this.maxDaysBack=moment(this.editEvent.dateOnly).diff(t,"day"),this.editEvent.notificationEmailDaysBefore=this.maxDaysBack,this.$timeout(function(){this.showBadNotificationDateWarning=!1},1e4))},r.prototype.expandCalendarEventModel=function(){this.showExpandedCalendarEventModel=!0,this.hookUpWysiwyg()},r.prototype.hookUpWysiwyg=function(){var t=this;this.$timeout(function(){s.HtmlUtil2.initTinyMce("tiny-mce-editor",200,{menubar:!1}).then(function(e){t.tinyMceEditor=e,t.editEvent&&t.editEvent.description?t.tinyMceEditor.setContent(t.editEvent.description):t.tinyMceEditor.setContent("")})},100)},r.prototype.setEditEvent=function(e,t){var i=this;this.showExpandedCalendarEventModel=t||!1,this.editEvent=e,this.showBadNotificationDateWarning=!1,this.editEvent&&(this.residents&&(this.residents.forEach(function(e){return e.isAssociated=!1}),this.editEvent.associatedUserIds)&&this.residents.filter(function(e){return-1!==i.editEvent.associatedUserIds.indexOf(e.userId)}).forEach(function(e){return e.isAssociated=!0}),this.editEvent.associatedGroupShortNames?this.associatedGroups.forEach(function(e){e.isAssociated=-1!==i.editEvent.associatedGroupShortNames.indexOf(e.groupShortName)}):this.associatedGroups.forEach(function(e){return e.isAssociated=!1}),this.editEvent.associatedGroupShortNames=this.associatedGroups.filter(function(e){return e.isAssociated}).map(function(e){return e.groupShortName}),this.editEvent.shouldSendNotification=null!==this.editEvent.notificationEmailDaysBefore,setTimeout(function(){$("#calendar-event-title").focus()},10),this.showExpandedCalendarEventModel)&&this.hookUpWysiwyg()},r.prototype.deleteCalendarEvent=function(e){var t=this;confirm("Are you sure you want to remove this event?")&&(this.isLoadingCalendarEvents=!0,this.$http.delete("/api/CalendarEvent?eventId="+e).then(function(){t.isLoadingCalendarEvents=!1,t.editEvent=null,t.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){t.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")}))},r.prototype.getDaysBeforeValue=function(){var e=null;return null!==this.editEvent.notificationEmailDaysBefore&&void 0!==this.editEvent.notificationEmailDaysBefore&&("string"==typeof this.editEvent.notificationEmailDaysBefore?(e=parseInt(this.editEvent.notificationEmailDaysBefore),isNaN(e)&&(e=null)):"number"==typeof this.editEvent.notificationEmailDaysBefore&&(e=this.editEvent.notificationEmailDaysBefore)),e=null!==e&&e<0?null:e},r.prototype.saveCalendarEvent=function(){var t=this;if(s.HtmlUtil2.isValidString(this.editEvent.title)){if(this.tinyMceEditor&&(this.editEvent.description=this.tinyMceEditor.getContent()),this.editEvent.shouldSendNotification)if(null===this.getDaysBeforeValue())return void alert("Please enter a valid number for the 'days before' email send date");this.residents&&(e=_.filter(this.residents,function(e){return e.isAssociated}),this.editEvent.associatedUserIds=_.map(e,function(e){return e.userId}));var e="";"string"==typeof this.editEvent.timeOnly&&1<this.editEvent.timeOnly.length?(e=moment(this.editEvent.dateOnly).format(r.DateFormat)+" "+this.editEvent.timeOnly,this.editEvent.eventDateUtc=moment(e,r.DateFormat+" "+r.TimeFormat).utc().toDate()):(e=moment(this.editEvent.dateOnly).format(r.DateFormat)+" "+r.NoTime,this.editEvent.eventDateUtc=moment.utc(e,r.DateFormat+" "+r.TimeFormat).toDate()),this.editEvent.shouldSendNotification||(this.editEvent.notificationEmailDaysBefore=null),this.editEvent.associatedGroupShortNames=this.associatedGroups.filter(function(e){return e.isAssociated}).map(function(e){return e.groupShortName}),e=this.editEvent.eventId?this.$http.put:this.$http.post,analytics.track("addCalendarEvent"),this.isLoadingCalendarEvents=!0,e("/api/CalendarEvent",this.editEvent).then(function(){t.isLoadingCalendarEvents=!1,t.editEvent=null,t.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(e){t.isLoadingCalendarEvents=!1;e=e.data.exceptionMessage||e.data;alert("Failed to save the calendar event: "+e)})}else alert("Please enter a title in the 'what' field")},r.prototype.getNumSelectedIndividuals=function(){return this.residents.filter(function(e){return e.isAssociated}).length},r.prototype.getNumSelectedGroups=function(){return this.associatedGroups.filter(function(e){return e.isAssociated}).length},r.$inject=["$scope","$timeout","$http","$rootScope","$q","fellowResidents","SiteInfo"],r.DateFormat="YYYY-MM-DD",r.TimeFormat="h:mma",r.NoTime="12:37am",s.LogbookController=r}(Ally=Ally||{}),CA.angularApp.component("logbookPage",{templateUrl:"/ngApp/chtn/member/logbook.html",controller:Ally.LogbookController}),!function(e){var a=function(){this.emailAddress="",this.password=""},t=(e.LoginInfo=a,i.prototype.$onInit=function(){HtmlUtil.isLocalStorageAllowed()||(this.loginResult="You have cookies/local storage disabled. Condo Ally requires these features, please enable to continue. You may be in private browsing mode.");var e=navigator.userAgent.toLowerCase(),e=-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):0;0<e&&e<10&&(document.getElementById("bad-browser-panel").style.display="block"),this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),"1"===HtmlUtil.GetQueryStringParameter("s")&&(this.isDemoSite=!1),this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl,this.sectionStyle={position:"relative"},this.isDemoSite||(this.welcomeImageContainerStyle={"margin-bottom":"21px","max-width":"100%"},(e=window.localStorage.welcomeImage_width)&&"0"!=e&&!HtmlUtil.isNullOrWhitespace(this.loginImageUrl)&&(this.welcomeImageContainerStyle.width=e+"px",this.welcomeImageContainerStyle.height=window.localStorage.welcomeImage_height+"px"),HtmlUtil.isNullOrWhitespace(this.loginImageUrl)?this.sectionStyle["max-width"]="500px":this.sectionStyle["max-width"]="760px",this.sectionStyle["margin-left"]="auto",this.sectionStyle["margin-right"]="auto"),"true"===this.appCacheService.getAndClear(AppCacheService.Key_WasLoggedIn403)?this.$rootScope.isSiteManager?this.loginResult="You are not authorized to perform that action. Please contact support.":this.loginResult="You are not authorized to perform that action. Please contact an admin.":"true"===this.appCacheService.getAndClear(AppCacheService.Key_WasLoggedIn401)&&(this.loginResult="Please login first."),setTimeout(function(){$("#login-email-textbox").focus()},200)},i.prototype.onWelcomeImageLoaded=function(e){var t=document.getElementById("welcome-image");window.localStorage.welcomeImage_width=t.naturalWidth,window.localStorage.welcomeImage_height=t.naturalHeight,this.welcomeImageContainerStyle.width=t.naturalWidth+"px",this.welcomeImageContainerStyle.height="auto"},i.prototype.onWelcomeImageError=function(){document.getElementById("welcome-image");console.log("Welcome image error"),window.localStorage.removeItem("welcomeImage_width"),window.localStorage.removeItem("welcomeImage_height")},i.prototype.onForgotPassword=function(){this.appCacheService.set("forgotEmail",this.loginInfo.emailAddress),this.$location.path("/ForgotPassword")},i.prototype.demoLogin=function(){this.loginInfo={emailAddress:"testuser",password:"demosite"},this.onLogin()},i.prototype.onLogin=function(){this.isLoading=!0;var i=this;this.$http.post("/api/Login",this.loginInfo).then(function(e){i.isLoading=!1;var e=e.data,t=i.appCacheService.getAndClear(AppCacheService.Key_AfterLoginRedirect);i.siteInfo.setAuthToken(e.authToken),i.siteInfo.handleSiteInfo(e.siteInfo,i.$rootScope),i.rememberMe?(window.localStorage.rememberMe_Email=i.loginInfo.emailAddress,window.localStorage.rememberMe_Password=btoa(i.loginInfo.password)):(window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null),e.siteInfo.userInfo.acceptedTermsDate||i.isDemoSite?(HtmlUtil.isValidString(t)||"/Login"===t||(t="/Home"),i.$location.path(t)):i.$location.path("/MyProfile")},function(e){i.isLoading=!1;e=e.data.exceptionMessage||e.data;i.loginResult="Failed to log in: "+e})},i.$inject=["$http","$rootScope","$location","appCacheService","SiteInfo","xdLocalStorage"],i);function i(e,t,i,n,o,s){this.$http=e,this.$rootScope=t,this.$location=i,this.appCacheService=n,this.siteInfo=o,this.xdLocalStorage=s,this.isDemoSite=!1,this.loginInfo=new a}e.LoginController=t}(Ally=Ally||{}),CA.angularApp.component("loginPage",{templateUrl:"/ngApp/chtn/member/login.html",controller:Ally.LoginController}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}()),CreateDwollaUser=(!function(e){function t(){}e.SimpleUserEntry=t,__extends(o,i=t);var i,n=o;function o(){return null!==i&&i.apply(this,arguments)||this}e.SimpleUserEntryWithTerms=n;var s;__extends(a,s=n);function a(){return null!==s&&s.apply(this,arguments)||this}__extends(l,r=t);var r,n=l;function l(){return null!==r&&r.apply(this,arguments)||this}function d(e,t,i,n,o,s){this.$rootScope=e,this.$http=t,this.$location=i,this.appCacheService=n,this.siteInfo=o,this.$scope=s,this.showPassword=!1,this.shouldShowPassword=!1,this.selectedProfileView="Primary",this.passwordComplexity="short"}e.PtaMember=n,d.prototype.$onInit=function(){var i=this;this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),this.siteInfo.privateSiteInfo&&(this.canHideContactInfo=this.siteInfo.privateSiteInfo.canHideContactInfo),this.retrieveProfileData();setTimeout(function(){$("#JQFileUploader").fileupload({dropZone:null,pasteZone:null,add:function(e,t){t.url="api/DocumentUpload/ProfileImage?ApiAuthToken="+i.siteInfo.authToken,i.siteInfo.publicSiteInfo.baseApiUrl&&(t.url=i.siteInfo.publicSiteInfo.baseApiUrl+"DocumentUpload/ProfileImage"),i.$scope.$apply(function(){return i.isLoading=!0}),t.submit().done(function(e){i.$scope.$apply(function(){window.location.reload()})})},beforeSend:function(e){i.siteInfo.publicSiteInfo.baseApiUrl?e.setRequestHeader("Authorization","Bearer "+i.$rootScope.authToken):e.setRequestHeader("ApiAuthToken",i.$rootScope.authToken)},fail:function(e,t){i.$scope.$apply(function(){i.isLoading=!1,alert("Upload Failed: "+t.jqXHR.responseJSON.exceptionMessage)})}})},500)},d.prototype.saveProfilePhoto=function(e){var t=this;"upload"!==this.initialProfileImageType||confirm("Are you sure you want to change your profile image away from your uploaded photo? Your uploaded photo will be deleted.")?(this.isLoading=!0,this.$http.put("/api/MyProfile/ProfileImage?type="+e,null).then(function(){t.isLoading=!1,t.initialProfileImageType=t.profileImageType},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})):this.profileImageType=this.initialProfileImageType},d.prototype.onShowPassword=function(){document.getElementById("passwordTextBox").type=this.shouldShowPassword?"text":"password"},d.prototype.retrieveProfileData=function(){var t=this;this.isLoading=!0,this.$http.get("/api/MyProfile").then(function(e){t.isLoading=!1,t.profileInfo=e.data,t.initialProfileImageType="blank",t.profileInfo.avatarUrl&&-1===t.profileInfo.avatarUrl.indexOf("blank-headshot")?t.profileInfo.avatarUrl&&-1!==t.profileInfo.avatarUrl.indexOf("gravatar")?t.initialProfileImageType="gravatar":t.profileInfo.avatarUrl&&0<t.profileInfo.avatarUrl.length&&(t.initialProfileImageType="upload"):t.initialProfileImageType="blank","upload"!==t.initialProfileImageType&&(t.profileInfo.avatarUrl=null),t.profileImageType=t.initialProfileImageType,t.gravatarUrl="https://www.gravatar.com/avatar/"+md5((t.profileInfo.email||"").toLowerCase())+"?s=80&d=identicon",HtmlUtil.endsWith(t.profileInfo.email,"@condoally.com")&&(t.profileInfo.email=""),t.needsToAcceptTerms=null===t.profileInfo.acceptedTermsDate&&!t.isDemoSite,t.hasAcceptedTerms=!t.needsToAcceptTerms,t.$rootScope.shouldHideMenu=t.needsToAcceptTerms,t.saveButtonStyle={width:"100px","font-size":"1em"}})},d.prototype.onSaveInfo=function(){var t=this;this.isLoading=!0,this.$http.put("/api/MyProfile",this.profileInfo).then(function(){t.profileInfo.password=null,t.resultMessage="Your changes have been saved.",t.$rootScope.shouldHideMenu&&(t.$rootScope.shouldHideMenu=!1,t.$location.path("/Home")),t.isLoading=!1},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},d.prototype.onPasswordChange=function(){var e,t,i;!this.profileInfo.password||this.profileInfo.password.length<6?this.passwordComplexity="short":(i=!!this.profileInfo.password.match(/[a-z]+/i),e=!!this.profileInfo.password.match(/[0-9]+/),t=!!this.profileInfo.password.match(/[^a-z0-9]+/i),i=12<=this.profileInfo.password.length&&i&&e&&t,this.passwordComplexity=i?"complex":"simple")},d.$inject=["$rootScope","$http","$location","appCacheService","SiteInfo","$scope"],e.MyProfileController=d}(Ally=Ally||{}),CA.angularApp.component("myProfile",{templateUrl:"/ngApp/chtn/member/my-profile.html",controller:Ally.MyProfileController}),!function(e){function t(e,t,i,n){this.$scope=e,this.$http=t,this.$timeout=i,this.WizardHandler=n,this.unitNumberingType="Numbered",this.numUnits=3,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.shouldShowHoaMessage=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.signUpInfo={buildings:[{units:[]}],signerUpInfo:{buildingIndex:0,boardPositionValue:"1"},recaptchaKey:""}}t.prototype.$onInit=function(){var i=this,e=this;this.$timeout(function(){e.init()},500),this.$scope.$on("wizard:stepChanged",function(e,t){2===t.index&&i.$timeout(function(){return grecaptcha.render("recaptcha-check-elem")},50)})},t.prototype.onNumUnitsChanged=function(){if(this.numUnits){this.numUnits<1?this.numUnits=1:100<this.numUnits&&(this.numUnits=100);var e=this.numUnits-this.signUpInfo.buildings[0].units.length;if(this.signUpInfo.buildings[0].units.length=this.numUnits,0<e)for(var t=this.numUnits-e;t<this.numUnits;++t)this.signUpInfo.buildings[0].units[t]={name:this.getUnitName(t),residents:[{}]}}},t.prototype.onAssociationNameChanged=function(){this.signUpInfo&&this.signUpInfo.name?this.shouldShowHoaMessage=-1!==this.signUpInfo.name.toLowerCase().indexOf("hoa")||-1!==this.signUpInfo.name.toLowerCase().indexOf("home"):this.shouldShowHoaMessage=!1},t.prototype.addResident=function(e){e.residents||(e.residents=[]),e.residents.push({})},t.prototype.getUnitName=function(e){var t,i;return"Numbered"===this.unitNumberingType?(e+1).toString():"Lettered"===this.unitNumberingType?(t="",0<(i=Math.floor(e/26))&&(t+=String.fromCharCode("A".charCodeAt(0)+(i-1))),i=e%26,t+String.fromCharCode("A".charCodeAt(0)+i)):"EW"===this.unitNumberingType||"NS"===this.unitNumberingType?e%2==0?(e/2+1).toString()+("EW"===this.unitNumberingType?"E":"N"):Math.ceil(e/2).toString()+("EW"===this.unitNumberingType?"W":"S"):(e+1).toString()},t.prototype.onNumberingTypeChange=function(){for(var e=0;e<this.signUpInfo.buildings[0].units.length;++e)this.signUpInfo.buildings[0].units[e]||(this.signUpInfo.buildings[0].units[e]={}),this.signUpInfo.buildings[0].units[e].name=this.getUnitName(e)},t.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},t.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},t.prototype.init=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted",{category:"SignUp",label:"Started"});var e=document.getElementById("address-map"),e=(this.map=new google.maps.Map(e,{center:{lat:41.869638,lng:-87.657423},zoom:9}),document.getElementById("building-0-address-text-box")),i=(this.addressAutocomplete=new google.maps.places.Autocomplete(e),this.addressAutocomplete.bindTo("bounds",this.map),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this);this.addressAutocomplete.addListener("place_changed",function(){i.setPlaceWasSelected(),i.mapMarker.setVisible(!1);var e=i.addressAutocomplete.getPlace(),t=e.formatted_address;t.indexOf(", USA")===t.length-", USA".length&&(t=t.substring(0,t.length-", USA".length)),i.signUpInfo.buildings[0].streetAddress=t,HtmlUtil.isNullOrWhitespace(i.signUpInfo.name)&&i.$scope.$apply(function(){i.signUpInfo.name=e.name+" Condo Association"}),e.geometry&&(i.centerMap(e.geometry),$("#association-name-text-box").focus())}),i.onNumUnitsChanged()},t.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForBuildingAddress())},t.prototype.refreshMapForBuildingAddress=function(){this.isLoadingMap=!0;var n=this;HtmlUtil.geocodeAddress(this.signUpInfo.buildings[0].streetAddress,function(t,i){n.$scope.$apply(function(){var e;n.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK&&((e=t[0].formatted_address).indexOf(", USA")===e.length-", USA".length&&(e=e.substring(0,e.length-", USA".length)),n.signUpInfo.buildings[0].streetAddress=e,n.centerMap(t[0].geometry),HtmlUtil.isNullOrWhitespace(n.signUpInfo.name))&&(e=HtmlUtil.getStringUpToFirst(e,","),n.signUpInfo.name=e+" Condo Association")})})},t.prototype.addBuilding=function(){25<=this.signUpInfo.buildings.length+1?alert("We do not support more than 25 buildings."):this.signUpInfo.buildings.push({})},t.prototype.onFinishedWizard=function(){var t=this;this.signUpInfo.recaptchaKey=grecaptcha.getResponse(),HtmlUtil.isNullOrWhitespace(this.signUpInfo.recaptchaKey)?alert("Please complete the reCAPTCHA field"):(this.isLoading=!0,this.$http.post("/api/SignUpWizard",this.signUpInfo).then(function(e){t.isLoading=!1;e=e.data;HtmlUtil.isNullOrWhitespace(e.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete",{category:"SignUp",label:"Success"}),HtmlUtil.isNullOrWhitespace(e.createUrl)?(t.hideWizard=!0,t.resultMessage="Great work! We just sent you an email with instructions on how access your new site."):window.location.href=e.createUrl):(alert("Failed to complete sign-up: "+e.errorMessage),t.WizardHandler.wizard().goTo(e.stepIndex),grecaptcha.reset())},function(e){t.isLoading=!1,alert("Failed to complete sign-up: "+e.data.exceptionMessage),grecaptcha.reset()}))},t.$inject=["$scope","$http","$timeout","WizardHandler"],e.CondoSignUpWizardController=t}(Ally=Ally||{}),CA.angularApp.component("condoSignUpWizard",{templateUrl:"/ngApp/chtn/public/condo-sign-up-wizard.html",controller:Ally.CondoSignUpWizardController}),!function(e){e.DiscussionThread=function(){},i.prototype.$onInit=function(){this.unsubscribeUser()},i.prototype.loadDiscussion=function(){var e=decodeURIComponent(this.$routeParams.idValue),t=(this.isLoading=!0,this);this.$http.get("/Discussion/"+e).then(function(e){t.isLoading=!1,t.discussion=e.data},function(e){t.isLoading=!1,t.errorMessage="Failed to find the discussion details. Please contact support to alert them to the issue."})},i.prototype.unsubscribeUser=function(){var e=decodeURIComponent(this.$routeParams.idValue),t=(this.isLoading=!0,this.activeView="loading",this);this.$http.put("/api/Discussion/Unsubscribe/"+e,null).then(function(e){t.isLoading=!1,t.activeView="unsubscribed",t.discussion=e.data},function(e){t.isLoading=!1,t.activeView="error",t.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},i.prototype.resubscribeUser=function(){var e=decodeURIComponent(this.$routeParams.idValue),t=(this.isLoading=!0,this.activeView="loading",this);this.$http.put("/api/Discussion/Resubscribe/"+e,null).then(function(e){t.isLoading=!1,t.activeView="resubscribed"},function(e){t.isLoading=!1,t.activeView="error",t.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},i.$inject=["$http","$routeParams"];var t=i;function i(e,t){this.$http=e,this.$routeParams=t,this.isLoading=!1,this.activeView="loading"}e.DiscussionManageController=t}(Ally=Ally||{}),CA.angularApp.component("discussionManage",{templateUrl:"/ngApp/chtn/public/discussion-manage.html",controller:Ally.DiscussionManageController}),!function(e){function t(e,t){this.$http=e,this.$routeParams=t,this.isLoading=!1,this.showButtons=!0}t.prototype.$onInit=function(){this.boardEmail="board."+HtmlUtil.getSubdomain()+"@inmail."+AppConfig.baseTld},t.prototype.reportAbuse=function(e){var t=this;"not-member"===e&&!confirm("You should reach out to the board rather than contact technical support. Click 'OK' to still proceed with contacting technical support anyway.")||(e={abuseReason:e,idVal:decodeURIComponent(this.$routeParams.idValue),otherReasonText:this.otherReasonText},this.isLoading=!0,this.$http.post("/api/EmailAbuse/v3",e).then(function(){t.isLoading=!1,t.showButtons=!1}))},t.$inject=["$http","$routeParams"],e.EmailAbuseController=t}(Ally=Ally||{}),CA.angularApp.component("emailAbuse",{templateUrl:"/ngApp/chtn/public/email-abuse.html",controller:Ally.EmailAbuseController}),!function(o){function e(){this.name="",this.streetAddress="",this.isResident=!0,this.signerUpInfo=new t,this.referralSource="",this.recaptchaKey=""}var t=function(){this.boardPositionValue=1},i=(o.HoaSignerUpInfo=t,o.HoaSignUpInfo=e,n.prototype.$onInit=function(){var i=this;this.signUpInfo.referralSource=HtmlUtil.GetQueryStringParameter("utm_sourcecapterra"),HtmlUtil.isNullOrWhitespace(this.signUpInfo.referralSource)&&(this.signUpInfo.referralSource=null),this.$scope.$on("wizard:stepChanged",function(e,t){1===t.index?i.$timeout(function(){return i.showMap=!0},50):2===t.index?i.$timeout(function(){return grecaptcha.render("recaptcha-check-elem")},50):i.showMap=!1})},n.prototype.onHoaNameChanged=function(){var e;this.signUpInfo&&this.signUpInfo.name?((e=-1!==this.signUpInfo.name.toLowerCase().indexOf("condo"))&&!this.shouldShowCondoMessage&&$("#suggestCondoMessageLabel").css("font-size","1.3em").css("margin","25px auto").addClass("alert alert-warning").fadeIn(200).fadeOut(200).fadeIn(200).fadeOut(200).fadeIn(200).fadeIn(200).fadeOut(200).fadeIn(200),this.shouldShowCondoMessage=e):this.shouldShowCondoMessage=!1},n.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},n.prototype.initMapStep=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted"),this.showMap=!0;var i,e,t=document.getElementById("association-address-text-box");t&&(this.addressAutocomplete=new google.maps.places.Autocomplete(t),this.addressAutocomplete.bindTo("bounds",this.map)),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this.addressAutocomplete&&(e=function(){i.setPlaceWasSelected(),i.mapMarker.setVisible(!1);var e=i.addressAutocomplete.getPlace(),t=e.formatted_address;t.indexOf(", USA")===t.length-", USA".length&&(t=t.substring(0,t.length-", USA".length)),i.signUpInfo.streetAddress=t,e.geometry&&(i.setEditPolyForAddress(e.geometry.location),i.centerMap(e.geometry))},(i=this).addressAutocomplete.addListener("place_changed",function(){i.$scope.$apply(e)}))},n.prototype.onMapEditorReady=function(e){this.map=e,this.initMapStep()},n.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForAddress())},n.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},n.prototype.setEditPolyForAddress=function(e){var t=.0014;this.hoaPoly={vertices:[{lat:e.lat()-.001,lon:e.lng()-t},{lat:e.lat()+.001,lon:e.lng()-t},{lat:e.lat()+.001,lon:e.lng()+t},{lat:e.lat()-.001,lon:e.lng()+t}]}},n.prototype.refreshMapForAddress=function(){this.isLoadingMap=!0;var n=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){n.$scope.$apply(function(){var e;n.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK&&((e=t[0].formatted_address).indexOf(", USA")===e.length-", USA".length&&(e=e.substring(0,e.length-", USA".length)),n.signUpInfo.streetAddress=e,t[0].geometry)&&(n.setEditPolyForAddress(t[0].geometry.location),n.centerMap(t[0].geometry))})})},n.prototype.onFinishedWizard=function(){var i=this;this.signUpInfo.recaptchaKey=grecaptcha.getResponse(),HtmlUtil.isNullOrWhitespace(this.signUpInfo.recaptchaKey)?alert("Please complete the reCAPTCHA field"):(this.isLoading=!0,this.signUpInfo.boundsGpsVertices=this.hoaPoly.vertices,this.$http.post("/api/SignUpWizard/Hoa",this.signUpInfo).then(function(e){i.isLoading=!1;var t=e.data;HtmlUtil.isNullOrWhitespace(t.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete"),void 0!==window.goog_report_conversion&&window.goog_report_conversion(),i.signUpInfo.referralSource&&void 0!==window.capterra_trackingListener_v2&&window.capterra_trackingListener_v2(),HtmlUtil.isNullOrWhitespace(t.createUrl)?(i.hideWizard=!0,i.resultMessage="Great work! We just sent you an email with instructions on how access your new site."):window.setTimeout(function(){return window.location.href=t.createUrl},50)):(alert("Failed to complete sign-up: "+t.errorMessage),i.WizardHandler.wizard().goTo(t.stepIndex),grecaptcha.reset())},function(e){i.isLoading=!1,alert("Failed to complete sign-up: "+e.data.exceptionMessage),grecaptcha.reset()}))},n.prototype.submitEmailForHoaNotify=function(){var t=this;HtmlUtil.isNullOrWhitespace(this.hoaAlertEmail)?alert("Please enter a valid email address"):(this.isLoading=!0,this.$http.get("/api/PublicEmail/SignUpForHoaAllyAlert?email="+encodeURIComponent(this.hoaAlertEmail)+"&numHomes="+encodeURIComponent(this.hoaAlertNumHomes)).then(function(e){t.isLoading=!1,t.didSignUpForHoaAlert=!0},function(e){t.isLoading=!1,alert("Failed to submit: "+e.data.exceptionMessage)}))},n.$inject=["$scope","$http","$timeout","WizardHandler"],n);function n(e,t,i,n){this.$scope=e,this.$http=t,this.$timeout=i,this.WizardHandler=n,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.shouldShowCondoMessage=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.hoaPoly={vertices:[]},this.showMap=!1,this.didSignUpForHoaAlert=!1,this.signUpInfo=new o.HoaSignUpInfo}o.HoaSignUpWizardController=i}(Ally=Ally||{}),CA.angularApp.component("hoaSignUpWizard",{templateUrl:"/ngApp/chtn/public/hoa-sign-up-wizard.html",controller:Ally.HoaSignUpWizardController}),!function(e){var i=function(){};function t(e,t){this.$http=e,this.siteInfo=t,this.isLoading=!1,this.signUpInfo=new i,this.resultIsError=!1}t.prototype.$onInit=function(){setTimeout(function(){var e=document.getElementById("address-text-box");new google.maps.places.Autocomplete(e,void 0)},750)},t.prototype.onSubmitInfo=function(){var e=this;HtmlUtil.isNullOrWhitespace(this.signUpInfo.emailAddress)?alert("Please enter an email address"):(this.isLoading=!0,this.$http.post("/api/NeighborSignUp/SignUpNewUser",this.signUpInfo).then(function(){e.isLoading=!1,e.resultIsError=!1,e.resultMessage="Your information has been successfully submitted. Look for a welcome email soon."},function(){e.isLoading=!1,e.resultIsError=!0,e.resultMessage="There was an error submitting your information. Please try again."}))},t.prototype.goBack=function(){this.resultMessage=null},t.$inject=["$http"],e.NeighborSignUpController=t}(Ally=Ally||{}),CA.angularApp.component("neighborSignUp",{templateUrl:"/ngApp/chtn/public/neighbor-sign-up.html",controller:Ally.NeighborSignUpController}),!function(o){var s=function(){this.fullName="",this.email="",this.address="",this.neighborhoodName="",this.notes=""};function e(e,t,i,n){this.$scope=e,this.$http=t,this.$timeout=i,this.WizardHandler=n,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.hoaPoly={vertices:[]},this.showMap=!1,this.tempSignUpInfo=new s,this.signUpInfo=new o.HoaSignUpInfo}e.prototype.$onInit=function(){var i=this;this.$scope.$on("wizard:stepChanged",function(e,t){1===t.index?i.$timeout(function(){return i.showMap=!0},50):i.showMap=!1}),setTimeout(function(){var e=document.getElementById("signUpAddress");e&&new google.maps.places.Autocomplete(e)},500)},e.prototype.onSubmitTempInfo=function(){var t=this;this.isLoading=!0,this.$http.post("/api/SignUpWizard/TempNeighborhood",this.tempSignUpInfo).then(function(){t.isLoading=!1,t.submitTempResult="Thank you for your submission. We'll be in touch shortly."},function(e){t.isLoading=!1,t.submitTempResult="Submission failed: "+e.data.exceptionMessage+". Feel free to refresh the page to try again or use the contact form at the bottom of the Community Ally home page."})},e.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},e.prototype.initMapStep=function(){var e,i=this,t=(void 0!==window.analytics&&window.analytics.track("condoSignUpStarted"),this.showMap=!0,document.getElementById("association-address-text-box"));t&&(this.addressAutocomplete=new google.maps.places.Autocomplete(t),this.addressAutocomplete.bindTo("bounds",this.map)),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this.addressAutocomplete&&(e=function(){i.setPlaceWasSelected(),i.mapMarker.setVisible(!1);var e=i.addressAutocomplete.getPlace(),t=e.formatted_address;t.indexOf(", USA")===t.length-", USA".length&&(t=t.substring(0,t.length-", USA".length)),i.signUpInfo.streetAddress=t,e.geometry&&(i.setEditPolyForAddress(e.geometry.location),i.centerMap(e.geometry))},this.addressAutocomplete.addListener("place_changed",function(){i.$scope.$apply(e)}))},e.prototype.onMapEditorReady=function(e){this.map=e,this.initMapStep()},e.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForAddress())},e.prototype.setPlaceWasSelected=function(){var e=this;this.placeWasSelected=!0,this.shouldCheckAddress=!1,setTimeout(function(){e.placeWasSelected=!0},500)},e.prototype.setEditPolyForAddress=function(e){var t=.0014;this.hoaPoly={vertices:[{lat:e.lat()-.001,lon:e.lng()-t},{lat:e.lat()+.001,lon:e.lng()-t},{lat:e.lat()+.001,lon:e.lng()+t},{lat:e.lat()-.001,lon:e.lng()+t}]}},e.prototype.refreshMapForAddress=function(){var n=this;this.isLoadingMap=!0,HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){n.$scope.$apply(function(){var e;n.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK&&((e=t[0].formatted_address).indexOf(", USA")===e.length-", USA".length&&(e=e.substring(0,e.length-", USA".length)),n.signUpInfo.streetAddress=e,t[0].geometry)&&(n.setEditPolyForAddress(t[0].geometry.location),n.centerMap(t[0].geometry))})})},e.prototype.onFinishedWizard=function(){var t=this;this.isLoading=!0,this.signUpInfo.boundsGpsVertices=this.hoaPoly.vertices,this.$http.post("/api/SignUpWizard/Hoa",this.signUpInfo).then(function(e){t.isLoading=!1;e=e.data;HtmlUtil.isNullOrWhitespace(e.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete"),void 0!==window.goog_report_conversion&&window.goog_report_conversion(),HtmlUtil.isNullOrWhitespace(e.createUrl)?(t.hideWizard=!0,t.resultMessage="Great work! We just sent you an email with instructions on how access your new site."):window.location.href=e.createUrl):(alert("Failed to complete sign-up: "+e.errorMessage),t.WizardHandler.wizard().goTo(e.stepIndex))},function(e){t.isLoading=!1,alert("Failed to complete sign-up: "+e.data.exceptionMessage)})},e.$inject=["$scope","$http","$timeout","WizardHandler"],o.NeighborhoodSignUpWizardController=e}(Ally=Ally||{}),CA.angularApp.component("neighborhoodSignUpWizard",{templateUrl:"/ngApp/chtn/public/neighborhood-sign-up-wizard.html",controller:Ally.NeighborhoodSignUpWizardController}),!function(e){var s=function(){};function t(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.appCacheService=o,this.isLoading=!1,this.signUpInfo=new s,this.showInputForm=!0,this.showSchoolField=!1}t.prototype.$onInit=function(){var e=this;this.groupName=this.siteInfo.publicSiteInfo.fullName,this.showSchoolField="pta"===AppConfig.appShortName,window.setTimeout(function(){return e.hookupAddressAutocomplete()},300),this.$timeout(function(){return grecaptcha.render("recaptcha-check-elem")},100)},t.prototype.hookupAddressAutocomplete=function(){var e=document.getElementById("member-home-address-text-box"),t=(this.addressAutocomplete=new google.maps.places.Autocomplete(e,void 0),this);google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var e=t.addressAutocomplete.getPlace();t.signUpInfo.streetAddress=e.formatted_address})},t.prototype.submitInfo=function(){var t=this;this.signUpInfo.recaptchaKey=grecaptcha.getResponse(),HtmlUtil.isNullOrWhitespace(this.signUpInfo.recaptchaKey)?this.errorMessage="Please complete the reCAPTCHA field":(this.isLoading=!0,this.errorMessage=null,this.$http.post("/api/PublicPendingUser",this.signUpInfo).then(function(e){t.isLoading=!1,t.showInputForm=!1},function(e){t.isLoading=!1,t.errorMessage="Failed to submit: "+e.data.exceptionMessage}))},t.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService"],e.PendingMemberSignUpController=t}(Ally=Ally||{}),CA.angularApp.component("pendingMemberSignUp",{templateUrl:"/ngApp/chtn/public/pending-member-sign-up.html",controller:Ally.PendingMemberSignUpController}),!function(e){function t(e,t,i){this.siteInfo=e,this.fellowResidents=t,this.$routeParams=i,this.canManage=!1}t.prototype.$onInit=function(){var t=this;this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId).then(function(e){return t.canManage=e}),this.$routeParams&&HtmlUtil.isNumericString(this.$routeParams.discussionThreadId)&&(this.autoOpenDiscussionThreadId=parseInt(this.$routeParams.discussionThreadId))},t.$inject=["SiteInfo","fellowResidents","$routeParams"],e.CommitteeHomeController=t}(Ally=Ally||{}),CA.angularApp.component("committeeHome",{bindings:{committee:"<"},templateUrl:"/ngApp/committee/committee-home.html",controller:Ally.CommitteeHomeController}),!function(e){function t(e,t,i,n){this.$http=e,this.fellowResidents=t,this.$cacheFactory=i,this.siteInfo=n,this.isLoading=!1,this.canManage=!1}t.prototype.$onInit=function(){this.populateAllMembers()},t.prototype.populateAllMembers=function(){var t=this;this.isLoading=!0,this.fellowResidents.getResidents().then(function(e){t.allGroupMembers=e,t.getMembers()})},t.prototype.setContactMember=function(){var t=this;this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/SetContactMember?userId="+this.contactUser.userId,null).then(function(e){t.isLoading=!1,t.committee.contactMemberUserId=t.contactUser.userId,t.$cacheFactory.get("$http").remove("/api/Committee/"+t.committee.committeeId),t.fellowResidents.clearResidentCache()},function(e){t.isLoading=!1,alert("Failed to set contact member: "+e.data.exceptionMessage)})},t.prototype.getMembers=function(){var i=this;this.isLoading=!0,this.fellowResidents.getCommitteeMembers(this.committee.committeeId).then(function(e){i.isLoading=!1,i.members=e,i.members=_.sortBy(i.members,function(e){return(e.fullName||"").toLowerCase()});i.filteredGroupMembers=_.filter(i.allGroupMembers,function(e){return t=e,!_.some(i.members,function(e){return e.userId===t.userId});var t}),i.filteredGroupMembers=_.sortBy(i.filteredGroupMembers,function(e){return(e.fullName||"").toLowerCase()}),i.contactUser=_.find(i.members,function(e){return e.userId==i.committee.contactMemberUserId}),i.canManage=i.siteInfo.userInfo.isAdmin||i.siteInfo.userInfo.isSiteManager||_.any(i.members,function(e){return e.userId===i.siteInfo.userInfo.userId})},function(e){i.isLoading=!1,alert("Failed to retrieve committee members, please refresh the page to try again")})},t.prototype.addSelectedMember=function(){var t=this;this.userForAdd&&(this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/AddMember?userId="+this.userForAdd.userId,null).then(function(e){t.isLoading=!1,t.getMembers()},function(e){t.isLoading=!1,alert("Failed to add member, please refresh the page to try again: "+e.data.exceptionMessage)}))},t.prototype.removeMember=function(e){var t=this;confirm("Are you sure you want to remove this person from this committee?")&&(this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/RemoveMember?userId="+e.userId,null).then(function(e){t.isLoading=!1,t.getMembers()},function(e){t.isLoading=!1,alert("Failed to remove member, please refresh the page to try again: "+e.data.exceptionMessage)}))},t.$inject=["$http","fellowResidents","$cacheFactory","SiteInfo"],e.CommitteeMembersController=t}(Ally=Ally||{}),CA.angularApp.component("committeeMembers",{bindings:{committee:"<"},templateUrl:"/ngApp/committee/committee-members.html",controller:Ally.CommitteeMembersController}),!function(e){function t(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.$cacheFactory=n,this.$rootScope=o,this.canManage=!1,this.initialView="Home",this.selectedView=null,this.isLoading=!1,this.committeeId=this.$routeParams.committeeId,this.initialView=this.$routeParams.viewName||"Home"}t.prototype.$onInit=function(){this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.retrieveCommittee()},t.prototype.retrieveCommittee=function(){var t=this;this.isLoading=!0,this.$rootScope.dontHandle403=!0,this.$http.get("/api/Committee/"+this.committeeId,{cache:!0}).then(function(e){t.$rootScope.dontHandle403=!1,t.isLoading=!1,t.committee=e.data,t.selectedView=t.initialView},function(e){t.$rootScope.dontHandle403=!1,t.isLoading=!1,403===e.status?(alert("You are not authorized to view this private committee. You must be a member of the committee to view its contents. Reach out to a board member to inquire about joining the committiee."),window.location.href="/#!/Home"):alert("Failed to load committee: "+e.data.exceptionMessage)})},t.prototype.onUpdateCommitteeName=function(){var t=this,e=(this.isLoading=!0,"/api/Committee/"+this.committeeId+"?name="+this.committee.name);this.$http.put(e,null).then(function(){t.isLoading=!1,t.$cacheFactory.get("$http").remove("/api/Committee/"+t.committeeId)},function(e){t.isLoading=!1,alert("Failed to update the committee name: "+e.data.exceptionMessage)})},t.$inject=["$http","SiteInfo","$routeParams","$cacheFactory","$rootScope"],e.CommitteeParentController=t}(Ally=Ally||{}),CA.angularApp.component("committeeParent",{templateUrl:"/ngApp/committee/committee-parent.html",controller:Ally.CommitteeParentController}),!function(o){function e(e,t,i,n){this.$http=e,this.siteInfo=t,this.$timeout=i,this.$rootScope=n,this.isLoading=!1,this.multiSelectWriteInPlaceholder=new o.PollAnswer("write-in")}e.prototype.$onInit=function(){this.refreshPolls()},e.prototype.populatePollData=function(e){(this.polls=e)&&0<e.length&&this.$rootScope.$broadcast("homeHasActivePolls");for(var t=0;t<this.polls.length;++t){var i,n=this.polls[t];n.hasUsersUnitVoted&&n.canViewResults&&(i=o.FellowResidentsService.pollReponsesToChart(n,this.siteInfo),n.chartData=i.chartData,n.chartLabels=i.chartLabels)}},e.prototype.refreshPolls=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Poll?getActive=1").then(function(e){t.isLoading=!1,t.$timeout(function(){return t.populatePollData(e.data)},100)},function(){t.isLoading=!1})},e.prototype.onPollAnswer=function(e,t){var i=this,t=(this.isLoading=!0,t?t.pollAnswerId.toString():""),n=e.writeInAnswer?encodeURIComponent(e.writeInAnswer):"",e="/api/Poll/PollResponse?pollId="+e.pollId+"&answerIdsCsv="+t+"&writeInAnswer="+n;this.$http.put(e,null).then(function(){i.isLoading=!1,i.refreshPolls()},function(e){i.isLoading=!1,alert("Failed to submit vote: "+e.data.exceptionMessage)})},e.prototype.onMultiResponseChange=function(e,t){var i="Abstain"===t.answerText,i=(i&&t.isLocalMultiSelect&&(e.answers.filter(function(e){return"Abstain"!==e.answerText}).forEach(function(e){return e.isLocalMultiSelect=!1}),e.isWriteInMultiSelected=!1),i||(i=e.answers.find(function(e){return"Abstain"===e.answerText}))&&(i.isLocalMultiSelect=!1),e.answers.filter(function(e){return e.isLocalMultiSelect}).length);e.isWriteInMultiSelected&&++i,i>e.maxNumResponses&&(alert("You can only select at most "+e.maxNumResponses+" answers"),t===this.multiSelectWriteInPlaceholder?e.isWriteInMultiSelected=!1:t.isLocalMultiSelect=!1),e.localMultiSelectedAnswers=e.answers.filter(function(e){return e.isLocalMultiSelect})},e.prototype.onSubmitMultiAnswer=function(e){var t,i=this;e.localMultiSelectedAnswers&&0!==e.localMultiSelectedAnswers.length?(t=e.localMultiSelectedAnswers.map(function(e){return e.pollAnswerId}).join(","),this.isLoading=!0,t="/api/Poll/PollResponse?pollId="+e.pollId+"&answerIdsCsv="+t+"&writeInAnswer="+(e.isWriteInMultiSelected&&e.writeInAnswer?encodeURIComponent(e.writeInAnswer):""),this.$http.put(t,null).then(function(){i.isLoading=!1,i.refreshPolls()},function(e){i.isLoading=!1,alert("Failed to submit vote: "+e.data.exceptionMessage)})):alert("Please select at least one reponse")},e.$inject=["$http","SiteInfo","$timeout","$rootScope","fellowResidents"],o.ActivePollsController=e}(Ally=Ally||{}),CA.angularApp.component("activePolls",{templateUrl:"/ngApp/common/active-polls.html",controller:Ally.ActivePollsController}),!function(a){function e(e,t,i,n,o,s){this.$http=e,this.siteInfo=t,this.$rootScope=i,this.$sce=n,this.$timeout=o,this.$q=s,this.isLoading_Payment=!1,this.isLoadingDwolla=!1,this.showParagon=!1,this.showParagonCheckingSignUpModal=!1,this.showParagonCreditSignUpModal=!1,this.dwollaSignUpInfo={dateOfBirth:"",ssnLast4:"",ssnFull:"",streetAddress:new a.FullAddress},this.isWePayPaymentActive=!1,this.isDwollaEnabledOnGroup=!1,this.isDwollaReadyForPayment=!1,this.shouldShowDwollaAddAccountModal=!1,this.shouldShowDwollaModalClose=!1,this.hasComplexPassword=!1,this.didAgreeToDwollaTerms=!1,this.dwollaFeePercent=.5,this.dwollaMaxFee=5,this.dwollaDocUploadType="license",this.dwollaDocUploadFile=null,this.dwollaBalance=-1,this.isDwollaIavDone=!1,this.shouldShowMicroDepositModal=!1,this.dwollaMicroDepositAmount1String="0.01",this.dwollaMicroDepositAmount2String="0.01",this.shouldShowOwnerFinanceTxn=!1,this.shouldShowDwollaAutoPayArea=!0,this.currentDwollaAutoPayAmount=null}e.prototype.$onInit=function(){var t=this,e=(this.showParagon=!1,this.paragonPaymentParams="&BillingAddress1="+encodeURIComponent("900 W Ainslie St")+"&BillingState=Illinois&BillingCity=Chicago&BillingZip=60640&FirstName="+encodeURIComponent(this.siteInfo.userInfo.firstName)+"&LastName="+encodeURIComponent(this.siteInfo.userInfo.lastName),this.paragonCheckingLast4=this.siteInfo.userInfo.paragonCheckingLast4,this.paragonCardLast4=this.siteInfo.userInfo.paragonCardLast4,this.isWePayPaymentActive=this.siteInfo.privateSiteInfo.isWePayPaymentActive,this.isDwollaEnabledOnGroup=this.siteInfo.privateSiteInfo.isDwollaPaymentActive,this.dwollaFeePercent=this.siteInfo.privateSiteInfo.isPremiumPlanActive?.5:1,this.dwollaMaxFee=this.siteInfo.privateSiteInfo.isPremiumPlanActive?5:10,this.shouldShowOwnerFinanceTxn=this.siteInfo.privateSiteInfo.shouldShowOwnerFinanceTxn,this.currentDwollaAutoPayAmount=this.siteInfo.userInfo.dwollaAutoPayAmount,this.siteInfo.privateSiteInfo.customFinancialInstructions&&(this.customFinancialInstructions=this.$sce.trustAsHtml(this.siteInfo.privateSiteInfo.customFinancialInstructions)),this.isDwollaEnabledOnGroup&&(this.isDwollaUserAccountVerified=this.siteInfo.userInfo.isDwollaAccountVerified,this.isDwollaUserAccountVerified?(this.dwollaUserStatus="verified",this.hasDwollaFundingSource=a.HtmlUtil2.isValidString(this.siteInfo.userInfo.dwollaFundingSourceName),this.hasDwollaFundingSource?(this.dwollaFundingSourceName=this.siteInfo.userInfo.dwollaFundingSourceName,this.dwollaFundingSourceIsVerified=this.siteInfo.userInfo.dwollaFundingSourceIsVerified,this.isDwollaReadyForPayment=this.isDwollaUserAccountVerified&&this.dwollaFundingSourceIsVerified&&this.siteInfo.privateSiteInfo.isDwollaPaymentActive,this.isDwollaReadyForPayment&&this.$timeout(function(){t.$http.get("/api/Dwolla/DwollaBalance").then(function(e){return t.dwollaBalance=e.data.balanceAmount})},1e3)):this.$http.get("/api/Dwolla/HasComplexPassword").then(function(e){return t.hasComplexPassword=e.data})):(this.dwollaUserStatus="checking",this.userFullName=this.siteInfo.userInfo.fullName,this.userEmail=this.siteInfo.userInfo.emailAddress,this.$timeout(function(){t.$http.get("/api/Dwolla/MyAccountStatus").then(function(e){t.dwollaUserStatus=e.data.status,t.dwollaSignUpInfo.streetAddress=e.data.streetAddress},function(e){t.dwollaUserStatus="error",console.log("Failed to get Dwolla account status: "+e.data.exceptionMessage)})},500))),this.allyAppName=AppConfig.appName,this.isWePayAutoPayActive=this.siteInfo.userInfo.isAutoPayActive,this.assessmentCreditCardFeeLabel=this.siteInfo.privateSiteInfo.payerPaysCCFee?"Service fee applies":"No service fee",this.assessmentAchFeeLabel=this.siteInfo.privateSiteInfo.payerPaysAchFee?"Service fee applies":"No service fee",this.payerPaysAchFee=this.siteInfo.privateSiteInfo.payerPaysAchFee,this.errorPayInfoText="Is the amount incorrect?",this.isWePaySetup=this.siteInfo.privateSiteInfo.isPaymentEnabled,this.hasAssessments=this.siteInfo.privateSiteInfo.hasAssessments,this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,!this.isWePayAutoPayActive&&HtmlUtil.isNumericString(HtmlUtil.GetQueryStringParameter("preapproval_id"))&&(this.isWePayAutoPayActive=!0),this.nextAutoPayText=this.siteInfo.userInfo.nextAutoPayText,null!=this.siteInfo.userInfo.usersUnits&&0<this.siteInfo.userInfo.usersUnits.length?this.assessmentAmount=this.siteInfo.userInfo.usersUnits.filter(function(e){return!e.isRenter}).reduce(function(e,t){return e+(t.assessment||0)},0):this.assessmentAmount=0,-1!==["qa","casadelnorthern","ivytownhomescondominium"].indexOf(this.siteInfo.publicSiteInfo.shortName));this.shouldShowDwollaAutoPayArea=this.isDwollaReadyForPayment&&e&&null!=this.siteInfo.privateSiteInfo.assessmentFrequency&&0<this.assessmentAmount||"number"==typeof this.currentDwollaAutoPayAmount&&!isNaN(this.currentDwollaAutoPayAmount)&&1<this.currentDwollaAutoPayAmount,this.shouldShowDwollaAutoPayArea&&(this.assessmentFrequencyInfo=PeriodicPaymentFrequencies.find(function(e){return e.id===t.siteInfo.privateSiteInfo.assessmentFrequency})),this.paymentInfo={paymentType:"other",amount:this.assessmentAmount,note:"",fundingType:null,paysFor:[]},this.onPaymentAmountChange();this.historicPayments=this.siteInfo.userInfo.recentPayments,this.historicPayments&&0<this.historicPayments.length&&24<this.historicPayments.length&&(this.historicPayments=this.historicPayments.slice(0,24)),null!=this.siteInfo.privateSiteInfo.assessmentFrequency&&null!=this.siteInfo.userInfo.usersUnits&&0<this.siteInfo.userInfo.usersUnits.length&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled)&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())},e.prototype.showParagonSignUp=function(){var t=this;this.showParagonCheckingSignUpModal=!0,this.paragonSignUpInfo||(this.isLoading_Payment=!0,this.$http.get("/api/Paragon/SignUpPrefill").then(function(e){t.isLoading_Payment=!1,t.paragonSignUpInfo=e.data},function(e){t.isLoading_Payment=!1,t.paragonSignUpInfo=new ParagonPayerSignUpInfo,console.log("Failed to SignUpPrefill: "+e.data.exceptionMessage)}))},e.prototype.showParagonCreditSignUp=function(){var t=this;this.isLoading_Payment=!0,this.paragonCardTokenizedUrl=null,this.paragonCardTokenizationMessage="Connecting...",this.showParagonCreditSignUpModal=!0,this.$http.get("/api/Paragon/CardTokenizationKey").then(function(e){t.isLoading_Payment=!1,t.paragonCardTokenizedUrl=t.$sce.trustAsResourceUrl("https://stage.paragonsolutions.com/ws/hosted.aspx?Username=54cE7DU2p%2bBh7h9uwJWW8Q%3d%3d&Password=jYvmN41tt1lz%2bpiazUqQYK9Abl73Z%2bHoBG4vOZImo%2bYlKTbPeNPwOcMB0%2bmIS3%2bs&MerchantKey=1293&InvNum="+e.data),t.paragonCardTokenizationMessage=null},function(e){t.isLoading_Payment=!1,t.paragonCardTokenizationMessage="There was an error connecting to the server. Please close this window and try again. If this has happened more than once please contact support.",console.log("Failed in CardTokenizationKey: "+e.data.exceptionMessage)})},e.prototype.hideParagonCreditSignUp=function(){this.showParagonCreditSignUpModal=!1,this.paragonCardTokenizedUrl&&window.location.reload()},e.prototype.submitParagonSignUp=function(){var t=this;this.isLoading_Payment=!0,this.paragonSignUpError=null,this.$http.post("/api/Paragon/CheckPaymentSignUp",this.paragonSignUpInfo).then(function(){window.location.reload()},function(e){t.isLoading_Payment=!1,t.paragonSignUpError=e.data.exceptionMessage})},e.prototype.submitParagonPayment=function(e){var t,i=this;confirm("This will submit payment.")&&(this.paragonPaymentMessage=null,(t=new ParagonPaymentRequest).notes=this.paymentInfo.note,t.paymentAmount=this.paymentInfo.amount,t.paysFor=this.paymentInfo.paysFor,t.paySource=e,this.isLoading_Payment=!0,this.$http.post("/api/Paragon/MakePayment",t).then(function(){i.isLoading_Payment=!1,i.paragonPaymentMessage="Payment Successfully Processed"},function(e){i.isLoading_Payment=!1,i.paragonPaymentMessage=e.data.exceptionMessage}))},e.prototype.unenrollParagonAccount=function(e){var t=this;this.isLoading_Payment=!0,this.$http.get("/api/Paragon/UnenrollPayment?paySource="+e).then(function(){window.location.reload()},function(e){t.isLoading_Payment=!1,alert("Failed to un-enroll: "+e.data.exceptionMessage),t.paragonPaymentMessage=e.data.exceptionMessage})},e.prototype.submitWePayPayment=function(e){var t=this,i=(this.isLoading_Payment=!0,this.paymentInfo.fundingType=e,this.paymentInfo.amount);HtmlUtil.isValidString(i)&&"$"===i[0]&&(this.paymentInfo.amount=parseFloat(i.substr(1))),analytics.track("makePayment",{fundingType:e}),this.$http.post("/api/WePayPayment/MakeNewPayment",this.paymentInfo).then(function(e){e=e.data;null!==e&&"string"==typeof e.checkoutUri&&0<e.checkoutUri.length?window.location.href=e.checkoutUri:(t.isLoading_Payment=!1,alert("Unable to initiate WePay checkout"))},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)})},e.prototype.getMyRecentPayments=function(){var t=this;this.$http.get("/api/WePayPayment/MyRecentPayments").then(function(e){t.myRecentPayments=e.data},function(e){console.log("Failed to retrieve recent payments: "+e.data.exceptionMessage)})},e.prototype.onIncorrectPayDetails=function(){var e=this.assessmentAmount.toString(),e=e=Math.round(this.assessmentAmount)!=this.assessmentAmount?this.assessmentAmount.toFixed(2):e;this.knowsNextPayment&&HtmlUtil.isValidString(this.nextPaymentText)&&(e+="|"+this.nextPaymentText),this.$rootScope.$broadcast("prepAssessmentEmailToBoard",e)},e.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},e.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"==e?this.assessmentAmount:0,this.updatePaymentText(),this.onPaymentAmountChange()},e.prototype.getNextPaymentText=function(e,t){var i;return e?(i="",(t=GetLongPayPeriodNames(FrequencyIdToInfo(t).intervalName))&&(i=t[e.period-1]),i+=" "+e.year,this.paymentInfo.paysFor=[e],i):""},e.prototype.onSetupWePayAutoPay=function(e){var t=this;this.isLoading_Payment=!0,this.$http.get("/api/WePayPayment/SetupAutoPay?fundingType="+e).then(function(e){e=e.data;"string"==typeof e&&0<e.length?window.location.href=e:(t.isLoading_Payment=!1,alert("Unable to initiate WePay auto-pay setup"))},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)})},e.prototype.onDisableAutoPay=function(){var t=this;confirm("Just to double check, this will disable your auto-payment. You need to make sure to manually make your regular payments to avoid any late fees your association may enforce.")&&(this.isLoading_Payment=!0,this.$http.get("/api/WePayPayment/DisableAutoPay").then(function(){t.isLoading_Payment=!1,t.isWePayAutoPayActive=!1},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)}))},e.prototype.dwollaSignUp=function(){var t=this;this.didAgreeToDwollaTerms?(this.isLoading_Payment=!0,this.$http.post("/api/Dwolla/CreatePayer",this.dwollaSignUpInfo).then(function(){window.location.reload()},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)})):alert("Please agree to Dwolla's terms and privacy policy")},e.prototype.dwollaStartIAV=function(){var i=this;this.shouldShowDwollaAddAccountModal=!0,this.shouldShowDwollaModalClose=!1,this.isDwollaIavDone=!1,this.isLoadingDwolla=!0;this.$http.get("/api/Dwolla/UserIavToken").then(function(t){i.isLoadingDwolla=!1,window.setTimeout(function(){return e=t.data.iavToken,dwolla.configure(a.AppConfigInfo.dwollaEnvironmentName),void dwolla.iav.start(e,{container:"dwolla-iav-container",stylesheets:["https://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext"],microDeposits:!0,fallbackToMicroDeposits:!0},function(e,t){t&&t._links&&t._links["funding-source"]&&t._links["funding-source"].href&&(t=t._links["funding-source"].href,i.$http.put("/api/Dwolla/SetUserFundingSourceUri",{fundingSourceUri:t}).then(function(){i.isDwollaIavDone=!0},function(e){i.isLoadingDwolla=!1,i.shouldShowDwollaModalClose=!0,alert("Failed to complete sign-up: "+e.data.exceptionMessage)}))});var e},150)},function(e){i.isLoadingDwolla=!1,alert("Failed to start IAV: "+e.data.exceptionMessage)})},e.prototype.hideDwollaAddAccountModal=function(){this.shouldShowDwollaAddAccountModal=!1,this.isDwollaIavDone&&(this.isLoading_Payment=!0,window.location.reload())},e.prototype.submitDwollaPayment=function(){var t=this;this.dwollaPaymentMessage=null,this.isLoading_Payment=!0,this.$http.post("/api/Dwolla/MakePayment",this.paymentInfo).then(function(){t.isLoading_Payment=!1,t.dwollaPaymentMessage="Payment Successfully Processed",t.refreshHistoricPayments()},function(e){t.isLoading_Payment=!1,t.dwollaPaymentMessage="Payment failed: "+e.data.exceptionMessage})},e.prototype.refreshHistoricPayments=function(){var t=this;this.isLoading_Payment=!0,this.$http.get("/api/MyProfile/RecentPayments").then(function(e){t.isLoading_Payment=!1,t.historicPayments=e.data},function(e){t.isLoading_Payment=!1,console.log("Failed to refresh rescent payments: "+e.data.exceptionMessage)})},e.prototype.unlinkDwollaFundingSource=function(){var t=this;confirm("Are you sure you want to disconnect the bank account? You will no longer be able to make payments.")&&(this.isLoading_Payment=!0,this.$http.put("/api/Dwolla/DisconnectUserFundingSource",null).then(function(){window.location.reload()},function(e){t.isLoading_Payment=!1,alert("Failed to disconnect account"+e.data.exceptionMessage)}))},e.prototype.getFeeAmount=function(e){e=Math.ceil(e*this.dwollaFeePercent)/100;return e=e>this.dwollaMaxFee?this.dwollaMaxFee:e},e.prototype.onPaymentAmountChange=function(){var e=this.getFeeAmount(this.paymentInfo.amount);this.dwollaFeeAmountString="$"+e.toFixed(2)},e.prototype.uploadDwollaDoc=function(){var t=this,e=(this.isLoading_Payment=!0,this.dwollaDocUploadMessage=null,new FormData),i=(e.append("DocumentFile",this.dwollaDocUploadFile),e.append("DocumentType",this.dwollaDocUploadType),{headers:{"Content-Type":void 0}});this.$http.post("/api/Dwolla/UploadCustomerDocument",e,i).then(function(){t.isLoading_Payment=!1,t.dwollaDocUploadFile=null,t.dwollaDocUploadMessage="Your document has been successfully uploaded. You will be notified when it is reviewed."},function(e){t.isLoading_Payment=!1,alert("Failed to upload document: "+e.data.exceptionMessage)})},e.prototype.onDwollaDocSelected=function(e){this.dwollaDocUploadFile=e?e.target.files[0]:null},e.prototype.withdrawDwollaBalance=function(){var t=this;this.isLoading_Payment=!0,this.dwollaBalanceMessage=null,this.$http.get("/api/Dwolla/WithdrawDwollaBalance").then(function(){t.isLoading_Payment=!1,t.dwollaBalanceMessage="Balance withdraw successfully initiated. Expect the transfer to complete in 1-2 business days."},function(e){t.isLoading_Payment=!1,alert("Failed to initiate withdraw: "+e.data.exceptionMessage)})},e.prototype.submitDwollaMicroDepositAmounts=function(){var t=this,e=(this.isLoading_Payment=!0,{amount1String:this.dwollaMicroDepositAmount1String,amount2String:this.dwollaMicroDepositAmount2String,isForGroup:!1});this.$http.post("/api/Dwolla/VerifyMicroDeposit",e).then(function(){window.location.reload()},function(e){t.isLoading_Payment=!1,alert("Failed to verify: "+e.data.exceptionMessage)})},e.prototype.reloadPage=function(){this.isLoading_Payment=!0,window.location.reload()},e.prototype.enableDwollaAutoPay=function(){var t=this;this.isLoading_Payment=!0,this.$http.put("/api/Dwolla/EnableAutoPay/"+encodeURIComponent(this.assessmentAmount.toString()),null).then(function(){window.location.reload()},function(e){t.isLoading_Payment=!1,alert("Failed to enable Dwolla auto-pay: "+e.data.exceptionMessage)})},e.prototype.disableDwollaAutoPay=function(){var t=this;this.isLoading_Payment=!0,this.$http.put("/api/Dwolla/DisableAutoPay",null).then(function(){window.location.reload()},function(e){t.isLoading_Payment=!1,alert("Failed to disable Dwolla auto-pay: "+e.data.exceptionMessage)})},e.$inject=["$http","SiteInfo","$rootScope","$sce","$timeout","$q"],a.AssessmentPaymentFormController=e}(Ally=Ally||{}),CA.angularApp.component("assessmentPaymentForm",{templateUrl:"/ngApp/common/assessment-payment-form.html",controller:Ally.AssessmentPaymentFormController}),function(){}),ParagonPayerSignUpInfo=function(){this.billingAddress=new Ally.FullAddress,this.checkType="PERSONAL",this.accountType="CHECKING"},ParagonPaymentRequest=function(){},__extends=(!function(i){function e(e,t,i,n){this.$http=e,this.siteInfo=t,this.$sce=i,this.$routeParams=n,this.isLoading=!1}e.prototype.$onInit=function(){var t=this;this.isLoading=!0,this.$http.get("/api/PublicCustomPage/View/"+this.$routeParams.slug,{cache:!0}).then(function(e){t.isLoading=!1,t.customPage=e.data,t.markupHtml=t.$sce.trustAsHtml(t.customPage.markupHtml),setTimeout(function(){return i.RichTextHelper.makeLinksOpenNewTab("custom-page-content")},500)},function(e){t.isLoading=!1,alert("Failed to load page, try refreshing the page. If the problem persists, contact support: "+e.data.exceptionMessage)})},e.$inject=["$http","SiteInfo","$sce","$routeParams"],i.CustomPageViewController=e}(Ally=Ally||{}),CA.angularApp.component("customPageView",{templateUrl:"/ngApp/common/custom-page-view.html",controller:Ally.CustomPageViewController}),!function(e){function t(e,t,i){this.appCacheService=e,this.$scope=t,this.$timeout=i,this.filterPresetDateRange="custom",this.shouldSuppressCustom=!1,this.thisYearLabel=(new Date).getFullYear().toString(),this.lastYearLabel=((new Date).getFullYear()-1).toString()}t.prototype.$onInit=function(){var i=this;this.startDate||this.endDate||this.selectPresetDateRange(!0),this.$scope.$watch("$ctrl.startDate",function(e,t){e&&e!==t&&!i.shouldSuppressCustom&&(i.filterPresetDateRange="custom")}),this.$scope.$watch("$ctrl.endDate",function(e,t){e&&e!==t&&!i.shouldSuppressCustom&&(i.filterPresetDateRange="custom")})},t.prototype.selectPresetDateRange=function(e){var t,i=this;void 0===e&&(e=!1),"last30days"===this.filterPresetDateRange?(this.startDate=moment().subtract(30,"days").toDate(),this.endDate=moment().toDate()):"thisMonth"===this.filterPresetDateRange?(this.startDate=moment().startOf("month").toDate(),this.endDate=moment().endOf("month").toDate()):"lastMonth"===this.filterPresetDateRange?(t=moment().subtract(1,"months"),this.startDate=t.startOf("month").toDate(),this.endDate=t.endOf("month").toDate()):"thisYear"===this.filterPresetDateRange?(this.startDate=moment().startOf("year").toDate(),this.endDate=moment().endOf("year").toDate()):"lastYear"===this.filterPresetDateRange?(t=moment().subtract(1,"years"),this.startDate=t.startOf("year").toDate(),this.endDate=t.endOf("year").toDate()):"oneYear"===this.filterPresetDateRange&&(this.startDate=moment().subtract(1,"years").toDate(),this.endDate=moment().toDate()),this.shouldSuppressCustom=!0,window.setTimeout(function(){return i.shouldSuppressCustom=!1},25),!e&&this.onChange&&window.setTimeout(function(){return i.onChange()},50)},t.prototype.onInternalChange=function(e){var t=this;if(void 0===e&&(e=!1),"string"==typeof this.startDate){if(10!==this.startDate.length)return;this.startDate=moment(this.startDate,"MM-DD-YYYY").toDate()}if("string"==typeof this.endDate){if(10!==this.endDate.length)return;this.endDate=moment(this.endDate,"MM-DD-YYYY").toDate()}e||this.$timeout(function(){t.onChange&&t.onChange()},10)},t.$inject=["appCacheService","$scope","$timeout"],e.DateRangePickerController=t}(Ally=Ally||{}),CA.angularApp.component("dateRangePicker",{bindings:{startDate:"=",endDate:"=",onChange:"&"},templateUrl:"/ngApp/common/date-range-picker.html",controller:Ally.DateRangePickerController}),!function(a){function e(){}a.DocumentTreeFile=function(){};a.DocLinkInfo=e,t.prototype.getSubDirectoryByName=function(e){if(this.subdirectories)for(var t=0;t<this.subdirectories.length;++t)if(this.subdirectories[t].name===e)return this.subdirectories[t];return null};var s=t;function t(){}function r(e,t,i,n,o,s,a){this.$http=e,this.$rootScope=t,this.$cacheFactory=i,this.$scope=n,this.siteInfo=o,this.fellowResidents=s,this.$location=a,this.isLoading=!1,this.filesSortDescend=!1,this.title="Documents",this.getDocsUri="/api/ManageDocuments",this.showPopUpWarning=!1,this.shouldShowSubdirectories=!0,this.docsHttpCache=this.$cacheFactory.get("docs-http-cache")||this.$cacheFactory("docs-http-cache"),this.fileSortType=window.localStorage[r.LocalStorageKey_SortType],this.fileSortType||(this.fileSortType="title"),this.filesSortDescend="true"===window.localStorage[r.LocalStorageKey_SortDirection],this.fileSearch={all:""}}a.DocumentDirectory=s,r.prototype.$onInit=function(){var n=this;this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId).then(function(e){return n.canManage=e}),this.apiAuthToken=this.$rootScope.authToken,this.Refresh();setTimeout(function(){$("#JQDocsFileUploader").fileupload({autoUpload:!0,pasteZone:null,add:function(e,t){var i;52428800<t.files[0].size?(i=Math.round(t.files[0].size/1048576)+1,alert("The selected file is too large ("+i+"MB). The maximum file size allowed is 50MB.")):(i=n.getSelectedDirectoryPath(),$("#FileUploadProgressContainer").show(),t.url="api/DocumentUpload?dirPath="+encodeURIComponent(i),n.siteInfo.publicSiteInfo.baseApiUrl&&(t.url=n.siteInfo.publicSiteInfo.baseApiUrl+"DocumentUpload?dirPath="+encodeURIComponent(i)),(i=t.submit()).done(function(){n.docsHttpCache.removeAll(),$("#FileUploadProgressContainer").hide(),n.Refresh()}),i.error(function(e){alert("Upload failed: "+e.responseJSON.exceptionMessage)}))},beforeSend:function(e){n.siteInfo.publicSiteInfo.baseApiUrl?e.setRequestHeader("Authorization","Bearer "+n.apiAuthToken):e.setRequestHeader("ApiAuthToken",n.apiAuthToken)},progressall:function(e,t){t=parseInt((t.loaded/t.total*100).toString(),10);$("#FileUploadProgressBar").css("width",t+"%"),100===t?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(t+"%")},fail:function(e,t){$("#FileUploadProgressContainer").hide(),alert("Failed to upload document"),console.log("Failed to upload document",t)}})},100),this.committee&&(this.title="Committee Documents")},r.prototype.getSelectedDirectoryPath=function(){return this.getDirectoryFullPath(this.selectedDirectory)},r.prototype.viewDoc=function(i,n){var o,s=this,e=(this.isLoading=!0,this.showPopUpWarning=!1,".rtf"===this.getDisplayExtension(i)&&(n=!0),++i.numViews,n||(!(o=window.open("","_blank"))||o.closed||void 0===o.closed?(alert("Looks like your browser may be blocking pop-ups which are required to view documents. Please see the right of the address bar or your browser settings to enable pop-ups for "+AppConfig.appName+"."),this.showPopUpWarning=!0):o.document.write("Loading document... (If the document cannot be viewed directly in your browser, it will be downloaded automatically)")),"/api/DocumentLink/"+i.docId);this.$http.get(e).then(function(e){s.isLoading=!1;var t,e=i.url+"?vid="+encodeURIComponent(e.data.vid);HtmlUtil.startsWith(e,"/api/")&&(e=e.substr("/api/".length)),e=s.siteInfo.publicSiteInfo.baseApiUrl+e,n?((t=document.createElement("a")).setAttribute("type","hidden"),t.href=e+"&dl="+encodeURIComponent(i.fileName),t.download=i.fileName,document.body.appendChild(t),t.click(),t.remove()):a.HtmlUtil2.isAndroid()?o.location.href="http://docs.google.com/gview?embedded=true&url="+encodeURIComponent(e):o.location.href=e},function(e){s.isLoading=!1,alert("Failed to open document: "+e.data.exceptionMessage)})},r.prototype.startZipGenDownload=function(){var t=this,i=function(){t.$http.get("/api/DocumentUpload/GetZipGenStatus?vid="+t.generatingZipId).then(function(e){0===e.data.totalNumFiles?t.generatingZipStatus="Still waiting...":t.generatingZipStatus=e.data.numFilesProcessed+" of "+e.data.totalNumFiles+" files processed",e.data.isReady?(t.generatingZipStatus="ready",t.downloadZipUrl=t.siteInfo.publicSiteInfo.baseApiUrl+"DocumentUpload/DownloadZipGen?vid="+t.generatingZipId):window.setTimeout(i,750)},function(e){t.generatingZipStatus=null,alert("Zip file generation failed: "+e.data.exceptionMessage)})},e=(this.generatingZipStatus="Starting...","/api/DocumentUpload/StartFullZipGeneration");this.committee&&(e+="?committeeId="+this.committee.committeeId),this.$http.get(e).then(function(e){t.generatingZipId=e.data.statusId,t.generatingZipStatus="Waiting for update...",window.setTimeout(i,1250)},function(e){t.generatingZipStatus=null,alert("Failed to start zip generation: "+e.data.exceptionMessage)})},r.prototype.getDirectoryFullPath=function(e){for(var t=e.name,i=e.parentDirectory;i;)t=i.name+"/"+t,i=i.parentDirectory;return t=this.committee?r.DirName_Committees+"/"+this.committee.committeeId+"/"+t:t},r.prototype.FindDirectoryByPath=function(e){if(this.documentTree){for(var t,i=(e=this.committee&&HtmlUtil.startsWith(e,r.DirName_Committees)&&-1!==(t=(e=e.substr(r.DirName_Committees.length+1)).indexOf("/"))?e.substr(t+1):e).split("/"),n=this.documentTree,o=0;o<i.length&&(n=n.getSubDirectoryByName(i[o]));++o);return n}},r.prototype.updateFileFilter=function(){var t=(this.fileSearch.all||"").toLowerCase();this.searchFileList=_.filter(this.fullSearchFileList,function(e){return-1!==(e.localFilePath||"").toLowerCase().indexOf(t)||-1!==(e.uploadDateString||"").toLowerCase().indexOf(t)||-1!==(e.uploaderFullName||"").toLowerCase().indexOf(t)}),setTimeout(function(){var e=document.getElementById("documents-area"),t=e.style.display;e.style.display="none",e.offsetHeight;e.style.display=t},50)},r.prototype.hookUpFileDragging=function(){var o=this;this.canManage&&setTimeout(function(){$(".droppable").droppable({drop:function(e,t){var i=o.getSelectedDirectoryPath(),n=($(t.draggable).draggable("option","revert","false"),$(e.target).attr("data-folder-path").trim());o.$scope.$apply(function(){o.isLoading=!0;var e={relativeS3Path:o.selectedFile.relativeS3Path,action:"move",newFileName:"",sourceFolderPath:i,destinationFolderPath:n};o.selectedFile=null,o.$http.put("/api/ManageDocuments/MoveFile",e).then(function(){o.isLoading=!1,o.docsHttpCache.removeAll(),o.Refresh()},function(e){o.isLoading=!1;e=e.exceptionMessage||e.message||e;alert("Failed to move file: "+e)})})},hoverClass:"Document_Folder_DropHover"}),$(".draggable").draggable({distance:10,revert:!0,helper:"clone",opacity:1,containment:"document",appendTo:"body",start:function(e){var e=$(e.target).attr("id").substring("File_".length),t=parseInt(e);o.$scope.$apply(function(){var e=o.selectedDirectory.files[t];o.selectedFile=e})}})},250)},r.prototype.onDirectoryClicked=function(e){var t;this.selectedDirectory===e?this.shouldShowSubdirectories=!this.shouldShowSubdirectories:this.shouldShowSubdirectories=!0,this.selectedDirectory=e,this.selectedFile=null,this.fileSearch.all=null,this.hookUpFileDragging(),this.SortFiles(),this.committee?(t=r.DirName_Committees+"/"+this.committee.committeeId+"/",this.$location.search("directory",e.fullDirectoryPath.substring(t.length))):this.$location.search("directory",e.fullDirectoryPath)},r.prototype.createDirectory=function(){this.createUnderParentDirName=null,this.committee&&(this.createUnderParentDirName=r.DirName_Committees+"/"+this.committee.committeeId),this.shouldShowCreateFolderModal=!0,setTimeout(function(){return $("#CreateDirectoryNameTextBox").focus()},50)},r.prototype.CreateSubDirectory=function(){this.createUnderParentDirName=this.selectedDirectory.fullDirectoryPath,this.committee&&(this.createUnderParentDirName=r.DirName_Committees+"/"+this.committee.committeeId+"/"+this.createUnderParentDirName),this.shouldShowCreateFolderModal=!0,setTimeout(function(){return $("#CreateDirectoryNameTextBox").focus()},50)},r.prototype.SetFileSortType=function(e){this.fileSortType===e?this.filesSortDescend=!this.filesSortDescend:this.filesSortDescend=!1,this.fileSortType=e,window.localStorage[r.LocalStorageKey_SortType]=this.fileSortType,window.localStorage[r.LocalStorageKey_SortDirection]=this.filesSortDescend,this.SortFiles()},r.prototype.SortFiles=function(){this.selectedDirectory&&this.selectedDirectory.files&&("title"!==this.fileSortType&&"uploadDate"!==this.fileSortType||(this.selectedDirectory.files=_.sortBy(this.selectedDirectory.files,this.fileSortType)),this.filesSortDescend)&&this.selectedDirectory.files.reverse()},r.prototype.onCreateDirectoryClicked=function(){var t=this,e=(this.isLoading=!0,"/api/ManageDocuments/CreateDirectory?folderName="+encodeURIComponent(this.newDirectoryName));e+="&parentFolderPath=",this.createUnderParentDirName&&(e+=encodeURIComponent(this.createUnderParentDirName)),this.$http.put(e,null).then(function(){t.docsHttpCache.removeAll(),t.newDirectoryName="",t.Refresh(),t.shouldShowCreateFolderModal=!1},function(e){alert("Failed to create the folder: "+e.data.exceptionMessage),t.isLoading=!1})},r.prototype.onCancelAddDirectory=function(){this.shouldShowCreateFolderModal=!1,this.newDirectoryName=""},r.prototype.onFileClicked=function(e){this.selectedFile=e},r.prototype.RenameDocument=function(e){var t,i=this;e&&null!==(t=prompt("Enter the new name for the file",e.title))&&(64<t.length&&(t=t.substr(0,64)),this.isLoading=!0,e={relativeS3Path:e.relativeS3Path,action:"rename",newTitle:t,sourceFolderPath:this.getSelectedDirectoryPath(),destinationFolderPath:""},this.$http.put("/api/ManageDocuments/RenameFile",e).then(function(){i.docsHttpCache.removeAll(),i.Refresh()},function(e){i.isLoading=!1,alert("Failed to rename: "+e.data.exceptionMessage),i.Refresh()}))},r.prototype.DeleteDocument=function(e){var t=this;confirm("Are you sure you want to delete this file?")&&(this.isLoading=!0,this.$http.delete("/api/ManageDocuments?docPath="+e.relativeS3Path).then(function(){t.docsHttpCache.removeAll(),t.Refresh()},function(e){t.isLoading=!1,alert("Failed to delete file: "+e.data.exceptionMessage),t.Refresh()}))},r.prototype.RenameSelectedDirectory=function(){var e,t,i,n=this;this.selectedDirectory&&null!==(e=prompt("Enter the new name for the directory",this.selectedDirectory.name))&&(32<e.length&&(e=e.substr(0,32)),this.isLoading=!0,t=encodeURIComponent(this.getSelectedDirectoryPath()),i=encodeURIComponent(e),this.$http.put("/api/ManageDocuments/RenameDirectory?directoryPath="+t+"&newDirectoryName="+i,null).then(function(){n.docsHttpCache.removeAll(),n.selectedDirectory.name=e,n.Refresh()},function(e){n.isLoading=!1,alert("Failed to rename directory: "+e.data.exceptionMessage)}))},r.prototype.DeleteSelectedDirectory=function(){var e,t=this;this.selectedDirectory&&(0<this.selectedDirectory.files.length?alert("You can not delete a folder that contains files. Please delete or move all files from the folder."):confirm("Are you sure you want to delete this folder?")&&(this.isLoading=!0,e=this.getSelectedDirectoryPath(),this.$http.delete("/api/ManageDocuments/DeleteDirectory?directoryPath="+encodeURIComponent(e)).then(function(){t.docsHttpCache.removeAll(),t.Refresh()},function(e){t.isLoading=!1,alert("Failed to delete the folder: "+e.data.exceptionMessage)})))},r.prototype.getFileIcon=function(e){if(!e)return"";var t=null;switch(e.split(".").pop().toLowerCase()){case"pdf":t="PdfIcon.png";break;case"doc":case"docx":t="WordIcon.png";break;case"xls":case"xlsx":t="ExcelIcon.png";break;case"ppt":case"pptx":t="PptxIcon.png";break;case"jpeg":case"jpe":case"jpg":case"png":case"bmp":t="ImageIcon.png";break;case"zip":t="ZipIcon.png";break;case"txt":t="TxtIcon.png";break;case"mp4":t="Mp4Icon.png";break;default:t="GenericFileIcon.png"}return"/assets/images/FileIcons/"+t},r.prototype.isGenericIcon=function(e){return"/assets/images/FileIcons/GenericFileIcon.png"===this.getFileIcon(e.fileName)},r.prototype.getDisplayExtension=function(e){return"."+e.fileName.split(".").pop().toLowerCase()},r.prototype.hookupParentDirs=function(t){var i=this;t.fullDirectoryPath=this.getDirectoryFullPath(t),t.getSubDirectoryByName=s.prototype.getSubDirectoryByName,t.subdirectories&&t.subdirectories.forEach(function(e){e.parentDirectory=t,e.directoryDepth=t.directoryDepth+1,i.hookupParentDirs(e)})},r.prototype.Refresh=function(){var t=this,o=null;this.selectedDirectory?o=this.getSelectedDirectoryPath():HtmlUtil.isNullOrWhitespace(this.$location.search().directory)||(o=this.committee?r.DirName_Committees+"/"+this.committee.committeeId+"/"+this.$location.search().directory:this.$location.search().directory),this.isLoading=!0,this.selectedDirectory=null,this.selectedFile=null,this.getDocsUri="/api/ManageDocuments",this.committee&&(this.getDocsUri+="/Committee/"+this.committee.committeeId),this.$http.get(this.getDocsUri,{cache:this.docsHttpCache}).then(function(e){t.isLoading=!1,t.documentTree=e.data,t.documentTree.getSubDirectoryByName=s.prototype.getSubDirectoryByName,t.documentTree.subdirectories.forEach(function(e){e.directoryDepth=0,t.hookupParentDirs(e)});function i(t){_.each(t.files,function(e){e.localFilePath=t.name+"/"+e.title,e.uploadDateString=moment(e.uploadDate).format("MMMM D, YYYY")}),Array.prototype.push.apply(n,t.files),_.each(t.subdirectories,i)}var n=[];i(t.documentTree),t.fullSearchFileList=n,o&&(t.selectedDirectory=t.FindDirectoryByPath(o),t.SortFiles()),t.hookUpFileDragging()},function(e){alert("Failed to retrieve documents, please contact technical support. No need to worry, no documents have been lost."),t.isLoading=!1,console.log("Failed to retrieve docs: "+e.data.exceptionMessage)})},r.$inject=["$http","$rootScope","$cacheFactory","$scope","SiteInfo","fellowResidents","$location"],r.LocalStorageKey_SortType="DocsInfo_FileSortType",r.LocalStorageKey_SortDirection="DocsInfo_FileSortDirection",r.DirName_Committees="Committees_Root",a.DocumentsController=r}(Ally=Ally||{}),CA.angularApp.component("documents",{bindings:{committee:"<"},templateUrl:"/ngApp/common/documents.html",controller:Ally.DocumentsController}),!function(e){var s=function(){},t=(e.InfoItem=s,i.prototype.$onInit=function(){var t=this;this.hideDocuments=this.$rootScope.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId).then(function(e){return t.canManage=e}),this.faqsHttpCache=this.$cacheFactory.get("faqs-http-cache")||this.$cacheFactory("faqs-http-cache"),this.retrieveInfo(),e.HtmlUtil2.initTinyMce("tiny-mce-editor",500).then(function(e){return t.tinyMceEditor=e})},i.prototype.retrieveInfo=function(){var t=this;this.isLoadingInfo=!0,this.getUri||(this.getUri="/api/InfoItem",this.committee&&(this.getUri="/api/InfoItem/Committee/"+this.committee.committeeId)),this.$http.get(this.getUri,{cache:this.faqsHttpCache}).then(function(e){t.isLoadingInfo=!1,t.infoItems=e.data,setTimeout(function(){for(var e=0;e<t.infoItems.length;++e)n.makeLinksOpenNewTab("info-item-body-"+e)},500)})},i.prototype.scrollToInfo=function(e){document.getElementById("info-item-title-"+e).scrollIntoView()},i.prototype.onStartEditInfoItem=function(e){this.editingInfoItem=jQuery.extend({},e),this.tinyMceEditor.setContent(this.editingInfoItem.body),window.scrollTo(0,document.body.scrollHeight)},i.prototype.onSubmitItem=function(){var e=this,t=(this.editingInfoItem.body=this.tinyMceEditor.getContent(),this.isBodyMissing=HtmlUtil.isNullOrWhitespace(this.editingInfoItem.body),$("#info-item-edit-form"));t.validate(),t.valid()&&!this.isBodyMissing&&(this.committee&&(this.editingInfoItem.committeeId=this.committee.committeeId),this.isLoadingInfo=!0,t=function(){e.isLoadingInfo=!1,e.tinyMceEditor.setContent(""),e.editingInfoItem=new s,e.faqsHttpCache.removeAll(),e.retrieveInfo()},("number"==typeof this.editingInfoItem.infoItemId?this.$http.put("/api/InfoItem",this.editingInfoItem):this.$http.post("/api/InfoItem",this.editingInfoItem)).then(t))},i.prototype.onDeleteInfoItem=function(e){var t=this;confirm("Are you sure you want to delete this information?")&&(this.isLoadingInfo=!0,this.$http.delete("/api/InfoItem/"+e.infoItemId).then(function(){t.isLoadingInfo=!1,t.faqsHttpCache.removeAll(),t.retrieveInfo()}))},i.prototype.cancelInfoItemEdit=function(){this.editingInfoItem=new s,this.tinyMceEditor.setContent("")},i.$inject=["$http","$rootScope","SiteInfo","$cacheFactory","fellowResidents"],i);function i(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$cacheFactory=n,this.fellowResidents=o,this.isBodyMissing=!1,this.canManage=!1,this.headerText="Information and Frequently Asked Questions (FAQs)",this.editingInfoItem=new s,"home"===AppConfig.appShortName&&(this.headerText="Home Notes")}e.FAQsController=t;o.showFileUploadAlert=function(e,t){var i="";"unsupported-file-type"===e?i="Unsupported format "+t:console.log("error uploading file",e,t),$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button><strong>File upload error</strong> '+i+" </div>").prependTo("#alerts")},o.makeLinksOpenNewTab=function(e){window.setTimeout(function(){$("a","#"+e).each(function(e,t){t.href&&("#"===t.href[0]||-1<t.href.indexOf(AppConfig.baseTld))||$(t).attr("target","_blank")})},100)};var n=o;function o(){}e.RichTextHelper=n}(Ally=Ally||{}),CA.angularApp.component("faqs",{bindings:{committee:"<?"},templateUrl:"/ngApp/common/FAQs.html",controller:Ally.FAQsController}),!function(t){function e(e,t,i,n,o,s){this.$http=e,this.siteInfo=t,this.$timeout=i,this.$rootScope=n,this.uiGridConstants=o,this.$scope=s,this.shouldShowModal=!1,this.isLoading=!1,this.HistoryPageSize=50}e.prototype.$onInit=function(){this.homeName=AppConfig.homeName||"Unit",this.transactionGridOptions={columnDefs:[{field:"transactionDate",displayName:"Date",width:70,type:"date",cellFilter:"date:'shortDate'",enableFiltering:!1},{field:"description",displayName:"Description",enableFiltering:!0,filter:{placeholder:"search"}},{field:"categoryDisplayName",editModelField:"financialCategoryId",displayName:"Category",width:170,editDropdownOptionsArray:[],enableFiltering:!0},{field:"unitGridLabel",editModelField:"associatedUnitId",displayName:this.homeName,width:120,enableFiltering:!0},{field:"amount",displayName:"Amount",width:140,type:"number",cellFilter:"currency",enableFiltering:!0,aggregationType:this.uiGridConstants.aggregationTypes.sum,footerCellTemplate:'<div class="ui-grid-cell-contents">Total: {{col.getAggregationValue() | currency }}</div>'}],enableFiltering:!0,enableSorting:!0,showColumnFooter:!0,enableHorizontalScrollbar:window.innerWidth<640?this.uiGridConstants.scrollbars.ALWAYS:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1,enablePaginationControls:!0,paginationPageSize:this.HistoryPageSize,paginationPageSizes:[this.HistoryPageSize],enableRowHeaderSelection:!1}},e.prototype.populateGridUnitLabels=function(){var t=this,e=this.transactionGridOptions.columnDefs.find(function(e){return"unitGridLabel"===e.field});e&&e.visible&&this.$http.get("/api/MemberUnit/NamesOnly").then(function(e){var i=e.data;_.each(t.allFinancialTxns,function(t){var e;t.associatedUnitId&&(e=i.find(function(e){return e.unitId===t.associatedUnitId}))&&(t.unitGridLabel=e.name)})},function(e){console.log("Failed to load units")})},e.prototype.showModal=function(){this.shouldShowModal=!0,this.refreshEntries()},e.prototype.refreshEntries=function(){var i=this;this.isLoading=!0,this.$http.get("/api/OwnerLedger/MyTransactions").then(function(e){i.isLoading=!1,i.allFinancialTxns=e.data.entries,i.ownerFinanceTxNote=e.data.ownerFinanceTxNote;var e=i.allFinancialTxns.map(function(e){return e.associatedUnitId}).filter(function(e,t,i){return i.indexOf(e)===t}),t=i.transactionGridOptions.columnDefs.find(function(e){return"unitGridLabel"===e.field});t&&(t.visible=1<e.length||1<i.siteInfo.userInfo.usersUnits.length),i.$timeout(function(){return i.populateGridUnitLabels()},150),i.$timeout(function(){1<i.allFinancialTxns.length&&(i.filterEndDate=i.allFinancialTxns[0].transactionDate,i.filterStartDate=i.allFinancialTxns[i.allFinancialTxns.length-1].transactionDate),i.onFilterDateRangeChange()},100)},function(){i.isLoading=!1})},e.prototype.exportTransactionsCsv=function(){var e=[{headerText:"Date",fieldName:"transactionDate",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD"):""}},{headerText:"Description",fieldName:"description"},{headerText:"Category",fieldName:"categoryDisplayName"},{headerText:AppConfig.homeName,fieldName:"unitGridLabel"},{headerText:"Amount",fieldName:"amount"}],e=t.createCsvString(this.transactionGridOptions.data,e);t.HtmlUtil2.downloadCsv(e,"Owner-Transactions.csv")},e.prototype.onFilterDateRangeChange=function(){var t=this;this.filterStartDate&&this.filterEndDate&&(this.transactionGridOptions.data=this.allFinancialTxns.filter(function(e){return e.transactionDate>=t.filterStartDate&&e.transactionDate<=t.filterEndDate}),this.transactionGridOptions.data.length<=this.HistoryPageSize&&(this.transactionGridOptions.enablePagination=!1,this.transactionGridOptions.enablePaginationControls=!1),this.$scope.$apply())},e.$inject=["$http","SiteInfo","$timeout","$rootScope","uiGridConstants","$scope"],t.ResidentTransactionsController=e}(Ally=Ally||{}),CA.angularApp.component("residentTransactions",{templateUrl:"/ngApp/common/financial/resident-transactions.html",controller:Ally.ResidentTransactionsController}),!function(e){function t(e){this.$routeParams=e}t.prototype.$onInit=function(){for(var e=(this.$routeParams.appName||"").toLowerCase(),t=[CondoAllyAppConfig,HomeAppConfig,HOAAppConfig,NeighborhoodAppConfig,BlockClubAppConfig],i=null,n=0;n<t.length;++n)if(t[n].appShortName.toLowerCase()===e){i=t[n].baseTld;break}i=i||"condoally.com";var i="myhoaally.org",o="https://"+this.$routeParams.shortName+"."+i+"/";window.location.href=o},t.$inject=["$routeParams"],e.GroupRedirectController=t}(Ally=Ally||{}),CA.angularApp.component("groupRedirect",{templateUrl:"/ngApp/common/group-redirect.html",controller:Ally.GroupRedirectController}),!function(o){var e=function(){this.recipientType="board"};function t(e,t,i,n,o){this.$http=e,this.fellowResidents=t,this.$rootScope=i,this.siteInfo=n,this.$scope=o,this.isLoadingEmail=!1,this.showDiscussionEveryoneWarning=!1,this.showDiscussionLargeWarning=!1,this.showUseDiscussSuggestion=!1,this.showSendConfirmation=!1,this.showEmailForbidden=!1,this.showRestrictedGroupWarning=!1,this.defaultSubject="A message from your neighbor",this.memberLabel="resident",this.memberPageName="Residents",this.shouldShowSendAsBoard=!1}t.prototype.$onInit=function(){var i=this;this.groupEmailDomain="inmail."+AppConfig.baseTld,this.messageObject=new e,this.showSendEmail=!0,this.committee?(this.messageObject.committeeId=this.committee.committeeId,this.defaultSubject="A message from a committee member"):(this.loadGroupEmails(),this.$scope.$on("prepAssessmentEmailToBoard",function(e,t){return i.prepBadAssessmentEmailForBoard(t)}),"pta"===AppConfig.appShortName?(this.defaultSubject="A message from a PTA member",this.memberLabel="member",this.memberPageName="Members"):this.defaultSubject="A message from your neighbor"),this.messageObject.subject=this.defaultSubject},t.prototype.loadGroupEmails=function(){var t=this;this.isLoadingEmail=!0,this.fellowResidents.getGroupEmailObject().then(function(e){t.isLoadingEmail=!1,t.availableEmailGroups=e.filter(function(e){return"Treasurer"!==e.recipientType}),0<t.availableEmailGroups.length&&(t.defaultMessageRecipient=t.availableEmailGroups[0],t.selectedRecipient=t.availableEmailGroups[0],t.onSelectEmailGroup())})},t.prototype.prepBadAssessmentEmailForBoard=function(e){var e=e.split("|"),t=e[0],i=null;1<e.length&&(i=e[1]),this.messageObject.recipientType="board",this.messageObject.subject="Question About Assessment Amount",this.messageObject.message=i?"Hello Boardmembers,\n\nOur association's home page says my next payment of $"+t+" will cover "+i+", but I believe that is incorrect. My records indicate my next payment of $"+t+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:"Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+t+", but I believe that is incorrect. My records indicate my assessment payments should be $INSERT_PROPER_AMOUNT_HERE. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},t.prototype.onSendEmail=function(){var t=this;$("#message-form").validate(),$("#message-form").valid()&&(this.isLoadingEmail=!0,this.$rootScope.dontHandle403=!0,analytics.track("sendEmail",{recipientId:this.messageObject.recipientType}),this.$http.post("/api/Email/v2",this.messageObject).then(function(){t.$rootScope.dontHandle403=!1,t.isLoadingEmail=!1,t.messageObject=new e,t.selectedRecipient=t.defaultMessageRecipient,t.messageObject.recipientType=t.defaultMessageRecipient.recipientType,t.messageObject.subject=t.defaultSubject,t.onSelectEmailGroup(),t.committee&&(t.messageObject.committeeId=t.committee.committeeId),t.showSendConfirmation=!0,t.showSendEmail=!1},function(e){t.isLoadingEmail=!1,t.$rootScope.dontHandle403=!1,403===e.status?t.showEmailForbidden=!0:alert("Unable to send email: "+e.data.exceptionMessage)}))},t.prototype.onSelectEmailGroup=function(){var e,t,i,n;this.selectedRecipient&&(this.messageObject.recipientType=this.selectedRecipient.recipientType,e=this.messageObject.recipientType.toUpperCase()===o.FellowResidentsService.CustomRecipientType,this.messageObject.customRecipientShortName=e?this.selectedRecipient.recipientTypeName:null,this.groupEmailAddress=(e?this.selectedRecipient.recipientTypeName:this.selectedRecipient.recipientType)+"."+this.siteInfo.publicSiteInfo.shortName+"@inmail."+AppConfig.baseTld,this.showDiscussionEveryoneWarning=!1,t=-1!==this.messageObject.recipientType.toLowerCase().indexOf("owners"),!this.showDiscussionEveryoneWarning&&t&&30<this.siteInfo.privateSiteInfo.numUnits?this.showDiscussionLargeWarning=!0:this.showDiscussionLargeWarning=!1,t=-1!==this.messageObject.recipientType.toLowerCase().indexOf("discussion"),i=-1!==this.messageObject.recipientType.toLowerCase().indexOf("board"),n=-1!==this.messageObject.recipientType.toLowerCase().indexOf("propertymanagers"),this.showDiscussionEveryoneWarning=!1,this.showDiscussionLargeWarning=!1,this.showUseDiscussSuggestion=!t&&!i&&!n&&AppConfig.isChtnSite&&!e,this.showRestrictedGroupWarning=this.selectedRecipient.isRestrictedGroup,this.shouldShowSendAsBoard=o.FellowResidentsService.isNonPropMgrBoardPosition(this.siteInfo.userInfo.boardPosition)&&!i)},t.$inject=["$http","fellowResidents","$rootScope","SiteInfo","$scope"],o.GroupSendEmailController=t}(Ally=Ally||{}),CA.angularApp.component("groupSendEmail",{bindings:{committee:"<?"},templateUrl:"/ngApp/common/group-send-email.html",controller:Ally.GroupSendEmailController}),!function(e){function t(e,t,i){this.$http=e,this.siteInfo=t,this.$timeout=i,this.isLoading=!1}t.prototype.$onInit=function(){var e=this;this.isLoading=!0,this.$timeout(function(){return e.loadNewsStories()},200)},t.prototype.loadNewsStories=function(){var e,t,i=this;HtmlUtil.getSubdomain(window.location.host);this.isLoading=!0,t="US"===this.siteInfo.privateSiteInfo.country?(e="https://localnewsally.azurewebsites.net/api/LocalNews",{clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.privateSiteInfo.chicagoWard,zipCode:this.siteInfo.privateSiteInfo.zipCode,cityNeighborhood:this.siteInfo.privateSiteInfo.localNewsNeighborhoodQuery,city:this.siteInfo.privateSiteInfo.groupAddress.city,state2Char:this.siteInfo.privateSiteInfo.groupAddress.state}):(e="https://localnewsally.azurewebsites.net/api/LocalNews/International/MajorCity",{clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city}),this.$http.get(e,{cache:!0,params:t}).then(function(e){i.isLoading=!1,i.localNewStories=e.data})},t.$inject=["$http","SiteInfo","$timeout"],e.LocalNewsFeedController=t}(Ally=Ally||{}),CA.angularApp.component("localNewsFeed",{templateUrl:"/ngApp/common/local-news-feed.html",controller:Ally.LocalNewsFeedController}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}());function ServiceBankInfoCtrl(e){}function ServiceBusinessInfoCtrl(e){}function ServiceJobsCtrl(e){}!function(e){function t(){}var i;__extends(n,i=t);function n(){return null!==i&&i.apply(this,arguments)||this}var o;__extends(s,o=t);function s(){return null!==o&&o.apply(this,arguments)||this}function a(e,t,i){var n=this;this.$http=e,this.siteInfo=t,this.$timeout=i,this.isLoading=!1,this.viewingResults=null,this.historyGridOptions={data:[],columnDefs:[{field:"sendDateUtc",displayName:"Sent",cellFilter:"date:'short'",type:"date"},{field:"numPaperLettersSent",displayName:"# Letters",type:"number",width:100},{field:"numEmailsSent",displayName:"# Emails",type:"number",width:100},{field:"amountPaid",displayName:"Mailing Fee",cellFilter:"currency",type:"number",width:130},{field:"sendingReason",displayName:"Reason",width:150},{field:"mailingResultObject",displayName:"",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><span data-ng-click="grid.appScope.$ctrl.showMailingResults( row.entity )" class="text-link">View Results</span></div>'}],enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableColumnMenus:!1,minRowsToShow:5,onRegisterApi:function(e){n.historyGridApi=e,HtmlUtil.uiGridFixScroll()}},this.resultsGridOptions={data:[],columnDefs:[{field:"mailingType",displayName:"Type",width:100},{field:"recipient",displayName:"Recipient",width:300,cellTemplate:'<div class="ui-grid-cell-contents"><span title="{{row.entity.recipient}}">{{ row.entity.recipientEmail || row.entity.recipientStreetAddress.oneLiner }}</span></div>'},{field:"didSuccessfullySend",displayName:"Successful",width:100,type:"boolean"},{field:"resultMessage",displayName:"Result Message",cellTemplate:'<div class="ui-grid-cell-contents"><span title="{{row.entity.resultMessage}}">{{row.entity.resultMessage}}</span></div>'}],enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableColumnMenus:!1,minRowsToShow:5,onRegisterApi:function(e){HtmlUtil.uiGridFixScroll()}}}a.prototype.$onInit=function(){this.refreshHistory()},a.prototype.showMailingResults=function(t){var i=this;this.$timeout(function(){_.forEach(t.mailingResultObject.emailResults,function(e){return e.mailingType="E-mail"}),_.forEach(t.mailingResultObject.paperMailResults,function(e){return e.mailingType="Paper Letter"});var e=(e=[]).concat(t.mailingResultObject.emailResults,t.mailingResultObject.paperMailResults);i.resultsGridOptions.data=e,i.resultsGridOptions.minRowsToShow=e.length,i.resultsGridOptions.virtualizationThreshold=e.length,i.resultsGridheight=(e.length+1)*i.resultsGridOptions.rowHeight,i.$timeout(function(){i.viewingResults=t.mailingResultObject},10)},0)},a.prototype.refreshHistory=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Mailing/History").then(function(e){t.isLoading=!1,t.historyGridOptions.data=e.data,t.historyGridOptions.minRowsToShow=e.data.length,t.historyGridOptions.virtualizationThreshold=e.data.length},function(e){t.isLoading=!1,alert("Failed to load mailing history: "+e.data.exceptionMessage)})},a.$inject=["$http","SiteInfo","$timeout"],e.MailingHistoryController=a}(Ally=Ally||{}),CA.angularApp.component("mailingHistory",{templateUrl:"/ngApp/common/mailing/mailing-history.html",controller:Ally.MailingHistoryController}),function(e){var n=function(){};function o(e,t,i,n,o,s,a){var r=this,e=(this.$http=e,this.siteInfo=t,this.fellowResidents=i,this.wizardHandler=n,this.$scope=o,this.$timeout=s,this.$location=a,this.isLoading=!1,this.selectedEntries=[],this.numEmailsToSend=0,this.numPaperLettersToSend=0,this.paperInvoiceDollars=2,this.isAdmin=!1,this.numInvalidMailingAddresses=0,this.numAddressesToBulkValidate=0,this.shouldShowAutoUnselect=!1,'<div class="ui-grid-cell-contents">$<input type="number" style="width: 90%;" data-ng-model="row.entity[col.field]" autocomplete="off" data-lpignore="true" data-form-type="other" /></div>');this.homesGridOptions={data:[],columnDefs:[{field:"homeNames",displayName:AppConfig.homeName,width:210},{field:"ownerNames",displayName:"Owners"},{field:"amountDue",displayName:"Amount Due",width:120,cellTemplate:e},{field:"balanceForward",displayName:"Balance Forward",width:140,cellTemplate:e},{field:"lateFee",displayName:"Late Fee",width:120,cellTemplate:e},{field:"total",displayName:"Total",width:90,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.amountDue + (row.entity.balanceForward || 0) + (row.entity.lateFee || 0) | currency }}</div>'}],enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableColumnMenus:!1,minRowsToShow:5,enableRowHeaderSelection:!0,multiSelect:!0,enableSelectAll:!0,onRegisterApi:function(t){r.gridApi=t;function e(){var e=t.selection.getSelectedRows();r.selectedEntries=e}t.selection.on.rowSelectionChanged(o,e),t.selection.on.rowSelectionChangedBatch(o,e),HtmlUtil.uiGridFixScroll()}}}o.prototype.$onInit=function(){var n=this;this.authToken=this.siteInfo.authToken,this.isAdmin=this.siteInfo.userInfo.isAdmin,this.loadMailingInfo(),this.$scope.$on("wizard:stepChanged",function(e,t){n.activeStepIndex=t.index,1===n.activeStepIndex&&n.$timeout(function(){for(var e=0,t=n.selectedEntries;e<t.length;e++){var i=t[e];n.gridApi.selection.selectRow(i)}},250),2===n.activeStepIndex?window.setTimeout(function(){return document.getElementById("delivery-method-header").scrollIntoView(!0)},50):3===n.activeStepIndex&&(n.numEmailsToSend=_.filter(n.selectedEntries,function(e){return e.shouldSendEmail}).length,n.numPaperLettersToSend=_.filter(n.selectedEntries,function(e){return e.shouldSendPaperMail}).length)}),this.shouldShowAutoUnselect=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&50<=this.siteInfo.privateSiteInfo.assessmentFrequency,this.shouldShowAutoUnselect&&(this.autoUnselectLabel=o.getCurrentPayPeriodLabel(this.siteInfo.privateSiteInfo.assessmentFrequency),this.autoUnselectLabel||(this.shouldShowAutoUnselect=!1))},o.getCurrentPayPeriod=function(e){var t,i,e=FrequencyIdToInfo(e);return e?(i={year:(t=new Date).getFullYear(),period:-1,period1Based:-1},"month"===e.intervalName?i.period=t.getMonth():"quarter"===e.intervalName?i.period=Math.floor(t.getMonth()/3):"half-year"===e.intervalName?i.period=Math.floor(t.getMonth()/6):"year"===e.intervalName&&(i.period=0),i.period1Based=i.period+1,i):null},o.getCurrentPayPeriodLabel=function(e){var t,i=FrequencyIdToInfo(e);return i?(i=GetLongPayPeriodNames(i.intervalName))?(t=(e=o.getCurrentPayPeriod(e)).year.toString(),i[e.period]+" "+t):(new Date).getFullYear().toString():null},o.prototype.customizeNotes=function(e){e.overrideNotes=this.fullMailingInfo.notes||" "},o.prototype.uncustomizeNotes=function(e){e.overrideNotes=null},o.prototype.setAllDues=function(){var t=this;_.forEach(this.fullMailingInfo.mailingEntries,function(e){return e.amountDue=t.allDuesSetAmount})},o.prototype.getTotalDue=function(e){return e.amountDue-Math.abs(e.balanceForward||0)+(e.lateFee||0)},o.prototype.onShouldSendPaperMailChange=function(e){e.shouldSendPaperMail?this.testAddressRequiredFields(e):(e.isValidMailingAddress=e.validationMessage=null,this.numInvalidMailingAddresses=_.filter(this.selectedEntries,function(e){return!1===e.isValidMailingAddress}).length)},o.prototype.onAddressChanged=function(e){e.shouldSendPaperMail&&this.testAddressRequiredFields(e)},o.prototype.testAddressRequiredFields=function(t){var i=this;return t.isValidating=!0,t.isValidMailingAddress=null,t.validationMessage=null,this.$http.post("/api/Mailing/TestMailability",t.streetAddressObject).then(function(e){t.isValidating=!1,t.isValidMailingAddress=e.data.isValid,t.validationMessage=e.data.verificationMessage,i.numInvalidMailingAddresses=_.filter(i.selectedEntries,function(e){return!1===e.isValidMailingAddress}).length},function(e){t.isValidating=!1,t.isValidMailingAddress=!1,t.validatedAddress=null,t.validationMessage="Address validation failed: "+e.data.exceptionMessage})},o.prototype.validateAddress=function(t){t.isValidating=!0,t.isValidMailingAddress=null;var e="/api/Mailing/VerifyAddress?address="+encodeURIComponent(JSON.stringify(t.streetAddressObject));return this.$http.get(e).then(function(e){t.isValidating=!1,t.isValidMailingAddress=e.data.isValid,t.validationMessage=e.data.verificationMessage,t.isValidMailingAddress&&(t.validatedAddress=e.data.parsedStreetAddress.multiLiner)},function(e){t.isValidating=!1,t.isValidMailingAddress=!1,t.validatedAddress=null,t.validationMessage=e.data.exceptionMessage})},o.prototype.previewInvoice=function(t){var i=this,e=new n;e.invoiceTitleString=this.fullMailingInfo.invoiceTitleString,e.dueDateString=this.fullMailingInfo.dueDateString,e.duesLabel=this.fullMailingInfo.duesLabel,e.fromAddress=this.fullMailingInfo.fromStreetAddress,e.mailingInfo=t,e.notes=t.overrideNotes||this.fullMailingInfo.notes,this.isLoading=!0,t.wasPopUpBlocked=!1,this.$http.post("/api/Mailing/Preview/Invoice",e).then(function(e){i.isLoading=!1;e=i.siteInfo.publicSiteInfo.baseApiUrl+"PublicMailing/Preview/Invoice/"+e.data.previewId,e=window.open(e,"_blank");t.wasPopUpBlocked=!e||e.closed||void 0===e.closed},function(e){i.isLoading=!1,alert("Failed to preview invoice: "+e.data.exceptionMessage)})},o.prototype.onFinishedWizard=function(){var e,t=this;0===this.numPaperLettersToSend?0===this.numEmailsToSend?alert("No emails or paper letters selected to send."):this.submitFullMailingAfterCharge():(e=StripeCheckout.configure({key:StripeApiKey,image:"/assets/images/icons/Icon-144.png",locale:"auto",email:this.siteInfo.userInfo.emailAddress,token:function(e){t.fullMailingInfo.stripeToken=e.id,t.submitFullMailingAfterCharge()}}),this.isLoading=!0,e.open({name:"Community Ally",description:"Mailing "+this.numPaperLettersToSend+" invoice"+(1===this.numPaperLettersToSend?"":"s"),zipCode:!0,amount:this.numPaperLettersToSend*this.paperInvoiceDollars*100}),window.addEventListener("popstate",function(){e.close()}))},o.prototype.submitFullMailingAfterCharge=function(){var t=this;this.isLoading=!0,this.$http.post("/api/Mailing/Send/Invoice",this.fullMailingInfo).then(function(e){t.isLoading=!1;e="Your invoices have been successfully sent"+(e.data.hadErrors?", but there were errors":"")+". You can view the status in the history tab.";alert(e),t.$location.path("/Mailing/History")},function(e){t.isLoading=!1,alert("There was a problem sending your mailing, none were sent and you were not charged. Error: "+e.data.exceptionMessage)})},o.prototype.loadMailingInfo=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Mailing/RecipientInfo").then(function(e){t.isLoading=!1,t.fullMailingInfo=e.data,t.homesGridOptions.data=e.data.mailingEntries,t.homesGridOptions.minRowsToShow=e.data.mailingEntries.length,t.homesGridOptions.virtualizationThreshold=e.data.mailingEntries.length,t.selectedEntries=_.clone(e.data.mailingEntries)})},o.prototype.scrollToFirstAddressError=function(){var e=_.find(this.selectedEntries,function(e){return!1===e.isValidMailingAddress});e&&-1!==(e=_.indexOf(this.selectedEntries,e))&&document.getElementById("recipient-entry-"+e).scrollIntoView()},o.prototype.toggleAllSending=function(e){var t=this;if(0!==this.selectedEntries.length)if("email"===e)for(var i=!this.selectedEntries[0].shouldSendEmail,n=0;n<this.selectedEntries.length;++n)HtmlUtil.isNullOrWhitespace(this.selectedEntries[n].emailAddresses)||!this.selectedEntries[n].amountDue?this.selectedEntries[n].shouldSendEmail=!1:this.selectedEntries[n].shouldSendEmail=i;else{for(var o,s,i=!this.selectedEntries[0].shouldSendPaperMail,n=0;n<this.selectedEntries.length;++n)this.selectedEntries[n].streetAddressObject&&this.selectedEntries[n].amountDue?this.selectedEntries[n].shouldSendPaperMail=i:this.selectedEntries[n].shouldSendPaperMail=!1;i?0<this.selectedEntries.length&&(o=_.clone(this.selectedEntries),this.numAddressesToBulkValidate=o.length,(s=function(){t.testAddressRequiredFields(o[0]).then(function(){for(o.splice(0,1);0<o.length&&!o[0].amountDue;)o.splice(0,1);t.numAddressesToBulkValidate=o.length,0<o.length&&s()})})()):(_.each(this.selectedEntries,function(e){return e.isValidMailingAddress=e.validationMessage=null}),this.numInvalidMailingAddresses=0)}},o.prototype.autoUnselectPaidOwners=function(){var n=this,e=(this.isLoading=!0,o.getCurrentPayPeriod(this.siteInfo.privateSiteInfo.assessmentFrequency)),e="/api/PaymentHistory/RecentPayPeriod/"+e.year+"/"+e.period1Based;this.$http.get(e).then(function(e){n.isLoading=!1;for(var t=0,i=n.homesGridOptions.data;t<i.length;t++)!function(t){0<e.data.filter(function(e){return-1!==t.unitIds.indexOf(e.unitId)}).length?n.gridApi.selection.unSelectRow(t,null):n.gridApi.selection.selectRow(t,null)}(i[t])},function(e){n.isLoading=!1,alert("Failed to retrieve assessment status: "+e.data.exceptionMessage)})},o.$inject=["$http","SiteInfo","fellowResidents","WizardHandler","$scope","$timeout","$location"],e.MailingInvoiceController=o}(Ally=Ally||{}),CA.angularApp.component("mailingInvoice",{templateUrl:"/ngApp/common/mailing/mailing-invoice.html",controller:Ally.MailingInvoiceController}),function(e){function t(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.$cacheFactory=n,this.$rootScope=o,this.selectedView=null,this.selectedView=this.$routeParams.viewName||"Invoice"}t.prototype.$onInit=function(){},t.$inject=["$http","SiteInfo","$routeParams","$cacheFactory","$rootScope"],e.MailingParentController=t}(Ally=Ally||{}),CA.angularApp.component("mailingParent",{templateUrl:"/ngApp/common/mailing/mailing-parent.html",controller:Ally.MailingParentController}),function(n){var t=function(){},i=(n.MaintenanceProject=t,function(){}),e=(n.VendorListItem=function(){},s.prototype.$onInit=function(){var t=this;this.equipmentGridOptions={data:[],columnDefs:[{field:"name",displayName:"Name",cellTemplate:'<div class="ui-grid-cell-contents"><span class="text-link" data-ng-if="grid.appScope.$ctrl.isSiteManager" data-ng-click="grid.appScope.$ctrl.editEquipment( row.entity )">{{ row.entity.name }}</span><span data-ng-if="!grid.appScope.$ctrl.isSiteManager">{{ row.entity.name }}</span></div>'},{field:"type",displayName:"Type",width:150},{field:"installDate",displayName:"Installed",width:90,cellFilter:"date:'shortDate'",type:"date"},{field:"initialCost",displayName:"Cost",width:90,cellFilter:"currency",type:"number"},{field:"addedDateUtc",displayName:"Added",width:90,cellFilter:"date:'shortDate'",type:"date"}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableFullRowSelection:!1,enableColumnMenus:!1,enableRowHeaderSelection:!1,onRegisterApi:function(e){HtmlUtil.uiGridFixScroll()}},this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.fellowResidents.getResidents().then(function(e){return t.assigneeOptions=_.clone(e)}),this.entriesSortField=window.localStorage[s.StorageKey_SortField],this.entriesSortField?this.entriesSortAscending="true"===window.localStorage[s.StorageKey_SortDir]:(this.entriesSortField="entryDate",this.entriesSortAscending=!0),this.loadEquipment().then(function(){return t.loadVendors()}).then(function(){return t.loadProjects()}).then(function(){return t.loadMaintenanceTodos()}).then(function(){return t.rebuildMaintenanceEntries()})},s.prototype.rebuildMaintenanceEntries=function(){var i=this;this.maintenanceEntries=[],_.forEach(this.projects,function(e){var t=new n.MaintenanceEntry;t.project=e,i.maintenanceEntries.push(t)}),_.forEach(this.maintenanceTodos.todoItems,function(e){var t=new n.MaintenanceEntry;t.todo=e,i.maintenanceEntries.push(t)}),this.sortEntries()},s.prototype.loadEquipment=function(){var t=this;return this.isLoading=!0,this.$http.get("/api/Maintenance/Equipment").then(function(e){t.isLoading=!1,t.equipmentOptions=e.data,t.equipmentGridOptions.data=JSON.parse(JSON.stringify(t.equipmentOptions));e=new i;e.name="Add New...",e.equipmentId=s.EquipmentId_AddNew,t.equipmentOptions.push(e),_.forEach(t.equipmentOptions,function(e){e.typeTags=[{text:e.type}],e.locationTags=[{text:e.location}]}),t.editingProject&&t.editingProject.equipmentId===s.EquipmentId_AddNew&&0<t.equipmentOptions.length&&(t.editingProject.equipmentId=_.max(t.equipmentOptions,function(e){return e.equipmentId}).equipmentId)},function(e){t.isLoading=!1,alert("Failed to retrieve equipment: "+e.data.exceptionMessage)})},s.prototype.deleteEquipment=function(){var t=this;confirm("Are you sure you want to delete this equipment? This action cannot be undone.")&&(this.isLoading=!0,this.$http.delete("/api/Maintenance/Equipment/"+this.editingEquipment.equipmentId).then(function(){t.isLoading=!1,t.editingEquipment=null,t.shouldShowEditEquipmentModal=!1,t.loadEquipment().then(function(){return t.loadProjects()}).then(function(){return t.rebuildMaintenanceEntries()})},function(e){t.isLoading=!1,alert("Failed to delete the equipment: "+e.data.exceptionMessage)}))},s.prototype.loadVendors=function(){var t=this;return this.isLoading=!0,this.$http.get("/api/PreferredVendors/ListItems").then(function(e){t.isLoading=!1,t.vendorOptions=e.data},function(e){t.isLoading=!1,alert("Failed to retrieve vendors: "+e.data.exceptionMessage)})},s.prototype.onEquipmentSelectionChange=function(){this.editingProject.equipmentId===s.EquipmentId_AddNew&&this.openAddNewEquipment()},s.prototype.loadProjects=function(){var t=this;return this.isLoading=!0,this.maintenanceService.loadProjects().then(function(e){t.isLoading=!1,t.projects=e},function(e){t.isLoading=!1,alert("Failed to retrieve projects: "+e.exceptionMessage)})},s.prototype.loadMaintenanceTodos=function(){var t=this;return this.isLoading=!0,this.$http.get("/api/Todo/MaintenanceList").then(function(e){t.isLoading=!1,t.maintenanceTodos=e.data})},s.prototype.onProjectStartDateChange=function(){this.editingProject.endDate||(this.editingProject.endDate=this.editingProject.startDate)},s.prototype.openAddNewProject=function(){this.editingProject=new t,setTimeout(function(){return $("#project-title-text-box").focus()},100)},s.prototype.openAddNewEquipment=function(){this.shouldShowEditEquipmentModal=!0,this.editingEquipment=new i,setTimeout(function(){return $("#equipment-name-text-box").focus()},100)},s.prototype.saveProject=function(){var t=this;this.isLoading=!0,(this.editingProject.maintenanceProjectId?this.$http.put:this.$http.post)("/api/Maintenance/Project",this.editingProject).then(function(){t.isLoading=!1,t.editingProject=null,t.loadProjects().then(function(){return t.rebuildMaintenanceEntries()})},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},s.prototype.onEntryTypeChange=function(e){"todo"===e?(this.editingTodo=new n.TodoItem,this.editingTodo.owningTodoListId=this.maintenanceTodoListId,this.selectedAssignee=[],this.editingProject&&(this.editingTodo.description=this.editingProject.title),this.editingProject=null,setTimeout(function(){return $("#edit-todo-name-text-box").focus()},50)):(this.editingProject=new t,this.editingTodo&&(this.editingProject.title=this.editingTodo.description),this.editingTodo=null,setTimeout(function(){return $("#project-title-text-box").focus()},50))},s.prototype.saveTodo=function(){var t=this;this.isLoading=!0,this.selectedAssignee&&0<this.selectedAssignee.length&&(this.editingTodo.assignedToUserId=this.selectedAssignee[0].userId),(this.editingTodo.todoItemId?this.$http.put:this.$http.post)("/api/Todo/Item",this.editingTodo).then(function(){t.isLoading=!1,t.editingTodo=null,t.selectedAssignee=[],t.loadMaintenanceTodos().then(function(){return t.rebuildMaintenanceEntries()})},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},s.prototype.saveEquipment=function(){var t=this;this.isLoading=!0,this.editingEquipment.locationTags&&0<this.editingEquipment.locationTags.length?this.editingEquipment.location=this.editingEquipment.locationTags[0].text:this.editingEquipment.location=void 0,(this.editingEquipment.equipmentId?this.$http.put:this.$http.post)("/api/Maintenance/Equipment",this.editingEquipment).then(function(){t.isLoading=!1,t.shouldShowEditEquipmentModal=!1,t.loadEquipment()},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})},s.prototype.getEquipmentLocationAutocomplete=function(t){return HtmlUtil.isNullOrWhitespace(t)?s.AutocompleteLocationOptions:_.where(s.AutocompleteLocationOptions,function(e){return-1!==e.text.toLowerCase().indexOf(t.toLowerCase())})},s.prototype.getEquipmentTypeAutocomplete=function(t){return this.editingEquipment.typeTags&&0<this.editingEquipment.typeTags.length&&!HtmlUtil.isNullOrWhitespace(this.editingEquipment.typeTags[0].text)?[]:HtmlUtil.isNullOrWhitespace(t)?s.AutocompleteEquipmentTypeOptions:_.where(s.AutocompleteEquipmentTypeOptions,function(e){return-1!==e.text.toLowerCase().indexOf(t.toLowerCase())})},s.prototype.editEquipment=function(e){this.shouldShowEditEquipmentModal=!0,this.editingEquipment=_.clone(e),setTimeout(function(){return $("#equipment-name-text-box").focus()},100)},s.prototype.onEditEntry=function(e){var t=this;if(e.project)this.editProject(e.project);else{this.editingTodo=_.clone(e.todo);for(var i=0;i<this.assigneeOptions.length;++i)this.assigneeOptions[i].isSelectedAssignee=!1;e=_.find(this.assigneeOptions,function(e){return e.userId===t.editingTodo.assignedToUserId});e?(e.isSelectedAssignee=!0,this.selectedAssignee=[e]):this.selectedAssignee=[],setTimeout(function(){return $("#edit-todo-name-text-box").focus()},100)}},s.prototype.onDeleteEntry=function(e){var t=this;confirm("Are you sure you want to delete this entry? This action cannot be undone.")&&(e.project?this.onDeleteProject(e.project):(this.isLoading=!0,this.$http.delete("/api/Todo/Item/"+e.todo.todoItemId).then(function(){t.isLoading=!1,t.loadMaintenanceTodos().then(function(){return t.rebuildMaintenanceEntries()})},function(e){t.isLoading=!1,alert("Failed to delete to-do: "+e.data.exceptionMessage)})))},s.prototype.editProject=function(e){this.editingProject=_.clone(e),setTimeout(function(){return $("#project-title-text-box").focus()},100)},s.prototype.onDeleteProject=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Maintenance/Project/"+e.maintenanceProjectId).then(function(){t.isLoading=!1,t.loadProjects().then(function(){return t.rebuildMaintenanceEntries()})},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)})},s.prototype.exportMaintenanceCsv=function(){"undefined"!=typeof analytics&&analytics.track("exportMaintenanceCsv");var e=[{headerText:"Title",fieldName:"title"},{headerText:"Start Date",fieldName:"startDate",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD"):""}},{headerText:"End Date",fieldName:"endDate",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD"):""}},{headerText:"Description",fieldName:"descriptionText"},{headerText:"Cost",fieldName:"cost"},{headerText:"Vendor",fieldName:"vendorCompanyName"},{headerText:"Related Equipment",fieldName:"equipmentName"},{headerText:"Entered By",fieldName:"creatorFullName"},{headerText:"Status",fieldName:"status"},{headerText:"Assigned To",fieldName:"assignedTo"}],t=_.map(_.filter(this.maintenanceEntries,function(e){return!!e.project}),function(e){return e.project}),t=n.createCsvString(t,e);n.HtmlUtil2.downloadCsv(t,"Maintenance.csv")},s.prototype.sortEntries=function(){var t=this;this.maintenanceEntries=_.sortBy(this.maintenanceEntries,function(e){return"status"===t.entriesSortField?e.project?e.project.status:"ZZZZZ":"startDate"===t.entriesSortField?e.project?e.project.startDate:new Date(1001,12,30):e.getCreatedDate()}),("status"===this.entriesSortField?this.entriesSortAscending:!this.entriesSortAscending)&&this.maintenanceEntries.reverse()},s.prototype.updateEntriesSort=function(e){this.entriesSortField===(e=e||"entryDate")?this.entriesSortAscending=!this.entriesSortAscending:(this.entriesSortField=e,this.entriesSortAscending=!1),window.localStorage[s.StorageKey_SortField]=this.entriesSortField,window.localStorage[s.StorageKey_SortDir]=this.entriesSortAscending,this.sortEntries()},s.$inject=["$http","$rootScope","SiteInfo","maintenance","fellowResidents"],s.StorageKey_SortField="maintenance_entriesSortField",s.StorageKey_SortDir="maintenance_entriesSortAscending",s.EquipmentId_AddNew=-5,s.AutocompleteLocationOptions=[{text:"Attic"},{text:"Back Yard"},{text:"Basement"},{text:"Front Yard"},{text:"Garage"},{text:"Interior"},{text:"Kitchen"},{text:"Exterior"},{text:"Side of Building"},{text:"Structural"}],s.AutocompleteEquipmentTypeOptions=[{text:"Appliance"},{text:"Deck"},{text:"Driveway"},{text:"HVAC"},{text:"Patio"},{text:"Plumbing"},{text:"Roof"},{text:"Siding"},{text:"Structural"}],s);function s(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.maintenanceService=n,this.fellowResidents=o,this.isSiteManager=!1,this.shouldShowEditEquipmentModal=!1,this.shouldShowManageEquipmentModal=!1,this.maintenanceEntries=[],this.assigneeOptions=[],this.entriesSortAscending=!0,this.equipmentTypeOptions=_.map(s.AutocompleteEquipmentTypeOptions,function(e){return e.text}),this.equipmentLocationOptions=_.map(s.AutocompleteLocationOptions,function(e){return e.text}),this.maintenanceTodoListId=i.privateSiteInfo.maintenanceTodoListId}n.MaintenanceController=e}(Ally=Ally||{}),CA.angularApp.component("maintenance",{bindings:{},templateUrl:"/ngApp/common/maintenance.html",controller:Ally.MaintenanceController}),function(e){function t(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.upcomingWork=[],this.recentProjects=[]}t.prototype.$onInit=function(){this.loadProjects()},t.prototype.loadProjects=function(){var t=this;return this.isLoading=!0,this.$http.get("/api/Maintenance/Projects").then(function(e){t.isLoading=!1,t.recentProjects=_.take(e.data,3)},function(e){t.isLoading=!1,alert("Failed to retrieve projects: "+e.data.exceptionMessage)})},t.$inject=["$http","$rootScope","SiteInfo"],e.MaintenanceWidgetController=t}(Ally=Ally||{}),CA.angularApp.component("maintenanceWidget",{templateUrl:"/ngApp/common/maintenance-widget.html",controller:Ally.MaintenanceWidgetController}),function(e){function t(){}function i(){}function n(){}var r=function(){},o=(e.SplitAddress=r,e.GpsPoint=t,e.GpsPolygon=i,e.FullAddress=n,s.parseAddressComponents=function(e){for(var t=new r,i="",n="",o=0,s=e;o<s.length;o++){var a=s[o];-1!==a.types.indexOf("street_number")?i=a.short_name:-1!==a.types.indexOf("route")?n=a.short_name:-1!==a.types.indexOf("locality")?t.city=a.short_name:-1!==a.types.indexOf("administrative_area_level_1")?t.state=a.short_name:-1!==a.types.indexOf("postal_code")?t.zip=a.short_name:-1!==a.types.indexOf("country")&&(t.country=a.short_name)}return t.street=i+" "+n,t},s.gpsBoundsToGooglePoly=function(e){return _.map(e.vertices,function(e){return new google.maps.LatLng(e.lat,e.lon)})},s);function s(){}e.MapUtil=o}(Ally=Ally||{}),function(e){function t(e,t,i){this.$http=e,this.siteInfo=t,this.$rootScope=i,this.isLoading=!1,this.returnUrl="https://localtest.mycondoally.com/#!/Home"}t.prototype.$onInit=function(){var i=this;null!=this.siteInfo.userInfo.usersUnits&&0<this.siteInfo.userInfo.usersUnits.length?this.assessmentAmount=this.siteInfo.userInfo.usersUnits[0].assessment:this.assessmentAmount=0,this.errorPayInfoText="Is the amount incorrect?",this.paymentInfo={paymentType:"other",amount:this.assessmentAmount,note:"",fundingType:null,paysFor:null};if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments&&0<this.recentPayments.length)for(6<this.recentPayments.length&&(this.recentPayments=this.recentPayments.slice(0,6));this.recentPayments.length<6;)this.recentPayments.push({});null!=this.siteInfo.privateSiteInfo.assessmentFrequency&&null!=this.siteInfo.userInfo.usersUnits&&0<this.siteInfo.userInfo.usersUnits.length&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled)&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText([this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue],this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText()),setTimeout(function(){$("#btn_view_pay_history").click(function(){$("#pm_info").collapse("hide"),$("#payment_history").collapse("show")}),$("#btn_view_pay_info").click(function(){$("#payment_history").collapse("hide"),$("#pm_info").collapse("show")}),$(".hide").click(function(){$(this).parent().hide("")})},400),paypal.Button.render({env:"sandbox",commit:!0,style:{color:"gold",size:"medium"},client:{sandbox:null,production:"AW51-dH9dRrczrhVVf1kZyavtifN8z23Q0BTJwpWcTJQL6YoqGCTwOb0JfbCHTJIA_usIXAgrxwQ7osQ"},payment:function(e,t){return i.isLoading=!0,t.payment.create({payment:{transactions:[{amount:{total:i.paymentInfo.amount.toString(),currency:"USD"}}]}})},onAuthorize:function(e,t){return t.payment.execute().then(function(e){e={PayPalCheckoutId:e.id,Memo:i.paymentInfo.note};i.isLoading=!0,i.$http.put("/api/OnlinePayment/SetMemo",e).then(function(e){i.isLoading=!1},function(e){i.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})})},onCancel:function(e,t){i.isLoading=!1},onError:function(e){i.isLoading=!1}},"#paypal-button")},t.prototype.onIncorrectPayDetails=function(){var e=this.assessmentAmount.toString(),e=e=Math.round(this.assessmentAmount)!=this.assessmentAmount?this.assessmentAmount.toFixed(2):e;this.knowsNextPayment&&HtmlUtil.isValidString(this.nextPaymentText)&&(e+="|"+this.nextPaymentText),this.$rootScope.$broadcast("prepAssessmentEmailToBoard",e)},t.prototype.getNextPaymentText=function(e,t){if(null==e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];"month"===n.intervalName?i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]:"quarter"===n.intervalName?i=["Q1","Q2","Q3","Q4"][s.period-1]:"half-year"===n.intervalName&&(i=["First Half","Second Half"][s.period-1]),i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},t.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"==e?this.assessmentAmount:0,this.updatePaymentText()},t.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},t.$inject=["$http","SiteInfo","$rootScope"],e.PayPalPaymentFormController=t}(Ally=Ally||{}),CA.angularApp.component("paypalPaymentForm",{templateUrl:"/ngApp/common/paypal-payment-form.html",controller:Ally.PayPalPaymentFormController}),function(n){function e(e,t){this.$http=e,this.siteInfo=t,this.isLoading=!1,this.isSiteManager=!1,this.isInEditMode=!1}e.prototype.$onInit=function(){var e=this;this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.isAddForm=null==this.vendorItem,this.isAddForm&&(this.isInEditMode=!0,this.vendorItem=new n.PreferredVendor,this.editVendorItem=new n.PreferredVendor,window.setTimeout(function(){return e.hookupAddressAutocomplete()},500))},e.prototype.hookupAddressAutocomplete=function(){var t=this,e=("US"!==this.siteInfo.privateSiteInfo.country&&"CA"!==this.siteInfo.privateSiteInfo.country||$(".mask-phone").mask("(999) 999-9999? x999",{autoclear:!1}),void 0),i=(this.siteInfo.privateSiteInfo.googleGpsPosition&&(e={bounds:new google.maps.Circle({center:this.siteInfo.privateSiteInfo.googleGpsPosition,radius:40234}).getBounds()}),document.getElementById("vendor-"+(this.vendorItem.preferredVendorId||"")+"-address-text-box"));this.addressAutocomplete=new google.maps.places.Autocomplete(i,e),google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var e=t.addressAutocomplete.getPlace();t.editVendorItem.fullAddress||(t.editVendorItem.fullAddress=new n.FullAddress),t.editVendorItem.fullAddress.oneLiner=e.formatted_address})},e.prototype.onSaveVendor=function(){var e,t,i=this;HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyName)?alert("Please enter a company name"):this.editVendorItem.servicesTagArray&&0!==this.editVendorItem.servicesTagArray.length?(HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyWeb)||0!==this.editVendorItem.companyWeb.indexOf("http")&&(this.editVendorItem.companyWeb="http://"+this.editVendorItem.companyWeb),e=null==this.editVendorItem.preferredVendorId?this.$http.post:this.$http.put,this.isLoading=!0,t="",_.each(this.editVendorItem.servicesTagArray,function(e){t+="|"+e.text}),t+="|",this.editVendorItem.servicesProvided=t,e("/api/PreferredVendors",this.editVendorItem).then(function(){i.isLoading=!1,i.isAddForm?(i.editVendorItem=new n.PreferredVendor,i.onAddNewVendor&&i.onAddNewVendor()):i.isInEditMode=!1,i.onParentDataNeedsRefresh&&i.onParentDataNeedsRefresh()},function(e){i.isLoading=!1,alert("Failed to save the vendor information: "+e.exceptionMessage)})):alert("Please enter at least one service provided")},e.prototype.onCancelEdit=function(){this.isInEditMode=!1},e.prototype.onEditItem=function(){var e=this;this.editVendorItem=JSON.parse(JSON.stringify(this.vendorItem)),this.isInEditMode=!0,window.setTimeout(function(){return e.hookupAddressAutocomplete()},500)},e.prototype.deleteItem=function(){var t=this;confirm("Are you sure you want to remove this vendor?")&&(this.isLoading=!0,this.$http.delete("/api/PreferredVendors/"+this.vendorItem.preferredVendorId).then(function(){t.isLoading=!1,t.onParentDataNeedsRefresh&&t.onParentDataNeedsRefresh()},function(e){t.isLoading=!1,alert("Failed to delete the vendor: "+e.data.exceptionMessage)}))},e.prototype.getServiceAutocomplete=function(t){return _.where(e.AutocompleteServiceOptions,function(e){return-1!==e.text.toLowerCase().indexOf(t.toLowerCase())})},e.$inject=["$http","SiteInfo"],e.AutocompleteServiceOptions=[{text:"Additions & Remodels"},{text:"Appliances"},{text:"Cabinets & Countertops"},{text:"Cleaning"},{text:"Concrete & Masonry"},{text:"Deck, Porch, & Gazebo"},{text:"Drywall & Insulation"},{text:"Electrical"},{text:"Fencing"},{text:"Flooring"},{text:"Garages"},{text:"Gutters"},{text:"Handy Man"},{text:"HVAC"},{text:"Landscaping, Lawn Care & Sprinklers"},{text:"Painting & Staining"},{text:"Pest Control"},{text:"Plumbing"},{text:"Remodeling"},{text:"Roofing"},{text:"Siding"},{text:"Snow Removal"},{text:"Solar Electric, Heating & Cooling"},{text:"Swimming Pools"},{text:"Windows & Doors"}],n.PreferredVendorItemController=e}(Ally=Ally||{}),CA.angularApp.component("preferredVendorItem",{bindings:{vendorItem:"=?",onParentDataNeedsRefresh:"&?",onAddNewVendor:"&?"},templateUrl:"/ngApp/common/preferred-vendor-item.html",controller:Ally.PreferredVendorItemController}),function(t){var i=function(){this.fullAddress=new t.FullAddress},e=(t.PreferredVendor=i,n.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.entriesSortField=window.localStorage[n.StorageKey_SortField],this.entriesSortField?this.entriesSortAscending="true"===window.localStorage[n.StorageKey_SortDir]:(this.entriesSortField="name",this.entriesSortAscending=!1),this.retrieveVendors()},n.prototype.retrieveVendors=function(){var i=this;this.isLoading=!0,this.$http.get("/api/PreferredVendors").then(function(e){e=e.data;i.isLoading=!1,i.allVendors=e,i.filteredVendors=e,i.sortEntries(),i.usedServiceTags=[],_.each(i.allVendors,function(t){t.servicesTagArray=[],_.each(t.servicesProvidedSplit,function(e){return t.servicesTagArray.push({text:e})}),i.usedServiceTags=i.usedServiceTags.concat(t.servicesProvidedSplit),t.addedDateUtc=moment.utc(t.addedDateUtc).toDate()}),i.usedServiceTags=_.uniq(i.usedServiceTags),i.usedServiceTags.sort()})},n.prototype.exportVendorCsv=function(){"undefined"!=typeof analytics&&analytics.track("exportResidentCsv");var e=t.createCsvString(this.allVendors,[{headerText:"Company Name",fieldName:"companyName"},{headerText:"Company Phone",fieldName:"companyPhone"},{headerText:"Company Website",fieldName:"companyWeb"},{headerText:"Address",fieldName:"fullAddress",dataMapper:function(e){return e?e.oneLiner:""}},{headerText:"Contact Name",fieldName:"contactName"},{headerText:"Contact Phone",fieldName:"contactPhone"},{headerText:"Contact Email",fieldName:"contactEmail"},{headerText:"Services",fieldName:"servicesProvided",dataMapper:function(e){return HtmlUtil.isNullOrWhitespace(e)||(HtmlUtil.startsWith(e,"|")&&(e=e.substr(1)),HtmlUtil.endsWith(e,"|")&&(e=e.substr(0,e.length-1))),e}},{headerText:"Notes",fieldName:"notes"}]);t.HtmlUtil2.downloadCsv(e,"Vendors.csv")},n.prototype.onTagFilterToggle=function(e){var t=this,i=this.filterTags.indexOf(e);-1===i?this.filterTags.push(e):this.filterTags.splice(i,1),0===this.filterTags.length?this.filteredVendors=this.allVendors:(this.filteredVendors=[],_.each(this.allVendors,function(e){0<_.intersection(e.servicesProvidedSplit,t.filterTags).length&&t.filteredVendors.push(e)}))},n.prototype.onAddedNewVendor=function(){this.retrieveVendors()},n.prototype.sortEntries=function(){var t=this;this.filteredVendors=_.sortBy(this.filteredVendors,function(e){return"name"===t.entriesSortField?e.companyName.trim().toLocaleUpperCase():e.addedDateUtc}),this.entriesSortAscending&&this.filteredVendors.reverse()},n.prototype.updateEntriesSort=function(e){this.entriesSortField===(e=e||"entryDate")?this.entriesSortAscending=!this.entriesSortAscending:(this.entriesSortField=e,this.entriesSortAscending=!1),window.localStorage[n.StorageKey_SortField]=this.entriesSortField,window.localStorage[n.StorageKey_SortDir]=this.entriesSortAscending,this.sortEntries()},n.$inject=["$http","SiteInfo"],n.StorageKey_SortField="vendors_entriesSortField",n.StorageKey_SortDir="vendors_entriesSortAscending",n);function n(e,t){this.$http=e,this.siteInfo=t,this.allVendors=[],this.filteredVendors=[],this.editVendor=new i,this.isLoading=!1,this.isSiteManager=!1,this.usedServiceTags=[],this.filterTags=[],this.entriesSortAscending=!0}t.PreferredVendorsController=e}(Ally=Ally||{}),CA.angularApp.component("preferredVendors",{templateUrl:"/ngApp/common/preferred-vendors.html",controller:Ally.PreferredVendorsController}),function(e){function t(e,t){this.$http=e,this.siteInfo=t}t.prototype.$onInit=function(){this.shouldHideName=!!this.shouldHideName},t.prototype.onComponentChange=function(){this.onChange&&this.onChange()},t.$inject=["$http","SiteInfo"],e.StreetAddressFormController=t}(Ally=Ally||{}),CA.angularApp.component("streetAddressForm",{bindings:{streetAddress:"=",onChange:"&",shouldHideName:"<",useCareOf:"<"},templateUrl:"/ngApp/common/street-address-form.html",controller:Ally.StreetAddressFormController}),function(e){function t(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.isSiteManager=!1,this.hideDocuments=!1,this.selectedView="docs"}t.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideDocuments?this.selectedView="info":this.selectedView="docs"},t.$inject=["$http","SiteInfo","$cacheFactory"],e.HoaInfoController=t}(Ally=Ally||{}),CA.angularApp.component("hoaInfo",{templateUrl:"/ngApp/hoa/member/HoaInfo.html",controller:Ally.HoaInfoController}),function(e){function t(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.isSiteManager=!1}t.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager},t.$inject=["$http","SiteInfo","$cacheFactory"],e.HoaHomeController=t}(Ally=Ally||{}),CA.angularApp.component("hoaHome",{templateUrl:"/ngApp/hoa/member/Home.html",controller:Ally.HoaHomeController}),function(e){function t(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.appCacheService=o}t.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");HtmlUtil.getSubdomain(window.location.host);this.allyAppName=AppConfig.appName,this.messageObject={},null!==this.siteInfo.privateSiteInfo.assessmentFrequency&&null!==this.siteInfo.userInfo.usersUnits&&0<this.siteInfo.userInfo.usersUnits.length&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled)&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText([this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue],this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText()),this.refreshData()},t.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},t.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"===e?this.siteInfo.userInfo.assessmentAmount:0,this.updatePaymentText()},t.prototype.getNextPaymentText=function(e,t){if(null===e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];"month"===n.intervalName?i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]:"quarter"===n.intervalName?i=["Q1","Q2","Q3","Q4"][s.period-1]:"half-year"===n.intervalName&&(i=["First Half","Second Half"][s.period-1]),i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},t.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},t.prototype.onIncorrectPayDetails=function(){this.messageObject.recipientType="board",this.knowsNextPayment?this.messageObject.message="Hello Board Members,\n\nOur association's home page says my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" will cover "+this.nextPaymentText+", but I believe that is incorrect. My records indicate my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:this.messageObject.message="Hello Board Members,\n\nOur association's home page says my assessment payment is $"+this.siteInfo.userInfo.assessmentAmount+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},t.prototype.refreshData=function(){var e,t,i;HtmlUtil.getSubdomain(window.location.host);"localnews"===this.homeRightColumnType&&(this.isLoading_LocalNews=!0,t="US"===this.siteInfo.privateSiteInfo.country?(e="https://localnewsally.azurewebsites.net/api/LocalNews",{clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.privateSiteInfo.chicagoWard,zipCode:this.siteInfo.privateSiteInfo.zipCode,cityNeighborhood:this.siteInfo.privateSiteInfo.localNewsNeighborhoodQuery}):(e="https://localnewsally.azurewebsites.net/api/LocalNews/International/MajorCity",{clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city}),(i=this).$http.get(e,{cache:!0,params:t}).then(function(e){i.localNews=e.data,i.isLoading_LocalNews=!1}))},t.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService"],e.HomeGroupHomeController=t}(Ally=Ally||{}),CA.angularApp.component("homeGroupHome",{templateUrl:"/ngApp/home/home-group-home.html",controller:Ally.HomeGroupHomeController}),function(e){function t(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.shouldShowWidget=!1}t.prototype.$onInit=function(){this.retrieveInfo()},t.prototype.retrieveInfo=function(){var t=this;this.isLoading=!0,this.$http.get("/api/HomeValue/ZillowInfo").then(function(e){t.isLoading=!1,t.shouldShowWidget=!!e.data&&!!e.data.chartImageUri,t.shouldShowWidget&&(t.valueInfo=e.data)},function(e){t.isLoading=!1,t.shouldShowWidget=!1})},t.$inject=["$http","$rootScope","SiteInfo"],e.HomeValueWidgetController=t}(Ally=Ally||{}),CA.angularApp.component("homeValueWidget",{templateUrl:"/ngApp/home/home-value-widget.html",controller:Ally.HomeValueWidgetController}),function(e){function t(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.isAdmin=!1}t.prototype.$onInit=function(){},t.$inject=["$http","$rootScope","SiteInfo"],e.HomeUsersController=t}(Ally=Ally||{}),CA.angularApp.component("homeUsers",{templateUrl:"/ngApp/home/manager/home-users.html",controller:Ally.HomeUsersController}),function(n){var e=function(){},t=function(){},o=(n.HomeInfo=t,function(){this.signerUpInfo=new e,this.streetAddress="",this.homeInfo=new t});function i(e,t,i){this.$http=e,this.$scope=t,this.WizardHandler=i,this.lotSizeUnit="Acres",this.lotSquareUnits=0,this.signUpInfo=new o,this.isLoadingHomeInfo=!1,this.didLoadHomeInfo=!1,this.isLoading=!1,this.hideWizard=!1,this.hasAlreadyCheckedForHomeInfo=!1}i.prototype.$onInit=function(){var i=this;this.$scope.$on("wizard:stepChanged",function(e,t){1===t.index&&i.retrieveHomeInfoForAddress()});setTimeout(function(){i.initMap()},300)},i.prototype.retrieveHomeInfoForAddress=function(){var e,t=this;HtmlUtil.isNullOrWhitespace(this.signUpInfo.streetAddress)||this.hasAlreadyCheckedForHomeInfo||(this.hasAlreadyCheckedForHomeInfo=!0,e="/api/HomeSignUp/HomeInfo?streetAddress="+encodeURIComponent(this.signUpInfo.streetAddress),this.$http.get(e,{cache:!0}).then(function(e){e.data&&(t.signUpInfo.homeInfo=e.data,t.didLoadHomeInfo=!0,t.processLotSizeHint(t.signUpInfo.homeInfo.lotSquareFeet))}))},i.prototype.processLotSizeHint=function(e){e&&(43560<e?(this.lotSizeUnit="Acres",this.lotSquareUnits=e/43560,this.lotSquareUnits=parseFloat((Math.round(4*this.lotSquareUnits)/4).toFixed(2))):(this.lotSizeUnit="SquareFeet",this.lotSquareUnits=e))},i.prototype.initMap=function(){var e=document.getElementById("address-map"),e=(this.map=new google.maps.Map(e,{center:{lat:41.869638,lng:-87.657423},zoom:9}),this.mapMarker=new google.maps.Marker({map:this.map,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png",position:null}),document.getElementById("home-address-text-box")),i=(this.addressAutocomplete=new google.maps.places.Autocomplete(e),this.addressAutocomplete.bindTo("bounds",this.map),this);this.addressAutocomplete.addListener("place_changed",function(){i.mapMarker.setVisible(!1);var e=i.addressAutocomplete.getPlace(),t=e.formatted_address;t.indexOf(", USA")===t.length-", USA".length&&(t=t.substring(0,t.length-", USA".length)),i.signUpInfo.streetAddress=t,i.selectedSplitAddress=n.MapUtil.parseAddressComponents(e.address_components),e.geometry&&i.centerMap(e.geometry),$("#association-name-text-box").focus()})},i.prototype.goNextStep=function(){this.WizardHandler.wizard().next()},i.prototype.onFinishedWizard=function(){this.isLoading=!0;var t=this;this.$http.post("/api/HomeSignUp",this.signUpInfo).then(function(e){t.isLoading=!1;e=e.data;HtmlUtil.isNullOrWhitespace(e.errorMessage)?HtmlUtil.isNullOrWhitespace(e.createUrl)?(t.hideWizard=!0,t.resultMessage="Great work! We just sent you an email with instructions on how access your new site."):window.location.href=e.createUrl:(alert("Failed to complete sign-up: "+e.errorMessage),0<=e.stepIndex&&t.WizardHandler.wizard().goTo(e.stepIndex))},function(e){t.isLoading=!1;e=e.data.exceptionMessage||e.data;alert("Failed to complete sign-up: "+e)})},i.prototype.onHomeAddressChanged=function(){var n=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){n.$scope.$apply(function(){var e;i==google.maps.GeocoderStatus.OK&&((e=t[0].formatted_address).indexOf(", USA")===e.length-", USA".length&&(e=e.substring(0,e.length-", USA".length)),n.signUpInfo.streetAddress=e,n.centerMap(t[0].geometry))})})},i.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},i.prototype.prepopulateHomeInfo=function(){var e,t;this.selectedSplitAddress&&(this.isLoadingHomeInfo=!0,e="/api/PropertyResearch/HomeInfo?street="+encodeURIComponent(this.selectedSplitAddress.street)+"&city="+encodeURIComponent(this.selectedSplitAddress.city)+"&state="+this.selectedSplitAddress.state+"&zip="+this.selectedSplitAddress.zip,(t=this).$http.get(e).then(function(e){t.isLoadingHomeInfo=!1;e=e.data;e&&(t.didLoadHomeInfo=!0,t.signUpInfo.homeInfo=e,t.processLotSizeHint(e.lotSquareFeet))},function(){t.isLoadingHomeInfo=!1}))},i.$inject=["$http","$scope","WizardHandler"],n.HomeSignUpController=i}(Ally=Ally||{}),CA.angularApp.component("homeSignUp",{templateUrl:"/ngApp/home/public/home-sign-up.html",controller:Ally.HomeSignUpController}),function(e){function t(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.appCacheService=o}t.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");HtmlUtil.getSubdomain(window.location.host);this.allyAppName=AppConfig.appName,this.messageObject={},null!==this.siteInfo.privateSiteInfo.assessmentFrequency&&null!==this.siteInfo.userInfo.usersUnits&&0<this.siteInfo.userInfo.usersUnits.length&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled)&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText([this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue],this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())},t.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},t.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"===e?this.siteInfo.userInfo.assessmentAmount:0,this.updatePaymentText()},t.prototype.getNextPaymentText=function(e,t){if(null===e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];"month"===n.intervalName?i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]:"quarter"===n.intervalName?i=["Q1","Q2","Q3","Q4"][s.period-1]:"half-year"===n.intervalName&&(i=["First Half","Second Half"][s.period-1]),i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},t.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},t.prototype.onIncorrectPayDetails=function(){this.messageObject.recipientType="board",this.knowsNextPayment?this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" will cover "+this.nextPaymentText+", but I believe that is incorrect. My records indicate my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+this.siteInfo.userInfo.assessmentAmount+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},t.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService"],e.PtaGroupHomeController=t}(Ally=Ally||{}),CA.angularApp.component("ptaGroupHome",{templateUrl:"/ngApp/pta/pta-group-home.html",controller:Ally.PtaGroupHomeController}),ServiceBankInfoCtrl.$inject=["$http"],ServiceBusinessInfoCtrl.$inject=["$http"],ServiceJobsCtrl.$inject=["$http"];var Ally,AppCacheService=function(){function i(){}return i.prototype.set=function(e,t){window.sessionStorage[i.KeyPrefix+e]=t},i.prototype.get=function(e){return window.sessionStorage[i.KeyPrefix+e]},i.prototype.clear=function(e){window.sessionStorage[i.KeyPrefix+e]=void 0,delete window.sessionStorage[i.KeyPrefix+e]},i.prototype.getAndClear=function(e){var t=this.get(e);return this.clear(e),t},i.Key_WasLoggedIn403="wasLoggedIn403",i.Key_WasLoggedIn401="wasLoggedIn401",i.Key_AfterLoginRedirect="afterLoginRedirect",i.KeyPrefix="AppCacheService_",i}(),__extends=(angular.module("CondoAlly").service("appCacheService",[AppCacheService]),!function(e){function c(e){return!e||(e=e.toString(),HtmlUtil.isNullOrWhitespace(e))?"":-1!==e.indexOf('"')||-1!==e.indexOf(",")||-1!==e.indexOf("\r")||-1!==e.indexOf("\n")?'"'+(e=e.replace(/"/g,'""'))+'"':e}e.CsvColumnDescriptor=function(){},e.ValueToCsvValue=c,e.createCsvString=function(e,t,i){var n="";if(i=void 0===i?!0:i){for(var o=0;o<t.length;++o)0<o&&(n+=","),n+=c(t[o].headerText);n+="\n"}for(var s=0;s<e.length;++s){for(var a=e[s],r=0;r<t.length;++r){0<r&&(n+=",");var l=t[r],d=a[l.fieldName];n+=c(d=l.dataMapper?l.dataMapper(d):d)}n+="\n"}return n}}(Ally=Ally||{}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}()),__extends=(!function(e){function t(){}function i(){}function n(){}e.GroupEmailInfo=function(){},e.GroupEmailGroups=t,e.CustomEmailGroup=i,e.CustomEmailGroupMember=n;o=e.SimpleUserEntry,__extends(a,o);var o,s=a;function a(){return null!==o&&o.apply(this,arguments)||this}e.FellowChtnResident=s;function r(){}function l(){}e.CommitteeListingInfo=function(){},e.UnitListing=r;e.FellowResidents=l,c.prototype.getResidents=function(){var t=this;return this.$http.get("/api/BuildingResidents",{cache:this.httpCache}).then(function(e){return e.data.residents},function(e){return t.$q.reject(e)})},c.prototype.getCommitteeMembers=function(e){return this.$http.get("/api/Committee/"+e+"/Members").then(function(e){return e.data},function(e){return this.$q.reject(e)})},c.prototype.isCommitteeMember=function(e){var t=this;return this.$http.get("/api/Committee/"+e+"/IsMember",{cache:this.httpCache}).then(function(e){return e.data},function(e){return t.$q.reject(e)})},c.prototype.getByUnits=function(){var t=this;return this.$http.get("/api/BuildingResidents",{cache:this.httpCache}).then(function(e){return e.data.byUnit},function(e){return t.$q.reject(e)})},c.prototype.getByUnitsAndResidents=function(){var t=this;return this.$http.get("/api/BuildingResidents",{cache:this.httpCache}).then(function(e){return e.data},function(e){return t.$q.reject(e)})},c.prototype.getGroupEmailObject=function(){return this.$http.get("/api/BuildingResidents/EmailGroups",{cache:this.httpCache}).then(function(e){return e.data},function(e){return this.$q.reject(e)})},c.prototype.getAllGroupEmails=function(){var t=this;return this.$http.get("/api/BuildingResidents/AllEmailGroups",{cache:this.httpCache}).then(function(e){return e.data},function(e){return t.$q.reject(e)})},c.prototype._setupGroupEmailObject=function(e,i){for(var t={},t={everyone:[],owners:[],renters:[],board:[],residentOwners:[],nonResidentOwners:[],residentOwnersAndRenters:[],propertyManagers:[],discussion:[]},n=0;n<e.length;++n){for(var o=e[n],s=o.fullName+(o.hasEmail?"":"*"),a=(t.everyone.push(s),o.boardPosition!==c.BoardPos_None&&o.boardPosition!==c.BoardPos_PropertyManager&&t.board.push(s),o.boardPosition===c.BoardPos_PropertyManager&&t.propertyManagers.push(s),o.includeInDiscussionEmail&&t.discussion.push(s),!1),r=!1,l=!1,d=0;d<o.homes.length;++d)!function(e){var t=o.homes[e];t.isRenter||(a=!0,e=_.find(i,function(e){return e.unitId===t.unitId}),l=0<e.renters.length),t.isRenter&&(r=!0)}(d);a&&(t.owners.push(s),(l?t.nonResidentOwners:(t.residentOwners.push(s),t.residentOwnersAndRenters)).push(s)),r&&(t.renters.push(s),t.residentOwnersAndRenters.push(s))}return 0===t.renters.length&&(t.residentOwners=[],t.residentOwnersAndRenters=[],t.nonResidentOwners=[]),t},c.prototype.sendMessage=function(e,t,i,n){return this.$http.post("/api/BuildingResidents/SendMessage",{recipientUserId:e,messageBody:t,messageSubject:i,shouldSendAsBoard:n})},c.prototype.clearResidentCache=function(){this.httpCache.removeAll()},c.isOfficerBoardPosition=function(e){return-1!==[1,2,4,16,64].indexOf(e)},c.isNonPropMgrBoardPosition=function(e){return!(e<1||e===c.BoardPos_None||e===c.BoardPos_PropertyManager)},c.pollReponsesToChart=function(i,e){function t(e){return e.forEach(function(e){return t=e,(e=n.find(function(e){return e.answerId===t}))||(e=new d(t),n.push(e)),void++e.numVotes;var t})}for(var n=[],o=(i.responses.forEach(function(e){return t(e.answerIds)}),{chartData:[],chartLabels:[]}),s=0,a=n;s<a.length;s++)!function(t){var e=_.find(i.answers,function(e){return e.pollAnswerId===t.answerId});e?(o.chartLabels.push(e.answerText),o.chartData.push(t.numVotes)):console.log("Unknown answer ID found: "+t.answerId)}(a[s]);return i.responses&&i.responses.length<e.privateSiteInfo.numUnits&&(o.chartLabels.push("No Response"),"neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"pta"===AppConfig.appShortName?o.chartData.push(e.privateSiteInfo.numMembers-i.responses.length):o.chartData.push(e.privateSiteInfo.numUnits-i.responses.length)),o},c.BoardPos_None=0,c.BoardPos_PropertyManager=32,c.CustomRecipientType="CUSTOM",c.BoardPositionNames=[{id:c.BoardPos_None,name:"None"},{id:1,name:"President"},{id:2,name:"Treasurer"},{id:4,name:"Secretary"},{id:8,name:"Director/Member at Large"},{id:16,name:"Vice President"},{id:c.BoardPos_PropertyManager,name:"Property Manager"},{id:64,name:"Secretary + Treasurer"}];s=c;function c(e,t,i){this.$http=e,this.$q=t,this.$cacheFactory=i,this.httpCache=i("FellowResidentsService")}e.FellowResidentsService=s;var d=function(e){this.numVotes=0,this.answerId=e}}(Ally=Ally||{}),angular.module("CondoAlly").service("fellowResidents",["$http","$q","$cacheFactory",Ally.FellowResidentsService]),CA.angularApp.directive("googleMapPolyEditor",["$http",function(e){return{scope:{editPolyVerts:"=",visiblePolys:"=",visiblePoints:"=",groupBoundsPoly:"=",mapCenter:"=",onMapEditorReady:"&",enableMapControls:"=",enableClustering:"="},restrict:"E",replace:"true",templateUrl:"/ngApp/services/GoogleMapPolyEditorTemplate.html",link:function(n,e,t){n.mapInfo={center:{lat:39.5,lng:-98.35},zoom:4,disableDefaultUI:!n.enableMapControls,mapTypeId:google.maps.MapTypeId.HYBRID,events:{tilesloaded:function(e,t,i){google.maps.event.clearListeners(e,"tilesloaded")}}},n.markerClusterer=null,n.googlePolyToGpsBounds=function(e){return e=_.map(e,function(e){return{lat:e.lat(),lon:e.lng()}})},n.centerMapOnPoly=function(e){var t;e&&0!==e.length&&(t=new google.maps.LatLngBounds,_.map(e,function(e){t.extend(e)}),n.mapInstance.fitBounds(t))},n.setGroupBounds=function(e){e?(e={paths:Ally.MapUtil.gpsBoundsToGooglePoly(e),map:n.mapInstance,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1},n.activeShape&&n.activeShape.setMap(null),n.groupBoundsShape=new google.maps.Polygon(e)):n.groupBoundsShape&&(n.groupBoundsShape.setMap(null),n.groupBoundsShape=null)},n.fitBoundsForPolys=function(){var t=new google.maps.LatLngBounds;(n.groupBoundsShape||n.currentVisiblePolys&&0!==n.currentVisiblePolys.length)&&(n.groupBoundsShape&&_.each(n.groupBoundsShape.getPath().getArray(),function(e){t.extend(e)}),_.each(n.currentVisiblePolys,function(e){_.each(e.getPath().getArray(),function(e){t.extend(e)})}),n.mapInstance.fitBounds(t))},n.fitBoundsForPoints=function(){var t;n.currentVisiblePoints&&0!==n.currentVisiblePoints.length&&(t=new google.maps.LatLngBounds,_.each(n.currentVisiblePoints,function(e){t.extend(e.position)}),n.mapInstance.fitBounds(t))};function o(e){function t(e){return $("img[src$='"+e+"']")}var i,n=this,o=t(n.btnDeleteImageUrl);0===o.length&&((i=$("img[src$='http://maps.gstatic.com/mapfiles/undo_poly.png']")).parent().css("height","21px !important"),i.parent().parent().append('<div style="overflow-x: hidden; overflow-y: hidden; position: absolute; width: 30px; height: 27px;top:21px;"><img src="'+n.btnDeleteImageUrl+'" class="deletePoly" style="height:auto; width:auto; position: absolute; left:0;"/></div>'),(o=t(n.btnDeleteImageUrl)).hover(function(){return $(this).css("left","-30px"),!1},function(){return $(this).css("left","0px"),!1}),o.mousedown(function(){return $(this).css("left","-60px"),!1})),n.btnDeleteClickHandler&&o.unbind("click",n.btnDeleteClickHandler),n.btnDeleteClickHandler=function(){return n.removeAt(e),!1},o.click(n.btnDeleteClickHandler)}n.currentVisiblePolys=[],n.currentVisiblePoints=[],n.onVisiblePolysChange=function(e){_.each(n.currentVisiblePolys,function(e){e.setMap(null)}),n.currentVisiblePolys=[],_.each(e,function(e){var t={paths:Ally.MapUtil.gpsBoundsToGooglePoly(e),clickable:"function"==typeof e.onClick,map:n.mapInstance,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.35},i=new google.maps.Polygon(t);(i.polyInfo=e).mapShapeObject=i,n.currentVisiblePolys.push(i),t.clickable&&google.maps.event.addListener(i,"click",function(){i.polyInfo.onClick()})}),n.fitBoundsForPolys()},n.onVisiblePointsChange=function(e){_.each(n.currentVisiblePoints,function(e){e.setMap(null)}),n.currentVisiblePoints=[],_.each(e,function(e){var t=new google.maps.Marker({position:{lat:e.lat,lng:e.lon},map:n.mapInstance,title:e.fullAddress});t.pointSource=e,n.currentVisiblePoints.push(t),"function"==typeof e.onClick&&google.maps.event.addListener(t,"click",function(){t.pointSource.onClick()})}),n.fitBoundsForPoints(),n.enableClustering&&(n.markerClusterer&&markerCluster.setMap(null),n.markerCluster=new markerClusterer.MarkerClusterer({markers:n.currentVisiblePoints,map:n.mapInstance}))},n.onEditPolyChange=function(e){var t,i;if(e)return e=_.map(e.vertices,function(e){return new google.maps.LatLng(e.lat,e.lon)}),n.centerMapOnPoly(e),e={paths:e,editable:!0,draggable:!0,clickable:!0,map:n.mapInstance,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35},n.activeShape&&n.activeShape.setMap(null),n.activeShape=new google.maps.Polygon(e),e=function(){n.editPolyVerts.vertices=n.googlePolyToGpsBounds(n.activeShape.getPath().getArray())},google.maps.event.addListener(n.activeShape.getPath(),"set_at",e),google.maps.event.addListener(n.activeShape.getPath(),"insert_at",e),e=n.activeShape,t="http://i.imgur.com/RUrKV.png",(i=e.getPath()).btnDeleteClickHandler={},i.btnDeleteImageUrl=t,google.maps.event.addListener(e.getPath(),"set_at",o),google.maps.event.addListener(e.getPath(),"insert_at",o),n.activeShape;n.activeShape&&n.activeShape.setMap(null),n.activeShape=null},n.$watch("editPolyVerts",function(e){n.onEditPolyChange(e)}),n.$watch("visiblePolys",function(e){n.onVisiblePolysChange(e)}),n.$watch("visiblePoints",function(e){n.onVisiblePointsChange(e)}),n.$watch("groupBoundsPoly",function(e){n.setGroupBounds(e)}),n.$watch("mapCenter",function(e){e&&(e=new google.maps.LatLng(e.lat,e.lon),n.mapInstance.setCenter(e))}),n.mapInstance=new google.maps.Map($(e).children(".google-map-canvas")[0],n.mapInfo),n.onMapEditorReady&&n.onMapEditorReady({mapInstance:n.mapInstance}),google.maps.event.addListener(n.mapInstance,"click",function(e){var t={lat:e.latLng.lat(),lon:e.latLng.lng()},e={lat:e.latLng.lat()+.01,lon:e.latLng.lng()+.01};n.editPolyVerts&&(n.editPolyVerts.vertices=[t,{lat:e.lat,lon:t.lon},e,{lat:t.lat,lon:e.lon}]),n.onEditPolyChange(n.editPolyVerts)})}}}]),!function(t){function e(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.shouldShowAdminControls=!1,this.digestFrequency=null}e.prototype.$onInit=function(){this.defaultDigestFrequency=this.siteInfo.userInfo.defaultDigestFrequency,this.shouldShowAdminControls=this.siteInfo.userInfo.isSiteManager,this.threadUrl=this.siteInfo.publicSiteInfo.baseUrl+"/#!/Home/DiscussionThread/"+this.thread.commentThreadId,this.isPremiumPlanActive=this.siteInfo.privateSiteInfo.isPremiumPlanActive,this.retrieveComments()},e.prototype.onTextAreaKeyDown=function(e,t){e.keyCode||e.which;13==e.keyCode&&(e.preventDefault(),"new"===t?this.submitNewComment():"edit"===t?this.submitCommentEdit():"reply"===t&&this.submitReplyComment())},e.prototype.onChangeDigestFrequency=function(){var t=this,e=(this.isLoading=!0,"/api/CommentThread/"+this.thread.commentThreadId+"/DigestFrequency/"+this.commentsState.digestFrequency);this.$http.put(e,null).then(function(){t.isLoading=!1},function(e){t.isLoading=!1,alert("Failed to change: "+e.data.exceptionMessage)})},e.prototype.retrieveComments=function(){var i=this;this.isLoading=!0,this.$http.get("/api/CommentThread/"+this.thread.commentThreadId+"/Comments").then(function(e){i.isLoading=!1,i.commentsState=e.data;function t(e){e.isMyComment=e.authorUserId===i.$rootScope.userInfo.userId,e.replies&&_.each(e.replies,t)}_.forEach(i.commentsState.comments,t),i.commentsState.comments=_.sortBy(i.commentsState.comments,function(e){return e.postDateUtc}).reverse()},function(e){i.isLoading=!1})},e.prototype.startReplyToComment=function(e){this.replyToCommentId=e.commentId,this.replyCommentText="",setTimeout(function(){return $(".reply-to-textarea").focus()},150)},e.prototype.startEditComment=function(e){this.editCommentId=e.commentId,this.editCommentText=e.commentText},e.prototype.deleteComment=function(e){var t=this,i="Are you sure you want to delete this comment?";1===this.commentsState.comments.length&&(i="Since there is only one comment, if you delete this comment you'll delete the thread. Are you sure you want to delete this comment?"),confirm(i)&&(this.isLoading=!0,this.$http.delete("/api/CommentThread/"+this.thread.commentThreadId+"/"+e.commentId).then(function(){t.isLoading=!1,1===t.commentsState.comments.length?(t.$rootScope.$broadcast("refreshCommentThreadList"),t.closeModal(!1)):t.retrieveComments()},function(e){t.isLoading=!1,alert("Failed to post comment: "+e.data.exceptionMessage)}))},e.prototype.archiveThread=function(e){var t=this,i=(void 0===e&&(e=!0),this.isLoading=!0,"/api/CommentThread/Archive/"+this.thread.commentThreadId);e||(i="/api/CommentThread/Unarchive/"+this.thread.commentThreadId),this.$http.put(i,null).then(function(){t.isLoading=!1,t.$rootScope.$broadcast("refreshCommentThreadList"),t.closeModal(!1)},function(e){t.isLoading=!1,alert("Failed to archive: "+e.data.exceptionMessage)})},e.prototype.submitCommentEdit=function(){var t=this,e={commentId:this.editCommentId,newCommentText:this.editCommentText};this.isLoading=!0,this.$http.put("/api/CommentThread/"+this.thread.commentThreadId+"/EditComment",e).then(function(){t.isLoading=!1,t.editCommentId=-1,t.editCommentText="",t.retrieveComments()},function(e){t.isLoading=!1,alert("Failed to edit comment: "+e.data.exceptionMessage)})},e.prototype.submitReplyComment=function(){var t=this,e={replyToCommentId:this.replyToCommentId,commentText:this.replyCommentText};this.isLoading=!0,this.$http.put("/api/CommentThread/"+this.thread.commentThreadId+"/AddComment",e).then(function(e){t.isLoading=!1,t.replyToCommentId=-1,t.replyCommentText="",t.retrieveComments()},function(e){t.isLoading=!1,alert("Failed to add comment: "+e.data.exceptionMessage)})},e.prototype.submitNewComment=function(){var t=this,e={commentText:this.newCommentText};this.isLoading=!0,this.$http.put("/api/CommentThread/"+this.thread.commentThreadId+"/AddComment",e).then(function(e){t.isLoading=!1,t.newCommentText="",t.retrieveComments()},function(e){t.isLoading=!1,alert("Failed to add comment: "+e.data.exceptionMessage)})},e.prototype.closeModal=function(e){this.onClosed&&this.onClosed()},e.prototype.copyThreadLink=function(e){return e.stopPropagation(),e.preventDefault(),t.HtmlUtil2.copyTextToClipboard(this.threadUrl)?t.HtmlUtil2.showTooltip(e.target,"Copied!"):t.HtmlUtil2.showTooltip(e.target,"Auto-copy failed, right-click and copy link address"),!1},e.$inject=["$http","$rootScope","SiteInfo"],t.GroupCommentThreadViewController=e}(Ally=Ally||{}),CA.angularApp.component("groupCommentThreadView",{bindings:{thread:"<",onClosed:"&"},templateUrl:"/ngApp/services/group-comment-thread-view.html",controller:Ally.GroupCommentThreadViewController}),!function(e){e.CommentThread=function(){},i.prototype.$onInit=function(){var i=this;this.isPremiumPlanActive=this.siteInfo.privateSiteInfo.isPremiumPlanActive,this.canCreateThreads=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.canCreateThreads||(this.committeeId?this.fellowResidents.isCommitteeMember(this.committeeId).then(function(e){return i.canCreateThreads=e}):this.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads&&"everyone"!==this.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads?"board"===this.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads&&(this.canCreateThreads=this.siteInfo.userInfo.isSiteManager||0!==this.siteInfo.userInfo.boardPosition):this.canCreateThreads=!0),this.showBoardOnly=this.siteInfo.userInfo.isSiteManager||0!==this.siteInfo.userInfo.boardPosition,this.editComment={commentText:"",replyToCommentId:null},this.$scope.$on("refreshCommentThreadList",function(e,t){return i.refreshCommentThreads(!1)}),this.refreshCommentThreads(!1)},i.prototype.setDisplayCreateModal=function(e){this.showCreateNewModal=e,this.newThreadTitle="",this.newThreadBody="",this.newThreadIsBoardOnly=!1,this.newThreadIsReadOnly=!1,this.shouldSendNoticeForNewThread=!0,this.newThreadErrorMessage="",e&&setTimeout(function(){return $("#new-thread-title-text-box").focus()},100)},i.prototype.displayDiscussModal=function(e){this.viewingThread=e},i.prototype.hideDiscussModal=function(){this.viewingThread=null},i.prototype.onClickPin=function(e){var t=this;this.isLoading=!0,this.$http.put("/api/CommentThread/TogglePinned/"+e.commentThreadId,null).then(function(e){t.isLoading=!1,t.refreshCommentThreads()},function(e){t.isLoading=!1,alert("Failed to toggle: "+e.data.exceptionMessage)})},i.prototype.createNewThread=function(){var t=this,e=(this.isLoading=!0,this.newThreadErrorMessage=null,{title:this.newThreadTitle,body:this.newThreadBody,isBoardOnly:this.newThreadIsBoardOnly,isReadOnly:this.newThreadIsReadOnly,shouldSendNotice:this.shouldSendNoticeForNewThread,committeeId:this.committeeId});this.$http.post("/api/CommentThread",e).then(function(e){t.isLoading=!1,t.showCreateNewModal=!1,t.refreshCommentThreads(!1)},function(e){t.isLoading=!1,t.newThreadErrorMessage=e.data.exceptionMessage})},i.prototype.refreshCommentThreads=function(i){var n=this,e=(void 0===i&&(i=!1),this.isLoading=!0,"/api/CommentThread");i&&(e+="/Archived"),this.committeeId&&(e+="?committeeId="+this.committeeId),this.$http.get(e).then(function(e){var t;n.isLoading=!1,e.data=_.sortBy(e.data,function(e){return e.pinnedDateUtc||moment(e.lastCommentDateUtc).subtract(100,"years").toDate()}).reverse(),i?n.archivedThreads=e.data:(n.commentThreads=e.data,n.archivedThreads=null,n.autoOpenThreadId&&((t=_.find(n.commentThreads,function(e){return e.commentThreadId===n.autoOpenThreadId}))&&n.$timeout(function(){return n.displayDiscussModal(t)},125),n.autoOpenThreadId=null))},function(e){n.isLoading=!1})},i.$inject=["$http","$rootScope","SiteInfo","$scope","fellowResidents","$timeout"];var t=i;function i(e,t,i,n,o,s){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$scope=n,this.fellowResidents=o,this.$timeout=s,this.isLoading=!1,this.viewingThread=null,this.showCreateNewModal=!1,this.showBoardOnly=!1,this.archivedThreads=null,this.canCreateThreads=!1,this.isDiscussionEmailEnabled=!0,this.isPremiumPlanActive=!1}e.GroupCommentThreadsController=t}(Ally=Ally||{}),CA.angularApp.component("groupCommentThreads",{bindings:{committeeId:"<?",autoOpenThreadId:"<?"},templateUrl:"/ngApp/services/group-comment-threads.html",controller:Ally.GroupCommentThreadsController}),!function(e){e.Comment=function(){},i.prototype.$onInit=function(){this.isQaSite=!1,this.threadId||(this.threadId="Home"),this.editComment={threadId:this.threadId,commentText:"",replyToCommentId:null},this.refreshComments()},i.prototype.displayDiscussModal=function(){this.showDiscussModal=!0},i.prototype.hideDiscussModal=function(){this.showDiscussModal=!1},i.prototype.refreshComments=function(){var i=this;this.isLoading=!0,this.$http.get("/api/Comment?threadId="+this.threadId).then(function(e){i.isLoading=!1,i.commentList=e.data;function t(e){e.isMyComment=e.authorUserId===i.$rootScope.userInfo.userId,e.replies&&_.each(e.replies,t)}_.each(i.commentList,t)},function(e){i.isLoading=!1,alert("Failed to refresh comments: "+e.data.exceptionMessage)})},i.prototype.postComment=function(e){var t=this,i=(this.isLoading=!0,this.$http.post);(i="number"==typeof e.existingCommentId?this.$http.put:i)("/api/Comment",e).then(function(){t.isLoading=!1,t.editComment={},t.showReplyBoxId=-1,t.refreshComments()},function(e){t.isLoading=!1,alert("Failed to post comment: "+e.data.exceptionMessage)})},i.prototype.onPostCommentClicked=function(){var e;0!==this.editComment.commentText.length&&(e={threadId:this.threadId,commentText:this.editComment.commentText,replyToCommentId:null,existingCommentId:this.editComment.existingCommentId},this.postComment(e))},i.prototype.editMyComment=function(e){this.editComment={commentText:e.commentText,existingCommentId:e.commentId}},i.prototype.deleteMyComment=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Comment?commentId="+e.commentId).then(function(){t.isLoading=!1,t.refreshComments()},function(e){t.isLoading=!1;e=e.data.exceptionMessage||e.data;alert("Failed to post comment: "+e)})},i.prototype.onPostReplyCommentClicked=function(){var e;0!==this.editComment.replyText.length&&(e={threadId:this.threadId,commentText:this.editComment.replyText,replyToCommentId:this.editComment.replyToCommentId},this.postComment(e))},i.prototype.clickReplyToComment=function(e){this.showReplyBoxId=e,this.editComment={commentText:"",replyToCommentId:e}},i.$inject=["$http","$rootScope"];var t=i;function i(e,t){this.$http=e,this.$rootScope=t,this.isLoading=!1,this.showDiscussModal=!1}e.GroupCommentsController=t}(Ally=Ally||{}),CA.angularApp.component("groupComments",{bindings:{threadId:"@?"},templateUrl:"/ngApp/services/group-comments.html",controller:Ally.GroupCommentsController}),!function(e){function l(){}l.convertStringsToDates=function(e){if($.isArray(e)&&l.convertDatesFromArray(e),l.isObject(e))for(var t in e){var i,n=e[t];l.isObject(n)?l.convertStringsToDates(n):$.isArray(n)?l.convertDatesFromArray(n):l.isString(n)&&10<n.length&&l.dotNetTimeRegEx2.test(n)&&(i=void 0,i=HtmlUtil.endsWith(t,"_UTC")||HtmlUtil.endsWith(t,"Utc")?l.serverUtcDateToLocal(n):new Date(n),e[t]=i)}},l.convertDatesFromArray=function(e){for(var t=0;t<e.length;t++){var i=e[t];l.isObject(i)?l.convertStringsToDates(i):l.isString(i)&&l.iso8601RegEx.test(i)&&(e[t]=new Date(i))}},l.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},l.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},l.isValidString=function(e){return!(!e||"string"!=typeof e)&&"null"!==e&&0<e.length},l.serverUtcDateToLocal=function(e){return"string"!=typeof e?e:HtmlUtil.isNullOrWhitespace(e)?null:moment.utc(e).toDate()},l.showTooltip=function(e,t){$(e).qtip({style:{classes:"qtip-light qtip-shadow"},position:{my:"leftMiddle",at:"rightMiddle"},content:{text:t},events:{hide:function(e){$(e.originalEvent.currentTarget).qtip("destroy")}}}),$(e).qtip("show")},l.removeNonAlphanumeric=function(e){return e.replace(/\W/g,"")},l.downloadCsv=function(e,t){l.downloadFile(e,t,"text/csv")},l.downloadXml=function(e,t){l.downloadFile(e,t,"text/xml")},l.downloadFile=function(e,t,i){var n,o,s;"undefined"!=typeof Blob?(o=document.createElement("a"),document.body.appendChild(o),o.style.display="none",n=new Blob([e],{type:i}),n=window.URL.createObjectURL(n),o.href=n,o.download=t,o.click(),window.URL.revokeObjectURL(n)):(o=encodeURI("data:"+i+";charset=utf-8,"+e),(s=document.createElement("a")).setAttribute("href",o),s.setAttribute("download",t),document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s)},500))},l.startsWithNumber=function(e,t){return void 0===t&&(t=!0),!HtmlUtil.isNullOrWhitespace(e)&&(-1===(t=(e=t?e.trim():e).search(/\s/))&&(t=e.length),e=e.substring(0,t-1),HtmlUtil.isNumericString(e))},l.endsWithNumber=function(e,t){return void 0===t&&(t=!0),!HtmlUtil.isNullOrWhitespace(e)&&(t&&(e=e.trim()),/[0-9]+$/.test(e))},l.getNumberAtEnd=function(e){return l.endsWithNumber(e)?parseInt(e.match(/[0-9]+$/)[0]):null},l.isAndroid=function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")},l.copyTextToClipboard=function(e){var t=document.createElement("textarea"),e=(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.focus(),t.select(),!1);try{var i=document.execCommand("copy"),n=i?"successful":"unsuccessful";console.log("Copying text command was "+n),e=i}catch(e){console.log("Oops, unable to copy")}return document.body.removeChild(t),e},l.smartSortStreetAddresses=function(e,o){if(!e||0===e.length)return e;if(_.every(e,function(e){return HtmlUtil.isNumericString(e[o])}))return _.sortBy(e,function(e){return+e[o]});var t=e[0][o].substr(e[0][o].indexOf(" ")),i=_.every(e,function(e){return l.startsWithNumber(e[o])}),n=_.every(e,function(e){return HtmlUtil.endsWith(e[o],t)});if(i&&n)return _.sortBy(e,function(e){return parseInt(e[o].substr(0,e[o].indexOf(" ")))});var s,n=e[0][o].search(/[0-9]/);if(0<=n){var a=e[0][o].substr(0,n),n=_.every(e,function(e){return HtmlUtil.startsWith(e[o],a)}),r=_.every(e,function(e){return l.endsWithNumber(e[o])});if(n&&r)return _.sortBy(e,function(e){return l.getNumberAtEnd(e[o])})}return i?(s=function(e){return e.substring(e.search(/\s/)+1)},e.sort(function(e,t){return e=e[o],t=t[o],i=s(e),n=s(t),i===n?parseInt(e.substr(0,e.search(/\s/)))-parseInt(t.substr(0,t.search(/\s/))):i.localeCompare(n);var i,n})):_.sortBy(e,function(e){return(e[o]||"").toLowerCase()})},l.resizeBase64Img=function(s,a,r){return new Promise(function(e,t){var i=document.createElement("canvas"),n=(i.width=a,i.height=r,i.getContext("2d")),o=document.createElement("img");o.onload=function(){n.drawImage(o,0,0,o.width,o.height,0,0,a,r),e(i.toDataURL())},o.src=s})},l.resizeFromImg=function(o,s,a){return new Promise(function(e,t){var i=document.createElement("canvas"),n=(i.width=s,i.height=a,i.getContext("2d"));n.scale(s/o.width,a/o.height),n.drawImage(o,0,0),e(i.toDataURL())})},l.resizeFromImgToBlob=function(n,o,s,a){return void 0===a&&(a="image/jpeg"),new Promise(function(t,e){var i=document.createElement("canvas");i.width=o,i.height=s,i.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,o,s),i.toBlob(function(e){t(e)},a,.75)})},l.initTinyMce=function(n,o,s){return void 0===n&&(n="tiny-mce-editor"),void 0===o&&(o=400),void 0===s&&(s=null),new Promise(function(i,e){function t(){tinymce.remove();var e=s&&void 0!==s.menubar?s.menubar:"edit insert format table",t=s&&void 0!==s.toolbar?s.toolbar:"styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | checklist code formatpainter table";tinymce.init({selector:"#"+n,menubar:e,plugins:"image link autolink lists media table code",toolbar:t,height:o,file_picker_types:"image",image_description:!1,file_picker_callback:function(r,e,t){var i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("accept","image/*"),i.onchange=function(e){var a=e.target.files[0],n=new FileReader;n.onload=function(e){var i,o="blobid"+(new Date).getTime(),s=tinymce.activeEditor.editorUpload.blobCache,t=n.result.split(",")[1];1048576<t.length?((i=new Image).onload=function(){var e=1e3/i.width,t=1e3/i.height,t=t<e?t:e;l.resizeFromImgToBlob(i,Math.round(i.width*t),Math.round(i.height*t),a.type).then(function(i){var n=new FileReader;n.readAsDataURL(i),n.onloadend=function(){var e=new File([i],a.name,i),t=n.result.split(",")[1],e=s.create(o,e,t);s.add(e),r(e.blobUri(),{title:a.name})}})},i.src=e.target.result):(e=s.create(o,a,t),s.add(e),r(e.blobUri(),{title:a.name}))},n.readAsDataURL(a)},i.click()}}).then(function(e){i(e[0])})}setTimeout(function(){"undefined"==typeof tinymce?setTimeout(t,400):t()},100)})},l.iso8601RegEx=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/,l.dotNetTimeRegEx2=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/,e.HtmlUtil2=l,e.ExceptionResult=function(){}}(Ally=Ally||{}),!function(e){function t(){}function i(e,t,i){this.$http=e,this.$q=t,this.$cacheFactory=i}t.prototype.getTitle=function(){return this.project?this.project.title:this.todo.description},t.prototype.getTypeName=function(){return this.project?"Maintenance Record":"To-Do"},t.prototype.getAuthorName=function(){return this.project?this.project.creatorFullName:this.todo.addedByFullName},t.prototype.getCreatedDate=function(){return this.project?this.project.createDateUtc:this.todo.addedDateUtc},e.MaintenanceEntry=t,i.prototype.loadProjects=function(){var t=this;return this.$http.get("/api/Maintenance/Projects").then(function(e){return e.data},function(e){return t.$q.reject(e.data)})},e.MaintenanceService=i}(Ally=Ally||{}),angular.module("CondoAlly").service("maintenance",["$http","$q","$cacheFactory",Ally.MaintenanceService]),!function(t){function e(e,t,i){this.$rootScope=e,this.fellowResidents=t,this.siteInfo=i,this.shouldShowSendModal=!1,this.shouldShowButtons=!1,this.isSending=!1,this.messageBody="",this.messageSubject="",this.sendResultIsError=!1,this.isPremiumPlanActive=!1,this.isSendingToSelf=!1,this.shouldShowSendAsBoard=!1,this.shouldSendAsBoard=!1,this.messageSubject=i.userInfo.fullName+" has sent you a message via your "+AppConfig.appName+" site"}e.prototype.$onInit=function(){this.isPremiumPlanActive=this.siteInfo.privateSiteInfo.isPremiumPlanActive,this.isSendingToSelf=this.recipientInfo.userId===this.siteInfo.userInfo.userId;var e=this.recipientInfo.userId===t.GroupMembersController.AllBoardUserId;this.shouldShowSendAsBoard=t.FellowResidentsService.isNonPropMgrBoardPosition(this.siteInfo.userInfo.boardPosition)&&!e},e.prototype.showSendModal=function(){this.shouldShowSendModal=!0,this.sendResultMessage="",this.shouldShowButtons=!0,this.isPremiumPlanActive&&setTimeout(function(){return document.getElementById("message-text-box").focus()},100)},e.prototype.hideModal=function(){this.shouldShowSendModal=!1,this.messageBody=""},e.prototype.sendMessage=function(){var t=this;this.shouldShowButtons=!1,this.isSending=!0,this.sendResultMessage="",this.fellowResidents.sendMessage(this.recipientInfo.userId,this.messageBody,this.messageSubject,this.shouldSendAsBoard).then(function(e){t.isSending=!1,t.sendResultIsError=!1,t.messageBody="",t.sendResultMessage="Message sent successfully!"},function(e){t.shouldShowButtons=!0,t.isSending=!1,t.sendResultIsError=!0,t.sendResultMessage="Failed to send: "+e.data.exceptionMessage})},e.prototype.onSendAsBoardChanged=function(){this.shouldSendAsBoard?this.messageSubject="Your "+this.siteInfo.publicSiteInfo.fullName+" board has sent you a message via your "+AppConfig.appName+" site":this.messageSubject=this.siteInfo.userInfo.fullName+" has sent you a message via your "+AppConfig.appName+" site"},e.$inject=["$rootScope","fellowResidents","SiteInfo"],t.SendMessageController=e}(Ally=Ally||{}),CA.angularApp.component("sendMessage",{bindings:{recipientInfo:"="},templateUrl:"/ngApp/services/send-message.html",controller:Ally.SendMessageController}),angular.module("CondoAlly").directive("ngEnter",function(){return function(t,e,i){e.bind("keydown keypress",function(e){13===e.which&&(t.$apply(function(){t.$eval(i.ngEnter,{event:e})}),e.preventDefault())})}}),angular.module("CondoAlly").directive("ngEscape",function(){return function(t,e,i){e.bind("keydown keypress",function(e){27===e.which&&(t.$apply(function(){t.$eval(i.ngEscape,{event:e})}),e.preventDefault())})}}),angular.module("CondoAlly").directive("imageonload",function(){return{restrict:"A",link:function(t,e,i){e.bind("load",function(e){i.imageonload&&t.$apply(i.imageonload)})}}}),angular.module("CondoAlly").directive("imageonerror",function(){return{restrict:"A",link:function(t,e,i){e.bind("error",function(e){i.imageonerror&&t.$apply(i.imageonerror)})}}}),angular.module("CondoAlly").directive("onFileChange",function(){return{restrict:"A",link:function(t,e,i){e.bind("change",function(e){t.$apply(function(){t.$eval(i.onFileChange,{$event:e})}),e.preventDefault()})}}}),CA.angularApp.filter("iif",function(){return function(e,t,i){return e?t:i}}),CA.angularApp.filter("tel",function(){return function(e){if(!e)return"";var t,i,n,o=e.toString().trim().replace(/^\+/,"");if(o.match(/[^0-9]/))return e;switch(o.length){case 7:t=1,i="",n=o;break;case 10:t=1,i=o.slice(0,3),n=o.slice(3);break;case 11:t=o[0],i=o.slice(1,4),n=o.slice(4);break;case 12:t=o.slice(0,3),i=o.slice(3,5),n=o.slice(5);break;default:return i="",e}return 1===t&&(t=""),n=n.slice(0,3)+"-"+n.slice(3),(t+" "+(i=0<i.length?"("+i+")":i)+" "+n).trim()}}),CA.angularApp.filter("filesize",function(){return function(e){return(e=isNaN(e)?0:e)<1024?e+" bytes":(e/=1024)<1024?e.toFixed(2)+" KB":(e/=1024)<1024?e.toFixed(2)+" MB":(e/=1024)<1024?e.toFixed(2)+" GB":(e/=1024).toFixed(2)+" TB"}}),this&&this.__extends||function(){var n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])});return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}());function ManageMembersCtrl(i,n,e,t,n){i.members=[],i.newMember={boardPosition:0,isRenter:!1},i.editUser=null,i.setEdit=function(e){i.sentWelcomeEmail=!1,null===e?i.editUser=null:(i.editUserForm.$setPristine(),e=jQuery.extend({},e),i.editUser=e,i.memberGridOptions.selectAll(!1),setTimeout("$( '#edit-user-first-text-box' ).focus();",100))},i.onSendWelcome=function(){i.isSavingUser=!0,n.put("/api/Member/"+i.editUser.userId+"/SendWelcome").then(function(){i.isSavingUser=!1,i.sentWelcomeEmail=!0},function(){alert("Failed to send the welcome e-mail, please contact support if this problem persists."),i.isSavingUser=!1})},$resource("/api/Member",null,{update:{method:"PUT"}});var o,s={fields:["lastName"],directions:["asc"]},a=s;window.localStorage&&(0===(a=(o=window.localStorage.getItem("memberSort"))?JSON.parse(o):a).fields.length&&(a=s),t(function(){var e={fields:i.memberGridOptions.sortInfo.fields,directions:i.memberGridOptions.sortInfo.directions};window.localStorage.setItem("memberSort",JSON.stringify(e))},2e3)),i.memberGridOptions={data:"members",plugins:[new ngGridFlexibleHeightPlugin],columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first"},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last"},{field:"email",displayName:"E-mail",cellClass:"resident-cell-email"},{field:"isSiteManager",displayName:"Admin",width:60,cellClass:"resident-cell-site-manager",cellTemplate:'<div style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" ng-checked="row.getProperty(col.field)"></div>'},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.getProperty(col.field) | tel }}</span></div>'}],afterSelectionChange:function(e){e.selected&&i.setEdit(e.entity)},sortInfo:a,multiSelect:!1},i.refresh=function(){i.isLoading=!0,n.get("/api/Member/Watch").then(function(e){i.members=e.data,_.forEach(i.members,function(e){e.fullName=e.firstName+" "+e.lastName,"string"==typeof e.email&&-1!==e.email.indexOf("@condoally.com")&&(e.email="")}),i.isLoading=!1})},i.onSaveMember=function(){var e,t;null!=i.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid())&&(i.isSavingUser=!0,t=e=function(){i.editUser=null,i.isSavingUser=!1,i.refresh()},(i.editUser.userId?n.put("/api/Member",i.editUser):n.post("/api/Member",i.editUser)).then(e,t))},i.OnAdminSetPassword=function(){var e={userName:i.adminSetPass_Username,password:i.adminSetPass_Password};n.post("/api/AdminHelper/SetPassword",e).then(function(e){i.adminSetPass_ResultMessage=e.data},function(){})},i.onDeleteMember=function(){confirm("Are you sure you want to remove this person from your neighborhood watch group?")&&n.delete("/api/Member",{userId:i.editUser.userId,unitId:i.editUser.unitId}).then(function(){i.editUser=null,i.refresh()})},i.onSendAllWelcome=function(){i.isLoading=!0,n.put("/api/Member?userId&action=launchsite").then(function(){i.isLoading=!1,i.sentWelcomeEmail=!0,i.allEmailsSent=!0},function(){alert("Failed to send welcome e-mail, please contact support if this problem persists."),i.isLoading=!1})},i.refresh()}function WatchSettingsCtrl(e,t,i,n){var o=this,s=(o.settings={},o.defaultBGImage=$(document.documentElement).css("background-image"),o.showQaButton="president@mycondoally.com"===t.userInfo.emailAddress,i("/api/Settings",null,{update:{method:"PUT"}}));o.refreshData=function(){o.isLoading=!0,o.settings=s.get(function(){o.isLoading=!1})},o.onSiteTitleChange=function(){o.isLoading=!0,s.update({siteTitle:o.settings.siteTitle},function(){location.reload(),o.isLoading=!1})},o.onWelcomeMessageUpdate=function(){o.isLoading=!0,s.update({welcomeMessage:o.settings.welcomeMessage},function(){n.privateSiteInfo.welcomeMessage=o.settings.welcomeMessage,o.isLoading=!1})},o.onImageClick=function(e){o.settings.bgImageFileName=e,SettingsJS._defaultBG=e,s.update({BGImageFileName:o.settings.bgImageFileName},function(){$(".test-bg-image").removeClass("test-bg-image-selected"),$("img[src='"+t.bgImagePath+e+"']").addClass("test-bg-image-selected"),o.isLoading=!1})},o.onImageHoverOver=function(e){$(document.documentElement).css("background-image","url("+t.bgImagePath+e+")")},o.onImageHoverOut=function(){"string"==typeof o.settings.bgImageFileName&&0<o.settings.bgImageFileName.length?$(document.documentElement).css("background-image","url("+t.bgImagePath+o.settings.bgImageFileName+")"):$(document.documentElement).css("background-image",o.defaultBGImage)},o.onQaDeleteSite=function(){e.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(e){alert("Failed to delete site: "+e.data.message)})},o.mapInstance=new google.maps.Map(document.getElementById("map-canvas"),o.mapInfo),o.refreshData()}function WatchCalendarCtrl(s,e,n,i,t){var a="YYYY-MM-DD",r="h:mma",l="12:37am",o=(s.today=new Date,{height:600,editable:!1,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},viewRender:function(e,t){i.isSiteManager&&$(t).css("cursor","pointer")},dayClick:function(e){var t;i.isSiteManager&&(t=moment(moment.utc(e).format(a)).toDate(),s.$apply(function(){s.setEditEvent({date:t,dateOnly:t,associatedUserIds:[]})}))},eventClick:function(e){s.$apply(function(){e.calendarEventObject&&s.setEditEvent(e.calendarEventObject,!0)})},eventRender:function(e,t){$(t).css("cursor","default"),$(t).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:e.fullDescription,title:e.toolTipTitle}})},eventSources:[{events:function(e,t,i,o){s.isLoadingCalendarEvents=!0;e=e.format(a),t=t.format(a);n.get("/api/CalendarEvent?startDate="+e+"&endDate="+t).then(function(e){var n=[],e=e.data;s.isLoadingCalendarEvents=!1,_.each(e,function(e){e.timeOnly=moment.utc(e.date).format(r),e.dateOnly=e.date,e.timeOnly==l&&(e.timeOnly="");var t=e.title,i=(17<t.length&&(t=t.substring(0,17)+"..."),"Posted by: "+e.authorName+"<br><p>"+e.title+"</p>");n.push({title:t,start:e.date.substring(0,10),toolTipTitle:"Event",fullDescription:i,calendarEventObject:e})}),o(n)},function(){s.isLoadingCalendarEvents=!1})}}]});$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(o)}),s.onResidentClicked=function(e){_.contains(s.editEvent.associatedUserIds,e)?s.editEvent.associatedUserIds=_.without(s.editEvent.associatedUserIds,e):s.editEvent.associatedUserIds.push(e)},s.isUserAssociated=function(e){return!(!s.editEvent||!s.editEvent.associatedUserIds)&&_.contains(s.editEvent.associatedUserIds,e)},s.expandCalendarEventModel=function(){s.showExpandedCalendarEventModel=!0},s.setEditEvent=function(e,t){s.showExpandedCalendarEventModel=t||!1,(s.editEvent=e)&&setTimeout(function(){$("#calendar-event-title").focus()},10)},s.deleteCalendarEvent=function(e){confirm("Are you sure you want to remove this calendar event?")&&(s.isLoadingCalendarEvents=!0,n.delete("/api/CalendarEvent?eventId="+e).then(function(){s.isLoadingCalendarEvents=!1,s.editEvent=null,s.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){s.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")}))},s.saveCalendarEvent=function(){var e="",e="string"==typeof s.editEvent.timeOnly&&1<s.editEvent.timeOnly.length?moment.utc(s.editEvent.date).format(a)+" "+s.editEvent.timeOnly:moment.utc(s.editEvent.date).format(a)+" "+l;s.editEvent.date=moment.utc(e,a+" "+r).toDate(),e=s.editEvent.eventId?n.put:n.post,s.isLoadingCalendarEvents=!0,e("/api/CalendarEvent",s.editEvent).then(function(){s.isLoadingCalendarEvents=!1,s.editEvent=null,s.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){s.isLoadingCalendarEvents=!1})},s.onDeleteItem=function(e){confirm("Are you sure you want to delete this information?")&&(s.isLoading=!0,LogEntryResource.delete({logEntryId:e.logEntryId},function(){s.RetrieveItems()}))},$("#calendar-event-time").timepicker({scrollDefault:"10:00am"})}function WatchHomeCtrl(e,t,i){var n=this,o=t("/api/Watch/Home"),t=t("https://localnewsally.azurewebsites.net/api/LocalNews",null,{cache:!0});n.refreshData=function(){n.isLoading=!0,n.watchMembers=o.get(function(){n.isLoading=!1})},t.query({clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:i.publicSiteInfo.chicagoWard,zipCode:i.privateSiteInfo.zipCode,cityNeighborhood:i.publicSiteInfo.localNewsNeighborhoodQuery},function(e){n.localNews=e,n.isLoading_LocalNews=!1})}function WatchMembersCtrl(e,t,i){var o=this,n=t("/api/Watch/MemberList");o.refreshData=function(){o.isLoading=!0,o.memberList=n.query(function(){var e,i,n;o.isLoading=!1,o.housePolys=(e=o.memberList,i=[],n=[],_.each(e,function(t){t.houseGpsBounds&&!_.some(i,function(e){return e==t.addressId})&&(i.push(t.addressId),n.push(t.houseGpsBounds))}),n)})},o.mapCenter=i.privateSiteInfo.gpsPosition,o.groupBounds=i.publicSiteInfo.gpsBounds,o.refreshData()}!function(e){function t(){}function i(){}e.UsersHome=function(){},e.PayPeriod=t;function n(){}function o(){}e.UserInfo=i;var s,a=function(){},r=(e.PublicSiteInfo=a,e.RecentPayment=n,e.PrivateSiteInfo=o,__extends(l,s=o),l);function l(){return null!==s&&s.apply(this,arguments)||this}function d(){this.publicSiteInfo=new a,this.privateSiteInfo=new r,this.userInfo=new e.UserInfo,this.isLoggedIn=!1}function c(){}e.ChtnPrivateSiteInfo=r,d.prototype.refreshSiteInfo=function(t,i,e){var n,o,s,a=this,r=(this._rootScope=t,e.defer());return t.isLoadingSite=!0,"login"===HtmlUtil.getSubdomain()?(t.isLoadingSite=!1,this.handleSiteInfo(null,t),r.resolve()):(n=function(e){t.isLoadingSite=!1,a.handleSiteInfo(e,t),r.resolve(e)},o=function(){t.isLoadingSite=!1,r.reject()},i.get(s="https://0.webappapi.communityally.org/api/GroupSite").then(function(t){t.data&&!t.data.userInfo?a.xdLocalStorage.getItem("allyApiAuthToken").then(function(e){e&&HtmlUtil.isValidString(e.value)?(a.setAuthToken(e.value),i.get(s).then(function(e){n(e.data)},o)):n(t.data)},function(){n(t.data)}):n(t.data)},o)),r.promise},d.prototype.testIfIsNeutralPage=function(t){return!!HtmlUtil.startsWith(t,"#!/")&&(t="/"+t.substring("#!/".length),"object"==typeof _.find(AppConfig.menu,function(e){return e.path===t}))},d.prototype.handleSiteInfo=function(e,t){var i=HtmlUtil.getSubdomain(window.location.host);if(!this.authToken&&t.authToken&&this.setAuthToken(t.authToken),null===e||"null"===e||""===e){var n=null===i||"www"===i||"login"===i,o=this.testIfIsNeutralPage(window.location.hash);if(!n||!o)return void GlobalRedirect("https://login."+AppConfig.baseTld+"/#!/Login");(e={}).publicSiteInfo={bgImagePath:"",fullName:AppConfig.appName,siteLogo:"<span style='font-size: 22pt; color: #FFF;'>Welcome to "+AppConfig.appName+"</span>",baseApiUrl:"https://0.webappapi.communityally.org/api/"}}t.publicSiteInfo=e.publicSiteInfo,this.publicSiteInfo=e.publicSiteInfo,t.populatePublicPageMenu();n=(n=e.privateSiteInfo)||{};if(this.privateSiteInfo=n,this.privateSiteInfo.gpsPosition&&"undefined"!=typeof google&&(this.privateSiteInfo.googleGpsPosition=new google.maps.LatLng(this.privateSiteInfo.gpsPosition.lat,this.privateSiteInfo.gpsPosition.lon)),document.title=this.publicSiteInfo.fullName,t.isPremiumPlanActive=this.privateSiteInfo.isPremiumPlanActive,t.isPremiumPlanTrial=moment().isBefore(moment(this.privateSiteInfo.creationDate).add(3,"months")),this.userInfo=e.userInfo,t.userInfo=e.userInfo,HtmlUtil.isLocalStorageAllowed()&&window.localStorage.setItem("siteInfo",angular.toJson(this.publicSiteInfo)),this.isLoggedIn=null!==t.userInfo&&void 0!==t.userInfo,t.isLoggedIn=this.isLoggedIn,HtmlUtil.isNullOrWhitespace(this.publicSiteInfo.bgImagePath)||$(document.documentElement).css("background-image","url("+t.bgImagePath+this.publicSiteInfo.bgImagePath+")"),this.isLoggedIn)setTimeout(function(){"undefined"!=typeof $zopim&&$zopim(function(){$zopim.livechat.setName(t.userInfo.firstName+" "+t.userInfo.lastName),-1!==t.userInfo.emailAddress.indexOf("@")&&$zopim.livechat.setEmail(t.userInfo.emailAddress)})},8e3),t.isAdmin=t.userInfo.isAdmin,t.isSiteManager=t.userInfo.isSiteManager,"undefined"!=typeof analytics&&analytics.identify(t.userInfo.emailAddress,{name:t.userInfo.fullName});else{t.userInfo=null;o="#!/Login";if(window.location.hash!=o&&!AppConfig.isPublicRoute(window.location.hash)){if(this.publicSiteInfo&&this.publicSiteInfo.baseUrl)return window.location.hash&&"#!/Home"!==window.location.hash&&(window.sessionStorage[AppCacheService.KeyPrefix+AppCacheService.Key_AfterLoginRedirect]=window.location.hash.substr(2),window.sessionStorage[AppCacheService.KeyPrefix+AppCacheService.Key_WasLoggedIn401]="true"),void(this.publicSiteInfo.customLandingPagePath?window.location.hash=this.publicSiteInfo.customLandingPagePath:window.location.hash=o);GlobalRedirect("https://login."+AppConfig.baseTld+o)}}this.publicSiteInfo.baseUrl&&"login"===i&&(null===i||i!==this.publicSiteInfo.shortName)&&HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)&&GlobalRedirect(this.publicSiteInfo.baseUrl+"/#!/Home")},d.prototype.setAuthToken=function(e){window.localStorage&&window.localStorage.setItem("ApiAuthToken",e),this._rootScope.authToken=e,this.xdLocalStorage.setItem("allyApiAuthToken",e).then(function(e){}),this.authToken=e},d.AlwaysDiscussDate=new Date(2018,7,1),e.SiteInfoService=d,c.loginInit=function(e,t,i,n,o){var s=e.defer();return p.siteInfo.xdLocalStorage=o,p.isSiteInfoLoaded?s.resolve(p.siteInfo):p.siteInfo.refreshSiteInfo(i,t,e).then(function(){p.isSiteInfoLoaded=!0,i.isSiteInfoLoaded=!0,i.siteTitle={text:i.publicSiteInfo.siteTitleText},i.publicSiteInfo.siteLogo&&(i.siteTitle.logoHtml=n.trustAsHtml(i.publicSiteInfo.siteLogo)),i.onUpdateSiteTitleText=function(){analytics.track("updateSiteTitle"),t.put("/api/Settings",{siteTitle:i.siteTitle.text})},s.resolve(p.siteInfo)}),s.promise},e.SiteInfoHelper=c;h.prototype.$get=function(){return h.isSiteInfoLoaded||console.log("Not yet loaded!"),h.siteInfo},h.isSiteInfoLoaded=!1,h.siteInfo=new e.SiteInfoService;var p=h;function h(){}e.SiteInfoProvider=p}(Ally=Ally||{}),angular.module("CondoAlly").provider("SiteInfo",Ally.SiteInfoProvider),function(a){function e(){}var t=function(){},i=(a.TodoItem=t,a.TodoList=e,n.prototype.$onInit=function(){var t=this;this.isFixedList=!!this.fixedTodoListId,this.isFixedList?this.loadFixedTodoList():this.loadAllTodoLists(),this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId).then(function(e){return t.canManage=e})},n.prototype.loadFixedTodoList=function(){var t=this;this.isLoading=!0,this.$http.get("/api/Todo/List/"+this.fixedTodoListId).then(function(e){t.isLoading=!1,t.todoLists=[e.data]})},n.prototype.loadAllTodoLists=function(){var t=this,e=(this.isLoading=!0,"/api/Todo");this.committee&&(e="/api/Todo/ListsForCommittee/"+this.committee.committeeId),this.$http.get(e).then(function(e){t.isLoading=!1,t.todoLists=e.data})},n.prototype.onAddList=function(){var t=this,e=(this.isLoading=!0,"/api/Todo/newList?listName="+encodeURIComponent(this.newListName));this.committee&&(e+="&committeeId="+this.committee.committeeId),this.$http.post(e,null).then(function(){t.isLoading=!1,t.newListName="",t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to create: "+e.data.exceptionMessage)})},n.prototype.onAddItem=function(e){var t=this,e=(this.isLoading=!0,"/api/Todo/newItem/"+e+"?description="+encodeURIComponent(this.newItemDescription));this.$http.post(e,null).then(function(){t.isLoading=!1,t.newItemDescription="",t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to create: "+e.data.exceptionMessage)})},n.prototype.addNewItem=function(e){this.editTodoItem=new t,this.editTodoItem.owningTodoListId=e,this.committee&&(this.editTodoItem.owningTodoListId=e),this.shouldExpandTodoItemModal=!1,window.setTimeout(function(){return $("#edit-todo-name-text-box").focus()},100)},n.prototype.saveTodoItem=function(){var t=this;this.isLoading=!0;this.$http.post("/api/Todo/Item",this.editTodoItem).then(function(){t.isLoading=!1,t.newItemDescription="",t.editTodoItem=null,t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to create: "+e.data.exceptionMessage)})},n.prototype.onToggleComplete=function(e,t){var i=this;this.isLoading=!0,this.$http.put("/api/Todo/toggleComplete/"+e+"/"+t,null).then(function(){i.isLoading=!1,i.loadAllTodoLists()},function(e){i.isLoading=!1,alert("Failed to toggle: "+e.data.exceptionMessage)})},n.prototype.deleteTodoItem=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Todo/Item/"+e.todoItemId).then(function(){t.isLoading=!1,t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)})},n.prototype.deleteTodoList=function(e){var t=this;0<e.todoItems.length&&!confirm("Are you sure you want to delete this list with active to-dos?")||(this.isLoading=!0,this.$http.delete("/api/Todo/List/"+e.todoListId).then(function(){t.isLoading=!1,t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)}))},n.prototype.exportAllToCsv=function(){"undefined"!=typeof analytics&&analytics.track("exportTodoListCsv");this.todoLists[0].todoItems[0].completedByFullName;for(var e=[{headerText:"List",fieldName:"owningTodoListName"},{headerText:"Description",fieldName:"description"},{headerText:"Due Date",fieldName:"dueDate",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD"):""}},{headerText:"Added On",fieldName:"addedDateUtc"},{headerText:"Added By",fieldName:"addedByFullName"},{headerText:"Completed On",fieldName:"completedDateUtc"},{headerText:"Completed By",fieldName:"completedByFullName"}],t="",i=0;i<this.todoLists.length;++i){for(var n=this.todoLists[i],o=0;o<n.todoItems.length;++o)n.todoItems[o].owningTodoListName=n.name;t+=a.createCsvString(n.todoItems,e,0===i)}var s="ToDos.csv";this.committee&&(s=this.committee.name.replace(/\W/g,"")+"_"+s),a.HtmlUtil2.downloadCsv(t,s)},n.$inject=["$http","SiteInfo","fellowResidents"],n);function n(e,t,i){this.$http=e,this.siteInfo=t,this.fellowResidents=i,this.todoLists=[],this.isLoading=!1,this.newListName="",this.isFixedList=!1,this.shouldExpandTodoItemModal=!1,this.canManage=!1}a.TodoListCtrl=i}(Ally=Ally||{}),CA.angularApp.component("todoList",{bindings:{fixedTodoListId:"<?",committee:"<?"},templateUrl:"/ngApp/services/todo-list.html",controller:Ally.TodoListCtrl}),(Ally||(Ally={})).ExceptionResult=function(){},ManageMembersCtrl.$inject=["$scope","$http","$rootScope","$interval","$http"],WatchSettingsCtrl.$inject=["$http","$rootScope","$resource","SiteInfo"],WatchCalendarCtrl.$inject=["$scope","$timeout","$http","$rootScope","$q"],WatchHomeCtrl.$inject=["$rootScope","$resource","SiteInfo"],WatchMembersCtrl.$inject=["$rootScope","$resource","SiteInfo"];