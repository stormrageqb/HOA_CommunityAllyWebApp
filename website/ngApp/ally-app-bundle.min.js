/*! CommunityAllyWebApp 2017-12-31 */
function RoutePath(a,b,c,d,e){"/"!==a[0]&&(a="/"+a),this.path=a,this.templateUrl=b,this.controller=c,this.menuTitle=d,this.role=e||Role_Authorized,this.controllerAs="function"==typeof c?"vm":null}function RoutePath_v2(a){"/"!==a.path[0]&&(a.path="/"+a.path),this.path=a.path,this.templateUrl=a.templateUrl,this.templateHtml=a.templateHtml,this.controller=a.controller,this.menuTitle=a.menuTitle,this.role=a.role||Role_Authorized,this.controllerAs="function"==typeof a.controller?"vm":null}function RoutePath_v3(a){"/"!==a.path[0]&&(a.path="/"+a.path),this.path=a.path,this.templateHtml=a.templateHtml,this.menuTitle=a.menuTitle,this.role=a.role||Role_Authorized}function FrequencyIdToInfo(a){return PeriodicPaymentFrequencies[a-50]}function ServiceBankInfoCtrl(a){}function ServiceBusinessInfoCtrl(a){}function ServiceJobsCtrl(a){}function TodoCtrl(a){var b=this;b.todoLists=[],b.loadTodos=function(){b.isLoading=!0,a.get("/api/Todo").then(function(a){b.isLoading=!1,b.todoLists=a.data})},b.onAddList=function(){b.isLoading=!0,a.post("/api/Todo/newList?listName="+encodeURIComponent(b.newListName)).then(function(){b.isLoading=!1,b.loadTodos()})},b.onAddItem=function(c){b.isLoading=!0,a.post("/api/Todo/newItem/"+c+"?description="+encodeURIComponent(b.newItemDescription)).then(function(){b.isLoading=!1,b.newItemDescription="",b.loadTodos()})},b.onToggleComplete=function(c,d){b.isLoading=!0,a.put("/api/Todo/toggleComplete/"+c+"/"+d).then(function(){b.isLoading=!1,b.loadTodos()})},b.loadTodos()}function ManageMembersCtrl(a,b,c,d,b){a.members=[],a.newMember={boardPosition:0,isRenter:!1},a.editUser=null,a.setEdit=function(b){if(a.sentWelcomeEmail=!1,null===b)return void(a.editUser=null);a.editUserForm.$setPristine();var c=jQuery.extend({},b);a.editUser=c,a.memberGridOptions.selectAll(!1),setTimeout("$( '#edit-user-first-text-box' ).focus();",100)},a.onSendWelcome=function(){a.isSavingUser=!0,b.put("/api/Member/"+a.editUser.userId+"/SendWelcome").then(function(){a.isSavingUser=!1,a.sentWelcomeEmail=!0},function(){alert("Failed to send the welcome e-mail, please contact support if this problem persists."),a.isSavingUser=!1})};var e=($resource("/api/Member",null,{update:{method:"PUT"}}),{fields:["lastName"],directions:["asc"]}),f=e;if(window.localStorage){var g=window.localStorage.getItem("memberSort");g&&(f=JSON.parse(g)),0===f.fields.length&&(f=e),d(function(){var b={fields:a.memberGridOptions.sortInfo.fields,directions:a.memberGridOptions.sortInfo.directions};window.localStorage.setItem("memberSort",JSON.stringify(b))},2e3)}a.memberGridOptions={data:"members",plugins:[new ngGridFlexibleHeightPlugin],columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first"},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last"},{field:"email",displayName:"E-mail",cellClass:"resident-cell-email"},{field:"isSiteManager",displayName:"Admin",width:60,cellClass:"resident-cell-site-manager",cellTemplate:'<div style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" ng-checked="row.getProperty(col.field)"></div>'},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.getProperty(col.field) | tel }}</span></div>'}],afterSelectionChange:function(b){b.selected&&a.setEdit(b.entity)},sortInfo:f,multiSelect:!1},a.refresh=function(){a.isLoading=!0,b.get("/api/Member").then(function(b){a.members=b.data,_.forEach(a.members,function(a){a.fullName=a.firstName+" "+a.lastName,"string"==typeof a.email&&-1!==a.email.indexOf("@condoally.com")&&(a.email="")}),a.isLoading=!1})},a.onSaveMember=function(){if(null!=a.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid())){a.isSavingUser=!0;var c=function(){a.editUser=null,a.isSavingUser=!1,a.refresh()},d=c;a.editUser.userId?b.put("/api/Member",a.editUser).then(c,d):b.post("/api/Member",a.editUser).then(c,d)}},a.OnAdminSetPassword=function(){var c={userName:a.adminSetPass_Username,password:a.adminSetPass_Password};b.post("/api/AdminHelper/SetPassword",c).then(function(b){a.adminSetPass_ResultMessage=b.data},function(){})},a.onDeleteMember=function(){confirm("Are you sure you want to remove this person from your neighborhood watch group?")&&b["delete"]("/api/Member",{userId:a.editUser.userId,unitId:a.editUser.unitId}).then(function(){a.editUser=null,a.refresh()})},a.onSendAllWelcome=function(){a.isLoading=!0,b.put("/api/Member?userId&action=launchsite").then(function(){a.isLoading=!1,a.sentWelcomeEmail=!0,a.allEmailsSent=!0},function(){alert("Failed to send welcome e-mail, please contact support if this problem persists."),a.isLoading=!1})},a.refresh()}function WatchSettingsCtrl(a,b,c,d){var e=this;e.settings={},e.defaultBGImage=$(document.documentElement).css("background-image"),e.showQaButton="president@mycondoally.com"===b.userInfo.emailAddress;var f=c("/api/Settings",null,{update:{method:"PUT"}});e.refreshData=function(){e.isLoading=!0,e.settings=f.get(function(){e.isLoading=!1})},e.onSiteTitleChange=function(){e.isLoading=!0,f.update({siteTitle:e.settings.siteTitle},function(){location.reload(),e.isLoading=!1})},e.onWelcomeMessageUpdate=function(){e.isLoading=!0,f.update({welcomeMessage:e.settings.welcomeMessage},function(){d.privateSiteInfo.welcomeMessage=e.settings.welcomeMessage,e.isLoading=!1})},e.onImageClick=function(a){e.settings.bgImageFileName=a,SettingsJS._defaultBG=a,f.update({BGImageFileName:e.settings.bgImageFileName},function(){$(".test-bg-image").removeClass("test-bg-image-selected"),$("img[src='"+b.bgImagePath+a+"']").addClass("test-bg-image-selected"),e.isLoading=!1})},e.onImageHoverOver=function(a){$(document.documentElement).css("background-image","url("+b.bgImagePath+a+")")},e.onImageHoverOut=function(){"string"==typeof e.settings.bgImageFileName&&e.settings.bgImageFileName.length>0?$(document.documentElement).css("background-image","url("+b.bgImagePath+e.settings.bgImageFileName+")"):$(document.documentElement).css("background-image",e.defaultBGImage)},e.onQaDeleteSite=function(){a.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(a){alert("Failed to delete site: "+a.data.message)})},e.mapInstance=new google.maps.Map(document.getElementById("map-canvas"),e.mapInfo),e.refreshData()}function WatchCalendarCtrl(a,b,c,d,e){var f="YYYY-MM-DD",g="h:mma",h="12:37am";a.today=new Date;var i=function(b,d,e,i){a.isLoadingCalendarEvents=!0;var j=b.format(f),k=d.format(f);c.get("/api/CalendarEvent?startDate="+j+"&endDate="+k).then(function(b){var c=[],d=b.data;a.isLoadingCalendarEvents=!1,_.each(d,function(a){a.timeOnly=moment.utc(a.date).format(g),a.dateOnly=a.date,a.timeOnly==h&&(a.timeOnly="");var b=a.title;b.length>17&&(b=b.substring(0,17)+"...");var d="Posted by: "+a.authorName+"<br><p>"+a.title+"</p>";c.push({title:b,start:a.date.substring(0,10),toolTipTitle:"Event",fullDescription:d,calendarEventObject:a})}),i(c)},function(){a.isLoadingCalendarEvents=!1})},j={height:600,editable:!1,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},viewRender:function(a,b){d.isSiteManager&&$(b).css("cursor","pointer")},dayClick:function(b){if(d.isSiteManager){var c=moment(moment.utc(b).format(f)).toDate();a.$apply(function(){a.setEditEvent({date:c,dateOnly:c,associatedUserIds:[]})})}},eventClick:function(b){a.$apply(function(){b.calendarEventObject&&a.setEditEvent(b.calendarEventObject,!0)})},eventRender:function(a,b){$(b).css("cursor","default"),$(b).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:a.fullDescription,title:a.toolTipTitle}})},eventSources:[{events:i}]};$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(j)}),a.onResidentClicked=function(b){var c=_.contains(a.editEvent.associatedUserIds,b);c?a.editEvent.associatedUserIds=_.without(a.editEvent.associatedUserIds,b):a.editEvent.associatedUserIds.push(b)},a.isUserAssociated=function(b){return a.editEvent&&a.editEvent.associatedUserIds?_.contains(a.editEvent.associatedUserIds,b):!1},a.expandCalendarEventModel=function(){a.showExpandedCalendarEventModel=!0},a.setEditEvent=function(b,c){a.showExpandedCalendarEventModel=c||!1,a.editEvent=b,b&&setTimeout(function(){$("#calendar-event-title").focus()},10)},a.deleteCalendarEvent=function(b){confirm("Are you sure you want to remove this calendar event?")&&(a.isLoadingCalendarEvents=!0,c["delete"]("/api/CalendarEvent?eventId="+b).then(function(){a.isLoadingCalendarEvents=!1,a.editEvent=null,a.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){a.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")}))},a.saveCalendarEvent=function(){var b="";b="string"==typeof a.editEvent.timeOnly&&a.editEvent.timeOnly.length>1?moment.utc(a.editEvent.date).format(f)+" "+a.editEvent.timeOnly:moment.utc(a.editEvent.date).format(f)+" "+h,a.editEvent.date=moment.utc(b,f+" "+g).toDate();var d;d=a.editEvent.eventId?c.put:c.post,a.isLoadingCalendarEvents=!0,d("/api/CalendarEvent",a.editEvent).then(function(){a.isLoadingCalendarEvents=!1,a.editEvent=null,a.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){a.isLoadingCalendarEvents=!1})},a.onDeleteItem=function(b){confirm("Are you sure you want to delete this information?")&&(a.isLoading=!0,LogEntryResource["delete"]({logEntryId:b.logEntryId},function(){a.RetrieveItems()}))},$("#calendar-event-time").timepicker({scrollDefault:"10:00am"})}function WatchHomeCtrl(a,b,c){var d=this,e=b("/api/Watch/Home"),f=b("https://localnewsally.org/api/LocalNews",null,{cache:!0});d.refreshData=function(){d.isLoading=!0,d.watchMembers=e.get(function(){d.isLoading=!1})},f.query({clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:c.publicSiteInfo.chicagoWard,zipCode:c.publicSiteInfo.zipCode,cityNeighborhood:c.publicSiteInfo.localNewsNeighborhoodQuery},function(a){d.localNews=a,d.isLoading_LocalNews=!1})}function WatchMembersCtrl(a,b,c){var d=this,e=b("/api/Watch/MemberList"),f=function(a){var b=[],c=[];return _.each(a,function(a){if(a.houseGpsBounds){var d=_.some(b,function(b){return b==a.addressId});d||(b.push(a.addressId),c.push(a.houseGpsBounds))}}),c};d.refreshData=function(){d.isLoading=!0,d.memberList=e.query(function(){d.isLoading=!1,d.housePolys=f(d.memberList)})},d.mapCenter=c.privateSiteInfo.gpsPosition,d.groupBounds=c.publicSiteInfo.gpsBounds,d.refreshData()}var Ally;!function(a){var b=function(){function a(a,b){this.$http=a,this.$q=b,this.isLoading=!1}return a.prototype.$onInit=function(){this.refreshAddresses()},a.prototype.getPolyInfo=function(a,b){var c=this.$q.defer();this.isLoading=!0;var d=this;return this.$http.get(a).then(function(a){d.isLoading=!1;var e=a.data;_.each(e,function(a){a.polyType=b,"Group"==b&&(a.oneLiner=a.shortName+", "+a.appName)}),$.merge(d.addresses,e),c.resolve(d.addresses)},function(a){this.isLoading=!1;var b=a.data.exceptionMessage?a.data.exceptionMessage:a.data;alert("Failed to retrieve addresses: "+b),c.reject()}),c.promise},a.prototype.getGroupBoundPolys=function(){return this.getPolyInfo("/api/AdminMap/GetGroupBounds?filter="+this.filterAddresses,"Group")},a.prototype.getAddressPolys=function(){return this.getPolyInfo("/api/AdminMap?filter="+this.filterAddresses,"Address")},a.prototype.refreshAddresses=function(){this.isLoading=!0,this.addresses=[];var a=this;this.getAddressPolys().then(function(){return a.getGroupBoundPolys()}).then(function(b){a.addressPoints=[],_.each(b,function(b){b.gpsPos&&a.addressPoints.push(b.gpsPos)})})},a.prototype.onSavePoly=function(){this.isLoading=!0;var a={vertices:this.selectedAddress.gpsBounds.vertices},b="Address"===this.selectedAddress.polyType?"/api/AdminMap?addressId="+this.selectedAddress.addressId:"/api/AdminMap?groupId="+this.selectedAddress.groupId,c=this;this.$http.put(b,a).then(function(){c.isLoading=!1},function(){c.isLoading=!1})},a.prototype.onAddressSelected=function(a){if(this.selectedAddress=a,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&a.gpsPos){new google.maps.LatLng(a.gpsPos.lat,a.gpsPos.lon),new google.maps.LatLng(a.gpsPos.lat+.001,a.gpsPos.lon+.001);a.gpsBounds.vertices=[{lat:a.gpsPos.lat,lon:a.gpsPos.lon},{lat:a.gpsPos.lat+.001,lon:a.gpsPos.lon},{lat:a.gpsPos.lat+.001,lon:a.gpsPos.lon+.001},{lat:a.gpsPos.lat,lon:a.gpsPos.lon+.001}]}this.selectedGpsPoly=a.gpsBounds},a.$inject=["$http","$q"],a}();a.ManageAddressPolysController=b}(Ally||(Ally={})),CA.angularApp.component("manageAddressPolys",{templateUrl:"/ngApp/admin/manage-address-polys.html",controller:Ally.ManageAddressPolysController});var Ally;!function(a){var b=function(){function a(){}return a}(),c=function(){function a(a,c){this.$timeout=a,this.$http=c,this.newAssociation=new b,this.changeShortNameData={},this.retrieveGroups=function(){this.isLoading=!0;var a=this;this.$http.get("/api/Association/adminList").then(function(b){a.isLoading=!1,a.groups=b.data,_.each(a.groups,function(a){0===a.appName?(a.appNameString="Condo",a.baseUrl="https://"+a.shortName+".CondoAlly.com/"):1===a.appName?(a.appNameString="NeighborhoodWatch",a.baseUrl="https://"+a.shortName+".WatchAlly.com/"):2===a.appName?(a.appNameString="Home",a.baseUrl="https://"+a.shortName+".HomeAlly.org/"):3===a.appName?(a.appNameString="Hoa",a.baseUrl="https://"+a.shortName+".HoaAlly.org/"):4===a.appName&&(a.appNameString="Neighborhood",a.baseUrl="https://"+a.shortName+".NeighborhoodAlly.org/")})},function(){a.isLoading=!1,alert("Failed to retrieve groups")})}}return a.prototype.$onInit=function(){},a.prototype.changeShortName=function(){if(/[^a-zA-Z0-9]/.test(this.changeShortNameData.newShortName))return void alert("The new short name must be alphanumeric");if(this.changeShortNameData.newShortName!==this.changeShortNameData.newShortName.toLowerCase())return void alert("The new short name must be lower-case");if(0===this.changeShortNameData.newShortName.length)return void alert("New short name must not be empty");this.isLoading=!0;var a=this;this.$http.put("/api/AdminHelper/ChangeShortName?oldShortName="+this.changeShortNameData.old+"&newShortName="+this.changeShortNameData.newShortName,null).success(function(b){a.isLoading=!1,a.retrieveGroups()}).error(function(){a.isLoading=!1,alert("Failed to change short name")})},a.prototype.findAssociationsForUser=function(){this.isLoading=!0;var a=this;this.$http.get("/api/Admin/findAssociationsForUser?email="+this.findUserAssociationsEmail).then(function(b){a.isLoading=!1,a.foundUserAssociations=b.data},function(){a.isLoading=!1,alert("Failed to find associations for user")})},a.prototype.deleteAssociation=function(a){if(confirm("Are you sure you want to delete this association?")){this.isLoading=!0;var b=this;this.$http["delete"]("/api/Association/chtn/"+a.groupId).then(function(){b.isLoading=!1,b.retrieveGroups()},function(a){b.isLoading=!1,console.log(a.data.exceptionMessage),alert("Failed to delete group: "+a.data.exceptionMessage)})}},a.prototype.addAddress=function(){this.newAddressId=null,this.isLoading=!0;var a=this;this.$http.post("/api/AdminHelper/AddAddress?address="+encodeURIComponent(this.newAddress),null).success(function(b){a.isLoading=!1,a.newAddressId=b.data.newAddressId}).error(function(b){a.isLoading=!1,alert("Failed to add address: "+b.data.exceptionMessage)})},a.prototype.onCreateAssociationClick=function(){this.isLoading=!0;var a=this;this.$http.post("/api/Association",this.newAssociation).then(function(){a.isLoading=!1,a.newAssociation=new b,a.retrieveGroups()})},a.prototype.onSendTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendTestEmail?testEmailRecipient="+encodeURIComponent(this.testEmailRecipient))},a.prototype.onSendTaylorTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendFromTaylorEmail?testEmailRecipient="+encodeURIComponent(this.testTaylorEmailRecipient))},a.prototype.onSendTestPostmarkEmail=function(){this.isLoading=!0;var a=this;this.$http.get("/api/AdminHelper/SendTestPostmarkEmail?email="+this.testPostmarkEmail).success(function(){a.isLoading=!1,alert("Successfully sent email")}).error(function(){a.isLoading=!1,alert("Failed to send email")})},a.prototype.makeHelperRequest=function(a,b){void 0===b&&(b=null),this.isLoadingHelper=!0;var c;c=b?this.$http.post(a,b):this.$http.get(a);var d=this;c.then(function(){return d.isLoadingHelper=!1},function(){d.isLoadingHelper=!1,alert("Failed")})},a.prototype.onTestException=function(){this.makeHelperRequest("/api/Association/testException")},a.prototype.onClearElmahLogs=function(){this.makeHelperRequest("/api/Admin/clearElmah")},a.prototype.onClearAppGroupCache=function(){this.makeHelperRequest("/api/AdminHelper/ClearGroupCache")},a.prototype.onSendInactiveGroupsMail=function(){var a={shortNameLines:this.inactiveShortNames};this.makeHelperRequest("/api/AdminHelper/SendInactiveGroupsMail",a)},a.$inject=["$timeout","$http"],a}();a.ManageGroupsController=c}(Ally||(Ally={})),CA.angularApp.component("manageGroups",{templateUrl:"/ngApp/admin/manage-groups.html",controller:Ally.ManageGroupsController});var Ally;!function(a){var b=function(){function b(b,c){this.$http=b,this.$q=c,this.isLoading=!1,this.unitToEdit=new a.Unit,this.isEdit=!1}return b.prototype.$onInit=function(){this.refresh()},b.prototype.refresh=function(){this.isLoading=!0;var a=this;this.$http.get("/api/Unit?includeAddressData=true").then(function(b){a.isLoading=!1,a.units=b.data},function(){a.isLoading=!1,alert("Failed to load homes")})},b.prototype.onCreateUnitClick=function(){if($("#AddUnitForm").validate(),$("#AddUnitForm").valid()){this.isLoading=!0;var b=this,c=function(){b.isLoading=!1,b.isEdit=!1,b.unitToEdit=new a.Unit,b.refresh()};this.isEdit?this.$http.put("/api/Unit",this.unitToEdit).then(c):this.$http.post("/api/Unit",this.unitToEdit).then(c)}},b.prototype.onEditUnitClick=function(a){this.isEdit=!0,this.unitToEdit=a,a.fullAddress&&(this.unitToEdit.streetAddress=a.fullAddress.oneLiner)},b.prototype.onDeleteUnitClick=function(a){var b=this;this.$http["delete"]("/api/Unit/"+a.unitId).then(function(){b.refresh()})},b.prototype.onFastAddUnits=function(){var a=this;this.isLoading=!0;var b=this;this.$http.post("/api/Unit?fastAdd="+this.lastFastAddName,null).then(function(){a.isLoading=!1,b.refresh()},function(b){a.isLoading=!1,alert("Failed fast add:"+b.data.exceptionMessage)})},b.prototype.onAddUnitsPerLine=function(){var a={action:"onePerLine",lines:this.unitNamePerLine};this.isLoading=!0;var b=this;this.$http.post("/api/Unit?onePerLine=1",a).then(function(){b.isLoading=!1,b.refresh()},function(){b.isLoading=!1,alert("Failed")})},b.prototype.onAddUnitsByAddressPerLine=function(){var a={action:"onePerLine",lines:this.unitAddressPerLine};this.isLoading=!0;var b=this;this.$http.post("/api/Unit/FromAddresses",a).then(function(){b.isLoading=!1,b.refresh()},function(){b.isLoading=!1,alert("Failed")})},b.prototype.onDeleteAllClick=function(){if(confirm("This will delete every unit! This should only be used for new sites!")){var a=this;this.$http.get("/api/Unit?deleteAction=all").then(function(){a.refresh()},function(){})}},b.$inject=["$http","$rootScope"],b}();a.ManageHomesController=b}(Ally||(Ally={})),CA.angularApp.component("manageHomes",{templateUrl:"/ngApp/admin/manage-homes.html",controller:Ally.ManageHomesController});var Ally;!function(a){var b=function(){function a(a){this.$http=a,this.isLoading=!1}return a.prototype.$onInit=function(){this.retrieveEntries()},a.prototype.retrieveEntries=function(){this.isLoading=!0;var a=this;this.$http.get("/api/ActivityLog").then(function(b){a.isLoading=!1,a.logEntries=b.data},function(b){a.isLoading=!1,alert("Failed to load activity log: "+b.data.exceptionMessage)})},a.$inject=["$http"],a}();a.ViewActivityLogController=b}(Ally||(Ally={})),CA.angularApp.component("viewActivityLog",{templateUrl:"/ngApp/admin/view-activity-log.html",controller:Ally.ViewActivityLogController});var Ally;!function(a){var b=function(){function a(a){this.$http=a,this.isLoading=!1}return a.prototype.$onInit=function(){this.refreshAddresses()},a.prototype.findCenter=function(a){for(var b={lat:0,lng:0},c=0;c<a.length;++c){var d=a[c];if(d){for(var e={lat:0,lng:0},f=0;f<d.vertices.length;++f){var g=d.vertices[f];e.lat+=g.lat,e.lng+=g.lng}e.lat/=d.vertices.length,e.lng/=d.vertices.length,b.lat+=e.lat,b.lng+=e.lng}}return b.lat/=a.length,b.lng/=a.length,b},a.prototype.refreshAddresses=function(){var a=this;this.isLoading=!0,this.neighborhoodPolys=[];var b=this;this.$http.get("/api/Neighborhood").then(function(c){b.isLoading=!1,b.neighborhoods=c.data,b.neighborhoodPolys=_.select(b.neighborhoods,function(a){return a.Bounds}),b.mapCenter=b.findCenter(a.neighborhoodPolys)},function(a){b.isLoading=!1,alert("Failed to retrieve neighborhoods: "+a.data.exceptionMessage)})},a.$inject=["$http","$q"],a}();a.ViewPolysController=b}(Ally||(Ally={})),CA.angularApp.component("viewPolys",{templateUrl:"/ngApp/admin/view-polys.html",controller:Ally.ViewPolysController});var Ally;!function(a){var b=function(){function a(a){this.$http=a,this.isLoading=!1}return a.prototype.$onInit=function(){this.mapCenter={lat:41.99114,lng:-87.690425},this.refreshCells()},a.prototype.addLine=function(a,b,c,d,e){var f=[{lat:b,lng:c},{lat:d,lng:e}],g=new google.maps.Polyline({path:f,geodesic:!1,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});g.setMap(a)},a.prototype.onBuildingSelected=function(a){},a.prototype.onCellSelected=function(a){a.gpsBounds.mapShapeObject.setOptions({fillOpacity:.1}),this.selectedCell&&this.selectedCell.gpsBounds.mapShapeObject.setOptions({fillOpacity:.35}),this.selectedCell=a,_.each(this.selectedCell.streets,function(b){0!=b.minLat&&this.addLine(a.gpsBounds.mapShapeObject.map,b.minLat,b.minLon,b.maxLat,b.maxLon)})},a.prototype.refreshCells=function(){this.isLoading=!0;var a=this;this.$http.get("/api/ResearchMap").then(function(b){a.isLoading=!1,a.cells=b.data,a.isLoading=!0,a.$http.get("/api/ResearchMap/Buildings").then(function(b){a.isLoading=!1,a.buildings=b.data,a.buildingPoints=_.map(a.buildings,function(a){var b=a.addressPos;return b.ownerBuilding=a,b.onClick=function(){},b})})},function(b){a.isLoading=!1,alert("Failed to retrieve cells: "+b.data.exceptionMessage)})},a.prototype.onAddressSelected=function(a){if(this.selectedAddress=a,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&a.gpsPos){new google.maps.LatLng(a.gpsPos.lat,a.gpsPos.lon),new google.maps.LatLng(a.gpsPos.lat+.001,a.gpsPos.lon+.001);a.gpsBounds.vertices=[{lat:a.gpsPos.lat,lon:a.gpsPos.lon},{lat:a.gpsPos.lat+.001,lon:a.gpsPos.lon},{lat:a.gpsPos.lat+.001,lon:a.gpsPos.lon+.001},{lat:a.gpsPos.lat,lon:a.gpsPos.lon+.001}]}this.selectedGpsPoly=a.gpsBounds},a.$inject=["$http"],a}();a.ViewResearchController=b}(Ally||(Ally={})),CA.angularApp.component("viewResearch",{templateUrl:"/ngApp/admin/view-research.html",controller:Ally.ViewResearchController});var OverrideBaseApiPath=null;CA.angularApp.config(["$routeProvider","$httpProvider","$provide","SiteInfoProvider","$locationProvider",function(a,b,c,d,e){e.hashPrefix("!");var f=HtmlUtil.getSubdomain(OverrideBaseApiPath);if(null===f&&"#!/Login"!==window.location.hash)return void GlobalRedirect(AppConfig.baseUrl);for(var g=function(a,b,c,d){var e=b.defer();return c.userInfo?e.resolve():("/Home"!==a.path()&&"/Login"!==a.path()&&(d.set(d.Key_AfterLoginRedirect,a.path()),d.set(d.Key_WasLoggedIn401,"true")),e.reject(),a.path("/Login")),e.promise},h={app:["$q","$http","$rootScope","$sce","$location","xdLocalStorage","appCacheService",function(a,b,c,d,e,f,h){return Ally.SiteInfoHelper.loginInit(a,b,c,d,f).then(function(b){return g(e,a,b,h)})}]},i={app:["$q","$http","$rootScope","$sce","xdLocalStorage",Ally.SiteInfoHelper.loginInit]},j=angular.extend({},a,{when:function(b,c){return c.resolve=c.resolve?c.resolve:{},c.allyRole===Role_All?angular.extend(c.resolve,i):angular.extend(c.resolve,h),a.when(b,c),this}}),k=0;k<AppConfig.menu.length;++k){var l=AppConfig.menu[k],m={controller:l.controller,allyRole:l.role};l.templateUrl?m.templateUrl=l.templateUrl:m.template=l.templateHtml,l.controllerAs&&(m.controllerAs=l.controllerAs),j.when(l.path,m)}a.otherwise({redirectTo:"/Home"}),c.factory("http403Interceptor",["$q","$location","$rootScope","appCacheService","$injector",function(a,b,c,d,e){return{response:function(a){return a},responseError:function(f){var g=f.status;if(401===g||403===g){if(403===g&&c.dontHandle403)return a.reject(f);if(403===g&&c.isLoggedIn&&d.set(d.Key_WasLoggedIn403,"true"),401===g&&HtmlUtil.isValidString(window.localStorage.rememberMe_Email)){var h=e.get("$http");if(!c.retryLoginDeffered){c.retryLoginDeffered=a.defer();var i={emailAddress:window.localStorage.rememberMe_Email,password:atob(window.localStorage.rememberMe_Password)},j=function(){h.post("/api/Login",i).then(function(a){var b=a.data,d=e.get("SiteInfo");d.setAuthToken(b.authToken);var f=c.retryLoginDeffered;f.resolve()},function(){var a=c.retryLoginDeffered;c.onLogOut_ClearData(),a.reject()})["finally"](function(){c.retryLoginDeffered=null})};setTimeout(j,1e3)}var k=a.defer();return c.retryLoginDeffered.promise.then(function(){k.resolve(h(f.config))},function(){k.reject(f)}),k.promise}"/Home"!==b.path()&&"/Login"!==b.path()&&(d.set(d.Key_AfterLoginRedirect,b.path()),d.set(d.Key_WasLoggedIn401,"true")),c.onLogOut_ClearData()}return a.reject(f)}}}]),b.interceptors.push("http403Interceptor"),c.factory("apiUriInterceptor",["$rootScope",function(a){return"string"!=typeof a.authToken&&window.localStorage&&(a.authToken=window.localStorage.getItem("ApiAuthToken")),{request:function(b){return HtmlUtil.startsWith(b.url,"/api/")&&(HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||(b.url=OverrideBaseApiPath+b.url),b.headers.Authorization="Bearer "+a.authToken),b}}}]),b.interceptors.push("apiUriInterceptor")}]),CA.angularApp.run(["$rootScope","$http","$sce","$location","$templateCache","$cacheFactory","xdLocalStorage",function(a,b,c,d,e,f,g){a.bgImagePath="/assets/images/Backgrounds/",a.appConfig=AppConfig,a.isLoggedIn=!1,a.publicSiteInfo={},a.hideMenu=!1,a.isAdmin=!1,a.isSiteManager=!1,a.menuItems=_.where(AppConfig.menu,function(a){return!HtmlUtil.isNullOrWhitespace(a.menuTitle)}),a.mainMenuItems=_.where(a.menuItems,function(a){return a.role===Role_Authorized}),a.manageMenuItems=_.where(a.menuItems,function(a){return a.role===Role_Manager}),a.adminMenuItems=_.where(a.menuItems,function(a){return a.role===Role_Admin}),HtmlUtil.isLocalStorageAllowed()&&window.localStorage&&(a.publicSiteInfo=angular.fromJson(window.localStorage.getItem("siteInfo")),a.authToken=window.localStorage.getItem("ApiAuthToken"),(null===a.publicSiteInfo||void 0===a.publicSiteInfo)&&(a.publicSiteInfo={})),g.init({iframeUrl:"https://communityally.org/xd-local-storage.html"}).then(function(){}),a.onLogOut_ClearData=function(){a.userInfo={},a.isLoggedIn=!1,a.isAdmin=!1,a.isSiteManager=!1,a.authToken="",window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null,g.removeItem("allyApiAuthToken"),f.get("$http").removeAll(),window.localStorage&&window.localStorage.removeItem("siteInfo"),d.path("/Login")},a.onLogOut=function(){b.get("/api/Login/Logout").then(a.onLogOut_ClearData,a.onLogOut_ClearData)},a.$on("$routeChangeStart",function(){CA.clearTemplateCacheIfNeeded&&CA.clearTemplateCacheIfNeeded(e)}),a.$on("$routeChangeSuccess",function(b,c,e,f){a.curPath=d.path();var g="",h=d.path();-1!==h.indexOf("?")&&(g=h.substring(h.indexOf("?"),h.length));var i="";f&&f.name&&(i=d.protocol()+"://"+d.host()+"/#"+f.url),analytics.page({path:h,referrer:i,search:g,url:d.absUrl()})})}]);var Ally;!function(a){var b=function(){function a(){}return a}();a.MenuItem_v3=b}(Ally||(Ally={}));var Role_Authorized="authorized",Role_All="all",Role_Manager="manager",Role_Admin="admin",PeriodicPaymentFrequencies=[{name:"Monthly",intervalName:"month",id:50},{name:"Quarterly",intervalName:"quarter",id:51},{name:"Semiannually",intervalName:"half-year",id:52},{name:"Annually",intervalName:"year",id:53}],CondoAllyAppConfig={appShortName:"condo",appName:"Condo Ally",baseTld:"condoally.com",baseUrl:"https://condoally.com/",segmentWriteKey:"GnlZNd8jKCpDgFqRKbA4nftkuFIaqKPQ",homeName:"Unit",menu:[new RoutePath_v3({path:"Home",templateHtml:"<chtn-home></chtn-home>",menuTitle:"Home"}),new RoutePath_v3({path:"BuildingInfo",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info"}),new RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",controller:"LogbookController",menuTitle:"Calendar"}),new RoutePath_v3({path:"Map",templateHtml:"<chtn-map></chtn-map>",menuTitle:"Map"}),new RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Residents"}),new RoutePath_v3({path:"Committee/:committeeId/:viewName",templateHtml:"<committee-parent></committee-parent>"}),new RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"SignUp",templateHtml:"<condo-sign-up-wizard></condo-sign-up-wizard>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"EmailAbuse/:idValue",templateHtml:"<email-abuse></email-abuse>",role:Role_All}),new RoutePath_v3({path:"DiscussionManage/:idValue",templateHtml:"<discussion-manage></discussion-manage>"}),new RoutePath_v3({path:"NeighborSignUp",templateHtml:"<neighbor-sign-up></neighbor-sign-up>",role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager}),new RoutePath_v3({path:"ManagePolls",templateHtml:"<manage-polls></manage-polls>",menuTitle:"Polls",role:Role_Manager}),new RoutePath_v3({path:"ManagePayments",templateHtml:"<manage-payments></manage-payments>",menuTitle:"Online Payments",role:Role_Manager}),new RoutePath_v3({path:"AssessmentHistory",templateHtml:"<assessment-history></assessment-history>",menuTitle:"Assessment History",role:Role_Manager}),new RoutePath_v3({path:"Settings",templateHtml:"<chtn-settings></chtn-settings>",menuTitle:"Settings",role:Role_Manager}),new RoutePath_v3({path:"/Admin/ManageGroups",templateHtml:"<manage-groups></manage-groups>",menuTitle:"Manage Associations",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ManageHomes",templateHtml:"<manage-homes></manage-homes>",menuTitle:"Manage Homes",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"Edit Addresses",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ViewPolys",templateHtml:"<view-polys></view-polys>",menuTitle:"View Polygons",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ViewResearch",templateHtml:"<view-research></view-research>",menuTitle:"View Research",role:Role_Admin})]},WatchAppConfig={appShortName:"watch",appName:"Neighborhood Watch Ally",baseTld:"watchally.org",baseUrl:"https://watchally.org/",menu:[new RoutePath("Home","/ngApp/watch/member/WatchHome.html",WatchHomeCtrl,"Home"),new RoutePath("Members","/ngApp/watch/member/WatchMembers.html",WatchMembersCtrl,"Members"),new RoutePath("Calendar","/ngApp/watch/member/WatchCalendar.html",WatchCalendarCtrl,"Calendar"),new RoutePath_v3({
path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath("ManageMembers","/ngApp/watch/manager/ManageMembers.html",ManageMembersCtrl,"Members",Role_Manager),new RoutePath("Settings","/ngApp/watch/manager/Settings.html",WatchSettingsCtrl,"Settings",Role_Manager),new RoutePath("/Admin/ManageWatchGroups","/ngApp/Admin/ManageAssociations.html","ManageAssociationsController","Manage Groups",Role_Admin),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"Edit Addresses",role:Role_Admin})]},ServiceAppConfig={appShortName:"service",appName:"Service Professional Ally",baseTld:"serviceally.org",baseUrl:"https://serviceally.org/",menu:[new RoutePath("Jobs","/ngApp/service/Jobs.html",ServiceJobsCtrl,"Jobs"),new RoutePath("BusinessInfo","/ngApp/service/BusinessInfo.html",ServiceBusinessInfoCtrl,"Business Info"),new RoutePath("Banking","/ngApp/service/BankInfo.html",ServiceBankInfoCtrl,"Banking"),new RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin})]},HomeAppConfig={appShortName:"home",appName:"Home Ally",baseTld:"homeally.org",baseUrl:"https://homeally.org/",menu:[new RoutePath_v3({path:"Home",templateHtml:"<home-group-home></home-group-home>",menuTitle:"Home"}),new RoutePath_v2({path:"ToDo",templateUrl:"/ngApp/home/ToDos.html",controller:ServiceJobsCtrl,menuTitle:"Jobs"}),new RoutePath_v3({path:"SignUp",templateHtml:"<home-sign-up></home-sign-up>",role:Role_All}),new RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin})]},HOAAppConfig=_.clone(CondoAllyAppConfig);HOAAppConfig.appShortName="hoa",HOAAppConfig.appName="HOA Ally",HOAAppConfig.baseTld="hoaally.org",HOAAppConfig.baseUrl="https://hoaally.org/",HOAAppConfig.homeName="Home",HOAAppConfig.menu.push(new RoutePath_v3({path:"HoaSignUp",templateHtml:"<hoa-sign-up-wizard></hoa-sign-up-wizard>",role:Role_All}));var NeighborhoodAppConfig=_.clone(CondoAllyAppConfig);NeighborhoodAppConfig.appShortName="neighborhood",NeighborhoodAppConfig.appName="Neighborhood Ally",NeighborhoodAppConfig.baseTld="neighborhoodally.org",NeighborhoodAppConfig.baseUrl="https://neighborhoodally.org/",NeighborhoodAppConfig.homeName="Home",NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(a){return"Residents"===a.menuTitle}),NeighborhoodAppConfig.menu.push(new RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"})),NeighborhoodAppConfig.menu.splice(0,0,new RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager})),NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(a){return"Assessment History"===a.menuTitle}),NeighborhoodAppConfig.menu.splice(3,0,new RoutePath_v3({path:"DuesHistory",menuTitle:"Dues History",templateHtml:"<dues-history></dues-history>",role:Role_Manager}));var AppConfig=null,lowerDomain=document.domain.toLowerCase();HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||(lowerDomain=OverrideBaseApiPath.toLowerCase()),-1!==lowerDomain.indexOf("condoally")||-1!==lowerDomain.indexOf("hellocondo")?AppConfig=CondoAllyAppConfig:-1!==lowerDomain.indexOf("watchally")?AppConfig=WatchAppConfig:-1!==lowerDomain.indexOf("serviceally")?AppConfig=ServiceAppConfig:-1!==lowerDomain.indexOf("homeally")||-1!==lowerDomain.indexOf("helloathome")?AppConfig=HomeAppConfig:-1!==lowerDomain.indexOf("hoaally")||-1!==lowerDomain.indexOf("hellohoa")?AppConfig=HOAAppConfig:-1!==lowerDomain.indexOf("neighborhoodally")||-1!==lowerDomain.indexOf("chicagoblock")||-1!==lowerDomain.indexOf("blockclub")||-1!==lowerDomain.indexOf("helloneighborhood")?AppConfig=NeighborhoodAppConfig:(console.log("Unknown ally app"),AppConfig=CondoAllyAppConfig),window.AppConfig=AppConfig,AppConfig.isPublicRoute=function(a){a||(a=window.location.hash),HtmlUtil.startsWith(a,"#!")&&(a=a.substr(2));var b=-1!==a.indexOf("/",1);b&&(a=a.substr(0,a.indexOf("/",1)));var c=_.find(AppConfig.menu,function(c){var d=c.path;return d?(b&&-1!==d.indexOf("/",1)&&(d=d.substr(0,d.indexOf("/",1))),d===a):!1});return c?c.role===Role_All:!1},document.title=AppConfig.appName,$(document).ready(function(){$("header").css("background-image","url(/assets/images/header-img-"+AppConfig.appShortName+".jpg)")});var Ally;!function(a){var b;!function(a){a[a.Monthly=50]="Monthly",a[a.Quarterly=51]="Quarterly",a[a.Semiannually=52]="Semiannually",a[a.Annually=53]="Annually"}(b||(b={}));var c=function(){function a(a,b,c,d){this.$http=a,this.$location=b,this.siteInfo=c,this.appCacheService=d,this.LocalStorageKey_ShowPaymentInfo="AssessmentHistory_ShowPaymentInfo",this.NumPeriodsVisible=10,this.shouldShowCreateSpecialAssessment=!1,this.unitPayments={},this.onSavePayment=function(){var a=this,b=function(){a.isSavingPayment=!1,a.editPayment=null,a.retrievePaymentHistory()},c=function(b){a.isSavingPayment=!1,alert(b.data.message),a.editPayment=null};this.isSavingPayment=!0,this.editPayment.payment.paymentId?(analytics.track("editAssessmentHistoryPayment"),this.$http.put("/api/PaymentHistory",this.editPayment.payment).then(b,c)):(analytics.track("addAssessmentHistoryPayment"),this.$http.post("/api/PaymentHistory",this.editPayment.payment).then(b,c))}}return a.prototype.$onInit=function(){"neighborhood"===AppConfig.appShortName?this.pageTitle="Membership Dues Payment History":this.pageTitle="Assessment Payment History",this.authToken=window.localStorage.getItem("ApiAuthToken"),this.units=[{name:"A",monthPayments:[1,2,3]},{name:"B",monthPayments:[1,2,3]},{name:"C",monthPayments:[1,2,3]}];this.showPaymentInfo="true"===window.localStorage[this.LocalStorageKey_ShowPaymentInfo];var a=51,b=52,c=53;this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,this.payPeriodName="month",this.assessmentFrequency===a?this.payPeriodName="quarter":this.assessmentFrequency===b?this.payPeriodName="half-year":this.assessmentFrequency===c&&(this.payPeriodName="year"),this.maxPeriodRange=12,this.assessmentFrequency===a?this.maxPeriodRange=4:this.assessmentFrequency===b?this.maxPeriodRange=2:this.assessmentFrequency===c&&(this.maxPeriodRange=1),this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["Quarter 1","Quarter 2","Quarter 3","Quarter 4"],f=["Q1","Q2","Q3","Q4"],g=["First Half","Second Half"],h=["1st Half","2nd Half"];this.periodNames=this.monthNames,this.shortPeriodNames=d,this.assessmentFrequency===a?(this.periodNames=e,this.shortPeriodNames=f):this.assessmentFrequency===b?(this.periodNames=g,this.shortPeriodNames=h):this.assessmentFrequency===c&&(this.periodNames=[""],this.shortPeriodNames=[""]),this.startPeriodValue=(new Date).getMonth()+2,this.startYearValue=(new Date).getFullYear(),this.assessmentFrequency===a?this.startPeriodValue=Math.floor((new Date).getMonth()/4)+2:this.assessmentFrequency===b?this.startPeriodValue=Math.floor((new Date).getMonth()/6)+2:this.assessmentFrequency===c&&(this.startPeriodValue=1,this.startYearValue=(new Date).getFullYear()+1),this.startPeriodValue>this.maxPeriodRange&&(this.startPeriodValue=1,this.startYearValue+=1),this.isPeriodicPaymentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled,this.retrievePaymentHistory()},a.prototype.onChangePeriodicPaymentTracking=function(){if(this.isPeriodicPaymentTrackingEnabled!==this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled){this.isPeriodicPaymentTrackingEnabled,this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled=this.isPeriodicPaymentTrackingEnabled,this.isLoading=!0;var a=this;this.$http.put("/api/Association/updatePeriodicPaymentTracking?isPeriodicPaymentTrackingEnabled="+this.isPeriodicPaymentTrackingEnabled,null).then(function(){a.isLoading=!1},function(){alert("Failed to update the payment tracking"),a.isLoading=!1})}},a.prototype.fillInEmptyPayments=function(a){for(var b=null!==a.owners&&a.owners.length>0?a.owners[0].userId:null,c=[],d=this.startPeriodValue,e=this.startYearValue,f=0;f<this.NumPeriodsVisible;++f){1>d&&(d=this.maxPeriodRange,--e);var g=_.find(a.allPayments,function(a){return a.period===d&&a.year===e});(void 0===g||g.isEmptyEntry)&&(g={isPaid:!1,period:d,year:e,amount:a.assessment,payerUserId:b,paymentDate:new Date,isEmptyEntry:!0}),c.push(g),d--}return c},a.prototype.viewWePayDetails=function(a){this.appCacheService.set("hwpid",a),this.$location.path("/ManagePayments")},a.prototype.addSpecialAssessment=function(){this.createSpecialAssessment=parseInt(this.createSpecialAssessment)+1,this.isLoading=!0;var a=this;this.$http.post("/api/PaymentHistory/SpecialAssessment",this.createSpecialAssessment).then(function(){a.isLoading=!1,a.shouldShowCreateSpecialAssessment=!1,a.retrievePaymentHistory()},function(b){a.isLoading=!1;var c=b.data.exceptionMessage?b.data.exceptionMessage:b.data;alert("Failed to add special assessment: "+c)})},a.prototype.showCreateSpecialAssessment=function(){this.shouldShowCreateSpecialAssessment=!0,this.createSpecialAssessment={year:(new Date).getFullYear(),month:(new Date).getMonth().toString(),notes:"",amount:null}},a.prototype.browsePast=function(){for(this.startPeriodValue=this.startPeriodValue-6;this.startPeriodValue<1;)this.startPeriodValue=this.maxPeriodRange+this.startPeriodValue,--this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},a.prototype.browseFuture=function(){for(this.startPeriodValue=this.startPeriodValue+6;this.startPeriodValue>this.maxPeriodRange;)this.startPeriodValue-=this.maxPeriodRange,++this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},a.prototype.displayPaymentsForRange=function(a,b){this.startYearValue=a,this.startPeriodValue=b,this.visiblePeriodNames=[];for(var c=this.startYearValue,d=this.startPeriodValue,e=0;e<this.NumPeriodsVisible;++e){1>d&&(d=this.maxPeriodRange,--c);var f=this.shortPeriodNames[d-1];(1===d||d===this.maxPeriodRange)&&(f+=" "+c),this.visiblePeriodNames.push({name:f,periodIndex:d,arrayIndex:e,year:c}),--d}var g=this;_.each(this.unitPayments,function(a){a.payments=g.fillInEmptyPayments(a)})},a.prototype.retrievePaymentHistory=function(){this.isLoading=!0;var a=this;this.$http.get("/api/PaymentHistory?oldestDate=").then(function(b){for(var c=b.data,d=0;d<c.payments.length;++d)"string"==typeof c.payments[d].paymentDate&&c.payments[d].paymentDate.length>0&&(c.payments[d].paymentDate=new Date(c.payments[d].paymentDate));a.unitPayments={},_.each(c.units,function(b){for(a.unitPayments[b.unitId]=b,a.unitPayments[b.unitId].displayOwners=_.first(b.owners,2);a.unitPayments[b.unitId].displayOwners.length<2;)a.unitPayments[b.unitId].displayOwners.push({name:""});a.unitPayments[b.unitId].payments=[]}),_.each(c.payments,function(b){a.unitPayments[b.unitId].payments.push(b)}),_.each(c.units,function(a){a.allPayments=a.payments}),a.displayPaymentsForRange(a.startYearValue,a.startPeriodValue);var e=[];for(var f in a.unitPayments)e.push(a.unitPayments[f]);a.unitPayments=_.sortBy(e,function(a){return a.name}),a.payers=_.sortBy(c.payers,function(a){return a.name}),a.isLoading=!1})},a.prototype.getPaymentSumForPayPeriod=function(a){for(var b=0,c=_.keys(this.unitPayments),d=0;d<c.length;++d){var e=c[d],f=this.unitPayments[e].payments[a];f&&f.isPaid&&(b+=f.amount)}return b},a.prototype.onshowPaymentInfo=function(){window.localStorage[this.LocalStorageKey_ShowPaymentInfo]=this.showPaymentInfo},a.prototype.onPaymentCellClick=function(a,b){b.unitId=a.unitId,this.editPayment={unit:a,payment:_.clone(b),periodName:this.periodNames[b.period-1],filteredPayers:_.filter(this.payers,function(b){return!_.some(a.owners,function(a){return a.userId===b.userId})})},setTimeout(function(){$("#paid-amount-textbox").focus()},10)},a.$inject=["$http","$location","SiteInfo","appCacheService"],a}();a.AssessmentHistoryController=c}(Ally||(Ally={})),CA.angularApp.component("assessmentHistory",{templateUrl:"/ngApp/chtn/manager/assessment-history.html",controller:Ally.AssessmentHistoryController});var Ally;!function(a){var b=function(){function a(){}return a}();a.DuesHistoryController=b}(Ally||(Ally={})),CA.angularApp.component("duesHistory",{templateUrl:"/ngApp/chtn/manager/dues-history.html",controller:Ally.DuesHistoryController});var Ally;!function(a){var b=function(){function a(){}return a}();a.Committee=b;var c=function(){function a(a,c,d){this.$http=a,this.siteInfo=c,this.$cacheFactory=d,this.includeInactive=!1,this.committees=[],this.newCommittee=new b,this.isLoading=!1,this.newCommittee.committeeType="Ongoing"}return a.prototype.$onInit=function(){this.retrieveCommittees()},a.prototype.toggleCommitteeActive=function(a){this.isLoading=!0;var b=(a.deactivationDateUtc?"/api/Committee/Reactivate/":"/api/Committee/Deactivate/")+a.committeeId,c=this;this.$http.put(b,null).success(function(a){c.isLoading=!1,c.retrieveCommittees()}).error(function(a){c.isLoading=!1,alert("Failed to retrieve the modify committee: "+a.exceptionMessage)})},a.prototype.retrieveCommittees=function(){this.isLoading=!0;var a=this;this.$http.get("/api/Committee").success(function(b){a.isLoading=!1,a.committees=b,_.forEach(b,function(a){return a.creationDateUtc=moment.utc(a.creationDateUtc).toDate()})}).error(function(b){a.isLoading=!1,alert("Failed to retrieve the committee listing")})},a.prototype.createCommittee=function(){if(HtmlUtil.isNullOrWhitespace(this.newCommittee.name))return void alert("Please enter a name.");this.isLoading=!0;var a="/api/Committee?name="+encodeURIComponent(this.newCommittee.name)+"&type="+encodeURIComponent(this.newCommittee.committeeType),b=this;this.$http.post(a,null).success(function(){b.isLoading=!1,b.retrieveCommittees()}).error(function(a){b.isLoading=!1,alert("Failed to create the committee: "+a.exceptionMessage)})},a.$inject=["$http","SiteInfo","$cacheFactory"],a}();a.ManageCommitteesController=c}(Ally||(Ally={})),CA.angularApp.component("manageCommittees",{templateUrl:"/ngApp/chtn/manager/manage-committees.html",controller:Ally.ManageCommitteesController});var Ally;!function(a){var b=function(){function a(a,b,c){this.$http=a,this.siteInfo=b,this.appCacheService=c,this.PaymentHistory=[],this.message="",this.showPaymentPage="condo"===AppConfig.appShortName,this.PeriodicPaymentFrequencies=PeriodicPaymentFrequencies,this.AssociationPaysAch=!0,this.AssociationPaysCC=!1,this.lateFeeInfo={},this.isLoading=!1,this.isLoadingUnits=!1,this.isLoadingPayment=!1,this.isLoadingLateFee=!1,this.isLoadingCheckoutDetails=!1}return a.prototype.$onInit=function(){this.highlightWePayCheckoutId=this.appCacheService.getAndClear("hwpid"),this.isAssessmentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled,this.payments=[{Date:"",Unit:"",Resident:"",Amount:"",Status:""}],this.testFee={amount:200},this.signUpStep=0,this.signUpInfo={hasAssessments:null,assessmentFrequency:0,allPayTheSame:!0,allPayTheSameAmount:null,units:[]},this.refresh()},a.prototype.refresh=function(){var a=this;this.isLoading=!0;var b=this;this.$http.get("/api/OnlinePayment").then(function(c){b.isLoading=!1,b.hasAssessments=b.siteInfo.privateSiteInfo.hasAssessments;var d=c.data;b.paymentInfo=d,b.lateFeeInfo={lateFeeDayOfMonth:d.lateFeeDayOfMonth,lateFeeAmount:d.lateFeeAmount},HtmlUtil.isNullOrWhitespace(a.lateFeeInfo.lateFeeAmount)||HtmlUtil.endsWith(a.lateFeeInfo.lateFeeAmount,"%")||(a.lateFeeInfo.lateFeeAmount="$"+a.lateFeeInfo.lateFeeAmount),b.refreshUnits(),b.updateTestFee()})},a.prototype.refreshUnits=function(){this.isLoadingUnits=!0;var a=this;this.$http.get("/api/Unit").then(function(b){a.units=b.data,_.each(a.units,function(a){null===a.adjustedAssessment&&(a.adjustedAssessment=a.assessment)}),a.assessmentSum=_.reduce(a.units,function(a,b){return a+b.assessment},0),a.adjustedAssessmentSum=_.reduce(a.units,function(a,b){return a+(b.adjustedAssessment||0)},0),a.isLoadingUnits=!1})},a.prototype.getLateFeeDateSuper=function(){var a=this.lateFeeInfo.lateFeeDayOfMonth;if("string"==typeof a){if(HtmlUtil.isNullOrWhitespace(a))return"";a=parseInt(a),this.lateFeeInfo.lateFeeDayOfMonth=a}if(NaN==a||1>a)return a="","";if(a>31)return a="","";if(a>=10&&20>=a)return"th";var b=a%10;return 1===b?"st":2===b?"nd":3===b?"rd":"th"},a.prototype.selectText=function(){setTimeout(function(){$(".editable-input").select()},50)},a.prototype.onWithdrawalClick=function(){this.message="",this.$http.get("/api/OnlinePayment?action=withdrawal").then(function(a){var b=a.data;b.redirectUri?window.location.href=b.redirectUri:this.message=b.message},function(a){a.data&&a.data.exceptionMessage&&(this.message=a.data.exceptionMessage)})},a.prototype.onUnitAssessmentChanged=function(a){this.isLoadingUnits=!0,"string"==typeof a.assessment&&(a.assessment=parseFloat(a.assessment)),"string"==typeof a.adjustedAssessment&&(a.adjustedAssessment=parseFloat(a.adjustedAssessment));var b=this;this.$http.put("/api/Unit",a).then(function(){b.isLoadingUnits=!1,b.assessmentSum=_.reduce(b.units,function(a,b){return a+b.assessment},0),b.adjustedAssessmentSum=_.reduce(b.units,function(a,b){return a+(b.adjustedAssessment||0)},0)})},a.prototype.onChangeFeePayerInfo=function(a){var b=!1,c=!1;if(this.paymentInfo.usersWithAutoPay&&this.paymentInfo.usersWithAutoPay.length>0){var d="ACH",e="Credit Card",f=[];if("ach"===a?f=_.where(this.paymentInfo.usersWithAutoPay,function(a){return a.wePayAutoPayFundingSource===d}):"cc"===a&&(f=_.where(this.paymentInfo.usersWithAutoPay,function(a){return a.wePayAutoPayFundingSource===e})),f.length>0){c=void 0!==_.find(f,function(a){return a.userId===this.$parent.userInfo.userId}),b=!0;var g="Adjusting the fee payer type will cause the follow units to have their auto-pay cancelled and they will be informed by e-mail:\n";if(_.each(f,function(a){g+=a.ownerName+"\n"}),g+="\nDo you want to continue?",!confirm(g))return void("ach"===a?this.paymentInfo.payerPaysAchFee=!this.paymentInfo.payerPaysAchFee:this.paymentInfo.payerPaysCCFee=!this.paymentInfo.payerPaysCCFee)}}this.isLoadingPayment=!0;var h=this;this.$http.put("/api/OnlinePayment",this.paymentInfo).then(function(){c?window.location.reload():(h.isLoadingPayment=!1,b&&h.refresh())}),this.updateTestFee()},a.prototype.getSignUpSum=function(){return _.reduce(this.signUpInfo.units,function(a,b){return a+parseFloat(b.assessment)},0)},a.prototype.signUp_HasAssessments=function(a){this.signUpInfo.hasAssessments=a,this.signUpInfo.hasAssessments?(this.signUpInfo.units=[],_.each(this.units,function(a){this.signUpInfo.units.push({unitId:a.unitId,name:a.name,assessment:0})}),this.signUpStep=1):this.signUp_Commit()},a.prototype.signUp_AssessmentFrequency=function(a){this.signUpInfo.frequencyIndex=a,this.signUpInfo.assessmentFrequency=PeriodicPaymentFrequencies[a].name,this.signUpStep=2},a.prototype.saveLateFee=function(){this.isLoadingLateFee=!0;var a=this;this.$http.put("/api/OnlinePayment/LateFee?dayOfMonth="+this.lateFeeInfo.lateFeeDayOfMonth+"&lateFeeAmount="+this.lateFeeInfo.lateFeeAmount,null).then(function(b){a.isLoadingLateFee=!1;var c=b.data;c&&c.feeAmount&&0!==c.feeType?(a.lateFeeInfo.lateFeeAmount=c.feeAmount,1===c.feeType?a.lateFeeInfo.lateFeeAmount="$"+a.lateFeeInfo.lateFeeAmount:2===c.feeType&&(a.lateFeeInfo.lateFeeAmount=""+a.lateFeeInfo.lateFeeAmount+"%")):(""!==a.lateFeeInfo.lateFeeDayOfMonth&&alert("Failed to save the late fee. Please enter only a number for the date (ex. 5) and an amount (ex. 12.34) or percent (ex. 5%) for the fee. To disable late fees, clear the date field and hit save."),a.lateFeeInfo.lateFeeDayOfMonth="",a.lateFeeInfo.lateFeeAmount=null)},function(b){a.isLoadingLateFee=!1;var c=b.data.exceptionMessage?b.data.exceptionMessage:b.data;alert("Failed to update late fee: "+c)})},a.prototype.showWePayCheckoutInfo=function(a){if(this.viewingCheckoutId=a,this.viewingCheckoutId){this.isLoadingCheckoutDetails=!0,this.checkoutInfo={};var b=this;this.$http.get("/api/OnlinePayment/CheckoutInfo?checkoutId="+a,{cache:!0}).then(function(a){b.isLoadingCheckoutDetails=!1,b.checkoutInfo=a.data},function(a){b.isLoadingCheckoutDetails=!1;var c=a.data.exceptionMessage?a.data.exceptionMessage:a.data;alert("Failed to retrieve checkout details: "+c)})}},a.prototype.signUp_Commit=function(){this.isLoading=!0;var a=this;this.$http.post("/api/OnlinePayment/BasicInfo",this.signUpInfo).then(function(){a.isLoading=!1,a.refreshUnits(),a.hasAssessments=this.signUpInfo.hasAssessments,a.siteInfo.privateSiteInfo.hasAssessments=this.hasAssessments},function(b){a.isLoading=!1,b.data&&b.data.exceptionMessage&&(a.message=b.data.exceptionMessage)})},a.prototype.updateTestFee=function(){var a=parseFloat(this.testFee.amount);this.paymentInfo.payerPaysAchFee?(this.testFee.achResidentPays=a+1.5,this.testFee.achAssociationReceives=a):(this.testFee.achResidentPays=a,this.testFee.achAssociationReceives=a-1.5);var b=1.3+.029*a;this.paymentInfo.payerPaysCCFee?(this.testFee.ccResidentPays=a+b,this.testFee.ccAssociationReceives=a):(this.testFee.ccResidentPays=a,this.testFee.ccAssociationReceives=a-b)},a.prototype.admin_ClearAccessToken=function(){alert("TODO hook this up")},a.$inject=["$http","SiteInfo","appCacheService"],a}();a.ManagePaymentsController=b}(Ally||(Ally={})),CA.angularApp.component("managePayments",{templateUrl:"/ngApp/chtn/manager/manage-payments.html",controller:Ally.ManagePaymentsController});var Ally;!function(a){var b=function(){function a(){}return a}(),c=function(){function a(a,b){this.$http=a,this.siteInfo=b,this.pollHistory=[],this.isLoading=!1}return a.prototype.$onInit=function(){var a=new Date;a.setDate((new Date).getDate()+3),this.defaultPoll=new b,this.defaultPoll.expirationDate=a,this.defaultPoll.answers=[{answerText:"Yes"},{answerText:"No"}],this.editingItem=angular.copy(this.defaultPoll),this.retrieveItems()},a.prototype.retrieveItems=function(){var a=101;this.isLoading=!0;var b=this;this.$http.get("/api/Poll").then(function(c){b.pollHistory=c.data;for(var d=0;d<b.pollHistory.length;++d)b.pollHistory[d].expirationDate=new Date(b.pollHistory[d].expirationDate),b.pollHistory[d].fullResultAnswers=b.pollHistory[d].answers,b.pollHistory[d].answers=_.reject(b.pollHistory[d].answers,function(b){return b.sortOrder===a});b.isLoading=!1})},a.prototype.addAnswer=function(){return this.editingItem.answers||(this.editingItem.answers=[]),this.editingItem.answers.length>19?void alert("You can only have 20 answers maxiumum per poll."):void this.editingItem.answers.push({answerText:""})},a.prototype.cancelEdit=function(){this.editingItem=angular.copy(this.defaultPoll)},a.prototype.onSaveItem=function(){if(null!==this.editingItem){this.isLoading=!0;var a=this,b=function(){a.isLoading=!1,a.editingItem=angular.copy(a.defaultPoll),a.retrieveItems()},c=function(b){a.isLoading=!1,alert("Failed to save poll: "+b.data.exceptionMessage)};"number"==typeof this.editingItem.pollId?(analytics.track("editPoll"),this.$http.put("/api/Poll",this.editingItem).then(b,c)):(analytics.track("addPoll"),this.$http.post("/api/Poll",this.editingItem).then(b,c))}},a.prototype.onEditItem=function(a){this.editingItem=angular.copy(a),window.scrollTo(0,0)},a.prototype.onDeleteItem=function(a){this.isLoading=!0;var b=this;this.$http["delete"]("/api/Poll?pollId="+a.pollId).then(function(){b.retrieveItems()},function(a){b.isLoading=!1,403===a.status&&alert("You cannot authorized to delete this poll.")})},a.prototype.onViewResults=function(a){if(!a)return void(this.viewingPollResults=null);var b=_.groupBy(a.responses,"answerId");a.chartData=[],a.chartLabels=[];for(var c in b)if(b.hasOwnProperty(c)){var d=_.find(a.fullResultAnswers,function(a){return a.pollAnswerId===c});d&&(a.chartLabels.push(d.answerText),a.chartData.push(b[c].length))}a.responses&&a.responses.length<this.siteInfo.privateSiteInfo.numUnits&&(a.chartLabels.push("No Response"),a.chartData.push(this.siteInfo.privateSiteInfo.numUnits-a.responses.length)),a.answerCounts=[];for(var e=0;e<a.chartLabels.length;++e)a.answerCounts.push({label:a.chartLabels[e],count:a.chartData[e]});this.chartLabels=a.chartLabels,this.chartData=a.chartData,this.viewingPollResults=a},a.$inject=["$http","SiteInfo"],a}();a.ManagePollsController=c}(Ally||(Ally={})),CA.angularApp.component("managePolls",{templateUrl:"/ngApp/chtn/manager/manage-polls.html",controller:Ally.ManagePollsController});var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),Ally;!function(a){var b=function(){function a(){}return a}();a.Unit=b;var c=function(){function a(){}return a}();a.HomeEntry=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.HomeEntry);a.HomeEntryWithName=d;var e=function(){function a(){}return a}();a.Member=e;var f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(e);a.Resident=f;var g=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(f);a.UpdateResident=g;var h=function(){function b(a,b,c,d,e,f){this.$http=a,this.$rootScope=b,this.$interval=c,this.$cacheFactory=d,this.uiGridConstants=e,this.siteInfo=f,this.isAdmin=!1,this.multiselectMulti="single",this.isSavingUser=!1,this.isLoading=!1,this.isLoadingSettings=!1}return b.prototype.$onInit=function(){this.isAdmin=this.siteInfo.userInfo.isAdmin,this.siteLaunchedDateUtc=this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.bulkImportRows=[{}],this.multiselectOptions="",this.allUnits=null,this.homeName=AppConfig.homeName||"Unit",this.showIsRenter="condo"===AppConfig.appShortName,this.boardPositions=[{id:0,name:"None"},{id:1,name:"President"},{id:2,name:"Treasurer"},{id:4,name:"Secretary"},{id:8,name:"Director/Trustee"},{id:16,name:"Vice President"},{id:32,name:"Property Manager"}],this.newResident={boardPosition:0,isRenter:!1},this.editUser=null;var a="residentSort_v2",b={field:"lastName",direction:this.uiGridConstants.ASC};if(this.residentSortInfo=b,window.localStorage){var c=window.localStorage.getItem(a);c&&(this.residentSortInfo=JSON.parse(c)),this.residentSortInfo.field||(this.residentSortInfo=b)}var d=this;if(this.residentGridOptions={data:[],columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first"},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last"},{field:"email",displayName:"E-mail",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text class="resident-cell-email" data-ng-style="{ \'color\': row.entity.postmarkReportedBadEmailUtc ? \'#F00\' : \'auto\' }">{{ row.entity.email }}</span></div>'},{field:"unitGridLabel",displayName:"condo"===AppConfig.appShortName?"Unit":"Home",cellClass:"resident-cell-unit",width:this.showIsRenter?62:175,sortingAlgorithm:function(a,b){return a.toString().localeCompare(b.toString())}},{field:"isRenter",displayName:"Is Renter",width:80,cellClass:"resident-cell-is-renter",visible:this.showIsRenter,cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isRenter"></div>'},{field:"boardPosition",displayName:"Board Position",width:125,cellClass:"resident-cell-board",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ grid.appScope.$ctrl.getBoardPositionName(row.entity.boardPosition) }}</span></div>'},{field:"isSiteManager",displayName:"Is Admin",width:80,cellClass:"resident-cell-site-manager",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isSiteManager"></div>'},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.phoneNumber | tel }}</span></div>'}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableFullRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,onRegisterApi:function(b){d.gridApi=b,b.selection.on.rowSelectionChanged(d.$rootScope,function(a){"row selected "+a.isSelected;d.setEdit(a.entity)}),b.core.on.sortChanged(d.$rootScope,function(b,c){if(c&&0!==c.length){var d={field:c[0].field,direction:c[0].sort.direction};window.localStorage.setItem(a,JSON.stringify(d))}}),HtmlUtil.uiGridFixScroll()}},window.innerWidth<769)for(var e=2;e<this.residentGridOptions.columnDefs.length;++e)this.residentGridOptions.columnDefs[e].visible=!1;this.refresh(),this.loadSettings()},b.prototype.getBoardPositionName=function(a){if(!a)return"";var b=jQuery.grep(this.boardPositions,function(b,c){return b.id===a})[0];return b?b.name:""},b.prototype.setEdit=function(b){if(this.sentWelcomeEmail=!1,null===b)return void(this.editUser=null);this.editUserForm.$setPristine();var c=jQuery.extend({},b);if(this.editUser=c,this.editUser.showAdvancedHomePicker=this.allUnits.length>20,this.multiselectMulti="single","object"==typeof this.editUser.units&&(this.editUser.units.length>0&&(this.editUser.singleUnitId=this.editUser.units[0].unitId),this.editUser.units.length>1&&(this.editUser.showAdvancedHomePicker=!0,this.multiselectMulti="multiple")),this.allUnits.length>20&&"single"===this.multiselectMulti&&null!==this.allUnits[0].unitId){var d=new a.Unit;d.name="None Selected",this.allUnits.unshift(d)}var e=this;_.each(this.allUnits,function(a){var b=void 0!==_.find(e.editUser.units,function(b){return b.unitId===a.unitId});a.isSelectedForEditUser=b}),this.gridApi.selection.clearSelectedRows(),setTimeout("$( '#edit-user-first-text-box' ).focus();",100)},b.prototype.onSendWelcome=function(){this.isSavingUser=!0;var a=this;this.$http.put("/api/Residents/"+this.editUser.userId+"/SendWelcome",null).success(function(){a.isSavingUser=!1,a.sentWelcomeEmail=!0}).error(function(){a.isSavingUser=!1,alert("Failed to send the welcome e-mail, please contact support if this problem persists.")})},b.prototype.populateGridUnitLabels=function(){_.each(this.residentGridOptions.data,function(a){var b=_.reduce(a.units,function(a,b){return a.length>0?a+","+b.name:b.name},"");a.unitGridLabel=b})},b.prototype.refresh=function(){
this.isLoading=!0;var a=this;this.$http.get("/api/Residents").success(function(b){if(a.isLoading=!1,a.residentGridOptions.data=b,a.residentGridOptions.minRowsToShow=b.length,a.residentGridOptions.virtualizationThreshold=b.length,a.hasOneAdmin=1===_.filter(b,function(a){return a.isSiteManager}).length&&b.length>1,a.residentSortInfo){var c=_.find(a.gridApi.grid.columns,function(b){return b.field===a.residentSortInfo.field});c&&a.gridApi.grid.sortColumn(c,a.residentSortInfo.direction,!1)}_.forEach(b,function(a){a.fullName=a.firstName+" "+a.lastName,"string"==typeof a.email&&-1!==a.email.indexOf("@condoally.com")&&(a.email=""),a.lastLoginDateUtc&&(a.lastLoginDateUtc=moment.utc(a.lastLoginDateUtc).toDate())}),a.populateGridUnitLabels(),a.allUnits||(a.isLoading=!0,a.$http.get("/api/Unit").then(function(b){a.isLoading=!1,a.allUnits=b.data,a.multiselectOptions=a.allUnits.length>20?"filter":""},function(){a.isLoading=!1,alert("Failed to retrieve your association's home listing, please contact support.")}))})},b.prototype.enableMultiHomePicker=function(){this.editUser&&(this.editUser.showAdvancedHomePicker=!0),this.multiselectMulti="multiple",this.allUnits&&this.allUnits.length>0&&null===this.allUnits[0].unitId&&this.allUnits.shift()},b.prototype.onSaveResident=function(){if(this.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid()&&(this.editUser.userId!==this.$rootScope.userInfo.userId||!this.siteInfo.userInfo.isSiteManager||this.editUser.isSiteManager||confirm("If you remove yourself as a site admin you won't be able to continue making changes. Are you sure you want to remove yourself as a site admin?")))){this.editUser.showAdvancedHomePicker||(this.editUser.units=[{unitId:this.editUser.singleUnitId}]),this.isSavingUser=!0;var a=this,b=function(b){return a.isSavingUser=!1,"string"==typeof b.data.errorMessage?void alert("Failed to add resident: "+b.data.errorMessage):(a.editUser=null,void a.refresh())},c=!1,d=function(b){a.isSavingUser=!1;var d=c?"Failed to add new resident":"Failed to update resident";b&&b.data&&b.data.exceptionMessage&&(d+=": "+b.data.exceptionMessage),alert(d)};this.editUser.userId?(c=!1,analytics.track("editResident"),this.$http.put("/api/Residents",this.editUser).then(b,d)):(c=!0,analytics.track("addNewResident"),this.$http.post("/api/Residents",this.editUser).then(b,d)),this.$cacheFactory.get("$http").remove("/api/BuildingResidents")}},b.prototype.OnAdminSetPassword=function(){var a={userName:this.adminSetPass_Username,password:this.adminSetPass_Password},b=this;this.$http.post("/api/AdminHelper/SetPassword",a).success(function(a){b.adminSetPass_ResultMessage=a}).error(function(a){var b=a.exceptionMessage?a.exceptionMessage:a;alert("Failed to set password: "+b)})},b.prototype.loadSettings=function(){var a=this;this.isLoadingSettings=!0;var b=this;this.$http.get("/api/Settings").success(function(c){b.isLoadingSettings=!1,a.residentSettings=c}).error(function(a){b.isLoadingSettings=!1,console.log("Failed to retrieve settings")})},b.prototype.exportResidentCsv=function(){"undefined"!=typeof analytics&&analytics.track("exportResidentCsv");var b=[{headerText:"First Name",fieldName:"firstName"},{headerText:"Last Name",fieldName:"lastName"},{headerText:"Phone",fieldName:"phoneNumber"},{headerText:"E-mail",fieldName:"email"},{headerText:"Unit",fieldName:"unitGridLabel"},{headerText:"Is Renter",fieldName:"isRenter"},{headerText:"Is Admin",fieldName:"isSiteManager"},{headerText:"Board Position",fieldName:"boardPosition",dataMapper:function(a){return this.getBoardPositionName(a)}},{headerText:"Last Login Date",fieldName:"lastLoginDateUtc",dataMapper:function(a){return a?moment(a).format("YYYY-MM-DD HH:mm:00"):"Has not logged-in"}}],c=a.createCsvString(this.residentGridOptions.data,b);c="data:text/csv;charset=utf-8,"+c;var d=encodeURI(c),e=document.createElement("a");e.setAttribute("href",d),e.setAttribute("download","Residents.csv"),document.body.appendChild(e),e.click(),setTimeout(function(){document.body.removeChild(e)},500)},b.prototype.saveResidentSettings=function(){analytics.track("editResidentSettings"),this.isLoadingSettings=!0;var a=this;this.$http.put("/api/Settings",this.residentSettings).success(function(){a.isLoadingSettings=!1,a.$cacheFactory.get("$http").remove("/api/BuildingResidents"),a.siteInfo.privateSiteInfo.canHideContactInfo=a.residentSettings.canHideContactInfo}).error(function(){a.isLoadingSettings=!1,alert("Failed to update settings, please try again or contact support.")})},b.prototype.onDeleteResident=function(){if(confirm("Are you sure you want to remove this person from your building?")&&(this.siteInfo.userInfo.userId!==this.editUser.userId||confirm("If you remove your own account you won't be able to login anymore. Are you still sure?"))){this.isSavingUser=!0;var a=this;this.$http["delete"]("/api/Residents?userId="+this.editUser.userId).success(function(){a.isSavingUser=!1,a.editUser=null,a.$cacheFactory.get("$http").remove("/api/BuildingResidents"),a.refresh()}).error(function(){alert("Failed to remove the resident. Please let support know if this continues to happen."),a.isSavingUser=!1,a.editUser=null})}},b.prototype.onSendAllWelcome=function(){if(confirm("This will e-mail all of the residents in your association. Do you want to proceed?")){this.isLoading=!0;var a=this;this.$http.put("/api/Residents?userId&action=launchsite",null).success(function(b){a.isLoading=!1,a.sentWelcomeEmail=!0,a.allEmailsSent=!0}).error(function(){a.isLoading=!1,alert("Failed to send welcome e-mail, please contact support if this problem persists.")})}},b.prototype.parseBulkCsv=function(){var a=$.csv,b=a.toArrays(this.bulkImportCsv);this.bulkImportRows=[];for(var c=function(a){a||(a="");var b=a.toLowerCase();return b=b.replace(/0th /g,"0 ").replace(/1st /g,"1 "),b=b.replace(/2nd /g,"2 ").replace(/3rd /g,"3 "),b=b.replace(/4th /g,"4 ").replace(/5th /g,"5 "),b=b.replace(/6th /g,"6 ").replace(/7th /g,"7 "),b=b.replace(/8th /g,"8 ").replace(/9th /g,"9 "),b=b.replace(/\./g,"").replace(/ /g,""),b=b.replace(/street/g,"st").replace(/road/g,"rd").replace(/drive/g,"dr"),b=b.replace(/place/g,"pl").replace(/avenue/g,"ave")},d=0;d<this.allUnits.length;++d)this.allUnits[d].csvTestName=c(this.allUnits[d].name);for(var d=0;d<b.length;++d){for(var e=b[d];e.length<7;)e.push("");for(var f=0;f<e.length;++f)HtmlUtil.isNullOrWhitespace(e[f])?e[f]=null:e[f]=e[f].trim();var g={unitName:e[0]||null,unitId:void 0,email:e[1],firstName:e[2],lastName:e[3],phoneNumber:e[4],isRenter:!HtmlUtil.isNullOrWhitespace(e[5]),isAdmin:!HtmlUtil.isNullOrWhitespace(e[6]),csvTestName:""};if(HtmlUtil.isNullOrWhitespace(g.unitName))g.unitId=null;else{g.csvTestName=c(g.unitName);var h=_.find(this.allUnits,function(a){return a.csvTestName===g.csvTestName});h?g.unitId=h.unitId:g.unitId=void 0}this.bulkImportRows.push(g)}},b.prototype.submitBulkRows=function(){this.isLoading=!0;var a=this;this.$http.post("/api/Residents/BulkLoad",this.bulkImportRows).success(function(){a.isLoading=!1,a.bulkImportRows=[{}],a.bulkImportCsv="",alert("Success")}).error(function(){a.isLoading=!1,alert("Bulk upload failed")})},b.prototype.addBulkRow=function(){var a={unitName:"",unitId:null,email:"",firstName:"",lastName:"",phoneNumber:"",isRenter:!1,isAdmin:!1};if(this.bulkImportRows.length>0){var b=this.bulkImportRows[this.bulkImportRows.length-1].unitId,c=_.findIndex(this.allUnits,function(a){return a.unitId===b});++c,c<this.allUnits.length&&(a.unitName=this.allUnits[c].name,a.unitId=this.allUnits[c].unitId)}this.bulkImportRows.push(a)},b.$inject=["$http","$rootScope","$interval","$cacheFactory","uiGridConstants","SiteInfo"],b}();a.ManageResidentsController=h}(Ally||(Ally={})),CA.angularApp.component("manageResidents",{templateUrl:"/ngApp/chtn/manager/manage-residents.html",controller:Ally.ManageResidentsController});var Ally;!function(a){var b=function(){function a(a,b,c,d){this.$http=a,this.siteInfo=b,this.$timeout=c,this.$scope=d}return a.prototype.$onInit=function(){this.settings={},this.defaultBGImage=$(document.documentElement).css("background-image"),this.showQaButton="president@mycondoally.com"===this.siteInfo.userInfo.emailAddress,this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl;var a=this;this.$timeout(function(){return a.hookUpFileUpload()},200),this.refreshData()},a.prototype.refreshData=function(){this.isLoading=!0;var a=this;this.$http.get("/api/Settings").then(function(b){a.isLoading=!1,a.settings=b.data})},a.prototype.removeLoginImage=function(){analytics.track("clearLoginImage"),this.isLoading=!0;var a=this;this.$http.get("/api/Settings/ClearLoginImage").then(function(){a.isLoading=!1,a.siteInfo.publicSiteInfo.loginImageUrl="",a.loginImageUrl=""},function(b){a.isLoading=!1,alert("Failed to remove loading image: "+b.data.exceptionMessage)})},a.prototype.saveSettings=function(a){void 0===a&&(a=!1),analytics.track("editSettings"),this.isLoading=!0;var b=this;this.$http.put("/api/Settings",this.settings).then(function(){b.isLoading=!1,b.siteInfo.privateSiteInfo.homeRightColumnType=b.settings.homeRightColumnType,a&&location.reload()})},a.prototype.onSiteTitleChange=function(){analytics.track("editSiteTitle"),this.isLoading=!0;this.$http.put("/api/Settings",{siteTitle:this.settings.siteTitle}).then(function(){location.reload()})},a.prototype.onWelcomeMessageUpdate=function(){analytics.track("editWelcomeMessage"),this.isLoading=!0;var a=this;this.$http.put("/api/Settings",{welcomeMessage:this.settings.welcomeMessage}).then(function(){a.isLoading=!1,a.siteInfo.privateSiteInfo.welcomeMessage=a.settings.welcomeMessage})},a.prototype.onImageClick=function(a){this.settings.bgImageFileName=a;var b=this;this.$http.put("/api/Settings",{BGImageFileName:this.settings.bgImageFileName}).then(function(){$(".test-bg-image").removeClass("test-bg-image-selected"),b.isLoading=!1})},a.prototype.onImageHoverOver=function(a){},a.prototype.onImageHoverOut=function(){},a.prototype.onQaDeleteSite=function(){this.$http.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(a){alert("Failed to delete site: "+a.data.exceptionMessage)})},a.prototype.hookUpFileUpload=function(){var a=this;$(function(){$("#JQFileUploader").fileupload({autoUpload:!0,add:function(b,c){a.$scope.$apply(function(){this.isLoading=!0}),analytics.track("setLoginImage"),$("#FileUploadProgressContainer").show(),c.url="api/DocumentUpload/LoginImage?ApiAuthToken="+a.siteInfo.authToken;var d=c.submit();d.done(function(b){a.$scope.$apply(function(){a.isLoading=!1,a.loginImageUrl=b.newUrl+"?cacheBreaker="+(new Date).getTime(),a.siteInfo.publicSiteInfo.loginImageUrl=this.loginImageUrl}),$("#FileUploadProgressContainer").hide()})},progressall:function(a,b){var c=Math.floor(100*b.loaded/b.total);$("#FileUploadProgressBar").css("width",c+"%"),100===c?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(c+"%")}})})},a.$inject=["$http","SiteInfo","$timeout","$scope"],a}();a.ChtnSettingsController=b}(Ally||(Ally={})),CA.angularApp.component("chtnSettings",{templateUrl:"/ngApp/chtn/manager/settings.html",controller:Ally.ChtnSettingsController});var Ally;!function(a){var b=function(){function a(a){this.siteInfo=a,this.hideDocuments=!1,this.hideVendors=!1}return a.prototype.$onInit=function(){this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideVendors="neighborhood"===AppConfig.appShortName,this.hideDocuments?this.selectedView="info":this.selectedView="docs"},a.$inject=["SiteInfo"],a}();a.AssociationInfoController=b}(Ally||(Ally={})),CA.condoAllyControllers.directive("contenteditable",["$sce",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){function f(){var a=c.html();d.stripBr&&"<br>"===a&&(a=""),e.$setViewValue(a)}e&&(e.$render=function(){c.html(a.getTrustedHtml(e.$viewValue||""))},c.on("blur keyup change",function(){b.$evalAsync(f)}),f())}}}]),CA.angularApp.filter("highlight",function(a){return function(b,c){return b=b||"",c&&(b=b.replace(new RegExp("("+c+")","gi"),'<span class="fileSearchHighlight">$1</span>')),a.trustAsHtml(b)}}),CA.angularApp.component("associationInfo",{templateUrl:"/ngApp/chtn/member/association-info.html",controller:Ally.AssociationInfoController});var Ally;!function(a){var b=function(){function a(a,b,c,d,e){this.$http=a,this.$rootScope=b,this.siteInfo=c,this.$timeout=d,this.$scope=e}return a.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.canMakePayment=this.siteInfo.privateSiteInfo.isPaymentEnabled&&!this.siteInfo.userInfo.isRenter,this.canSendEmail=this.siteInfo.privateSiteInfo.canSendEmail,this.cantDoAnything=!(this.canMakePayment||this.canSendEmail),this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.allyAppName=AppConfig.appName,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");var a=(HtmlUtil.getSubdomain(window.location.host),this);this.$scope.$on("homeHasActivePolls",function(){return a.shouldShowAlertSection=!0})},a.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},a.$inject=["$http","$rootScope","SiteInfo","$timeout","$scope"],a}();a.ChtnHomeController=b}(Ally||(Ally={})),CA.angularApp.component("chtnHome",{templateUrl:"/ngApp/chtn/member/chtn-home.html",controller:Ally.ChtnHomeController});var Ally;!function(a){var b=function(){function a(){}return a}(),c=function(){function a(a,c,d,e){this.$scope=a,this.$timeout=c,this.$http=d,this.siteInfo=e,this.editingTip=new b,this.hoaHomes=[],this.tips=[],this.isLoading=!1}return a.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager;var a=void 0;if(this.siteInfo.privateSiteInfo.googleGpsPosition){var b=40234,c=new google.maps.Circle({center:this.siteInfo.privateSiteInfo.googleGpsPosition,radius:b});a={bounds:c.getBounds()}}var d=document.getElementById("edit-location-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(d,a);var e=this;google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var a=e.addressAutocomplete.getPlace();e.editingTip.address=a.formatted_address}),"hoa"===AppConfig.appShortName?this.retrieveHoaHomes():this.refresh();var e=this;this.$timeout(function(){return e.getWalkScore()},1e3),MapCtrlMapMgr.Init(this.siteInfo,this.$scope,this)},a.prototype.refresh=function(){this.isLoading=!0;var a=this;this.$http.get("/api/WelcomeTip").then(function(b){a.tips=b.data,MapCtrlMapMgr.ClearAllMarkers(),"condo"===AppConfig.appShortName&&MapCtrlMapMgr.AddMarker(MapCtrlMapMgr._homeGpsPos.lat(),MapCtrlMapMgr._homeGpsPos.lng(),"Home",MapCtrlMapMgr.MarkerNumber_Home);for(var c=0;c<a.tips.length;++c){var d=a.tips[c];null!==d.gpsPos&&(d.markerIndex=MapCtrlMapMgr.AddMarker(d.gpsPos.lat,d.gpsPos.lon,d.name,d.markerNumber))}_.each(a.hoaHomes,function(a){a.fullAddress&&a.fullAddress.gpsPos&&MapCtrlMapMgr.AddMarker(a.fullAddress.gpsPos.lat,a.fullAddress.gpsPos.lon,a.name,MapCtrlMapMgr.MarkerNumber_Home)}),MapCtrlMapMgr.OnMarkersReady(),a.isLoading=!1})},a.prototype.onEditTip=function(a){this.editingTip=jQuery.extend({},a),window.scrollTo(0,document.body.scrollHeight)},a.prototype.onMoveMarker=function(a){MapCtrlMapMgr.SetMarkerDraggable(a.markerIndex,!0)},a.prototype.onDeleteTip=function(a){if(confirm("Are you sure you want to delete this item?")){this.isLoading=!0;var b=this;this.$http["delete"]("/api/WelcomeTip/"+a.itemId).then(function(){b.isLoading=!1,b.refresh()})}},a.prototype.onSaveTip=function(){if(null!==this.editingTip){var a=this,c=function(){a.isLoading=!1,a.editingTip=new b,a.refresh()};this.isLoading=!0,this.editingTip.itemId?this.$http.put("/api/WelcomeTip",this.editingTip).then(c):this.$http.post("/api/WelcomeTip",this.editingTip).then(c)}},a.prototype.isLocationTip=function(a){return null!==a.gpsPos},a.prototype.isNotLocationTip=function(a){return null===a.gpsPos},a.prototype.getMarkerIconUrl=function(a){var b=-2,c=-3,d=-4,e="/assets/images/MapMarkers/";return a>=1&&10>=a?e+="green_"+a:a===b?e+="MapMarker_Home":a===c?e+="MapMarker_Hospital":a===d&&(e+="MapMarker_PostOffice"),e+=".png"},a.prototype.updateItemGpsLocation=function(a,b,c){var d=_.find(this.tips,function(b){return b.markerIndex===a}),e={itemId:d.itemId,newLat:b,newLon:c};this.isLoading=!0;var f=this;this.$http.put("/api/WelcomeTip/UpdateGpsLocation",e).then(function(){f.isLoading=!1})},a.prototype.getWalkScore=function(){var a=function(a){a&&a.data&&"Error"!==a.data?$("#WalkScorePanel").html(a.data):($("#WalkScorePanel").html("Failed to load Walk Score."),$("#WalkScorePanel").hide())};this.$http.get("/api/WelcomeTip/GetWalkScore").then(a,a)},a.prototype.retrieveHoaHomes=function(){var a=this;this.$http.get("/api/BuildingResidents/FullUnits").then(function(b){a.hoaHomes=b.data,a.refresh()},function(){a.refresh()})},a.$inject=["$scope","$timeout","$http","SiteInfo"],a}();a.ChtnMapController=c}(Ally||(Ally={})),CA.angularApp.component("chtnMap",{templateUrl:"/ngApp/chtn/member/chtn-map.html",controller:Ally.ChtnMapController});var MapCtrlMapMgr=function(){function a(){}return a.Init=function(b,c,d){if(a.ngScope=c,a.mapCtrl=d,"undefined"!=typeof google){a._homeGpsPos=b.privateSiteInfo.googleGpsPosition,a._groupGpsBounds=b.publicSiteInfo.gpsBounds;var e={center:a._homeGpsPos,zoom:25,mapTypeId:google.maps.MapTypeId.ROADMAP};a._mainMap=new google.maps.Map(document.getElementById("map_canvas"),e),"condo"===AppConfig.appShortName&&a.AddMarker(a._homeGpsPos.lat(),a._homeGpsPos.lng(),"Home",a.MarkerNumber_Home),a.OnMapReady()}},a.OnMapReady=function(){a._isMapReady=!0,a._areMarkersReady&&a.OnMapAndMarkersReady()},a.OnMarkersReady=function(){a._areMarkersReady=!0,a._isMapReady&&a.OnMapAndMarkersReady()},a.OnMapAndMarkersReady=function(){for(var b=0;b<a._tempMarkers.length;++b){var c=a._tempMarkers[b],d=null;c.markerNumber>=1&&c.markerNumber<=10?d="/assets/images/MapMarkers/green_"+c.markerNumber+".png":c.markerNumber===a.MarkerNumber_Home?d="/assets/images/MapMarkers/MapMarker_Home.png":c.markerNumber===a.MarkerNumber_Hospital?d="/assets/images/MapMarkers/MapMarker_Hospital.png":c.markerNumber===a.MarkerNumber_PostOffice&&(d="/assets/images/MapMarkers/MapMarker_PostOffice.png");var e=new google.maps.Marker({position:new google.maps.LatLng(c.lat,c.lon),map:a._mainMap,animation:google.maps.Animation.DROP,title:c.name,icon:d});e.markerIndex=b,google.maps.event.addListener(e,"dragend",function(){var b=this,c=b.getPosition();a.ngScope.$apply(function(){a.mapCtrl.updateItemGpsLocation(b.markerIndex,c.lat(),c.lng())})}),a._markers.push(e)}if(a._tempMarkers=[],a._groupGpsBounds){var f=Ally.MapUtil.gpsBoundsToGooglePoly(a._groupGpsBounds),g={paths:f,map:a._mainMap,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1};a._groupBoundsShape=new google.maps.Polygon(g)}a.ZoomMapToFitMarkers()},a.ClearAllMarkers=function(){for(var b=0;b<a._markers.length;b++)a._markers[b].setMap(null);a._markers=[]},a.SetMarkerDraggable=function(b,c){a._markers[b].setDraggable(c)},a.AddMarker=function(b,c,d,e){return a._tempMarkers.push({lat:b,lon:c,name:d,markerNumber:e}),a._tempMarkers.length-1},a.ZoomMapToFitMarkers=function(){for(var b=new google.maps.LatLngBounds,c=0;c<a._markers.length;++c)b.extend(a._markers[c].getPosition());if(a._groupBoundsShape)for(var d=a._groupBoundsShape.getPath(),e=0;e<d.getLength();++e)b.extend(d.getAt(e));a._mainMap.fitBounds(b)},a._mainMap=null,a._homeGpsPos=null,a._groupGpsBounds=null,a._groupBoundsShape=null,a._markers=[],a.MarkerNumber_Home=-2,a.MarkerNumber_Hospital=-3,a.MarkerNumber_PostOffice=-4,a._isMapReady=!1,a._areMarkersReady=!1,a._tempMarkers=[],a.ngScope=null,a.mapCtrl=null,a}(),Ally;!function(a){var b=function(){function a(a,b){this.$http=a,this.appCacheService=b,this.isLoading=!1,this.loginInfo={},this.shouldHideControls=!1}return a.prototype.$onInit=function(){this.loginInfo={},this.loginInfo.emailAddress=this.appCacheService.getAndClear("forgotEmail")},a.prototype.onSubmitEmail=function(){this.isLoading=!0;var a=this;this.$http.post("/api/Login/Forgot",this.loginInfo).then(function(){a.shouldHideControls=!0,a.isLoading=!1,a.resultText="Please check your e-mail for updated login information.",a.resultTextColor="#00F"},function(b){a.isLoading=!1,a.resultText="Failed to process your request: "+b.data,a.resultTextColor="#F00"})},a.$inject=["$http","appCacheService"],a}();a.ForgotPasswordController=b}(Ally||(Ally={})),CA.angularApp.component("forgotPassword",{templateUrl:"/ngApp/chtn/member/forgot-password.html",controller:Ally.ForgotPasswordController});var Ally;!function(a){var b=function(){function a(a,b){this.fellowResidents=a,this.siteInfo=b,this.isLoading=!0,this.allyAppName=AppConfig.appName,this.groupShortName=HtmlUtil.getSubdomain(),this.showMemberList="neighborhood"===AppConfig.appShortName,this.showGroupEmailInfo=b.privateSiteInfo.canSendEmail}return a.prototype.$onInit=function(){this.emailLists={board:[],discussion:[],owners:[],renters:[],residentOwners:[],nonResidentOwners:[],residentOwnersAndRenters:[],propertyManagers:[],everyone:[]};var a=this;this.fellowResidents.getByUnitsAndResidents().then(function(b){if(a.isLoading=!1,a.unitList=b.byUnit,a.allResidents=b.residents,a.allResidents=_.sortBy(a.allResidents,function(a){return a.lastName}),a.boardMembers=_.filter(b.residents,function(a){return 0!==a.boardPosition}),a.boardMessageRecipient=null,a.boardMembers.length>0){var c=_.some(a.boardMembers,function(a){return a.hasEmail});c&&(a.boardMessageRecipient={fullName:"Entire Board",firstName:"everyone on the board",hasEmail:!0,userId:"af615460-d92f-4878-9dfa-d5e4a9b1f488"})}"neighborhood"===AppConfig.appShortName&&(a.allResidents=_.filter(a.allResidents,function(a){return 0===a.boardPosition}));for(var d=[{id:0,name:"None"},{id:1,name:"President"},{id:2,name:"Treasurer"},{id:4,name:"Secretary"},{id:8,name:"Director"},{id:16,name:"Vice President"},{id:32,name:"Property Manager"}],e=0;e<a.boardMembers.length;++e)a.boardMembers[e].boardPositionName=_.find(d,function(b){return b.id===a.boardMembers[e].boardPosition}).name;var f=[1,16,2,4,8,32];a.boardMembers=_.sortBy(a.boardMembers,function(a){var b=_.indexOf(f,a.boardPosition);return-1===b&&(b=100),b});var g=function(a,b){return Array.prototype.push.apply(a,b.owners),a};a.allOwners=_.reduce(a.unitList,g,[]),a.allOwners=_.map(_.groupBy(a.allOwners,function(a){return a.email}),function(a){return a[0]}),a.allOwnerEmails=_.reduce(a.allOwners,function(a,b){return HtmlUtil.isValidString(b.email)&&a.push(b.email),a},[]);var h=_.every(a.unitList,function(a){return HtmlUtil.isNumericString(a.name)});h&&(a.unitList=_.sortBy(a.unitList,function(a){return+a.name})),a.setupGroupEmails()})},a.prototype.setupGroupEmails=function(){this.hasMissingEmails=_.some(this.allResidents,function(a){return!a.hasEmail}),this.fellowResidents.setupGroupEmailObject(this.allResidents,this.unitList,this.emailLists),"neighborhood"===AppConfig.appShortName&&delete this.emailLists.owners,setTimeout(function(){var a=new Clipboard(".clipboard-button"),b=function(a,b){$(a).qtip({style:{classes:"qtip-light qtip-shadow"},position:{my:"leftMiddle",at:"rightMiddle"},content:{text:b},events:{hide:function(a){$(a.originalEvent.currentTarget).qtip("destroy")}}}),$(a).qtip("show")};a.on("success",function(a){b(a.trigger,"Copied!"),a.clearSelection()}),a.on("error",function(a){b(a.trigger,"Auto-copy failed, press CTRL+C now")})},750)},a.$inject=["fellowResidents","SiteInfo"],a}();a.GroupMembersController=b}(Ally||(Ally={})),CA.angularApp.component("groupMembers",{templateUrl:"/ngApp/chtn/member/group-members.html",controller:Ally.GroupMembersController});var Ally;!function(a){var b=function(){function a(){}return a}(),c=function(){function a(a,c){this.$http=a,this.siteInfo=c,this.sendInfo=new b,this.isLoading=!1,this.wasMessageSent=!1,this.onSendHelp=function(){if($("#help-form").validate(),$("#help-form").valid()){this.isLoading=!0;var a=this;this.$http.post("/api/Help",this.sendInfo).then(function(){a.isLoading=!1,a.sendInfo={},a.wasMessageSent=!0,a.resultStyle.color="#00F",a.sendResult="Your message has been sent. We'll do our best to get back to you within 24 hours."},function(){a.isLoading=!1,a.resultStyle.color="#F00",a.sendResult="Failed to send message."})}},this.resultStyle={"text-align":"center","font-size":"large","font-weight":"bold"}}return a.prototype.$onInit=function(){this.siteInfo.isLoggedIn&&(this.sendInfo.emailAddress=this.siteInfo.userInfo.emailAddress)},a.$inject=["$http","SiteInfo"],a}();a.HelpFormController=c}(Ally||(Ally={})),CA.angularApp.component("helpForm",{templateUrl:"/ngApp/chtn/member/Help.html",controller:Ally.HelpFormController});var Ally;!function(a){var b=function(){function a(a,b,c,d,e,f){this.$scope=a,this.$timeout=b,this.$http=c,this.$rootScope=d,this.$q=e,this.fellowResidents=f,this.showBadNotificationDateWarning=!1,this.isLoadingNews=!1,this.isLoadingLogbookForCalendar=!1,this.isLoadingPolls=!1,this.isLoadingCalendarEvents=!1,this.onlyRefreshCalendarEvents=!1,this.showExpandedCalendarEventModel=!1,this.onResidentClicked=function(a){if(!a.hasEmail)return alert("That user cannot be included because they do not have an e-mail address on file."),void(a.isAssociated=!1);var b=_.contains(this.editEvent.associatedUserIds,a.userId);b?this.editEvent.associatedUserIds=_.without(this.editEvent.associatedUserIds,a.userId):this.editEvent.associatedUserIds.push(a.userId)},this.clearViewEvent=function(){this.viewEvent=null}}return a.prototype.$onInit=function(){var b=this;this.fellowResidents.getResidents().then(function(a){b.residents=a,b.residents=_.sortBy(b.residents,function(a){return a.lastName})});var c={height:600,editable:!1,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},viewRender:function(a,b){$(b).css("cursor","pointer")},dayClick:function(c){if(b.$rootScope.isSiteManager){var d=moment(moment.utc(c).format(a.DateFormat)).toDate();b.$scope.$apply(function(){var a=null,c={date:d,dateOnly:d,associatedUserIds:[],notificationEmailDaysBefore:a};b.setEditEvent(c,!1)})}},eventClick:function(a){b.$scope.$apply(function(){a.calendarEventObject&&(b.$rootScope.isSiteManager?b.setEditEvent(a.calendarEventObject,!0):b.viewEvent=a.calendarEventObject)})},eventRender:function(a,b){$(b).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:a.fullDescription,title:a.toolTipTitle}})},eventSources:[{events:function(a,c,d,e){b.getAssociationEvents(a,c,d,e)}},{events:function(a,c,d,e){b.getCalendarEvents(a,c,d,e)}}]};$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(c),$("#calendar-event-time").timepicker({scrollDefault:"10:00am"}),$(".fc-bg td.fc-today").append("<div class='today-note'>Today</div>")})},a.prototype.getAllEvents=function(b,c){var d=!1,e=!0,f=!0,g=b.format(a.DateFormat),h=c.format(a.DateFormat),i=this.$q.defer(),j=this.$q.defer(),k=this.$q.defer();if(d){this.isLoadingNews=!0;var l=this;this.$http.get("/api/News?startDate="+g+"&endDate="+h).then(function(a){var b=a.data;l.isLoadingNews=!1,_.each(b,function(a){var b=a.text;b.length>10&&(b=b.substring(0,10)+"...");var c="Posted by: "+a.authorName+"<br><p>"+a.text+"</p>";l.calendarEvents.push({title:"Notice: "+b,start:a.postDate.substring(0,10),toolTipTitle:"Notice Added",fullDescription:c})}),i.resolve()},function(){l.isLoadingNews=!1,i.resolve()})}else i.resolve();if(e){this.isLoadingLogbookForCalendar=!0;var l=this;this.$http.get("/api/Logbook?startDate="+g+"&endDate="+h).then(function(a){var b=a.data;l.isLoadingLogbookForCalendar=!1,_.each(b,function(a){var b=a.text;b.length>10&&(b=b.substring(0,10)+"...");var c="Posted by: "+a.authorName+"<br><p>"+a.text+"</p>";l.calendarEvents.push({title:"Logbook: "+b,start:a.postDate.substring(0,10),toolTipTitle:"Logbook Entry Added",fullDescription:c})}),j.resolve()},function(){l.isLoadingLogbookForCalendar=!1,j.resolve()})}if(f){this.isLoadingPolls=!0;var l=this;this.$http.get("/api/Poll?startDate="+g+"&endDate="+h).then(function(a){var b=a.data;l.isLoadingPolls=!1,_.each(b,function(a){var b=a.text;b.length>10&&(b=b.substring(0,10)+"...");var c="Posted by: "+a.authorName+"<br><p>"+a.text+"</p>";l.calendarEvents.push({title:"Poll: "+b,start:a.postDate.substring(0,10),toolTipTitle:"Poll Added",fullDescription:c})}),k.resolve()},function(){l.isLoadingPolls=!1,k.resolve()})}return this.$q.all([i.promise,j.promise,k.promise])},a.prototype.getAssociationEvents=function(a,b,c,d){if(this.onlyRefreshCalendarEvents)return this.onlyRefreshCalendarEvents=void 0,void d(this.calendarEvents);this.calendarEvents=[];var e=this;this.getAllEvents(a,b).then(function(){d(e.calendarEvents)})},a.prototype.getCalendarEvents=function(b,c,d,e){this.isLoadingCalendarEvents=!0;var f=b.format(a.DateFormat),g=c.format(a.DateFormat),h=this;this.$http.get("/api/CalendarEvent?startDate="+f+"&endDate="+g).then(function(b){var c=b.data,d=[];h.isLoadingCalendarEvents=!1,_.each(c,function(b){var c,e=moment.utc(b.eventDateUtc),f=e.format(a.TimeFormat),g=f==a.NoTime;if(g)b.timeOnly="",b.dateOnly=new Date(e.year(),e.month(),e.date()),c=new Date(e.year(),e.month(),e.date());else{var h=moment.utc(b.eventDateUtc).local();b.timeOnly=h.format(a.TimeFormat),b.dateOnly=h.clone().startOf("day").toDate(),c=h.toDate()}var i=b.title;i&&i.length>10&&(i=i.substring(0,10)+"...");var j="Posted by: "+b.authorName+"<br><p>"+b.title+"</p>";d.push({title:i,start:c,toolTipTitle:"Event",fullDescription:j,calendarEventObject:b,allDay:g})}),e(d)},function(){h.isLoadingCalendarEvents=!1})},a.prototype.isUserAssociated=function(a){return this.editEvent&&this.editEvent.associatedUserIds?_.contains(this.editEvent.associatedUserIds,a):!1},a.prototype.isDateInPast=function(a){var b=moment(a),c=moment();return b.isBefore(c,"day")||b.isSame(c,"day")},a.prototype.onShouldSendChange=function(){this.editEvent.shouldSendNotification&&this.isDateInPast(this.editEvent.dateOnly)&&(this.editEvent.shouldSendNotification=!1)},a.prototype.onChangeEmailDaysBefore=function(){var a=moment(this.editEvent.dateOnly).subtract(this.editEvent.notificationEmailDaysBefore,"day"),b=moment();if(this.showBadNotificationDateWarning=a.isBefore(b,"day")||a.isSame(b,"day"),this.showBadNotificationDateWarning){this.maxDaysBack=moment(this.editEvent.dateOnly).diff(b,"day"),this.editEvent.notificationEmailDaysBefore=this.maxDaysBack;var c=this;this.$timeout(function(){c.showBadNotificationDateWarning=!1},1e4)}},a.prototype.expandCalendarEventModel=function(){this.showExpandedCalendarEventModel=!0},a.prototype.setEditEvent=function(a,b){if(this.showExpandedCalendarEventModel=b||!1,this.editEvent=a,this.showBadNotificationDateWarning=!1,this.editEvent){var c=this;_.each(this.residents,function(a){a.isAssociated=c.isUserAssociated(a.userId)}),this.editEvent.shouldSendNotification=null!==this.editEvent.notificationEmailDaysBefore,setTimeout(function(){$("#calendar-event-title").focus()},10)}},a.prototype.deleteCalendarEvent=function(a){if(confirm("Are you sure you want to remove this event?")){this.isLoadingCalendarEvents=!0;var b=this;this.$http["delete"]("/api/CalendarEvent?eventId="+a).then(function(){b.isLoadingCalendarEvents=!1,b.editEvent=null,b.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){b.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")})}},a.prototype.saveCalendarEvent=function(){var b=_.filter(this.residents,function(a){return a.isAssociated});this.editEvent.associatedUserIds=_.map(b,function(a){return a.userId});var c="";"string"==typeof this.editEvent.timeOnly&&this.editEvent.timeOnly.length>1?(c=moment(this.editEvent.dateOnly).format(a.DateFormat)+" "+this.editEvent.timeOnly,
this.editEvent.eventDateUtc=moment(c,a.DateFormat+" "+a.TimeFormat).utc().toDate()):(c=moment(this.editEvent.dateOnly).format(a.DateFormat)+" "+a.NoTime,this.editEvent.eventDateUtc=moment.utc(c,a.DateFormat+" "+a.TimeFormat).toDate()),this.editEvent.shouldSendNotification||(this.editEvent.notificationEmailDaysBefore=null);var d;d=this.editEvent.eventId?this.$http.put:this.$http.post,analytics.track("addCalendarEvent"),this.isLoadingCalendarEvents=!0;var e=this;d("/api/CalendarEvent",this.editEvent).then(function(){e.isLoadingCalendarEvents=!1,e.editEvent=null,e.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(a){e.isLoadingCalendarEvents=!1;var b=a.data.exceptionMessage?a.data.exceptionMessage:a.data;alert("Failed to save the calendar event: "+b)})},a.$inject=["$scope","$timeout","$http","$rootScope","$q","fellowResidents"],a.DateFormat="YYYY-MM-DD",a.TimeFormat="h:mma",a.NoTime="12:37am",a}();a.LogbookController=b}(Ally||(Ally={})),CA.angularApp.component("logbookPage",{templateUrl:"/ngApp/chtn/member/logbook.html",controller:Ally.LogbookController});var Ally;!function(a){var b=function(){function a(a,b,c,d,e,f){this.$http=a,this.$rootScope=b,this.$location=c,this.appCacheService=d,this.siteInfo=e,this.xdLocalStorage=f,this.isDemoSite=!1,this.loginInfo={}}return a.prototype.$onInit=function(){HtmlUtil.isLocalStorageAllowed()||(this.loginResult="You have cookies/local storage disabled. Condo Ally requires these features, please enable to continue. You may be in private browsing mode.");var a=navigator.userAgent.toLowerCase(),b=-1!=a.indexOf("msie")?parseInt(a.split("msie")[1]):0;b>0&&10>b&&(document.getElementById("bad-browser-panel").style.display="block"),this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),"1"===HtmlUtil.GetQueryStringParameter("s")&&(this.isDemoSite=!1),this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl,this.sectionStyle={position:"relative"},this.isDemoSite||(this.sectionStyle.left="50%",this.loginImageUrl?(this.sectionStyle.width="760px",this.sectionStyle["margin-left"]="-380px"):(this.sectionStyle.width="450px",this.sectionStyle["margin-left"]="-225px")),"true"===this.appCacheService.getAndClear(this.appCacheService.Key_WasLoggedIn403)?this.$rootScope.isSiteManager?this.loginResult="You are not authorized to perform that action. Please contact support.":this.loginResult="You are not authorized to perform that action. Please contact an admin.":"true"===this.appCacheService.getAndClear(this.appCacheService.Key_WasLoggedIn401)&&(this.loginResult="Please login first."),setTimeout(function(){$("#login-email-textbox").focus()},200)},a.prototype.onForgotPassword=function(){this.appCacheService.set("forgotEmail",this.loginInfo.emailAddress),this.$location.path("/ForgotPassword")},a.prototype.demoLogin=function(){this.loginInfo={emailAddress:"testuser",password:"demosite"},this.onLogin()},a.prototype.onLogin=function(){this.isLoading=!0;var a=this;this.$http.post("/api/Login",this.loginInfo).then(function(b){a.isLoading=!1;var c=b.data,d=a.appCacheService.getAndClear(a.appCacheService.Key_AfterLoginRedirect);a.siteInfo.setAuthToken(c.authToken),a.siteInfo.handleSiteInfo(c.siteInfo,a.$rootScope),a.rememberMe?(window.localStorage.rememberMe_Email=a.loginInfo.emailAddress,window.localStorage.rememberMe_Password=btoa(a.loginInfo.password)):(window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null),null!==c.siteInfo.userInfo.acceptedTermsDate||a.isDemoSite?(HtmlUtil.isValidString(d)||"/Login"===d||(d="/Home"),a.$location.path(d)):a.$location.path("/MyProfile")},function(b){a.isLoading=!1;var c=b.data.exceptionMessage?b.data.exceptionMessage:b.data;a.loginResult="Failed to log in: "+c})},a.$inject=["$http","$rootScope","$location","appCacheService","SiteInfo","xdLocalStorage"],a}();a.LoginController=b}(Ally||(Ally={})),CA.angularApp.component("loginPage",{templateUrl:"/ngApp/chtn/member/login.html",controller:Ally.LoginController});var Ally;!function(a){var b=function(){function a(a,b,c,d,e){this.$rootScope=a,this.$http=b,this.$location=c,this.appCacheService=d,this.siteInfo=e}return a.prototype.$onInit=function(){this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),this.siteInfo.privateSiteInfo&&(this.canHideContactInfo=this.siteInfo.privateSiteInfo.canHideContactInfo),this.retrieveItems()},a.prototype.retrieveItems=function(){this.isLoading=!0;var a=this;this.$http.get("/api/MyProfile").then(function(b){a.isLoading=!1,a.profileInfo=b.data,HtmlUtil.endsWith(a.profileInfo.email,"@condoally.com")&&(a.profileInfo.email=""),a.needsToAcceptTerms=null===a.profileInfo.acceptedTermsDate&&!this.isDemoSite,a.hasAcceptedTerms=!a.needsToAcceptTerms,a.$rootScope.hideMenu=a.needsToAcceptTerms,a.saveButtonStyle={width:"100px","font-size":"1em"}})},a.prototype.onSaveInfo=function(){this.isLoading=!0;var a=this;this.$http.put("/api/MyProfile",this.profileInfo).then(function(){a.resultMessage="Your changes have been saved.",a.$rootScope.hideMenu&&(a.$rootScope.hideMenu=!1,a.$location.path("/Home")),a.isLoading=!1},function(b){a.isLoading=!1,alert("Failed to save: "+b.data.exceptionMessage)})},a.$inject=["$rootScope","$http","$location","appCacheService","SiteInfo"],a}();a.MyProfileController=b}(Ally||(Ally={})),CA.angularApp.component("myProfile",{templateUrl:"/ngApp/chtn/member/my-profile.html",controller:Ally.MyProfileController});var Ally;!function(a){var b=function(){function a(a,b,c,d){this.$scope=a,this.$http=b,this.$timeout=c,this.WizardHandler=d,this.unitNumberingType="Numbered",this.numUnits=3,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.signUpInfo={buildings:[{units:[]}],signerUpInfo:{buildingIndex:0,boardPositionValue:"1"}}}return a.prototype.$onInit=function(){var a=this,b=function(){a.init()};this.$timeout(b,500)},a.prototype.onNumUnitsChanged=function(){if(this.numUnits){this.numUnits<1?this.numUnits=1:this.numUnits>100&&(this.numUnits=100);var a=this.numUnits-this.signUpInfo.buildings[0].units.length;if(this.signUpInfo.buildings[0].units.length=this.numUnits,a>0)for(var b=this.numUnits-a;b<this.numUnits;++b)this.signUpInfo.buildings[0].units[b]={name:this.getUnitName(b),residents:[{}]}}},a.prototype.addResident=function(a){a.residents||(a.residents=[]),a.residents.push({})},a.prototype.getUnitName=function(a){if("Numbered"===this.unitNumberingType)return(a+1).toString();if("Lettered"===this.unitNumberingType){var b="",c=Math.floor(a/26);c>0&&(b+=String.fromCharCode("A".charCodeAt(0)+(c-1)));var d=a%26;return b+=String.fromCharCode("A".charCodeAt(0)+d)}return"EW"===this.unitNumberingType||"NS"===this.unitNumberingType?a%2==0?(a/2+1).toString()+("EW"===this.unitNumberingType?"E":"N"):Math.ceil(a/2).toString()+("EW"===this.unitNumberingType?"W":"S"):(a+1).toString()},a.prototype.onNumberingTypeChange=function(){for(var a=0;a<this.signUpInfo.buildings[0].units.length;++a)this.signUpInfo.buildings[0].units[a]||(this.signUpInfo.buildings[0].units[a]={}),this.signUpInfo.buildings[0].units[a].name=this.getUnitName(a)},a.prototype.centerMap=function(a){a.viewport?this.map.fitBounds(a.viewport):(this.map.setCenter(a.location),this.map.setZoom(17)),this.mapMarker.setPosition(a.location),this.mapMarker.setVisible(!0)},a.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var a=this;setTimeout(function(){a.placeWasSelected=!0},500)},a.prototype.init=function(){"undefined"!=typeof window.analytics&&window.analytics.track("condoSignUpStarted");var a=document.getElementById("address-map");this.map=new google.maps.Map(a,{center:{lat:41.869638,lng:-87.657423},zoom:9});var b=document.getElementById("building-0-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(b),this.addressAutocomplete.bindTo("bounds",this.map),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"});var c=this;this.addressAutocomplete.addListener("place_changed",function(){c.setPlaceWasSelected(),c.mapMarker.setVisible(!1);var a=c.addressAutocomplete.getPlace(),b=a.formatted_address;b.indexOf(", USA")===b.length-", USA".length&&(b=b.substring(0,b.length-", USA".length)),c.signUpInfo.buildings[0].streetAddress=b,HtmlUtil.isNullOrWhitespace(c.signUpInfo.name)&&c.$scope.$apply(function(){c.signUpInfo.name=a.name+" Condo Association"}),a.geometry&&(c.centerMap(a.geometry),$("#association-name-text-box").focus())}),c.onNumUnitsChanged()},a.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForBuildingAddress())},a.prototype.refreshMapForBuildingAddress=function(){this.isLoadingMap=!0;var a=this;HtmlUtil.geocodeAddress(this.signUpInfo.buildings[0].streetAddress,function(b,c){a.$scope.$apply(function(){if(a.isLoadingMap=!1,c==google.maps.GeocoderStatus.OK){var d=b[0].formatted_address;if(d.indexOf(", USA")===d.length-", USA".length&&(d=d.substring(0,d.length-", USA".length)),a.signUpInfo.buildings[0].streetAddress=d,a.centerMap(b[0].geometry),HtmlUtil.isNullOrWhitespace(a.signUpInfo.name)){var e=HtmlUtil.getStringUpToFirst(d,",");a.signUpInfo.name=e+" Condo Association"}}})})},a.prototype.addBuilding=function(){var a=25;return this.signUpInfo.buildings.length+1>=a?void alert("We do not support more than "+a+" buildings."):void this.signUpInfo.buildings.push({})},a.prototype.onFinishedWizard=function(){this.isLoading=!0;var a=this;this.$http.post("/api/SignUpWizard",this.signUpInfo).then(function(b){a.isLoading=!1;var c=b.data;HtmlUtil.isNullOrWhitespace(c.errorMessage)?("undefined"!=typeof window.analytics&&window.analytics.track("condoSignUpComplete"),"undefined"!=typeof window.goog_report_conversion&&window.goog_report_conversion(),HtmlUtil.isNullOrWhitespace(c.createUrl)?(a.hideWizard=!0,a.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=c.createUrl):(alert("Failed to complete sign-up: "+c.errorMessage),a.WizardHandler.wizard().goTo(c.stepIndex))},function(b){a.isLoading=!1;var c=b.data.exceptionMessage?b.data.exceptionMessage:b.data;alert("Failed to complete sign-up: "+c)})},a.$inject=["$scope","$http","$timeout","WizardHandler"],a}();a.CondoSignUpWizardController=b}(Ally||(Ally={})),CA.angularApp.component("condoSignUpWizard",{templateUrl:"/ngApp/chtn/public/condo-sign-up-wizard.html",controller:Ally.CondoSignUpWizardController});var Ally;!function(a){var b=function(){function a(){}return a}();a.DiscussionThread=b;var c=function(){function a(a,b){this.$http=a,this.$routeParams=b,this.isLoading=!1,this.activeView="loading"}return a.prototype.$onInit=function(){this.unsubscribeUser()},a.prototype.loadDiscussion=function(){var a=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0;var b=this;this.$http.get("/Discussion/"+a).then(function(a){b.isLoading=!1,b.discussion=a.data},function(a){b.isLoading=!1,b.errorMessage="Failed to find the discussion details. Please contact support to alert them to the issue."})},a.prototype.unsubscribeUser=function(){var a=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0,this.activeView="loading";var b=this;this.$http.put("/api/Discussion/Unsubscribe/"+a,null).then(function(a){b.isLoading=!1,b.activeView="unsubscribed",b.discussion=a.data},function(a){b.isLoading=!1,b.activeView="error",b.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},a.prototype.resubscribeUser=function(){var a=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0,this.activeView="loading";var b=this;this.$http.put("/api/Discussion/Resubscribe/"+a,null).then(function(a){b.isLoading=!1,b.activeView="resubscribed"},function(a){b.isLoading=!1,b.activeView="error",b.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},a.$inject=["$http","$routeParams"],a}();a.DiscussionManageController=c}(Ally||(Ally={})),CA.angularApp.component("discussionManage",{templateUrl:"/ngApp/chtn/public/discussion-manage.html",controller:Ally.DiscussionManageController});var Ally;!function(a){var b=function(){function a(a,b){this.$http=a,this.$routeParams=b,this.isLoading=!1,this.showButtons=!0}return a.prototype.$onInit=function(){},a.prototype.reportAbuse=function(a){var b=decodeURIComponent(this.$routeParams.idValue),c={abuseReason:a,idVal:b,otherReasonText:this.otherReasonText};this.isLoading=!0;var d=this;this.$http.post("/api/EmailAbuse/v3",c).then(function(){d.isLoading=!1,d.showButtons=!1})},a.$inject=["$http","$routeParams"],a}();a.EmailAbuseController=b}(Ally||(Ally={})),CA.angularApp.component("emailAbuse",{templateUrl:"/ngApp/chtn/public/email-abuse.html",controller:Ally.EmailAbuseController});var Ally;!function(a){var b=function(){function a(){this.boardPositionValue=1}return a}();a.HoaSignerUpInfo=b;var c=function(){function a(){this.name="",this.streetAddress="",this.isResident=!0,this.signerUpInfo=new b}return a}();a.HoaSignUpInfo=c;var d=function(){function b(b,c,d,e){this.$scope=b,this.$http=c,this.$timeout=d,this.WizardHandler=e,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.hoaPoly={vertices:[]},this.showMap=!1,this.signUpInfo=new a.HoaSignUpInfo}return b.prototype.$onInit=function(){var a=this,a=this;this.$scope.$on("wizard:stepChanged",function(b,c){1===c.index?a.$timeout(function(){return a.showMap=!0},50):a.showMap=!1})},b.prototype.centerMap=function(a){a.viewport?this.map.fitBounds(a.viewport):(this.map.setCenter(a.location),this.map.setZoom(17)),this.mapMarker.setPosition(a.location),this.mapMarker.setVisible(!0)},b.prototype.initMapStep=function(){"undefined"!=typeof window.analytics&&window.analytics.track("condoSignUpStarted"),this.showMap=!0;var a=document.getElementById("association-address-text-box");if(a&&(this.addressAutocomplete=new google.maps.places.Autocomplete(a),this.addressAutocomplete.bindTo("bounds",this.map)),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this.addressAutocomplete){var b=this,c=function(){b.setPlaceWasSelected(),b.mapMarker.setVisible(!1);var a=b.addressAutocomplete.getPlace(),c=a.formatted_address;c.indexOf(", USA")===c.length-", USA".length&&(c=c.substring(0,c.length-", USA".length)),b.signUpInfo.streetAddress=c,a.geometry&&(b.setEditPolyForAddress(a.geometry.location),b.centerMap(a.geometry))};this.addressAutocomplete.addListener("place_changed",function(){b.$scope.$apply(c)})}},b.prototype.onMapEditorReady=function(a){this.map=a,this.initMapStep()},b.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForAddress())},b.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var a=this;setTimeout(function(){a.placeWasSelected=!0},500)},b.prototype.setEditPolyForAddress=function(a){var b=.001,c=.0014;this.hoaPoly={vertices:[{lat:a.lat()-b,lon:a.lng()-c},{lat:a.lat()+b,lon:a.lng()-c},{lat:a.lat()+b,lon:a.lng()+c},{lat:a.lat()-b,lon:a.lng()+c}]}},b.prototype.refreshMapForAddress=function(){this.isLoadingMap=!0;var a=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(b,c){a.$scope.$apply(function(){if(a.isLoadingMap=!1,c==google.maps.GeocoderStatus.OK){var d=b[0].formatted_address;d.indexOf(", USA")===d.length-", USA".length&&(d=d.substring(0,d.length-", USA".length)),a.signUpInfo.streetAddress=d,b[0].geometry&&(a.setEditPolyForAddress(b[0].geometry.location),a.centerMap(b[0].geometry))}})})},b.prototype.onFinishedWizard=function(){this.isLoading=!0,this.signUpInfo.boundsGpsVertices=this.hoaPoly.vertices;var a=this;this.$http.post("/api/SignUpWizard/Hoa",this.signUpInfo).then(function(b){a.isLoading=!1;var c=b.data;HtmlUtil.isNullOrWhitespace(c.errorMessage)?("undefined"!=typeof window.analytics&&window.analytics.track("condoSignUpComplete"),"undefined"!=typeof window.goog_report_conversion&&window.goog_report_conversion(),HtmlUtil.isNullOrWhitespace(c.createUrl)?(a.hideWizard=!0,a.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=c.createUrl):(alert("Failed to complete sign-up: "+c.errorMessage),a.WizardHandler.wizard().goTo(c.stepIndex))},function(b){a.isLoading=!1,alert("Failed to complete sign-up: "+b.data.exceptionMessage)})},b.$inject=["$scope","$http","$timeout","WizardHandler"],b}();a.HoaSignUpWizardController=d}(Ally||(Ally={})),CA.angularApp.component("hoaSignUpWizard",{templateUrl:"/ngApp/chtn/public/hoa-sign-up-wizard.html",controller:Ally.HoaSignUpWizardController});var Ally;!function(a){var b=function(){function a(){}return a}(),c=function(){function a(a){this.$http=a,this.isLoading=!1,this.signUpInfo=new b,this.resultIsError=!1}return a.prototype.$onInit=function(){setTimeout(function(){var a=document.getElementById("address-text-box");new google.maps.places.Autocomplete(a)},750)},a.prototype.onSubmitInfo=function(){if(HtmlUtil.isNullOrWhitespace(this.signUpInfo.emailAddress))return void alert("Please enter an e-mail address");this.isLoading=!0;var a=this;this.$http.post("/api/NeighborSignUp/SignUpNewUser",this.signUpInfo).then(function(b){a.isLoading=!1,a.resultIsError=!1,a.resultMessage="Your information has been successfully submitted. Look for a welcome email soon."},function(){a.isLoading=!1,a.resultIsError=!0,a.resultMessage="There was an error submitting your information. Please try again."})},a.prototype.goBack=function(){this.resultMessage=null},a.$inject=["$http"],a}();a.NeighborSignUpController=c}(Ally||(Ally={})),CA.angularApp.component("neighborSignUp",{templateUrl:"/ngApp/chtn/public/neighbor-sign-up.html",controller:Ally.NeighborSignUpController});var Ally;!function(a){var b=function(){function a(a,b,c,d){this.$http=a,this.$rootScope=b,this.siteInfo=c,this.$cacheFactory=d}return a.prototype.$onInit=function(){},a.$inject=["$http","$rootScope","SiteInfo","$cacheFactory"],a}();a.CommitteeHomeController=b}(Ally||(Ally={})),CA.angularApp.component("committeeHome",{bindings:{committee:"<"},templateUrl:"/ngApp/committee/committee-home.html",controller:Ally.CommitteeHomeController});var Ally;!function(a){var b=function(){function a(a,b,c){this.$http=a,this.siteInfo=b,this.$routeParams=c,this.canManage=!1,this.selectedView="home",this.isLoading=!1,this.committeeId=this.$routeParams.committeeId,this.selectedView=this.$routeParams.viewName||"home"}return a.prototype.$onInit=function(){this.canManage=this.siteInfo.userInfo.isSiteManager,this.retrieveCommittee()},a.prototype.retrieveCommittee=function(){this.isLoading=!0;var a=this;this.$http.get("/api/Committee/"+this.committeeId).success(function(b){a.isLoading=!1,a.committee=b}).error(function(b){a.isLoading=!1,alert("Failed to load committee: "+b.exceptionMessage)})},a.prototype.onUpdateCommitteeName=function(){this.isLoading=!0;var a="/api/Committee/"+this.committeeId+"?newName="+this.committee.name,b=this;this.$http.put(a,null).success(function(){b.isLoading=!1}).error(function(a){b.isLoading=!1,alert("Failed to update the committee name: "+a.exceptionMessage)})},a.$inject=["$http","SiteInfo","$routeParams"],a}();a.CommitteeParentController=b}(Ally||(Ally={})),CA.angularApp.component("committeeParent",{templateUrl:"/ngApp/committee/committee-parent.html",controller:Ally.CommitteeParentController});var Ally;!function(a){var b=function(){function a(){}return a}();a.InfoItem=b;var c=function(){function a(a,c,d,e){this.$http=a,this.$rootScope=c,this.siteInfo=d,this.$cacheFactory=e,this.isBodyMissing=!1,this.isSiteManager=!1,this.editingInfoItem=new b}return a.prototype.$onInit=function(){this.hideDocuments=this.$rootScope.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.isSiteManager=this.$rootScope.isSiteManager,this.retrievePageInfo(),window.setTimeout(function(){function a(){var a=["Serif","Sans","Arial","Arial Black","Courier","Courier New","Comic Sans MS","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],b=$("[title=Font]").siblings(".dropdown-menu");$.each(a,function(a,c){b.append($('<li><a data-edit="fontName '+c+'" style="font-family:\''+c+"'\">"+c+"</a></li>"))});var c=$("a[title]");if(c.tooltip({container:"body"}),$(".dropdown-menu input").click(function(){return!1}).change(function(){var a=$(this).parent(".dropdown-menu").siblings(".dropdown-toggle");a.dropdown("toggle")}).keydown("esc",function(){this.value="",$(this).change()}),$("[data-role=magic-overlay]").each(function(){var a=$(this),b=$(a.data("target"));a.css("opacity",0).css("position","absolute").offset(b.offset()).width(b.outerWidth()).height(b.outerHeight())}),"onwebkitspeechchange"in document.createElement("input")){var d=$("#editor").offset();$("#voiceBtn").css("position","absolute").offset({top:d.top,left:d.left+$("#editor").innerWidth()-35})}else $("#voiceBtn").hide()}var b=function(a,b){var c="";"unsupported-file-type"===a?c="Unsupported format "+b:console.log("error uploading file",a,b),$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button><strong>File upload error</strong> '+c+" </div>").prependTo("#alerts")};a();var c=$("#editor");c.wysiwyg({fileUploadError:b})},10)},a.prototype.retrieveInfo=function(){this.isLoadingInfo=!0;var a=this;this.$http.get("/api/InfoItem",{cache:!0}).then(function(b){a.isLoadingInfo=!1,a.infoItems=b.data})},a.prototype.retrievePageInfo=function(){this.retrieveInfo()},a.prototype.scrollToInfo=function(a){document.getElementById("info-item-title-"+a).scrollIntoView()},a.prototype.onStartEditInfoItem=function(a){this.editingInfoItem=jQuery.extend({},a),$("#editor").html(this.editingInfoItem.body),window.scrollTo(0,document.body.scrollHeight)},a.prototype.onSubmitItem=function(){this.editingInfoItem.body=$("#editor").html(),this.isBodyMissing=HtmlUtil.isNullOrWhitespace(this.editingInfoItem.body);var a=$("#info-item-edit-form");if(a.validate(),a.valid()&&!this.isBodyMissing){this.isLoadingInfo=!0;var c=this,d=function(){c.isLoadingInfo=!1,$("#editor").html(""),c.editingInfoItem=new b,c.$cacheFactory.get("$http").remove("/api/InfoItem"),c.retrieveInfo()};"number"==typeof this.editingInfoItem.infoItemId?this.$http.put("/api/InfoItem",this.editingInfoItem).then(d):this.$http.post("/api/InfoItem",this.editingInfoItem).then(d)}},a.prototype.onDeleteInfoItem=function(a){if(confirm("Are you sure you want to delete this information?")){this.isLoadingInfo=!0;var b=this;this.$http["delete"]("/api/InfoItem/"+a.infoItemId).then(function(){b.isLoadingInfo=!1,b.$cacheFactory.get("$http").remove("/api/InfoItem"),b.retrievePageInfo()})}},a.$inject=["$http","$rootScope","SiteInfo","$cacheFactory"],a}();a.FAQsController=c}(Ally||(Ally={})),CA.angularApp.component("faqs",{templateUrl:"/ngApp/common/FAQs.html",controller:Ally.FAQsController});var Ally;!function(a){var b=function(){function a(a,b,c,d){this.$http=a,this.siteInfo=b,this.$timeout=c,this.$rootScope=d,this.isLoading=!1}return a.prototype.$onInit=function(){this.refreshPolls()},a.prototype.populatePollData=function(a){this.polls=a,a&&a.length>0&&this.$rootScope.$broadcast("homeHasActivePolls");for(var b=0;b<this.polls.length;++b){var c=this.polls[b];if(c.hasUsersUnitVoted&&c.canViewResults){var d=_.groupBy(c.responses,"answerId");c.chartData=[],c.chartLabels=[];for(var e in d)d.hasOwnProperty(e)&&(c.chartLabels.push(_.find(c.answers,function(a){return a.pollAnswerId==e}).answerText),c.chartData.push(d[e].length));c.responses&&c.responses.length<this.siteInfo.privateSiteInfo.numUnits&&(c.chartLabels.push("No Response"),c.chartData.push(this.siteInfo.privateSiteInfo.numUnits-c.responses.length))}}},a.prototype.refreshPolls=function(){this.isLoading=!0;var a=this;this.$http({method:"GET",url:"/api/Poll?getActive=1"}).then(function(b){a.isLoading=!1,a.$timeout(function(){a.populatePollData(b.data)},100)},function(){a.isLoading=!1})},a.prototype.onPollAnswer=function(a,b,c){this.isLoading=!0;var d="/api/PollResponse?pollId="+a.pollId+"&answerId="+(b?b.pollAnswerId:"")+"&writeInAnswer="+c,e=this;this.$http.put(d,null).then(function(a){e.polls=a.data,e.isLoading=!1,e.refreshPolls()},function(){e.isLoading=!1})},a.$inject=["$http","SiteInfo","$timeout","$rootScope"],a}();a.ActivePollsController=b}(Ally||(Ally={})),CA.angularApp.component("activePolls",{templateUrl:"/ngApp/common/active-polls.html",controller:Ally.ActivePollsController});var Ally;!function(a){var b=function(){function a(a,b,c){this.$http=a,this.siteInfo=b,this.$rootScope=c,this.isLoading_Payment=!1}return a.prototype.$onInit=function(){this.allyAppName=AppConfig.appName,this.isAutoPayActive=this.siteInfo.userInfo.isAutoPayActive,this.assessmentCreditCardFeeLabel=this.siteInfo.privateSiteInfo.payerPaysCCFee?"Service fee applies":"No service fee",this.assessmentAchFeeLabel=this.siteInfo.privateSiteInfo.payerPaysAchFee?"Service fee applies":"No service fee",this.payerPaysAchFee=this.siteInfo.privateSiteInfo.payerPaysAchFee,this.errorPayInfoText="Is the amount incorrect?",this.isWePaySetup=this.siteInfo.privateSiteInfo.isPaymentEnabled,this.hasAssessments=this.siteInfo.privateSiteInfo.hasAssessments,this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,!this.isAutoPayActive&&HtmlUtil.isNumericString(HtmlUtil.GetQueryStringParameter("preapproval_id"))&&(this.isAutoPayActive=!0),this.nextAutoPayText=this.siteInfo.userInfo.nextAutoPayText,null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0?this.assessmentAmount=this.siteInfo.userInfo.usersUnits[0].assessment:this.assessmentAmount=0,this.paymentInfo={paymentType:"other",amount:this.assessmentAmount,note:"",fundingType:null};var a=6;if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments&&this.recentPayments.length>0)for(this.recentPayments.length>a&&(this.recentPayments=this.recentPayments.slice(0,a)),this.numRecentPayments=this.recentPayments.length;this.recentPayments.length<a;)this.recentPayments.push({});null!=this.siteInfo.privateSiteInfo.assessmentFrequency&&null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())),setTimeout(function(){$("#btn_view_pay_history").click(function(){$("#pm_info").collapse("hide"),$("#payment_history").collapse("show")}),$("#btn_view_pay_info").click(function(){$("#payment_history").collapse("hide"),$("#pm_info").collapse("show")}),$(".hide").click(function(){$(this).parent().hide("")})},400)},a.prototype.makePayment=function(a){this.isLoading_Payment=!0,this.paymentInfo.fundingType=a,analytics.track("makePayment",{fundingType:a});var b=this;this.$http.post("/api/WePayPayment",this.paymentInfo).then(function(a){var c=a.data;null!==c&&"string"==typeof c.checkoutUri&&c.checkoutUri.length>0?window.location.href=c.checkoutUri:(b.isLoading_Payment=!1,alert("Unable to initiate WePay checkout"))},function(a){b.isLoading_Payment=!1,a.data&&a.data.exceptionMessage&&alert(a.data.exceptionMessage)})},a.prototype.onIncorrectPayDetails=function(){var a=this.assessmentAmount.toString();Math.round(this.assessmentAmount)!=this.assessmentAmount&&(a=this.assessmentAmount.toFixed(2));var b=a;this.knowsNextPayment&&HtmlUtil.isValidString(this.nextPaymentText)&&(b+="|"+this.nextPaymentText),this.$rootScope.$broadcast("prepAssessmentEmailToBoard",b)},a.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},a.prototype.onSelectPaymentType=function(a){this.paymentInfo.paymentType=a,this.paymentInfo.amount="periodic"==a?this.assessmentAmount:0,this.updatePaymentText()},a.prototype.getNextPaymentText=function(a,b){if(null==a)return"";a.constructor!==Array&&(a=[a]);for(var c="",d=FrequencyIdToInfo(b),e=0;e<a.length;++e){var f=a[e];if("month"===d.intervalName){var g=["January","February","March","April","May","June","July","August","September","October","November","December"];c=g[f.period-1]}else if("quarter"===d.intervalName){var h=["Q1","Q2","Q3","Q4"];c=h[f.period-1]}else if("half-year"===d.intervalName){var h=["First Half","Second Half"];c=h[f.period-1]}c+=" "+f.year,this.paymentInfo.paysFor=[f]}return c},a.prototype.onSetupAutoPay=function(a){this.isLoading_Payment=!0;var b=this;this.$http.get("/api/WePayPayment/SetupAutoPay?fundingType="+a).then(function(a){var c=a.data;"string"==typeof c&&c.length>0?window.location.href=c:(b.isLoading_Payment=!1,alert("Unable to initiate WePay auto-pay setup"))},function(a){b.isLoading_Payment=!1,a.data&&a.data.exceptionMessage&&alert(a.data.exceptionMessage)})},a.prototype.onDisableAutoPay=function(){if(confirm("Just to double check, this will disable your auto-payment. You need to make sure to manually make your regular payments to avoid any late fees your association may enforce.")){this.isLoading_Payment=!0;var a=this;this.$http.get("/api/WePayPayment/DisableAutoPay").then(function(){a.isLoading_Payment=!1,a.isAutoPayActive=!1},function(b){a.isLoading_Payment=!1,b.data&&b.data.exceptionMessage&&alert(b.data.exceptionMessage)})}},a.$inject=["$http","SiteInfo","$rootScope"],a}();a.AssessmentPaymentFormController=b}(Ally||(Ally={})),CA.angularApp.component("assessmentPaymentForm",{templateUrl:"/ngApp/common/assessment-payment-form.html",controller:Ally.AssessmentPaymentFormController});var Ally;!function(a){var b=function(){function a(){}return a}();a.DocumentTreeFile=b;var c=function(){function a(){}return a.prototype.getSubDirectoryByName=function(a){if(!this.subdirectories)return null;for(var b=0;b<this.subdirectories.length;++b)if(this.subdirectories[b].name===a)return this.subdirectories[b];return null},a}();a.DocumentDirectory=c;var d=function(){function a(b,c,d,e){this.$http=b,this.$rootScope=c,this.$cacheFactory=d,this.$scope=e,this.isLoading=!1,this.filesSortDescend=!1,this.title="Documents",this.getDocsUri="/api/ManageDocuments",this.fileSortType=window.localStorage[a.LocalStorageKey_SortType],this.fileSortType||(this.fileSortType="title"),this.filesSortDescend="true"===window.localStorage[a.LocalStorageKey_SortDirection],this.fileSearch={all:""},this.isSiteManager=c.isSiteManager}return a.prototype.$onInit=function(){this.apiAuthToken=this.$rootScope.authToken,this.Refresh();var a=this,b=function(){$(function(){var b=$("#JQFileUploader");b.fileupload({autoUpload:!0,add:function(b,c){var d=a.getSelectedDirectoryPath();$("#FileUploadProgressContainer").show(),c.url="api/DocumentUpload?dirPath="+encodeURIComponent(d)+"&ApiAuthToken="+a.apiAuthToken;var e=c.submit();e.done(function(b){a.$cacheFactory.get("$http").remove(a.getDocsUri),$("#FileUploadProgressContainer").hide(),a.Refresh()})},progressall:function(a,b){var c=parseInt((b.loaded/b.total*100).toString(),10);$("#FileUploadProgressBar").css("width",c+"%"),100===c?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(c+"%")}})})};setTimeout(b,100),this.committee&&(this.title=this.committee.name+" Documents")},a.prototype.getSelectedDirectoryPath=function(){return this.getDirectoryFullPath(this.selectedDirectory);
},a.prototype.getDirectoryFullPath=function(b){for(var c=b.name,d=b.parentDirectory;d;)c=d.name+"/"+c,d=d.parentDirectory;return this.committee&&(c=a.DirName_Committees+"/"+this.committee.committeeId+"/"+c),c},a.prototype.FindDirectoryByPath=function(b){if(this.documentTree){if(this.committee&&HtmlUtil.startsWith(b,a.DirName_Committees)){b=b.substr(a.DirName_Committees.length+1);var c=b.indexOf("/");-1!==c&&(b=b.substr(c+1))}for(var d=b.split("/"),e=this.documentTree,f=0;f<d.length&&(e=e.getSubDirectoryByName(d[f]),e);++f);return e}},a.prototype.updateFileFilter=function(){var a=angular.lowercase(this.fileSearch.all)||"",b=function(b){return-1!==angular.lowercase(b.localFilePath||"").indexOf(a)||-1!==angular.lowercase(b.uploadDateString||"").indexOf(a)||-1!==angular.lowercase(b.uploaderFullName||"").indexOf(a)};this.searchFileList=_.filter(this.fullSearchFileList,b),setTimeout(function(){var a=document.getElementById("documents-area"),b=a.style.display;a.style.display="none";a.offsetHeight;a.style.display=b},50)},a.prototype.hookUpFileDragging=function(){if(this.isSiteManager){var a=this;setTimeout(function(){var b=$(".droppable");b.droppable({drop:function(b,c){var d=a.getSelectedDirectoryPath(),e=$(c.draggable);e.draggable("option","revert","false");var f=$(this).attr("data-folder-path").trim();a.$scope.$apply(function(){a.isLoading=!0;var b={relativeS3Path:a.selectedFile.relativeS3Path,action:"move",newFileName:"",sourceFolderPath:d,destinationFolderPath:f};a.selectedFile=null,a.$http.put("/api/ManageDocuments/MoveFile",b).then(function(){a.isLoading=!1,a.$cacheFactory.get("$http").remove(a.getDocsUri),a.Refresh()},function(b){a.isLoading=!1;var c=b.exceptionMessage||b.message||b;alert("Failed to move file: "+c)})})},hoverClass:"Document_Folder_DropHover"});var c=$(".draggable");c.draggable({distance:10,revert:!0,helper:"clone",opacity:.7,containment:"document",appendTo:"body",start:function(b,c){var d=$(this).attr("id").substring("File_".length),e=parseInt(d);a.$scope.$apply(function(){var b=a.selectedDirectory.files[e];a.selectedFile=b})}})},250)}},a.prototype.onDirectoryClicked=function(a){this.selectedDirectory=a,this.selectedFile=null,this.fileSearch.all=null,this.hookUpFileDragging(),this.SortFiles()},a.prototype.CreateDirectory=function(){this.createUnderParentDirName=null,this.committee&&(this.createUnderParentDirName=a.DirName_Committees+"/"+this.committee.committeeId),this.shouldShowCreateFolderModal=!0,setTimeout(function(){$("#CreateDirectoryNameTextBox").focus()},50)},a.prototype.CreateSubDirectory=function(){this.createUnderParentDirName=this.selectedDirectory.name,this.committee&&(this.createUnderParentDirName=a.DirName_Committees+"/"+this.committee.committeeId+"/"+this.createUnderParentDirName),this.shouldShowCreateFolderModal=!0,setTimeout(function(){$("#CreateDirectoryNameTextBox").focus()},50)},a.prototype.SetFileSortType=function(b){this.fileSortType===b?this.filesSortDescend=!this.filesSortDescend:this.filesSortDescend=!1,this.fileSortType=b,window.localStorage[a.LocalStorageKey_SortType]=this.fileSortType,window.localStorage[a.LocalStorageKey_SortDirection]=this.filesSortDescend,this.SortFiles()},a.prototype.SortFiles=function(){this.selectedDirectory&&this.selectedDirectory.files&&(("title"===this.fileSortType||"uploadDate"===this.fileSortType)&&(this.selectedDirectory.files=_.sortBy(this.selectedDirectory.files,this.fileSortType)),this.filesSortDescend&&this.selectedDirectory.files.reverse())},a.prototype.onCreateDirectoryClicked=function(){this.isLoading=!0,$("#CreateDirectoryButtonsPanel").hide();var a=encodeURIComponent(this.newDirectoryName),b="/api/ManageDocuments/CreateDirectory?folderName="+a;b+="&parentFolderPath=",this.createUnderParentDirName&&(b+=encodeURIComponent(this.createUnderParentDirName));var c=this;this.$http.put(b,null).then(function(){c.$cacheFactory.get("$http").remove(c.getDocsUri),c.newDirectoryName="",c.Refresh(),c.shouldShowCreateFolderModal=!1,$("#CreateDirectoryButtonsPanel").show()},function(a){var b=a.data.exceptionMessage||a.data.message||a.data;alert("Failed to create the folder: "+b),c.isLoading=!1,$("#CreateDirectoryButtonsPanel").show()})},a.prototype.onCancelAddDirectory=function(){this.shouldShowCreateFolderModal=!1,this.newDirectoryName=""},a.prototype.onFileClicked=function(a){this.selectedFile=a},a.prototype.RenameDocument=function(a){if(a){var b=prompt("Enter the new name for the file",a.title);if(null!==b){b.length>64&&(b=b.substr(0,64)),this.isLoading=!0;var c={relativeS3Path:a.relativeS3Path,action:"rename",newTitle:b,sourceFolderPath:this.getSelectedDirectoryPath(),destinationFolderPath:""},d=this;this.$http.put("/api/ManageDocuments/RenameFile",c).then(function(){d.$cacheFactory.get("$http").remove(d.getDocsUri),d.Refresh()},function(){d.Refresh()})}}},a.prototype.DeleteDocument=function(a){if(confirm("Are you sure you want to delete this file?")){this.isLoading=!0;var b=this;this.$http["delete"]("/api/ManageDocuments?docPath="+a.relativeS3Path).then(function(){b.$cacheFactory.get("$http").remove(b.getDocsUri),b.Refresh()},function(){b.Refresh()})}},a.prototype.RenameSelectedDirectory=function(){if(this.selectedDirectory){var a=prompt("Enter the new name for the directory",this.selectedDirectory.name);if(null!==a){a.length>32&&(a=a.substr(0,32)),this.isLoading=!0;var b=encodeURIComponent(this.getSelectedDirectoryPath()),c=encodeURIComponent(a),d=this;this.$http.put("/api/ManageDocuments/RenameDirectory?directoryPath="+b+"&newDirectoryName="+c,null).then(function(){d.$cacheFactory.get("$http").remove(d.getDocsUri),d.selectedDirectory.name=a,d.Refresh()},function(){d.Refresh()})}}},a.prototype.DeleteSelectedDirectory=function(){if(this.selectedDirectory){if(this.selectedDirectory.files.length>0)return void alert("You can not delete a folder that contains files. Please delete or move all files from the folder.");if(confirm("Are you sure you want to delete this folder?")){this.isLoading=!0;var a=this,b=this.getSelectedDirectoryPath();this.$http["delete"]("/api/ManageDocuments/DeleteDirectory?directoryPath="+encodeURIComponent(b)).then(function(){a.$cacheFactory.get("$http").remove(a.getDocsUri),a.Refresh()},function(b){a.isLoading=!1,alert("Failed to delete the folder: "+b.data.exceptionMessage)})}}},a.prototype.getFileIcon=function(a){if(!a)return"";var b=a.split(".").pop().toLowerCase(),c=null;switch(b){case"pdf":c="PdfIcon.png";break;case"doc":case"docx":c="WordIcon.png";break;case"xls":case"xlsx":c="ExcelIcon.png";break;case"jpeg":case"jpe":case"jpg":case"png":c="ImageIcon.png";break;case"zip":c="ZipIcon.png";break;default:c="GenericFileIcon.png"}return"/assets/images/FileIcons/"+c},a.prototype.hookupParentDirs=function(a){var b=this;a.fullDirectoryPath=this.getDirectoryFullPath(a),a.getSubDirectoryByName=c.prototype.getSubDirectoryByName,a.subdirectories&&a.subdirectories.forEach(function(c){c.parentDirectory=a,b.hookupParentDirs(c)})},a.prototype.Refresh=function(){var a=null;this.selectedDirectory&&(a=this.getSelectedDirectoryPath()),this.isLoading=!0,this.selectedDirectory=null,this.selectedFile=null,this.getDocsUri="/api/ManageDocuments",this.committee&&(this.getDocsUri+="/Committee/"+this.committee.committeeId);var b=this;this.$http.get(this.getDocsUri,{cache:!0}).then(function(d){b.isLoading=!1,b.documentTree=d.data,b.documentTree.getSubDirectoryByName=c.prototype.getSubDirectoryByName,b.documentTree.subdirectories.forEach(function(a){b.hookupParentDirs(a)});var e=[],f=function(a){_.each(a.files,function(b){b.localFilePath=a.name+"/"+b.title,b.uploadDateString=moment(b.uploadDate).format("MMMM D, YYYY")}),Array.prototype.push.apply(e,a.files),_.each(a.subdirectories,f)};f(b.documentTree),b.fullSearchFileList=e,a&&(b.selectedDirectory=b.FindDirectoryByPath(a),b.SortFiles()),b.hookUpFileDragging()},function(a){b.isLoading=!1})},a.$inject=["$http","$rootScope","$cacheFactory","$scope"],a.LocalStorageKey_SortType="DocsInfo_FileSortType",a.LocalStorageKey_SortDirection="DocsInfo_FileSortDirection",a.DirName_Committees="Committees_Root",a}();a.DocumentsController=d}(Ally||(Ally={})),CA.angularApp.component("documents",{bindings:{committee:"<"},templateUrl:"/ngApp/common/Documents.html",controller:Ally.DocumentsController});var Ally;!function(a){var b=(function(){function a(){}return a}(),function(){function a(){this.subject="A message from your neighbor",this.recipientType="board"}return a}()),c=function(){function a(a,c,d,e,f){this.$http=a,this.fellowResidents=c,this.$rootScope=d,this.siteInfo=e,this.$scope=f,this.isLoadingEmail=!1,this.messageObject=new b,this.defaultMessageRecipient="board",this.showDiscussionEveryoneWarning=!1,this.showDiscussionLargeWarning=!1,this.showSendConfirmation=!1,this.showEmailForbidden=!1}return a.prototype.$onInit=function(){this.messageObject=new b,this.showSendEmail=!0,this.loadGroupEmails();var a=this;this.$scope.$on("prepAssessmentEmailToBoard",function(b,c){return a.prepBadAssessmentEmailForBoard(c)})},a.prototype.loadGroupEmails=function(){this.isLoadingEmail=!0;var a=this;this.fellowResidents.getGroupEmailObject().then(function(b){a.isLoadingEmail=!1;for(var c=_.keys(b),d=[],e=0;e<c.length;++e){var f=c[e];b[f].length>0&&d.push(f)}var g={propertyManagers:{displayName:"Property Managers",sortOrder:10},board:{displayName:"Board Members",sortOrder:20},discussion:{displayName:"Discussion",sortOrder:30},owners:{displayName:"Owners",sortOrder:40},renters:{displayName:"Renters",sortOrder:50},residentOwners:{displayName:"Resident Owners",sortOrder:60},nonResidentOwners:{displayName:"Non-Resident Owners",sortOrder:70},residentOwnersAndRenters:{displayName:"Resident Owners And Renters",sortOrder:80},everyone:{displayName:"Everyone",sortOrder:90}};a.availableEmailGroups=[];for(var e=0;e<d.length;++e){var h=g[d[e]],i={recipientType:d[e],displayName:h.displayName,sortOrder:h.sortOrder};a.availableEmailGroups.push(i)}a.availableEmailGroups.length>0&&(a.availableEmailGroups=_.sortBy(a.availableEmailGroups,function(a){return a.sortOrder}),a.defaultMessageRecipient=a.availableEmailGroups[0].recipientType,a.messageObject.recipientType=a.defaultMessageRecipient,a.onSelectEmailGroup())})},a.prototype.prepBadAssessmentEmailForBoard=function(a){var b=a.split("|"),c=b[0],d=null;b.length>1&&(d=b[1]),this.messageObject.recipientType="board",d?this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my next payment of $"+c+" will cover "+d+", but I believe that is incorrect. My records indicate my next payment of $"+c+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+c+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},a.prototype.onSendEmail=function(){if($("#message-form").validate(),$("#message-form").valid()){this.isLoadingEmail=!0,this.$rootScope.dontHandle403=!0,analytics.track("sendEmail",{recipientId:this.messageObject.recipientType});var a=this;this.$http.post("/api/Email/v2",this.messageObject).then(function(){a.$rootScope.dontHandle403=!1,a.isLoadingEmail=!1,a.messageObject=new b,a.messageObject.recipientType=a.defaultMessageRecipient,a.showSendConfirmation=!0,a.showSendEmail=!1},function(b){a.isLoadingEmail=!1,a.$rootScope.dontHandle403=!1,403===b.status?a.showEmailForbidden=!0:alert("Unable to send e-mail, please contact technical support.")})}},a.prototype.onSelectEmailGroup=function(){var a=HtmlUtil.getSubdomain(window.location.host).toLowerCase();this.groupEmailAddress=this.messageObject.recipientType+"."+a+"@inmail.condoally.com",this.showDiscussionEveryoneWarning="everyone"===this.messageObject.recipientType;var b=-1!==this.messageObject.recipientType.toLowerCase().indexOf("owners");!this.showDiscussionEveryoneWarning&&b&&this.siteInfo.privateSiteInfo.numUnits>30?this.showDiscussionLargeWarning=!0:this.showDiscussionLargeWarning=!1},a.$inject=["$http","fellowResidents","$rootScope","SiteInfo","$scope"],a}();a.GroupSendEmailController=c}(Ally||(Ally={})),CA.angularApp.component("groupSendEmail",{templateUrl:"/ngApp/common/group-send-email.html",controller:Ally.GroupSendEmailController});var Ally;!function(a){var b=function(){function a(a,b,c){this.$http=a,this.siteInfo=b,this.$timeout=c,this.isLoading=!1}return a.prototype.$onInit=function(){this.isLoading=!0;var a=this;this.$timeout(function(){return a.loadNewsStories()},200)},a.prototype.loadNewsStories=function(){var a=HtmlUtil.getSubdomain(window.location.host),b="qa"===a||"localtest"===a;if(b=!1,!b){this.isLoading=!0;var c,d;"US"===this.siteInfo.privateSiteInfo.country?(c="https://localnewsally.org/api/LocalNews",d={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.publicSiteInfo.chicagoWard,zipCode:this.siteInfo.publicSiteInfo.zipCode,cityNeighborhood:this.siteInfo.publicSiteInfo.localNewsNeighborhoodQuery}):(c="https://localnewsally.org/api/LocalNews/International/MajorCity",d={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city});var e=this;this.$http.get(c,{cache:!0,params:d}).then(function(a){e.isLoading=!1,e.localNewStories=a.data})}},a.$inject=["$http","SiteInfo","$timeout"],a}();a.LocalNewsFeedController=b}(Ally||(Ally={})),CA.angularApp.component("localNewsFeed",{templateUrl:"/ngApp/common/local-news-feed.html",controller:Ally.LocalNewsFeedController});var Ally;!function(a){var b=function(){function a(){}return a}();a.SplitAddress=b;var c=function(){function a(){}return a}();a.GpsPoint=c;var d=function(){function a(){}return a}();a.GpsPolygon=d;var e=function(){function a(){}return a}();a.FullAddress=e;var f=function(){function a(){}return a.parseAddressComponents=function(a){for(var c=new b,d="",e="",f=0,g=a;f<g.length;f++){var h=g[f];-1!==h.types.indexOf("street_number")?d=h.short_name:-1!==h.types.indexOf("route")?e=h.short_name:-1!==h.types.indexOf("locality")?c.city=h.short_name:-1!==h.types.indexOf("administrative_area_level_1")?c.state=h.short_name:-1!==h.types.indexOf("postal_code")?c.zip=h.short_name:-1!==h.types.indexOf("country")&&(c.country=h.short_name)}return c.street=d+" "+e,c},a.gpsBoundsToGooglePoly=function(a){var b=_.map(a.vertices,function(a){return new google.maps.LatLng(a.lat,a.lon)});return b},a}();a.MapUtil=f}(Ally||(Ally={}));var Ally;!function(a){var b=function(){function b(a,b){this.$http=a,this.siteInfo=b,this.isLoading=!1,this.isSiteManager=!1,this.isInEditMode=!1}return b.prototype.$onInit=function(){if(this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.isAddForm=null==this.vendorItem,this.isAddForm){this.isInEditMode=!0,this.vendorItem=new a.PreferredVendor,this.editVendorItem=new a.PreferredVendor;var b=this;window.setTimeout(function(){b.hookupAddressAutocomplete()},500)}},b.prototype.hookupAddressAutocomplete=function(){if("US"===this.siteInfo.privateSiteInfo.country||"CA"===this.siteInfo.privateSiteInfo.country){var b=$(".mask-phone");b.mask("(999) 999-9999 ?x999")}var c=void 0;if(this.siteInfo.privateSiteInfo.googleGpsPosition){var d=40234,e=new google.maps.Circle({center:this.siteInfo.privateSiteInfo.googleGpsPosition,radius:d});c={bounds:e.getBounds()}}var f=document.getElementById("vendor-"+(this.vendorItem.preferredVendorId||"")+"-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(f,c);var g=this;google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var b=g.addressAutocomplete.getPlace();g.editVendorItem.fullAddress||(g.editVendorItem.fullAddress=new a.FullAddress),g.editVendorItem.fullAddress.oneLiner=b.formatted_address})},b.prototype.onSaveVendor=function(){var b=this;if(HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyName))return void alert("Please enter a company name");if(!this.editVendorItem.servicesTagArray||0===this.editVendorItem.servicesTagArray.length)return void alert("Please enter at least one service provided");HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyWeb)||0!==this.editVendorItem.companyWeb.indexOf("http")&&(this.editVendorItem.companyWeb="http://"+this.editVendorItem.companyWeb);var c=null==this.editVendorItem.preferredVendorId?this.$http.post:this.$http.put;this.isLoading=!0;var d="";_.each(this.editVendorItem.servicesTagArray,function(a){d+="|"+a.text}),d+="|",this.editVendorItem.servicesProvided=d;var e=this;c("/api/PreferredVendors",this.editVendorItem).success(function(){e.isLoading=!1,b.isAddForm?(e.editVendorItem=new a.PreferredVendor,e.onAddNewVendor&&e.onAddNewVendor()):e.isInEditMode=!1,e.onParentDataNeedsRefresh&&e.onParentDataNeedsRefresh()}).error(function(a){e.isLoading=!1,alert("Failed to save the vendor information: "+a.exceptionMessage)})},b.prototype.onCancelEdit=function(){this.isInEditMode=!1},b.prototype.onEditItem=function(){this.editVendorItem=JSON.parse(JSON.stringify(this.vendorItem)),this.isInEditMode=!0;var a=this;window.setTimeout(function(){a.hookupAddressAutocomplete()},500)},b.prototype.deleteItem=function(){if(confirm("Are you sure you want to remove this vendor?")){this.isLoading=!0;var a=this;this.$http["delete"]("/api/PreferredVendors/"+this.vendorItem.preferredVendorId).success(function(){a.isLoading=!1,a.onParentDataNeedsRefresh&&a.onParentDataNeedsRefresh()}).error(function(b){a.isLoading=!1,alert("Failed to delete the vendor: "+b.exceptionMessage)})}},b.prototype.getServiceAutocomplete=function(a){return _.where(b.AutocompleteServiceOptions,function(b){return-1!==b.text.toLowerCase().indexOf(a.toLowerCase())})},b.$inject=["$http","SiteInfo"],b.AutocompleteServiceOptions=[{text:"Additions & Remodels"},{text:"Appliances"},{text:"Cabinets & Countertops"},{text:"Cleaning"},{text:"Concrete & Masonry"},{text:"Deck, Porch, & Gazebo"},{text:"Drywall & Insulation"},{text:"Electrical"},{text:"Fencing"},{text:"Flooring"},{text:"Garages"},{text:"Gutters"},{text:"Handy Man"},{text:"HVAC"},{text:"Landscaping, Lawn Care & Sprinklers"},{text:"Painting & Staining"},{text:"Pest Control"},{text:"Plumbing"},{text:"Remodeling"},{text:"Roofing"},{text:"Siding"},{text:"Snow Removal"},{text:"Solar Electric, Heating & Cooling"},{text:"Swimming Pools"},{text:"Windows & Doors"}],b}();a.PreferredVendorItemController=b}(Ally||(Ally={})),CA.angularApp.component("preferredVendorItem",{bindings:{vendorItem:"=?",onParentDataNeedsRefresh:"&?",onAddNewVendor:"&?"},templateUrl:"/ngApp/common/preferred-vendor-item.html",controller:Ally.PreferredVendorItemController});var Ally;!function(a){var b=function(){function b(){this.fullAddress=new a.FullAddress}return b}();a.PreferredVendor=b;var c=function(){function a(a,c){this.$http=a,this.siteInfo=c,this.allVendors=[],this.filteredVendors=[],this.editVendor=new b,this.isLoading=!1,this.isSiteManager=!1,this.usedServiceTags=[],this.filterTags=[]}return a.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.retrieveVendors()},a.prototype.retrieveVendors=function(){this.isLoading=!0;var a=this;this.$http.get("/api/PreferredVendors").success(function(b){a.isLoading=!1,a.allVendors=b,a.filteredVendors=b,a.usedServiceTags=[],_.each(a.allVendors,function(b){b.servicesTagArray=[],_.each(b.servicesProvidedSplit,function(a){return b.servicesTagArray.push({text:a})}),a.usedServiceTags=a.usedServiceTags.concat(b.servicesProvidedSplit),b.addedDateUtc=moment.utc(b.addedDateUtc).toDate()}),a.usedServiceTags=_.uniq(a.usedServiceTags),a.usedServiceTags.sort()})},a.prototype.onTagFilterToggle=function(a){var b=this.filterTags.indexOf(a);if(-1===b?this.filterTags.push(a):this.filterTags.splice(b,1),0===this.filterTags.length)this.filteredVendors=this.allVendors;else{this.filteredVendors=[];var c=this;_.each(this.allVendors,function(a){_.intersection(a.servicesProvidedSplit,c.filterTags).length>0&&c.filteredVendors.push(a)})}},a.prototype.onAddedNewVendor=function(){this.retrieveVendors()},a.$inject=["$http","SiteInfo"],a}();a.PreferredVendorsController=c}(Ally||(Ally={})),CA.angularApp.component("preferredVendors",{templateUrl:"/ngApp/common/preferred-vendors.html",controller:Ally.PreferredVendorsController});var Ally;!function(a){var b=function(){function a(a,b,c){this.$http=a,this.siteInfo=b,this.$cacheFactory=c,this.isSiteManager=!1,this.hideDocuments=!1,this.selectedView="docs"}return a.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideDocuments?this.selectedView="info":this.selectedView="docs"},a.$inject=["$http","SiteInfo","$cacheFactory"],a}();a.HoaInfoController=b}(Ally||(Ally={})),CA.angularApp.component("hoaInfo",{templateUrl:"/ngApp/hoa/member/HoaInfo.html",controller:Ally.HoaInfoController});var Ally;!function(a){var b=function(){function a(a,b,c){this.$http=a,this.siteInfo=b,this.$cacheFactory=c,this.isSiteManager=!1}return a.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager},a.$inject=["$http","SiteInfo","$cacheFactory"],a}();a.HoaHomeController=b}(Ally||(Ally={})),CA.angularApp.component("hoaHome",{templateUrl:"/ngApp/hoa/member/Home.html",controller:Ally.HoaHomeController});var Ally;!function(a){var b=function(){function a(a,b,c,d,e,f){this.$http=a,this.$rootScope=b,this.siteInfo=c,this.$timeout=d,this.appCacheService=e,this.fellowResidents=f}return a.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");HtmlUtil.getSubdomain(window.location.host);this.allyAppName=AppConfig.appName;var a=6;if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments)for(this.recentPayments.length>a&&(this.recentPayments=this.recentPayments.slice(0,a)),this.numRecentPayments=this.recentPayments.length;this.recentPayments.length<a;)this.recentPayments.push({});this.messageObject={recipientType:"everyone"},null!==this.siteInfo.privateSiteInfo.assessmentFrequency&&null!==this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())),this.refreshData()},a.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},a.prototype.onSelectPaymentType=function(a){this.paymentInfo.paymentType=a,this.paymentInfo.amount="periodic"===a?this.siteInfo.userInfo.assessmentAmount:0,this.updatePaymentText()},a.prototype.getNextPaymentText=function(a,b){if(null===a)return"";a.constructor!==Array&&(a=[a]);for(var c="",d=FrequencyIdToInfo(b),e=0;e<a.length;++e){var f=a[e];if("month"===d.intervalName){var g=["January","February","March","April","May","June","July","August","September","October","November","December"];c=g[f.period-1]}else if("quarter"===d.intervalName){var h=["Q1","Q2","Q3","Q4"];c=h[f.period-1]}else if("half-year"===d.intervalName){var i=["First Half","Second Half"];c=i[f.period-1]}c+=" "+f.year,this.paymentInfo.paysFor=[f]}return c},a.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},a.prototype.onIncorrectPayDetails=function(){this.messageObject.recipientType="board",this.knowsNextPayment?this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" will cover "+this.nextPaymentText+", but I believe that is incorrect. My records indicate my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+this.siteInfo.userInfo.assessmentAmount+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},a.prototype.refreshData=function(){var a=HtmlUtil.getSubdomain(window.location.host),b="qa"===a||"localtest"===a;if(b=!1,!b&&"localnews"===this.homeRightColumnType){this.isLoading_LocalNews=!0;var c,d;"US"===this.siteInfo.privateSiteInfo.country?(c="https://localnewsally.org/api/LocalNews",d={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.publicSiteInfo.chicagoWard,zipCode:this.siteInfo.publicSiteInfo.zipCode,cityNeighborhood:this.siteInfo.publicSiteInfo.localNewsNeighborhoodQuery}):(c="https://localnewsally.org/api/LocalNews/International/MajorCity",d={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city});var e=this;this.$http.get(c,{cache:!0,params:d}).then(function(a){e.localNews=a.data,e.isLoading_LocalNews=!1})}if(this.canSendEmail){this.isLoadingEmail=!0;var e=this;this.fellowResidents.getGroupEmailObject().then(function(a){e.isLoadingEmail=!1;for(var b=_.keys(a),c=[],d=0;d<b.length;++d){var f=b[d];a[f].length>0&&c.push(f)}var g={everyone:"Everyone",owners:"Owners",renters:"Renters",board:"Board Members",residentOwners:"Resident Owners",nonResidentOwners:"Non-Resident Owners",residentOwnersAndRenters:"Resident Owners And Renters",propertyManagers:"Property Managers"};e.availableEmailGroups=[];for(var h=0;h<c.length;++h){var i={recipientType:c[h],displayName:g[c[h]]};this.availableEmailGroups.push(i)}e.messageObject.recipientType=e.availableEmailGroups[0].recipientType})}},a.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService","fellowResidents"],a}();a.HomeGroupHomeController=b}(Ally||(Ally={})),CA.angularApp.component("homeGroupHome",{templateUrl:"/ngApp/home/home-group-home.html",controller:Ally.HomeGroupHomeController});var Ally;!function(a){var b=function(){function a(){}return a}(),c=function(){function a(){this.streetAddress="",this.signerUpInfo=new b,this.homeInfo={}}return a}(),d="Acres",e="SquareFeet",f=43560,g=function(){function b(a,b,e){this.$http=a,this.$scope=b,this.WizardHandler=e,this.lotSizeUnit=d,this.lotSquareUnits=0,this.signUpInfo=new c,this.isLoadingHomeInfo=!1,this.didLoadHomeInfo=!1,this.isLoading=!1,this.hideWizard=!1}return b.prototype.$onInit=function(){var a=this;setTimeout(function(){a.initMap()},300)},b.prototype.initMap=function(){var b=document.getElementById("address-map");this.map=new google.maps.Map(b,{center:{lat:41.869638,lng:-87.657423},zoom:9}),this.mapMarker=new google.maps.Marker({map:this.map,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png",position:null});var c=document.getElementById("home-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(c),this.addressAutocomplete.bindTo("bounds",this.map);var d=this;this.addressAutocomplete.addListener("place_changed",function(){d.mapMarker.setVisible(!1);var b=d.addressAutocomplete.getPlace(),c=b.formatted_address;c.indexOf(", USA")===c.length-", USA".length&&(c=c.substring(0,c.length-", USA".length)),d.signUpInfo.streetAddress=c,d.selectedSplitAddress=a.MapUtil.parseAddressComponents(b.address_components),d.prepopulateHomeInfo(),b.geometry&&d.centerMap(b.geometry),$("#association-name-text-box").focus()})},b.prototype.onFinishedWizard=function(){this.lotSizeUnit===d?this.signUpInfo.homeInfo.lotSquareFeet=this.lotSquareUnits*f:this.signUpInfo.homeInfo.lotSquareFeet=this.lotSquareUnits,this.isLoading=!0;var a=this;this.$http.post("/api/HomeSignUp",this.signUpInfo).then(function(b){a.isLoading=!1;var c=b.data;HtmlUtil.isNullOrWhitespace(c.errorMessage)?HtmlUtil.isNullOrWhitespace(c.createUrl)?(a.hideWizard=!0,a.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=c.createUrl:(alert("Failed to complete sign-up: "+c.errorMessage),c.stepIndex>=0&&a.WizardHandler.wizard().goTo(c.stepIndex))},function(b){a.isLoading=!1;var c=b.data.exceptionMessage?b.data.exceptionMessage:b.data;alert("Failed to complete sign-up: "+c)})},b.prototype.onHomeAddressChanged=function(){var a=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(b,c){a.$scope.$apply(function(){if(c==google.maps.GeocoderStatus.OK){var d=b[0].formatted_address;d.indexOf(", USA")===d.length-", USA".length&&(d=d.substring(0,d.length-", USA".length)),a.signUpInfo.streetAddress=d,a.centerMap(b[0].geometry)}})})},b.prototype.centerMap=function(a){a.viewport?this.map.fitBounds(a.viewport):(this.map.setCenter(a.location),this.map.setZoom(17)),this.mapMarker.setPosition(a.location),this.mapMarker.setVisible(!0)},b.prototype.prepopulateHomeInfo=function(){if(this.selectedSplitAddress){this.isLoadingHomeInfo=!0;var a="/api/PropertyResearch/HomeInfo?street="+encodeURIComponent(this.selectedSplitAddress.street)+"&city="+encodeURIComponent(this.selectedSplitAddress.city)+"&state="+this.selectedSplitAddress.state+"&zip="+this.selectedSplitAddress.zip,b=this;this.$http.get(a).then(function(a){b.isLoadingHomeInfo=!1;var c=a.data;c&&(b.didLoadHomeInfo=!0,b.signUpInfo.homeInfo=c,c.lotSquareFeet&&(c.lotSquareFeet>f?(b.lotSizeUnit=d,b.lotSquareUnits=c.lotSquareFeet/f,b.lotSquareUnits=parseFloat((Math.round(4*b.lotSquareUnits)/4).toFixed(2))):(b.lotSizeUnit=e,b.lotSquareUnits=c.lotSquareFeet)))},function(){b.isLoadingHomeInfo=!1})}},b.$inject=["$http","$scope","WizardHandler"],b}();a.HomeSignUpController=g}(Ally||(Ally={})),CA.angularApp.component("homeSignUp",{templateUrl:"/ngApp/home/public/SignUp.html",controller:Ally.HomeSignUpController}),ServiceBankInfoCtrl.$inject=["$http"],ServiceBusinessInfoCtrl.$inject=["$http"],ServiceJobsCtrl.$inject=["$http"],CA.angularApp.directive("groupComments",["$http","$rootScope",function(a,b){function c(){var c=this;c.threadId="Home",c.isQaSite="qa"===HtmlUtil.getSubdomain()||"localtest"===HtmlUtil.getSubdomain(),c.editComment={threadId:c.threadId,commentText:"",replyToCommentId:null},c.displayDiscussModal=function(){c.showDiscussModal=!0},c.hideDiscussModal=function(){c.showDiscussModal=!1},c.refreshComments=function(){c.isLoading=!0,a.get("/api/Comment?threadId="+c.threadId).then(function(a){c.isLoading=!1,c.commentList=a.data;var d=function(a){a.postDateUtc=moment.utc(a.postDateUtc).toDate(),a.lastEditDateUtc&&(a.lastEditDateUtc=moment.utc(a.lastEditDateUtc).toDate()),a.deletedDateUtc&&(a.deletedDateUtc=moment.utc(a.deletedDateUtc).toDate()),a.isMyComment=a.authorUserId===b.userInfo.userId,a.replies&&_.each(a.replies,d)};_.each(c.commentList,d)},function(){c.isLoading=!1})},c.postComment=function(b){c.isLoading=!0;var d=a.post;"number"==typeof b.existingCommentId&&(d=a.put),
d("/api/Comment",b).then(function(){c.isLoading=!1,c.editComment={},c.showReplyBoxId=-1,c.refreshComments()},function(a){c.isLoading=!1;var b=a.exceptionMessage?a.exceptionMessage:a;alert("Failed to post comment: "+b)})},c.onPostCommentClicked=function(){if(0!==c.editComment.commentText.length){var a={threadId:c.threadId,commentText:c.editComment.commentText,replyToCommentId:null,existingCommentId:c.editComment.existingCommentId};c.postComment(a)}},c.editMyComment=function(a){c.editComment={commentText:a.commentText,existingCommentId:a.commentId}},c.deleteMyComment=function(b){c.isLoading=!0,a["delete"]("/api/Comment?commentId="+b.commentId).then(function(){c.isLoading=!1,c.refreshComments()},function(a){c.isLoading=!1;var b=a.data.exceptionMessage?a.data.exceptionMessage:a.data;alert("Failed to post comment: "+b)})},c.onPostReplyCommentClicked=function(){if(0!==c.editComment.replyText.length){var a={threadId:c.threadId,commentText:c.editComment.replyText,replyToCommentId:c.editComment.replyToCommentId};c.postComment(a)}},c.clickReplyToComment=function(a){c.showReplyBoxId=a,c.editComment={commentText:"",replyToCommentId:a}},c.refreshComments()}return{scope:{},restrict:"E",replace:"true",controllerAs:"ctrlVM",templateUrl:"/ngApp/Services/CommentDirectiveTemplate.html",controller:c}}]),CA.angularApp.directive("googleMapPolyEditor",["$http",function(a){var b=function(a,b,c){a.mapInfo={center:{lat:39.5,lng:-98.35},zoom:4,disableDefaultUI:!a.enableMapControls,mapTypeId:google.maps.MapTypeId.HYBRID,events:{tilesloaded:function(a,b,c){google.maps.event.clearListeners(a,"tilesloaded")}}},a.googlePolyToGpsBounds=function(a){return a=_.map(a,function(a){return{lat:a.lat(),lon:a.lng()}})},a.centerMapOnPoly=function(b){if(b&&0!==b.length){var c=new google.maps.LatLngBounds;_.map(b,function(a){c.extend(a)}),a.mapInstance.fitBounds(c)}},a.setGroupBounds=function(b){if(!b)return void(a.groupBoundsShape&&(a.groupBoundsShape.setMap(null),a.groupBoundsShape=null));var c=Ally.MapUtil.gpsBoundsToGooglePoly(b),d={paths:c,map:a.mapInstance,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1};a.activeShape&&a.activeShape.setMap(null),a.groupBoundsShape=new google.maps.Polygon(d)},a.fitBoundsForPolys=function(){var b=new google.maps.LatLngBounds;(a.groupBoundsShape||a.currentVisiblePolys&&0!==a.currentVisiblePolys.length)&&(a.groupBoundsShape&&_.each(a.groupBoundsShape.getPath().getArray(),function(a){b.extend(a)}),_.each(a.currentVisiblePolys,function(a){_.each(a.getPath().getArray(),function(a){b.extend(a)})}),a.mapInstance.fitBounds(b))},a.fitBoundsForPoints=function(){if(a.currentVisiblePoints&&0!==a.currentVisiblePoints.length){var b=new google.maps.LatLngBounds;_.each(a.currentVisiblePoints,function(a){b.extend(a.position)}),a.mapInstance.fitBounds(b)}};var d=function(a){var b=function(a){return $("img[src$='"+a+"']")},c=this,d=b(c.btnDeleteImageUrl);if(0===d.length){var e=$("img[src$='http://maps.gstatic.com/mapfiles/undo_poly.png']");e.parent().css("height","21px !important"),e.parent().parent().append('<div style="overflow-x: hidden; overflow-y: hidden; position: absolute; width: 30px; height: 27px;top:21px;"><img src="'+c.btnDeleteImageUrl+'" class="deletePoly" style="height:auto; width:auto; position: absolute; left:0;"/></div>'),d=b(c.btnDeleteImageUrl),d.hover(function(){return $(this).css("left","-30px"),!1},function(){return $(this).css("left","0px"),!1}),d.mousedown(function(){return $(this).css("left","-60px"),!1})}c.btnDeleteClickHandler&&d.unbind("click",c.btnDeleteClickHandler),c.btnDeleteClickHandler=function(){return c.removeAt(a),!1},d.click(c.btnDeleteClickHandler)},e=function(a,b){var c=a.getPath();c.btnDeleteClickHandler={},c.btnDeleteImageUrl=b,google.maps.event.addListener(a.getPath(),"set_at",d),google.maps.event.addListener(a.getPath(),"insert_at",d)};a.currentVisiblePolys=[],a.currentVisiblePoints=[],a.onVisiblePolysChange=function(b){_.each(a.currentVisiblePolys,function(a){a.setMap(null)}),a.currentVisiblePolys=[],_.each(b,function(b){var c=Ally.MapUtil.gpsBoundsToGooglePoly(b),d={paths:c,clickable:"function"==typeof b.onClick,map:a.mapInstance,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.35},e=new google.maps.Polygon(d);e.polyInfo=b,b.mapShapeObject=e,a.currentVisiblePolys.push(e),d.clickable&&google.maps.event.addListener(e,"click",function(){e.polyInfo.onClick()})}),a.fitBoundsForPolys()},a.onVisiblePointsChange=function(b){_.each(a.currentVisiblePoints,function(a){a.setMap(null)}),a.currentVisiblePoints=[],_.each(b,function(b){var c=new google.maps.Marker({position:{lat:b.lat,lng:b.lon},map:a.mapInstance,title:b.fullAddress});c.pointSource=b,a.currentVisiblePoints.push(c),"function"==typeof b.onClick&&google.maps.event.addListener(c,"click",function(){c.pointSource.onClick()})}),a.fitBoundsForPoints()},a.onEditPolyChange=function(b){if(!b)return a.activeShape&&a.activeShape.setMap(null),void(a.activeShape=null);var c=_.map(b.vertices,function(a){return new google.maps.LatLng(a.lat,a.lon)});a.centerMapOnPoly(c);var d={paths:c,editable:!0,draggable:!0,clickable:!0,map:a.mapInstance,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35};a.activeShape&&a.activeShape.setMap(null),a.activeShape=new google.maps.Polygon(d);var f=function(){a.editPolyVerts.vertices=a.googlePolyToGpsBounds(a.activeShape.getPath().getArray())};return google.maps.event.addListener(a.activeShape.getPath(),"set_at",f),google.maps.event.addListener(a.activeShape.getPath(),"insert_at",f),e(a.activeShape,"http://i.imgur.com/RUrKV.png"),a.activeShape},a.$watch("editPolyVerts",function(b){a.onEditPolyChange(b)}),a.$watch("visiblePolys",function(b){a.onVisiblePolysChange(b)}),a.$watch("visiblePoints",function(b){a.onVisiblePointsChange(b)}),a.$watch("groupBoundsPoly",function(b){a.setGroupBounds(b)}),a.$watch("mapCenter",function(b){b&&(b=new google.maps.LatLng(b.lat,b.lon),a.mapInstance.setCenter(b))}),a.mapInstance=new google.maps.Map($(b).children(".google-map-canvas")[0],a.mapInfo),a.onMapEditorReady&&a.onMapEditorReady({mapInstance:a.mapInstance}),google.maps.event.addListener(a.mapInstance,"click",function(b){var c={lat:b.latLng.lat(),lon:b.latLng.lng()},d={lat:b.latLng.lat()+.01,lon:b.latLng.lng()+.01},e=[c,{lat:d.lat,lon:c.lon},d,{lat:c.lat,lon:d.lon}];a.editPolyVerts&&(a.editPolyVerts.vertices=e),a.onEditPolyChange(a.editPolyVerts)})};return{scope:{editPolyVerts:"=",visiblePolys:"=",visiblePoints:"=",groupBoundsPoly:"=",mapCenter:"=",onMapEditorReady:"&",enableMapControls:"="},restrict:"E",replace:"true",templateUrl:"/ngApp/Services/GoogleMapPolyEditorTemplate.html",link:b}}]),CA.angularApp.directive("sendMessage",["$rootScope","fellowResidents",function(a,b){function c(){var a=this;a.shouldShowSendModal=!1,a.shouldShowButtons=!0,a.showSendModal=function(){a.shouldShowSendModal=!0,a.sendResultMessage="",a.shouldShowButtons=!0,setTimeout(function(){document.getElementById("message-text-box").focus()},50)},a.hideModal=function(){a.shouldShowSendModal=!1,a.messageBody=""},a.sendMessage=function(){a.shouldShowButtons=!1,a.isSending=!0,a.sendResultMessage="",b.sendMessage(a.recipientInfo.userId,a.messageBody).then(function(b){a.isSending=!1,a.sendResultIsError=!1,a.messageBody="",a.sendResultMessage="Message sent successfully!"},function(b){a.shouldShowButtons=!0,a.isSending=!1,a.sendResultIsError=!0;var c=b.data.exceptionMessage?b.data.exceptionMessage:b.data;a.sendResultMessage="Failed to send: "+c})}}return{scope:{recipientInfo:"="},restrict:"E",replace:"true",controllerAs:"vm",templateUrl:"/ngApp/Services/SendMessageTemplate.html",controller:c,bindToController:!0}}]),angular.module("CondoAlly").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){var d=13;b.which===d&&(a.$apply(function(){a.$eval(c.ngEnter,{event:b})}),b.preventDefault())})}}),angular.module("CondoAlly").directive("ngEscape",function(){return function(a,b,c){b.bind("keydown keypress",function(b){var d=27;b.which===d&&(a.$apply(function(){a.$eval(c.ngEscape,{event:b})}),b.preventDefault())})}}),CA.angularApp.filter("iif",function(){return function(a,b,c){return a?b:c}}),CA.angularApp.filter("tel",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 7:c=1,d="",e=b;break;case 10:c=1,d=b.slice(0,3),e=b.slice(3);break;case 11:c=b[0],d=b.slice(1,4),e=b.slice(4);break;case 12:c=b.slice(0,3),d=b.slice(3,5),e=b.slice(5);break;default:return d="",a}return 1===c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3),d.length>0&&(d="("+d+")"),(c+" "+d+" "+e).trim()}}),TodoCtrl.$inject=["$http"],CA.angularApp.component("todos",{bindings:{},templateUrl:"/ngApp/Services/TodoDirectiveTemplate.html",controller:TodoCtrl});var Ally;!function(a){var b=function(){function a(){}return a}();a.ExceptionResult=b}(Ally||(Ally={}));var AppCacheService=function(){function a(){this.Key_WasLoggedIn403="wasLoggedIn403",this.Key_WasLoggedIn401="wasLoggedIn401",this.Key_AfterLoginRedirect="afterLoginRedirect",this.KeyPrefix="AppCacheService_"}return a.prototype.set=function(a,b){window.sessionStorage[this.KeyPrefix+a]=b},a.prototype.get=function(a){return window.sessionStorage[this.KeyPrefix+a]},a.prototype.clear=function(a){window.sessionStorage[this.KeyPrefix+a]=void 0,delete window.sessionStorage[this.KeyPrefix+a]},a.prototype.getAndClear=function(a){var b;return b=this.get(a),this.clear(a),b},a}();angular.module("CondoAlly").service("appCacheService",[AppCacheService]);var Ally;!function(a){function b(a){if(!a)return"";var b=a.toString();if(HtmlUtil.isNullOrWhitespace(b))return"";var c=-1!==b.indexOf('"')||-1!==b.indexOf(",")||-1!==b.indexOf("\r")||-1!==b.indexOf("\n");return c&&(b=b.replace('"','""'),b='"'+b+'"'),b}function c(a,c){for(var d="",e=0;e<c.length;++e)e>0&&(d+=","),d+=b(c[e].headerText);for(var f=0;f<a.length;++f){d+="\n";for(var g=a[f],h=0;h<c.length;++h){h>0&&(d+=",");var i=c[h],j=g[i.fieldName];i.dataMapper&&(j=i.dataMapper(j)),d+=b(j)}}return d}var d=function(){function a(){}return a}();a.CsvColumnDescriptor=d,a.ValueToCsvValue=b,a.createCsvString=c}(Ally||(Ally={}));var Ally;!function(a){var b=function(){function a(a,b){this.$http=a,this.$q=b}return a.prototype.getResidents=function(){var a=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(a){return a.data.residents},function(b){return a.$q.reject(b)})},a.prototype.getByUnits=function(){var a=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(a){return a.data.byUnit},function(b){return a.$q.reject(b)})},a.prototype.getByUnitsAndResidents=function(){return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(a){return a.data},function(a){return this.$q.reject(a)})},a.prototype.getGroupEmailObject=function(){var a=this;return this.getByUnitsAndResidents().then(function(b){var c=b.byUnit,d=b.residents;return a.setupGroupEmailObject(d,c,null)})},a.prototype.setupGroupEmailObject=function(a,b,c){c&&"object"==typeof c.everyone||(c={everyone:[],owners:[],renters:[],board:[],residentOwners:[],nonResidentOwners:[],residentOwnersAndRenters:[],propertyManagers:[],discussion:[]});for(var d=0;d<a.length;++d){var e=a[d],f=e.fullName+(e.hasEmail?"":"*");c.everyone.push(f);var g=0,h=32;e.boardPosition!==g&&e.boardPosition!==h&&c.board.push(f),e.boardPosition===h&&c.propertyManagers.push(f),e.includeInDiscussionEmail&&c.discussion.push(f);for(var i=!1,j=!1,k=!1,l=0;l<e.homes.length;++l){var m=e.homes[l];if(!m.isRenter){i=!0;var n=_.find(b,function(a){return a.unitId===m.unitId});k=n.renters.length>0}m.isRenter&&(j=!0)}i&&(c.owners.push(f),k?c.nonResidentOwners.push(f):(c.residentOwners.push(f),c.residentOwnersAndRenters.push(f))),j&&(c.renters.push(f),c.residentOwnersAndRenters.push(f))}return 0===c.renters.length&&(c.residentOwners=[],c.residentOwnersAndRenters=[],c.nonResidentOwners=[]),c},a.prototype.sendMessage=function(a,b){var c={recipientUserId:a,messageBody:b};return this.$http.post("/api/BuildingResidents/SendMessage",c)},a}();a.FellowResidentsService=b}(Ally||(Ally={})),angular.module("CondoAlly").service("fellowResidents",["$http","$q",Ally.FellowResidentsService]);var Ally;!function(a){var b=function(){function a(){}return a}();a.ExceptionResult=b}(Ally||(Ally={}));var Ally;!function(a){var b=function(){function a(){}return a}();a.UserInfo=b;var c=function(){function b(){this.publicSiteInfo={},this.privateSiteInfo={},this.userInfo=new a.UserInfo,this.isLoggedIn=!1}return b.prototype.refreshSiteInfo=function(a,b,c){this._rootScope=a;var d=c.defer();a.isLoadingSite=!0;var e=this,f=function(b){a.isLoadingSite=!1,e.handleSiteInfo(b,a),d.resolve()},g=function(){a.isLoadingSite=!1,d.reject()};return b.get("/api/GroupSite").then(function(a){a.data&&!a.data.userInfo?e.xdLocalStorage.getItem("allyApiAuthToken").then(function(c){c&&HtmlUtil.isValidString(c.value)?(e.setAuthToken(c.value),b.get("/api/GroupSite").then(function(a){f(a.data)},g)):f(a.data)},function(){f(a.data)}):f(a.data)},g),d.promise},b.prototype.testIfIsNeutralPage=function(a){var b="#!/";if(!HtmlUtil.startsWith(a,b))return!1;a="/"+a.substring(b.length);var c=_.find(AppConfig.menu,function(b){return b.path===a});return"object"==typeof c},b.prototype.handleSiteInfo=function(a,b){var c=HtmlUtil.getSubdomain(window.location.host);if(!this.authToken&&b.authToken&&this.setAuthToken(b.authToken),null===a||"null"===a){var d=null===c||"www"===c||"login"===c,e=this.testIfIsNeutralPage(window.location.hash);if(!d||!e)return void GlobalRedirect("https://login."+AppConfig.baseTld+"/#!/Login");a={},a.publicSiteInfo={bgImagePath:"",fullName:AppConfig.appName,siteLogo:"<span style='font-size: 22pt; color: #FFF;'>Welcome to "+AppConfig.appName+"</span>"}}b.publicSiteInfo=a.publicSiteInfo,this.publicSiteInfo=a.publicSiteInfo;var f=a.privateSiteInfo;if(f||(f={}),f.gpsPosition&&"undefined"!=typeof google&&(f.googleGpsPosition=new google.maps.LatLng(f.gpsPosition.lat,f.gpsPosition.lon)),this.privateSiteInfo=f,document.title=this.publicSiteInfo.fullName,this.userInfo=a.userInfo,b.userInfo=a.userInfo,HtmlUtil.isLocalStorageAllowed()&&window.localStorage.setItem("siteInfo",angular.toJson(this.publicSiteInfo)),this.isLoggedIn=null!==b.userInfo&&void 0!==b.userInfo,b.isLoggedIn=this.isLoggedIn,this.isLoggedIn)"undefined"!=typeof $zopim&&$zopim(function(){$zopim.livechat.setName(b.userInfo.firstName+" "+b.userInfo.lastName),-1!==b.userInfo.emailAddress.indexOf("@")&&$zopim.livechat.setEmail(b.userInfo.emailAddress)}),b.isAdmin=b.userInfo.isAdmin,b.isSiteManager=b.userInfo.isSiteManager,"undefined"!=typeof analytics&&analytics.identify(b.userInfo.emailAddress,{name:b.userInfo.fullName});else{b.userInfo=null;var g="#!/Login";window.location.hash==g||AppConfig.isPublicRoute(window.location.hash)||(this.publicSiteInfo&&this.publicSiteInfo.baseUrl?window.location.hash=g:GlobalRedirect(AppConfig.baseUrl+g))}HtmlUtil.isNullOrWhitespace(this.publicSiteInfo.bgImagePath)||$(document.documentElement).css("background-image","url("+b.bgImagePath+this.publicSiteInfo.bgImagePath+")"),this.publicSiteInfo.baseUrl&&(null!==c&&c===this.publicSiteInfo.shortName||!HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||GlobalRedirect(this.publicSiteInfo.baseUrl+"/#!/Home"))},b.prototype.setAuthToken=function(a){window.localStorage&&window.localStorage.setItem("ApiAuthToken",a),this._rootScope.authToken=a,this.xdLocalStorage.setItem("allyApiAuthToken",a).then(function(a){}),this.authToken=a},b}();a.SiteInfoService=c;var d=function(){function a(){}return a.loginInit=function(a,b,c,d,f){var g=a.defer();return e.siteInfo.xdLocalStorage=f,e.isSiteInfoLoaded?g.resolve(e.siteInfo):e.siteInfo.refreshSiteInfo(c,b,a).then(function(){e.isSiteInfoLoaded=!0,c.isSiteInfoLoaded=!0,c.siteTitle={text:c.publicSiteInfo.siteTitleText},c.publicSiteInfo.siteLogo&&(c.siteTitle.logoHtml=d.trustAsHtml(c.publicSiteInfo.siteLogo)),c.onUpdateSiteTitleText=function(){analytics.track("updateSiteTitle"),b.put("/api/Settings",{siteTitle:c.siteTitle.text})},g.resolve(e.siteInfo)}),g.promise},a}();a.SiteInfoHelper=d;var e=function(){function b(){}return b.prototype.$get=function(){return b.isSiteInfoLoaded||alert("Not yet loaded!"),b.siteInfo},b.isSiteInfoLoaded=!1,b.siteInfo=new a.SiteInfoService,b}();a.SiteInfoProvider=e}(Ally||(Ally={})),angular.module("CondoAlly").provider("SiteInfo",Ally.SiteInfoProvider),ManageMembersCtrl.$inject=["$scope","$http","$rootScope","$interval","$http"],WatchSettingsCtrl.$inject=["$http","$rootScope","$resource","SiteInfo"],WatchCalendarCtrl.$inject=["$scope","$timeout","$http","$rootScope","$q"],WatchHomeCtrl.$inject=["$rootScope","$resource","SiteInfo"],WatchMembersCtrl.$inject=["$rootScope","$resource","SiteInfo"];