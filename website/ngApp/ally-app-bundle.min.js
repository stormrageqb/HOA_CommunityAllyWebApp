/*! CommunityAllyWebApp 2018-04-02 */

!function(e){var t=function(){function e(e,t){this.$http=e,this.$q=t,this.isLoading=!1}return e.prototype.$onInit=function(){this.refreshAddresses()},e.prototype.getPolyInfo=function(e,t){var i=this.$q.defer();this.isLoading=!0;var n=this;return this.$http.get(e).then(function(e){n.isLoading=!1;var o=e.data;_.each(o,function(e){e.polyType=t,"Group"==t&&(e.oneLiner=e.shortName+", "+e.appName)}),$.merge(n.addresses,o),i.resolve(n.addresses)},function(e){this.isLoading=!1;var t=e.data.exceptionMessage?e.data.exceptionMessage:e.data;alert("Failed to retrieve addresses: "+t),i.reject()}),i.promise},e.prototype.getGroupBoundPolys=function(){return this.getPolyInfo("/api/AdminMap/GetGroupBounds?filter="+this.filterAddresses,"Group")},e.prototype.getAddressPolys=function(){return this.getPolyInfo("/api/AdminMap?filter="+this.filterAddresses,"Address")},e.prototype.refreshAddresses=function(){this.isLoading=!0,this.addresses=[];var e=this;this.getAddressPolys().then(function(){return e.getGroupBoundPolys()}).then(function(t){e.addressPoints=[],_.each(t,function(t){t.gpsPos&&(t.gpsPos.fullAddress=t.oneLiner,e.addressPoints.push(t.gpsPos))})})},e.prototype.onSavePoly=function(){this.isLoading=!0;var e={vertices:this.selectedAddress.gpsBounds.vertices},t="Address"===this.selectedAddress.polyType?"/api/AdminMap?addressId="+this.selectedAddress.addressId:"/api/AdminMap?groupId="+this.selectedAddress.groupId,i=this;this.$http.put(t,e).then(function(){i.isLoading=!1},function(){i.isLoading=!1})},e.prototype.onAddressSelected=function(e){if(this.selectedAddress=e,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&e.gpsPos){new google.maps.LatLng(e.gpsPos.lat,e.gpsPos.lon),new google.maps.LatLng(e.gpsPos.lat+.001,e.gpsPos.lon+.001);e.gpsBounds.vertices=[{lat:e.gpsPos.lat,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon+.001},{lat:e.gpsPos.lat,lon:e.gpsPos.lon+.001}]}this.selectedGpsPoly=e.gpsBounds},e.$inject=["$http","$q"],e}();e.ManageAddressPolysController=t}(Ally||(Ally={})),CA.angularApp.component("manageAddressPolys",{templateUrl:"/ngApp/admin/manage-address-polys.html",controller:Ally.ManageAddressPolysController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e,i,n){this.$timeout=e,this.$http=i,this.siteInfo=n,this.newAssociation=new t,this.changeShortNameData={},this.retrieveGroups=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Association/adminList").then(function(t){e.isLoading=!1,e.groups=t.data,_.each(e.groups,function(e){0===e.appName?(e.appNameString="Condo",e.baseUrl="https://"+e.shortName+".CondoAlly.com/"):1===e.appName?(e.appNameString="NeighborhoodWatch",e.baseUrl="https://"+e.shortName+".WatchAlly.com/"):2===e.appName?(e.appNameString="Home",e.baseUrl="https://"+e.shortName+".HomeAlly.org/"):3===e.appName?(e.appNameString="Hoa",e.baseUrl="https://"+e.shortName+".HoaAlly.org/"):4===e.appName&&(e.appNameString="Neighborhood",e.baseUrl="https://"+e.shortName+".NeighborhoodAlly.org/")})},function(){e.isLoading=!1,alert("Failed to retrieve groups")})}}return e.prototype.$onInit=function(){},e.prototype.changeShortName=function(){if(/[^a-zA-Z0-9]/.test(this.changeShortNameData.newShortName))alert("The new short name must be alphanumeric");else if(this.changeShortNameData.newShortName===this.changeShortNameData.newShortName.toLowerCase())if(0!==this.changeShortNameData.newShortName.length){this.isLoading=!0;var e=this;this.$http.put("/api/AdminHelper/ChangeShortName?oldShortName="+this.changeShortNameData.old+"&newShortName="+this.changeShortNameData.newShortName,null).success(function(t){e.isLoading=!1,e.retrieveGroups()}).error(function(){e.isLoading=!1,alert("Failed to change short name")})}else alert("New short name must not be empty");else alert("The new short name must be lower-case")},e.prototype.findAssociationsForUser=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Admin/findAssociationsForUser?email="+this.findUserAssociationsEmail).then(function(t){e.isLoading=!1,e.foundUserAssociations=t.data},function(){e.isLoading=!1,alert("Failed to find associations for user")})},e.prototype.deleteAssociation=function(e){if(confirm("Are you sure you want to delete this association?")){this.isLoading=!0;var t=this;this.$http.delete("/api/Association/chtn/"+e.groupId).then(function(){t.isLoading=!1,t.retrieveGroups()},function(e){t.isLoading=!1,console.log(e.data.exceptionMessage),alert("Failed to delete group: "+e.data.exceptionMessage)})}},e.prototype.addAddress=function(){this.newAddressId=null,this.isLoading=!0;var e=this;this.$http.post("/api/AdminHelper/AddAddress?address="+encodeURIComponent(this.newAddress),null).success(function(t){e.isLoading=!1,e.newAddressId=t.data.newAddressId}).error(function(t){e.isLoading=!1,alert("Failed to add address: "+t.data.exceptionMessage)})},e.prototype.onCreateAssociationClick=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Association",this.newAssociation).then(function(){e.isLoading=!1,e.newAssociation=new t,e.retrieveGroups()})},e.prototype.onSendTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendTestEmail?testEmailRecipient="+encodeURIComponent(this.testEmailRecipient))},e.prototype.onSendTaylorTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendFromTaylorEmail?testEmailRecipient="+encodeURIComponent(this.testTaylorEmailRecipient))},e.prototype.onSendTestPostmarkEmail=function(){this.isLoading=!0;var e=this;this.$http.get("/api/AdminHelper/SendTestPostmarkEmail?email="+this.testPostmarkEmail).success(function(){e.isLoading=!1,alert("Successfully sent email")}).error(function(){e.isLoading=!1,alert("Failed to send email")})},e.prototype.makeHelperRequest=function(e,t){void 0===t&&(t=null),this.isLoadingHelper=!0;var i=this;(t?this.$http.post(e,t):this.$http.get(e)).then(function(){return i.isLoadingHelper=!1},function(){i.isLoadingHelper=!1,alert("Failed")})},e.prototype.onTestException=function(){this.makeHelperRequest("/api/Association/testException")},e.prototype.onClearElmahLogs=function(){this.makeHelperRequest("/api/Admin/clearElmah")},e.prototype.onClearAppGroupCache=function(){this.makeHelperRequest("/api/AdminHelper/ClearGroupCache")},e.prototype.onSendInactiveGroupsMail=function(){var e={shortNameLines:this.inactiveShortNames};this.makeHelperRequest("/api/AdminHelper/SendInactiveGroupsMail",e)},e.prototype.logInAs=function(){var e=this;this.isLoading=!0,this.$http.get("/api/AdminHelper/LogInAs?email="+this.logInAsEmail).then(function(t){e.siteInfo.setAuthToken(t.data),window.location.href="/#!/Home",window.location.reload(!1)},function(e){alert("Failed to perform login: "+e.data.exceptionMessage)}).finally(function(){return e.isLoading=!1})},e.$inject=["$timeout","$http","SiteInfo"],e}();e.ManageGroupsController=i}(Ally||(Ally={})),CA.angularApp.component("manageGroups",{templateUrl:"/ngApp/admin/manage-groups.html",controller:Ally.ManageGroupsController});!function(e){var t=function(){function t(t,i){this.$http=t,this.$q=i,this.isLoading=!1,this.unitToEdit=new e.Unit,this.isEdit=!1}return t.prototype.$onInit=function(){this.refresh()},t.prototype.refresh=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Unit?includeAddressData=true").then(function(t){e.isLoading=!1,e.units=t.data},function(){e.isLoading=!1,alert("Failed to load homes")})},t.prototype.onCreateUnitClick=function(){if($("#AddUnitForm").validate(),$("#AddUnitForm").valid()){this.isLoading=!0;var t=this,i=function(){t.isLoading=!1,t.isEdit=!1,t.unitToEdit=new e.Unit,t.refresh()};this.isEdit?this.$http.put("/api/Unit",this.unitToEdit).then(i):this.$http.post("/api/Unit",this.unitToEdit).then(i)}},t.prototype.onEditUnitClick=function(e){this.isEdit=!0,this.unitToEdit=e,e.fullAddress&&(this.unitToEdit.streetAddress=e.fullAddress.oneLiner)},t.prototype.onDeleteUnitClick=function(e){var t=this;this.$http.delete("/api/Unit/"+e.unitId).then(function(){t.refresh()})},t.prototype.onFastAddUnits=function(){var e=this;this.isLoading=!0;var t=this;this.$http.post("/api/Unit?fastAdd="+this.lastFastAddName,null).then(function(){e.isLoading=!1,t.refresh()},function(t){e.isLoading=!1,alert("Failed fast add:"+t.data.exceptionMessage)})},t.prototype.onAddUnitsPerLine=function(){var e={action:"onePerLine",lines:this.unitNamePerLine};this.isLoading=!0;var t=this;this.$http.post("/api/Unit?onePerLine=1",e).then(function(){t.isLoading=!1,t.refresh()},function(){t.isLoading=!1,alert("Failed")})},t.prototype.onAddUnitsByAddressPerLine=function(){var e={action:"onePerLine",lines:this.unitAddressPerLine};this.isLoading=!0;var t=this;this.$http.post("/api/Unit/FromAddresses",e).then(function(){t.isLoading=!1,t.refresh()},function(){t.isLoading=!1,alert("Failed")})},t.prototype.onDeleteAllClick=function(){if(confirm("This will delete every unit! This should only be used for new sites!")){var e=this;this.$http.get("/api/Unit?deleteAction=all").then(function(){e.refresh()},function(){})}},t.$inject=["$http","$rootScope"],t}();e.ManageHomesController=t}(Ally||(Ally={})),CA.angularApp.component("manageHomes",{templateUrl:"/ngApp/admin/manage-homes.html",controller:Ally.ManageHomesController});!function(e){var t=function(){function e(e){this.$http=e,this.isLoading=!1}return e.prototype.$onInit=function(){this.retrieveEntries()},e.prototype.retrieveEntries=function(){this.isLoading=!0;var e=this;this.$http.get("/api/ActivityLog").then(function(t){e.isLoading=!1,e.logEntries=t.data,_.each(e.logEntries,function(e){return e.postDate=moment(e.postDate).toDate()})},function(t){e.isLoading=!1,alert("Failed to load activity log: "+t.data.exceptionMessage)})},e.$inject=["$http"],e}();e.ViewActivityLogController=t}(Ally||(Ally={})),CA.angularApp.component("viewActivityLog",{templateUrl:"/ngApp/admin/view-activity-log.html",controller:Ally.ViewActivityLogController});!function(e){var t=function(){function e(e){this.$http=e,this.isLoading=!1}return e.prototype.$onInit=function(){this.refreshAddresses()},e.prototype.findCenter=function(e){for(var t={lat:0,lng:0},i=0;i<e.length;++i){var n=e[i];if(n){for(var o={lat:0,lng:0},s=0;s<n.vertices.length;++s){var a=n.vertices[s];o.lat+=a.lat,o.lng+=a.lng}o.lat/=n.vertices.length,o.lng/=n.vertices.length,t.lat+=o.lat,t.lng+=o.lng}}return t.lat/=e.length,t.lng/=e.length,t},e.prototype.refreshAddresses=function(){var e=this;this.isLoading=!0,this.neighborhoodPolys=[];var t=this;this.$http.get("/api/Neighborhood").then(function(i){t.isLoading=!1,t.neighborhoods=i.data,t.neighborhoodPolys=_.select(t.neighborhoods,function(e){return e.Bounds}),t.mapCenter=t.findCenter(e.neighborhoodPolys)},function(e){t.isLoading=!1,alert("Failed to retrieve neighborhoods: "+e.data.exceptionMessage)})},e.$inject=["$http","$q"],e}();e.ViewPolysController=t}(Ally||(Ally={})),CA.angularApp.component("viewPolys",{templateUrl:"/ngApp/admin/view-polys.html",controller:Ally.ViewPolysController});!function(e){var t=function(){function e(e){this.$http=e,this.isLoading=!1}return e.prototype.$onInit=function(){this.mapCenter={lat:41.99114,lng:-87.690425},this.refreshCells()},e.prototype.addLine=function(e,t,i,n,o){var s=[{lat:t,lng:i},{lat:n,lng:o}];new google.maps.Polyline({path:s,geodesic:!1,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(e)},e.prototype.onBuildingSelected=function(e){},e.prototype.onCellSelected=function(e){e.gpsBounds.mapShapeObject.setOptions({fillOpacity:.1}),this.selectedCell&&this.selectedCell.gpsBounds.mapShapeObject.setOptions({fillOpacity:.35}),this.selectedCell=e,_.each(this.selectedCell.streets,function(t){0!=t.minLat&&this.addLine(e.gpsBounds.mapShapeObject.map,t.minLat,t.minLon,t.maxLat,t.maxLon)})},e.prototype.refreshCells=function(){this.isLoading=!0;var e=this;this.$http.get("/api/ResearchMap").then(function(t){e.isLoading=!1,e.cells=t.data,e.isLoading=!0,e.$http.get("/api/ResearchMap/Buildings").then(function(t){e.isLoading=!1,e.buildings=t.data,e.buildingPoints=_.map(e.buildings,function(e){var t=e.addressPos;return t.ownerBuilding=e,t.onClick=function(){},t})})},function(t){e.isLoading=!1,alert("Failed to retrieve cells: "+t.data.exceptionMessage)})},e.prototype.onAddressSelected=function(e){if(this.selectedAddress=e,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&e.gpsPos){new google.maps.LatLng(e.gpsPos.lat,e.gpsPos.lon),new google.maps.LatLng(e.gpsPos.lat+.001,e.gpsPos.lon+.001);e.gpsBounds.vertices=[{lat:e.gpsPos.lat,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon+.001},{lat:e.gpsPos.lat,lon:e.gpsPos.lon+.001}]}this.selectedGpsPoly=e.gpsBounds},e.$inject=["$http"],e}();e.ViewResearchController=t}(Ally||(Ally={})),CA.angularApp.component("viewResearch",{templateUrl:"/ngApp/admin/view-research.html",controller:Ally.ViewResearchController});var OverrideBaseApiPath=null;CA.angularApp.config(["$routeProvider","$httpProvider","$provide","SiteInfoProvider","$locationProvider",function(e,t,i,n,o){o.hashPrefix("!");if(null!==HtmlUtil.getSubdomain(OverrideBaseApiPath)||"#!/Login"===window.location.hash){for(var s={app:["$q","$http","$rootScope","$sce","$location","xdLocalStorage","appCacheService",function(e,t,i,n,o,s,a){return Ally.SiteInfoHelper.loginInit(e,t,i,n,s).then(function(t){return function(e,t,i,n){var o=t.defer();return i.userInfo?o.resolve():("/Home"!==e.path()&&"/Login"!==e.path()&&(n.set(n.Key_AfterLoginRedirect,e.path()),n.set(n.Key_WasLoggedIn401,"true")),o.reject(),e.path("/Login")),o.promise}(o,e,t,a)})}]},a={app:["$q","$http","$rootScope","$sce","xdLocalStorage",Ally.SiteInfoHelper.loginInit]},r=angular.extend({},e,{when:function(t,i){return i.resolve=i.resolve?i.resolve:{},i.allyRole===Role_All?angular.extend(i.resolve,a):angular.extend(i.resolve,s),e.when(t,i),this}}),l=0;l<AppConfig.menu.length;++l){var p=AppConfig.menu[l],c={controller:p.controller,allyRole:p.role};p.templateUrl?c.templateUrl=p.templateUrl:c.template=p.templateHtml,p.controllerAs&&(c.controllerAs=p.controllerAs),r.when(p.path,c)}e.otherwise({redirectTo:"/Home"}),i.factory("http403Interceptor",["$q","$location","$rootScope","appCacheService","$injector",function(e,t,i,n,o){return{response:function(e){return e},responseError:function(s){var a=s.status;if(401===a||403===a){if(403===a&&i.dontHandle403)return e.reject(s);if(403===a&&i.isLoggedIn&&n.set(n.Key_WasLoggedIn403,"true"),401===a&&HtmlUtil.isValidString(window.localStorage.rememberMe_Email)){var r=o.get("$http");if(!i.retryLoginDeffered){i.retryLoginDeffered=e.defer();var l={emailAddress:window.localStorage.rememberMe_Email,password:atob(window.localStorage.rememberMe_Password)};setTimeout(function(){r.post("/api/Login",l).then(function(e){var t=e.data;o.get("SiteInfo").setAuthToken(t.authToken),i.retryLoginDeffered.resolve()},function(){var e=i.retryLoginDeffered;i.onLogOut_ClearData(),e.reject()}).finally(function(){i.retryLoginDeffered=null})},1e3)}var p=e.defer();return i.retryLoginDeffered.promise.then(function(){p.resolve(r(s.config))},function(){p.reject(s)}),p.promise}"/Home"!==t.path()&&"/Login"!==t.path()&&(n.set(n.Key_AfterLoginRedirect,t.path()),n.set(n.Key_WasLoggedIn401,"true")),i.onLogOut_ClearData()}return e.reject(s)}}}]),t.interceptors.push("http403Interceptor"),i.factory("apiUriInterceptor",["$rootScope",function(e){return"string"!=typeof e.authToken&&window.localStorage&&(e.authToken=window.localStorage.getItem("ApiAuthToken")),{request:function(t){return HtmlUtil.startsWith(t.url,"/api/")&&(HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||(t.url=OverrideBaseApiPath+t.url),t.headers.Authorization="Bearer "+e.authToken),t}}}]),t.interceptors.push("apiUriInterceptor")}else GlobalRedirect(AppConfig.baseUrl)}]),CA.angularApp.run(["$rootScope","$http","$sce","$location","$templateCache","$cacheFactory","xdLocalStorage",function(e,t,i,n,o,s,a){e.bgImagePath="/assets/images/Backgrounds/",e.appConfig=AppConfig,e.isLoggedIn=!1,e.publicSiteInfo={},e.hideMenu=!1,e.isAdmin=!1,e.isSiteManager=!1,e.menuItems=_.where(AppConfig.menu,function(e){return!HtmlUtil.isNullOrWhitespace(e.menuTitle)}),e.mainMenuItems=_.where(e.menuItems,function(e){return e.role===Role_Authorized}),e.manageMenuItems=_.where(e.menuItems,function(e){return e.role===Role_Manager}),e.adminMenuItems=_.where(e.menuItems,function(e){return e.role===Role_Admin}),HtmlUtil.isLocalStorageAllowed()&&window.localStorage&&(e.publicSiteInfo=angular.fromJson(window.localStorage.getItem("siteInfo")),e.authToken=window.localStorage.getItem("ApiAuthToken"),null!==e.publicSiteInfo&&void 0!==e.publicSiteInfo||(e.publicSiteInfo={})),a.init({iframeUrl:"https://communityally.org/xd-local-storage.html"}).then(function(){}),e.onLogOut_ClearData=function(){e.userInfo={},e.isLoggedIn=!1,e.isAdmin=!1,e.isSiteManager=!1,e.authToken="",window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null,a.removeItem("allyApiAuthToken"),s.get("$http").removeAll(),window.localStorage&&window.localStorage.removeItem("siteInfo"),n.path("/Login")},e.onLogOut=function(){t.get("/api/Login/Logout").then(e.onLogOut_ClearData,e.onLogOut_ClearData)},e.$on("$routeChangeStart",function(){CA.clearTemplateCacheIfNeeded&&CA.clearTemplateCacheIfNeeded(o)}),e.$on("$routeChangeSuccess",function(t,i,o,s){e.curPath=n.path();var a="",r=n.path();-1!==r.indexOf("?")&&(a=r.substring(r.indexOf("?"),r.length));var l="";s&&s.name&&(l=n.protocol()+"://"+n.host()+"/#"+s.url),analytics.page({path:r,referrer:l,search:a,url:n.absUrl()})})}]);!function(e){var t=function(){return function(){}}();e.MenuItem_v3=t}(Ally||(Ally={}));function RoutePath(e,t,i,n,o){"/"!==e[0]&&(e="/"+e),this.path=e,this.templateUrl=t,this.controller=i,this.menuTitle=n,this.role=o||Role_Authorized,this.controllerAs="function"==typeof i?"vm":null}function RoutePath_v2(e){"/"!==e.path[0]&&(e.path="/"+e.path),this.path=e.path,this.templateUrl=e.templateUrl,this.templateHtml=e.templateHtml,this.controller=e.controller,this.menuTitle=e.menuTitle,this.role=e.role||Role_Authorized,this.controllerAs="function"==typeof e.controller?"vm":null}function RoutePath_v3(e){"/"!==e.path[0]&&(e.path="/"+e.path),this.path=e.path,this.templateHtml=e.templateHtml,this.menuTitle=e.menuTitle,this.role=e.role||Role_Authorized}var Role_Authorized="authorized",Role_All="all",Role_Manager="manager",Role_Admin="admin",PeriodicPaymentFrequencies=[{name:"Monthly",intervalName:"month",id:50},{name:"Quarterly",intervalName:"quarter",id:51},{name:"Semiannually",intervalName:"half-year",id:52},{name:"Annually",intervalName:"year",id:53}];function FrequencyIdToInfo(e){return PeriodicPaymentFrequencies[e-50]}var CondoAllyAppConfig={appShortName:"condo",appName:"Condo Ally",baseTld:"condoally.com",baseUrl:"https://condoally.com/",segmentWriteKey:"GnlZNd8jKCpDgFqRKbA4nftkuFIaqKPQ",homeName:"Unit",menu:[new RoutePath_v3({path:"Home",templateHtml:"<chtn-home></chtn-home>",menuTitle:"Home"}),new RoutePath_v3({path:"BuildingInfo",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info"}),new RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",controller:"LogbookController",menuTitle:"Calendar"}),new RoutePath_v3({path:"Map",templateHtml:"<chtn-map></chtn-map>",menuTitle:"Map"}),new RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Residents"}),new RoutePath_v3({path:"Committee/:committeeId/:viewName",templateHtml:"<committee-parent></committee-parent>"}),new RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"SignUp",templateHtml:"<condo-sign-up-wizard></condo-sign-up-wizard>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"EmailAbuse/:idValue",templateHtml:"<email-abuse></email-abuse>",role:Role_All}),new RoutePath_v3({path:"DiscussionManage/:idValue",templateHtml:"<discussion-manage></discussion-manage>"}),new RoutePath_v3({path:"NeighborSignUp",templateHtml:"<neighbor-sign-up></neighbor-sign-up>",role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager}),new RoutePath_v3({path:"ManageCommittees",templateHtml:"<manage-committees></manage-committees>",menuTitle:"Committees",role:Role_Manager}),new RoutePath_v3({path:"ManagePolls",templateHtml:"<manage-polls></manage-polls>",menuTitle:"Polls",role:Role_Manager}),new RoutePath_v3({path:"ManagePayments",templateHtml:"<manage-payments></manage-payments>",menuTitle:"Online Payments",role:Role_Manager}),new RoutePath_v3({path:"AssessmentHistory",templateHtml:"<assessment-history></assessment-history>",menuTitle:"Assessment History",role:Role_Manager}),new RoutePath_v3({path:"Settings",templateHtml:"<chtn-settings></chtn-settings>",menuTitle:"Settings",role:Role_Manager}),new RoutePath_v3({path:"/Admin/ManageGroups",templateHtml:"<manage-groups></manage-groups>",menuTitle:"Manage Associations",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ManageHomes",templateHtml:"<manage-homes></manage-homes>",menuTitle:"Manage Homes",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"Edit Addresses",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ViewPolys",templateHtml:"<view-polys></view-polys>",menuTitle:"View Polygons",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ViewResearch",templateHtml:"<view-research></view-research>",menuTitle:"View Research",role:Role_Admin})]},WatchAppConfig={appShortName:"watch",appName:"Neighborhood Watch Ally",baseTld:"watchally.org",baseUrl:"https://watchally.org/",menu:[new RoutePath("Home","/ngApp/watch/member/WatchHome.html",WatchHomeCtrl,"Home"),new RoutePath("Members","/ngApp/watch/member/WatchMembers.html",WatchMembersCtrl,"Members"),new RoutePath("Calendar","/ngApp/watch/member/WatchCalendar.html",WatchCalendarCtrl,"Calendar"),new RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath("ManageMembers","/ngApp/watch/manager/ManageMembers.html",ManageMembersCtrl,"Members",Role_Manager),new RoutePath("Settings","/ngApp/watch/manager/Settings.html",WatchSettingsCtrl,"Settings",Role_Manager),new RoutePath("/Admin/ManageWatchGroups","/ngApp/Admin/ManageAssociations.html","ManageAssociationsController","Manage Groups",Role_Admin),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin}),new RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"Edit Addresses",role:Role_Admin})]},ServiceAppConfig={appShortName:"service",appName:"Service Professional Ally",baseTld:"serviceally.org",baseUrl:"https://serviceally.org/",menu:[new RoutePath("Jobs","/ngApp/service/Jobs.html",ServiceJobsCtrl,"Jobs"),new RoutePath("BusinessInfo","/ngApp/service/BusinessInfo.html",ServiceBusinessInfoCtrl,"Business Info"),new RoutePath("Banking","/ngApp/service/BankInfo.html",ServiceBankInfoCtrl,"Banking"),new RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin})]},HomeAppConfig={appShortName:"home",appName:"Home Ally",baseTld:"homeally.org",baseUrl:"https://homeally.org/",menu:[new RoutePath_v3({path:"Home",templateHtml:"<home-group-home></home-group-home>",menuTitle:"Home"}),new RoutePath_v2({path:"ToDo",templateUrl:"/ngApp/home/ToDos.html",controller:ServiceJobsCtrl,menuTitle:"Jobs"}),new RoutePath_v3({path:"SignUp",templateHtml:"<home-sign-up></home-sign-up>",role:Role_All}),new RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin})]},HOAAppConfig=_.clone(CondoAllyAppConfig);HOAAppConfig.appShortName="hoa",HOAAppConfig.appName="HOA Ally",HOAAppConfig.baseTld="hoaally.org",HOAAppConfig.baseUrl="https://hoaally.org/",HOAAppConfig.homeName="Home",HOAAppConfig.menu.push(new RoutePath_v3({path:"HoaSignUp",templateHtml:"<hoa-sign-up-wizard></hoa-sign-up-wizard>",role:Role_All}));var NeighborhoodAppConfig=_.clone(CondoAllyAppConfig);NeighborhoodAppConfig.appShortName="neighborhood",NeighborhoodAppConfig.appName="Neighborhood Ally",NeighborhoodAppConfig.baseTld="neighborhoodally.org",NeighborhoodAppConfig.baseUrl="https://neighborhoodally.org/",NeighborhoodAppConfig.homeName="Home",NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(e){return"Residents"===e.menuTitle}),NeighborhoodAppConfig.menu.push(new RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"})),NeighborhoodAppConfig.menu.splice(0,0,new RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager})),NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(e){return"Assessment History"===e.menuTitle}),NeighborhoodAppConfig.menu.splice(3,0,new RoutePath_v3({path:"DuesHistory",menuTitle:"Dues History",templateHtml:"<dues-history></dues-history>",role:Role_Manager})),NeighborhoodAppConfig.menu.push(new RoutePath_v3({path:"NeighborhoodSignUp",templateHtml:"<neighborhood-sign-up-wizard></neighborhood-sign-up-wizard>",role:Role_All}));var BlockClubAppConfig=_.clone(CondoAllyAppConfig);BlockClubAppConfig.appShortName="block-club",BlockClubAppConfig.appName="Block Club Ally",BlockClubAppConfig.baseTld="chicagoblock.club",BlockClubAppConfig.baseUrl="https://chicagoblock.club/",BlockClubAppConfig.homeName="Home",BlockClubAppConfig.menu=_.reject(BlockClubAppConfig.menu,function(e){return"Residents"===e.menuTitle}),BlockClubAppConfig.menu.push(new RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"})),BlockClubAppConfig.menu.splice(0,0,new RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager})),BlockClubAppConfig.menu=_.reject(BlockClubAppConfig.menu,function(e){return"Assessment History"===e.menuTitle}),BlockClubAppConfig.menu.splice(3,0,new RoutePath_v3({path:"DuesHistory",menuTitle:"Dues History",templateHtml:"<dues-history></dues-history>",role:Role_Manager})),BlockClubAppConfig.menu.push(new RoutePath_v3({path:"NeighborhoodSignUp",templateHtml:"<neighborhood-sign-up-wizard></neighborhood-sign-up-wizard>",role:Role_All}));var AppConfig=null,lowerDomain=document.domain.toLowerCase();HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||(lowerDomain=OverrideBaseApiPath.toLowerCase()),-1!==lowerDomain.indexOf("condoally")||-1!==lowerDomain.indexOf("hellocondo")?AppConfig=CondoAllyAppConfig:-1!==lowerDomain.indexOf("watchally")?AppConfig=WatchAppConfig:-1!==lowerDomain.indexOf("serviceally")?AppConfig=ServiceAppConfig:-1!==lowerDomain.indexOf("homeally")||-1!==lowerDomain.indexOf("helloathome")?AppConfig=HomeAppConfig:-1!==lowerDomain.indexOf("hoaally")||-1!==lowerDomain.indexOf("hellohoa")?AppConfig=HOAAppConfig:-1!==lowerDomain.indexOf("neighborhoodally")||-1!==lowerDomain.indexOf("helloneighborhood")?AppConfig=NeighborhoodAppConfig:-1!==lowerDomain.indexOf("chicagoblock")||-1!==lowerDomain.indexOf("blockclub")?AppConfig=BlockClubAppConfig:(console.log("Unknown ally app"),AppConfig=CondoAllyAppConfig),window.AppConfig=AppConfig,AppConfig.isPublicRoute=function(e){e||(e=window.location.hash),HtmlUtil.startsWith(e,"#!")&&(e=e.substr(2));var t=-1!==e.indexOf("/",1);t&&(e=e.substr(0,e.indexOf("/",1)));var i=_.find(AppConfig.menu,function(i){var n=i.path;return!!n&&(t&&-1!==n.indexOf("/",1)&&(n=n.substr(0,n.indexOf("/",1))),n===e)});return!!i&&i.role===Role_All},document.title=AppConfig.appName,$(document).ready(function(){$("header").css("background-image","url(/assets/images/header-img-"+AppConfig.appShortName+".jpg)")});!function(e){var t;(i=t||(t={}))[i.Monthly=50]="Monthly",i[i.Quarterly=51]="Quarterly",i[i.Semiannually=52]="Semiannually",i[i.Annually=53]="Annually";var i,n=function(){function e(e,t,i,n){this.$http=e,this.$location=t,this.siteInfo=i,this.appCacheService=n,this.LocalStorageKey_ShowPaymentInfo="AssessmentHistory_ShowPaymentInfo",this.NumPeriodsVisible=10,this.shouldShowCreateSpecialAssessment=!1,this.unitPayments={},this.onSavePayment=function(){var e=this,t=function(){e.isSavingPayment=!1,e.editPayment=null,e.retrievePaymentHistory()},i=function(t){e.isSavingPayment=!1,alert(t.data.message),e.editPayment=null};this.isSavingPayment=!0,this.editPayment.payment.paymentId?(analytics.track("editAssessmentHistoryPayment"),this.$http.put("/api/PaymentHistory",this.editPayment.payment).then(t,i)):(analytics.track("addAssessmentHistoryPayment"),this.$http.post("/api/PaymentHistory",this.editPayment.payment).then(t,i))}}return e.prototype.$onInit=function(){"neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName?this.pageTitle="Membership Dues Payment History":this.pageTitle="Assessment Payment History",this.authToken=window.localStorage.getItem("ApiAuthToken"),this.units=[{name:"A",monthPayments:[1,2,3]},{name:"B",monthPayments:[1,2,3]},{name:"C",monthPayments:[1,2,3]}];this.showPaymentInfo="true"===window.localStorage[this.LocalStorageKey_ShowPaymentInfo];this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,this.payPeriodName="month",51===this.assessmentFrequency?this.payPeriodName="quarter":52===this.assessmentFrequency?this.payPeriodName="half-year":53===this.assessmentFrequency&&(this.payPeriodName="year"),this.maxPeriodRange=12,51===this.assessmentFrequency?this.maxPeriodRange=4:52===this.assessmentFrequency?this.maxPeriodRange=2:53===this.assessmentFrequency&&(this.maxPeriodRange=1),this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this.periodNames=this.monthNames,this.shortPeriodNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],51===this.assessmentFrequency?(this.periodNames=["Quarter 1","Quarter 2","Quarter 3","Quarter 4"],this.shortPeriodNames=["Q1","Q2","Q3","Q4"]):52===this.assessmentFrequency?(this.periodNames=["First Half","Second Half"],this.shortPeriodNames=["1st Half","2nd Half"]):53===this.assessmentFrequency&&(this.periodNames=[""],this.shortPeriodNames=[""]),this.startPeriodValue=(new Date).getMonth()+2,this.startYearValue=(new Date).getFullYear(),51===this.assessmentFrequency?this.startPeriodValue=Math.floor((new Date).getMonth()/4)+2:52===this.assessmentFrequency?this.startPeriodValue=Math.floor((new Date).getMonth()/6)+2:53===this.assessmentFrequency&&(this.startPeriodValue=1,this.startYearValue=(new Date).getFullYear()+1),this.startPeriodValue>this.maxPeriodRange&&(this.startPeriodValue=1,this.startYearValue+=1),this.isPeriodicPaymentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled,this.retrievePaymentHistory()},e.prototype.onChangePeriodicPaymentTracking=function(){if(this.isPeriodicPaymentTrackingEnabled!==this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled){this.isPeriodicPaymentTrackingEnabled,this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled=this.isPeriodicPaymentTrackingEnabled,this.isLoading=!0;var e=this;this.$http.put("/api/Association/updatePeriodicPaymentTracking?isPeriodicPaymentTrackingEnabled="+this.isPeriodicPaymentTrackingEnabled,null).then(function(){e.isLoading=!1},function(){alert("Failed to update the payment tracking"),e.isLoading=!1})}},e.prototype.fillInEmptyPayments=function(e){for(var t=null!==e.owners&&e.owners.length>0?e.owners[0].userId:null,i=[],n=this.startPeriodValue,o=this.startYearValue,s=0;s<this.NumPeriodsVisible;++s){n<1&&(n=this.maxPeriodRange,--o);var a=_.find(e.allPayments,function(e){return e.period===n&&e.year===o});(void 0===a||a.isEmptyEntry)&&(a={isPaid:!1,period:n,year:o,amount:e.assessment,payerUserId:t,paymentDate:new Date,isEmptyEntry:!0}),i.push(a),n--}return i},e.prototype.viewWePayDetails=function(e){this.appCacheService.set("hwpid",e),this.$location.path("/ManagePayments")},e.prototype.addSpecialAssessment=function(){this.createSpecialAssessment=parseInt(this.createSpecialAssessment)+1,this.isLoading=!0;var e=this;this.$http.post("/api/PaymentHistory/SpecialAssessment",this.createSpecialAssessment).then(function(){e.isLoading=!1,e.shouldShowCreateSpecialAssessment=!1,e.retrievePaymentHistory()},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to add special assessment: "+i)})},e.prototype.showCreateSpecialAssessment=function(){this.shouldShowCreateSpecialAssessment=!0,this.createSpecialAssessment={year:(new Date).getFullYear(),month:(new Date).getMonth().toString(),notes:"",amount:null}},e.prototype.browsePast=function(){for(this.startPeriodValue=this.startPeriodValue-6;this.startPeriodValue<1;)this.startPeriodValue=this.maxPeriodRange+this.startPeriodValue,--this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},e.prototype.browseFuture=function(){for(this.startPeriodValue=this.startPeriodValue+6;this.startPeriodValue>this.maxPeriodRange;)this.startPeriodValue-=this.maxPeriodRange,++this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},e.prototype.displayPaymentsForRange=function(e,t){this.startYearValue=e,this.startPeriodValue=t,this.visiblePeriodNames=[];for(var i=this.startYearValue,n=this.startPeriodValue,o=0;o<this.NumPeriodsVisible;++o){n<1&&(n=this.maxPeriodRange,--i);var s=this.shortPeriodNames[n-1];1!==n&&n!==this.maxPeriodRange||(s+=" "+i),this.visiblePeriodNames.push({name:s,periodIndex:n,arrayIndex:o,year:i}),--n}var a=this;_.each(this.unitPayments,function(e){e.payments=a.fillInEmptyPayments(e)})},e.prototype.retrievePaymentHistory=function(){this.isLoading=!0;var e=this;this.$http.get("/api/PaymentHistory?oldestDate=").then(function(t){for(var i=t.data,n=0;n<i.payments.length;++n)"string"==typeof i.payments[n].paymentDate&&i.payments[n].paymentDate.length>0&&(i.payments[n].paymentDate=new Date(i.payments[n].paymentDate));e.unitPayments={},_.each(i.units,function(t){for(e.unitPayments[t.unitId]=t,e.unitPayments[t.unitId].displayOwners=_.first(t.owners,2);e.unitPayments[t.unitId].displayOwners.length<2;)e.unitPayments[t.unitId].displayOwners.push({name:""});e.unitPayments[t.unitId].payments=[]}),_.each(i.payments,function(t){e.unitPayments[t.unitId].payments.push(t)}),_.each(i.units,function(e){e.allPayments=e.payments}),e.displayPaymentsForRange(e.startYearValue,e.startPeriodValue);var o=[];for(var s in e.unitPayments)o.push(e.unitPayments[s]);e.unitPayments=_.sortBy(o,function(e){return e.name}),e.payers=_.sortBy(i.payers,function(e){return e.name}),e.isLoading=!1})},e.prototype.getPaymentSumForPayPeriod=function(e){for(var t=0,i=_.keys(this.unitPayments),n=0;n<i.length;++n){var o=i[n],s=this.unitPayments[o].payments[e];s&&s.isPaid&&(t+=s.amount)}return t},e.prototype.onshowPaymentInfo=function(){window.localStorage[this.LocalStorageKey_ShowPaymentInfo]=this.showPaymentInfo},e.prototype.onPaymentCellClick=function(e,t){t.unitId=e.unitId,this.editPayment={unit:e,payment:_.clone(t),periodName:this.periodNames[t.period-1],filteredPayers:_.filter(this.payers,function(t){return!_.some(e.owners,function(e){return e.userId===t.userId})})},setTimeout(function(){$("#paid-amount-textbox").focus()},10)},e.$inject=["$http","$location","SiteInfo","appCacheService"],e}();e.AssessmentHistoryController=n}(Ally||(Ally={})),CA.angularApp.component("assessmentHistory",{templateUrl:"/ngApp/chtn/manager/assessment-history.html",controller:Ally.AssessmentHistoryController});!function(e){var t=function(){return function(){}}();e.DuesHistoryController=t}(Ally||(Ally={})),CA.angularApp.component("duesHistory",{templateUrl:"/ngApp/chtn/manager/dues-history.html",controller:Ally.DuesHistoryController});!function(e){var t=function(){return function(){this.isPrivate=!1}}();e.Committee=t;var i=function(){function e(e,i,n){this.$http=e,this.siteInfo=i,this.$cacheFactory=n,this.includeInactive=!1,this.committees=[],this.newCommittee=new t,this.isLoading=!1,this.newCommittee.committeeType="Ongoing"}return e.prototype.$onInit=function(){this.retrieveCommittees()},e.prototype.toggleCommitteeActive=function(e){this.isLoading=!0;var t=(e.deactivationDateUtc?"/api/Committee/Reactivate/":"/api/Committee/Deactivate/")+e.committeeId,i=this;this.$http.put(t,null).success(function(e){i.isLoading=!1,i.retrieveCommittees()}).error(function(e){i.isLoading=!1,alert("Failed to retrieve the modify committee: "+e.exceptionMessage)})},e.prototype.retrieveCommittees=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Committee").success(function(t){e.isLoading=!1,e.committees=t,_.forEach(t,function(e){return e.creationDateUtc=moment.utc(e.creationDateUtc).toDate()})}).error(function(t){e.isLoading=!1,alert("Failed to retrieve the committee listing")})},e.prototype.createCommittee=function(){var e=this;if(HtmlUtil.isNullOrWhitespace(this.newCommittee.name))alert("Please enter a name.");else{this.isLoading=!0;var i="/api/Committee?name="+encodeURIComponent(this.newCommittee.name)+"&type="+encodeURIComponent(this.newCommittee.committeeType)+"&isPrivate="+this.newCommittee.isPrivate.toString();this.$http.post(i,null).success(function(){e.isLoading=!1,e.newCommittee=new t,e.retrieveCommittees()}).error(function(t){e.isLoading=!1,alert("Failed to create the committee: "+t.exceptionMessage)})}},e.$inject=["$http","SiteInfo","$cacheFactory"],e}();e.ManageCommitteesController=i}(Ally||(Ally={})),CA.angularApp.component("manageCommittees",{templateUrl:"/ngApp/chtn/manager/manage-committees.html",controller:Ally.ManageCommitteesController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.appCacheService=i,this.PaymentHistory=[],this.message="",this.showPaymentPage="condo"===AppConfig.appShortName,this.PeriodicPaymentFrequencies=PeriodicPaymentFrequencies,this.AssociationPaysAch=!0,this.AssociationPaysCC=!1,this.lateFeeInfo={},this.isLoading=!1,this.isLoadingUnits=!1,this.isLoadingPayment=!1,this.isLoadingLateFee=!1,this.isLoadingCheckoutDetails=!1}return e.prototype.$onInit=function(){this.highlightWePayCheckoutId=this.appCacheService.getAndClear("hwpid"),this.isAssessmentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled,this.payments=[{Date:"",Unit:"",Resident:"",Amount:"",Status:""}],this.testFee={amount:200},this.signUpStep=0,this.signUpInfo={hasAssessments:null,assessmentFrequency:0,allPayTheSame:!0,allPayTheSameAmount:null,units:[]},this.refresh()},e.prototype.refresh=function(){var e=this;this.isLoading=!0;var t=this;this.$http.get("/api/OnlinePayment").then(function(i){t.isLoading=!1,t.hasAssessments=t.siteInfo.privateSiteInfo.hasAssessments;var n=i.data;t.paymentInfo=n,t.lateFeeInfo={lateFeeDayOfMonth:n.lateFeeDayOfMonth,lateFeeAmount:n.lateFeeAmount},HtmlUtil.isNullOrWhitespace(e.lateFeeInfo.lateFeeAmount)||HtmlUtil.endsWith(e.lateFeeInfo.lateFeeAmount,"%")||(e.lateFeeInfo.lateFeeAmount="$"+e.lateFeeInfo.lateFeeAmount),t.refreshUnits(),t.updateTestFee()})},e.prototype.refreshUnits=function(){this.isLoadingUnits=!0;var e=this;this.$http.get("/api/Unit").then(function(t){e.units=t.data,_.each(e.units,function(e){null===e.adjustedAssessment&&(e.adjustedAssessment=e.assessment)}),e.assessmentSum=_.reduce(e.units,function(e,t){return e+t.assessment},0),e.adjustedAssessmentSum=_.reduce(e.units,function(e,t){return e+(t.adjustedAssessment||0)},0),e.isLoadingUnits=!1})},e.prototype.getLateFeeDateSuper=function(){var e=this.lateFeeInfo.lateFeeDayOfMonth;if("string"==typeof e){if(HtmlUtil.isNullOrWhitespace(e))return"";e=parseInt(e),this.lateFeeInfo.lateFeeDayOfMonth=e}if(NaN==e||e<1)return e="","";if(e>31)return e="","";if(e>=10&&e<=20)return"th";var t=e%10;return 1===t?"st":2===t?"nd":3===t?"rd":"th"},e.prototype.selectText=function(){setTimeout(function(){$(".editable-input").select()},50)},e.prototype.onWithdrawalClick=function(){this.message="",this.$http.get("/api/OnlinePayment?action=withdrawal").then(function(e){var t=e.data;t.redirectUri?window.location.href=t.redirectUri:this.message=t.message},function(e){e.data&&e.data.exceptionMessage&&(this.message=e.data.exceptionMessage)})},e.prototype.onUnitAssessmentChanged=function(e){this.isLoadingUnits=!0,"string"==typeof e.assessment&&(e.assessment=parseFloat(e.assessment)),"string"==typeof e.adjustedAssessment&&(e.adjustedAssessment=parseFloat(e.adjustedAssessment));var t=this;this.$http.put("/api/Unit",e).then(function(){t.isLoadingUnits=!1,t.assessmentSum=_.reduce(t.units,function(e,t){return e+t.assessment},0),t.adjustedAssessmentSum=_.reduce(t.units,function(e,t){return e+(t.adjustedAssessment||0)},0)})},e.prototype.onChangeFeePayerInfo=function(e){var t=!1,i=!1;if(this.paymentInfo.usersWithAutoPay&&this.paymentInfo.usersWithAutoPay.length>0){var n=[];if("ach"===e?n=_.where(this.paymentInfo.usersWithAutoPay,function(e){return"ACH"===e.wePayAutoPayFundingSource}):"cc"===e&&(n=_.where(this.paymentInfo.usersWithAutoPay,function(e){return"Credit Card"===e.wePayAutoPayFundingSource})),n.length>0){i=void 0!==_.find(n,function(e){return e.userId===this.$parent.userInfo.userId}),t=!0;var o="Adjusting the fee payer type will cause the follow units to have their auto-pay cancelled and they will be informed by e-mail:\n";if(_.each(n,function(e){o+=e.ownerName+"\n"}),o+="\nDo you want to continue?",!confirm(o))return void("ach"===e?this.paymentInfo.payerPaysAchFee=!this.paymentInfo.payerPaysAchFee:this.paymentInfo.payerPaysCCFee=!this.paymentInfo.payerPaysCCFee)}}this.isLoadingPayment=!0;var s=this;this.$http.put("/api/OnlinePayment",this.paymentInfo).then(function(){i?window.location.reload():(s.isLoadingPayment=!1,t&&s.refresh())}),this.updateTestFee()},e.prototype.getSignUpSum=function(){return _.reduce(this.signUpInfo.units,function(e,t){return e+parseFloat(t.assessment)},0)},e.prototype.signUp_HasAssessments=function(e){var t=this;this.signUpInfo.hasAssessments=e,this.signUpInfo.hasAssessments?(this.signUpInfo.units=[],_.each(this.units,function(e){t.signUpInfo.units.push({unitId:e.unitId,name:e.name,assessment:0})}),this.signUpStep=1):this.signUp_Commit()},e.prototype.signUp_AssessmentFrequency=function(e){this.signUpInfo.frequencyIndex=e,this.signUpInfo.assessmentFrequency=PeriodicPaymentFrequencies[e].name,this.signUpStep=2},e.prototype.saveLateFee=function(){this.isLoadingLateFee=!0;var e=this;this.$http.put("/api/OnlinePayment/LateFee?dayOfMonth="+this.lateFeeInfo.lateFeeDayOfMonth+"&lateFeeAmount="+this.lateFeeInfo.lateFeeAmount,null).then(function(t){e.isLoadingLateFee=!1;var i=t.data;i&&i.feeAmount&&0!==i.feeType?(e.lateFeeInfo.lateFeeAmount=i.feeAmount,1===i.feeType?e.lateFeeInfo.lateFeeAmount="$"+e.lateFeeInfo.lateFeeAmount:2===i.feeType&&(e.lateFeeInfo.lateFeeAmount=e.lateFeeInfo.lateFeeAmount+"%")):(""!==e.lateFeeInfo.lateFeeDayOfMonth&&alert("Failed to save the late fee. Please enter only a number for the date (ex. 5) and an amount (ex. 12.34) or percent (ex. 5%) for the fee. To disable late fees, clear the date field and hit save."),e.lateFeeInfo.lateFeeDayOfMonth="",e.lateFeeInfo.lateFeeAmount=null)},function(t){e.isLoadingLateFee=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to update late fee: "+i)})},e.prototype.showWePayCheckoutInfo=function(e){if(this.viewingCheckoutId=e,this.viewingCheckoutId){this.isLoadingCheckoutDetails=!0,this.checkoutInfo={};var t=this;this.$http.get("/api/OnlinePayment/CheckoutInfo?checkoutId="+e,{cache:!0}).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1;var i=e.data.exceptionMessage?e.data.exceptionMessage:e.data;alert("Failed to retrieve checkout details: "+i)})}},e.prototype.signUp_Commit=function(){var e=this;this.isLoading=!0,this.$http.post("/api/OnlinePayment/BasicInfo",this.signUpInfo).then(function(){e.isLoading=!1,e.refreshUnits(),e.hasAssessments=e.signUpInfo.hasAssessments,e.siteInfo.privateSiteInfo.hasAssessments=e.hasAssessments},function(t){e.isLoading=!1,t.data&&t.data.exceptionMessage&&(e.message=t.data.exceptionMessage)})},e.prototype.updateTestFee=function(){var e=parseFloat(this.testFee.amount);this.paymentInfo.payerPaysAchFee?(this.testFee.achResidentPays=e+1.5,this.testFee.achAssociationReceives=e):(this.testFee.achResidentPays=e,this.testFee.achAssociationReceives=e-1.5);var t=1.3+.029*e;this.paymentInfo.payerPaysCCFee?(this.testFee.ccResidentPays=e+t,this.testFee.ccAssociationReceives=e):(this.testFee.ccResidentPays=e,this.testFee.ccAssociationReceives=e-t)},e.prototype.admin_ClearAccessToken=function(){alert("TODO hook this up")},e.$inject=["$http","SiteInfo","appCacheService"],e}();e.ManagePaymentsController=t}(Ally||(Ally={})),CA.angularApp.component("managePayments",{templateUrl:"/ngApp/chtn/manager/manage-payments.html",controller:Ally.ManagePaymentsController});!function(e){var t=function(){return function(){this.isAnonymous=!0}}(),i=function(){function e(e,i){this.$http=e,this.siteInfo=i,this.editingItem=new t,this.pollHistory=[],this.isLoading=!1}return e.prototype.$onInit=function(){var e=new Date;e.setDate((new Date).getDate()+3),this.defaultPoll=new t,this.defaultPoll.expirationDate=e,this.defaultPoll.answers=[{answerText:"Yes"},{answerText:"No"}],this.editingItem=angular.copy(this.defaultPoll),this.retrieveItems()},e.prototype.retrieveItems=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Poll").then(function(t){e.pollHistory=t.data;for(var i=0;i<e.pollHistory.length;++i)e.pollHistory[i].expirationDate=new Date(e.pollHistory[i].expirationDate),e.pollHistory[i].fullResultAnswers=e.pollHistory[i].answers,e.pollHistory[i].answers=_.reject(e.pollHistory[i].answers,function(e){return 101===e.sortOrder});e.isLoading=!1})},e.prototype.addAnswer=function(){this.editingItem.answers||(this.editingItem.answers=[]),this.editingItem.answers.length>19?alert("You can only have 20 answers maxiumum per poll."):this.editingItem.answers.push({answerText:""})},e.prototype.cancelEdit=function(){this.editingItem=angular.copy(this.defaultPoll)},e.prototype.onSaveItem=function(){if(null!==this.editingItem){this.isLoading=!0;var e=this,t=function(){e.isLoading=!1,e.editingItem=angular.copy(e.defaultPoll),e.retrieveItems()},i=function(t){e.isLoading=!1,alert("Failed to save poll: "+t.data.exceptionMessage)};"number"==typeof this.editingItem.pollId?(analytics.track("editPoll"),this.$http.put("/api/Poll",this.editingItem).then(t,i)):(analytics.track("addPoll"),this.$http.post("/api/Poll",this.editingItem).then(t,i))}},e.prototype.onEditItem=function(e){this.editingItem=angular.copy(e),window.scrollTo(0,0)},e.prototype.onDeleteItem=function(e){this.isLoading=!0;var t=this;this.$http.delete("/api/Poll?pollId="+e.pollId).then(function(){t.retrieveItems()},function(e){t.isLoading=!1,403===e.status&&alert("You cannot authorized to delete this poll.")})},e.prototype.onViewResults=function(e){if(e){var t=_.groupBy(e.responses,"answerId");e.chartData=[],e.chartLabels=[];var i,n=function(){if(!t.hasOwnProperty(o))return"continue";var n=parseInt(o);(i=_.find(e.fullResultAnswers,function(e){return e.pollAnswerId===n}))&&(e.chartLabels.push(i.answerText),e.chartData.push(t[o].length))};for(var o in t)n();e.responses&&e.responses.length<this.siteInfo.privateSiteInfo.numUnits&&(e.chartLabels.push("No Response"),e.chartData.push(this.siteInfo.privateSiteInfo.numUnits-e.responses.length)),e.answerCounts=[];for(var s=0;s<e.chartLabels.length;++s)e.answerCounts.push({label:e.chartLabels[s],count:e.chartData[s]});this.chartLabels=e.chartLabels,this.chartData=e.chartData,this.viewingPollResults=e}else this.viewingPollResults=null},e.$inject=["$http","SiteInfo"],e}();e.ManagePollsController=i}(Ally||(Ally={})),CA.angularApp.component("managePolls",{templateUrl:"/ngApp/chtn/manager/manage-polls.html",controller:Ally.ManagePollsController});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}();e.Unit=t;var i=function(){return function(){}}();e.HomeEntry=i;var n=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(e.HomeEntry);e.HomeEntryWithName=n;var o=function(){return function(){}}();e.Member=o;var s=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(o);e.Resident=s;var a=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(s);e.UpdateResident=a;var r=function(){function t(e,t,i,n,o,s){this.$http=e,this.$rootScope=t,this.$interval=i,this.fellowResidents=n,this.uiGridConstants=o,this.siteInfo=s,this.isAdmin=!1,this.showEmailSettings=!0,this.multiselectMulti="single",this.isSavingUser=!1,this.isLoading=!1,this.isLoadingSettings=!1}return t.prototype.$onInit=function(){this.isAdmin=this.siteInfo.userInfo.isAdmin,this.siteLaunchedDateUtc=this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.bulkImportRows=[{}],this.multiselectOptions="",this.allUnits=null,this.homeName=AppConfig.homeName||"Unit",this.showIsRenter="condo"===AppConfig.appShortName||"hoa"===AppConfig.appShortName,this.showEmailSettings=!this.siteInfo.privateSiteInfo.isEmailSendingRestricted,this.boardPositions=[{id:0,name:"None"},{id:1,name:"President"},{id:2,name:"Treasurer"},{id:4,name:"Secretary"},{id:8,name:"Director/Trustee"},{id:16,name:"Vice President"},{id:32,name:"Property Manager"}],this.newResident={boardPosition:0,isRenter:!1},this.editUser=null;var e="residentSort_v2",t={field:"lastName",direction:this.uiGridConstants.ASC};if(this.residentSortInfo=t,window.localStorage){var i=window.localStorage.getItem(e);i&&(this.residentSortInfo=JSON.parse(i)),this.residentSortInfo.field||(this.residentSortInfo=t)}var n=this;if(this.residentGridOptions={data:[],columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first"},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last"},{field:"email",displayName:"E-mail",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text class="resident-cell-email" data-ng-style="{ \'color\': row.entity.postmarkReportedBadEmailUtc ? \'#F00\' : \'auto\' }">{{ row.entity.email }}</span></div>'},{field:"unitGridLabel",displayName:"condo"===AppConfig.appShortName?"Unit":"Home",cellClass:"resident-cell-unit",width:this.showIsRenter?62:175,sortingAlgorithm:function(e,t){return e.toString().localeCompare(t.toString())}},{field:"isRenter",displayName:"Is Renter",width:80,cellClass:"resident-cell-is-renter",visible:this.showIsRenter,cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isRenter"></div>'},{field:"boardPosition",displayName:"Board Position",width:125,cellClass:"resident-cell-board",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ grid.appScope.$ctrl.getBoardPositionName(row.entity.boardPosition) }}</span></div>'},{field:"isSiteManager",displayName:"Is Admin",width:80,cellClass:"resident-cell-site-manager",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isSiteManager"></div>'},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.phoneNumber | tel }}</span></div>'}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableFullRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,onRegisterApi:function(t){n.gridApi=t,t.selection.on.rowSelectionChanged(n.$rootScope,function(e){e.isSelected;n.setEdit(e.entity)}),t.core.on.sortChanged(n.$rootScope,function(t,i){if(i&&0!==i.length){var n={field:i[0].field,direction:i[0].sort.direction};window.localStorage.setItem(e,JSON.stringify(n))}}),HtmlUtil.uiGridFixScroll()}},window.innerWidth<769)for(var o=2;o<this.residentGridOptions.columnDefs.length;++o)this.residentGridOptions.columnDefs[o].visible=!1;this.refresh(),this.loadSettings()},t.prototype.getBoardPositionName=function(e){if(!e)return"";var t=jQuery.grep(this.boardPositions,function(t,i){return t.id===e})[0];return t?t.name:""},t.prototype.setEdit=function(t){if(this.sentWelcomeEmail=!1,null!==t){this.editUserForm.$setPristine();var i=jQuery.extend({},t);if(this.editUser=i,this.editUser.showAdvancedHomePicker=this.allUnits.length>20,this.multiselectMulti="single","object"==typeof this.editUser.units&&(this.editUser.units.length>0&&(this.editUser.singleUnitId=this.editUser.units[0].unitId),this.editUser.units.length>1&&(this.editUser.showAdvancedHomePicker=!0,this.multiselectMulti="multiple")),this.allUnits.length>20&&"single"===this.multiselectMulti&&null!==this.allUnits[0].unitId){var n=new e.Unit;n.name="None Selected",this.allUnits.unshift(n)}var o=this;_.each(this.allUnits,function(e){var t=void 0!==_.find(o.editUser.units,function(t){return t.unitId===e.unitId});e.isSelectedForEditUser=t}),this.gridApi.selection.clearSelectedRows(),setTimeout("$( '#edit-user-first-text-box' ).focus();",100)}else this.editUser=null},t.prototype.onSendWelcome=function(){this.isSavingUser=!0;var e=this;this.$http.put("/api/Residents/"+this.editUser.userId+"/SendWelcome",null).success(function(){e.isSavingUser=!1,e.sentWelcomeEmail=!0}).error(function(){e.isSavingUser=!1,alert("Failed to send the welcome e-mail, please contact support if this problem persists.")})},t.prototype.populateGridUnitLabels=function(){_.each(this.residentGridOptions.data,function(e){var t=_.reduce(e.units,function(e,t){return e.length>0?e+","+t.name:t.name},"");e.unitGridLabel=t})},t.prototype.refresh=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Residents").success(function(t){if(e.isLoading=!1,e.residentGridOptions.data=t,e.residentGridOptions.minRowsToShow=t.length,e.residentGridOptions.virtualizationThreshold=t.length,e.hasOneAdmin=1===_.filter(t,function(e){return e.isSiteManager}).length&&t.length>1,e.residentSortInfo){var i=_.find(e.gridApi.grid.columns,function(t){return t.field===e.residentSortInfo.field});i&&e.gridApi.grid.sortColumn(i,e.residentSortInfo.direction,!1)}_.forEach(t,function(e){e.fullName=e.firstName+" "+e.lastName,"string"==typeof e.email&&-1!==e.email.indexOf("@condoally.com")&&(e.email=""),e.lastLoginDateUtc&&(e.lastLoginDateUtc=moment.utc(e.lastLoginDateUtc).toDate())}),e.populateGridUnitLabels(),e.allUnits||(e.isLoading=!0,e.$http.get("/api/Unit").then(function(t){e.isLoading=!1,e.allUnits=t.data,e.multiselectOptions=e.allUnits.length>20?"filter":""},function(){e.isLoading=!1,alert("Failed to retrieve your association's home listing, please contact support.")}))})},t.prototype.enableMultiHomePicker=function(){this.editUser&&(this.editUser.showAdvancedHomePicker=!0),this.multiselectMulti="multiple",this.allUnits&&this.allUnits.length>0&&null===this.allUnits[0].unitId&&this.allUnits.shift()},t.prototype.onSaveResident=function(){if(this.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid()&&(this.editUser.userId!==this.$rootScope.userInfo.userId||!this.siteInfo.userInfo.isSiteManager||this.editUser.isSiteManager||confirm("If you remove yourself as a site admin you won't be able to continue making changes. Are you sure you want to remove yourself as a site admin?")))){this.editUser.showAdvancedHomePicker||(this.editUser.units=[{unitId:this.editUser.singleUnitId}]),this.isSavingUser=!0;var e=this,t=function(t){e.isSavingUser=!1,"string"!=typeof t.data.errorMessage?(e.editUser=null,e.refresh()):alert("Failed to add resident: "+t.data.errorMessage)},i=!1,n=function(t){e.isSavingUser=!1;var n=i?"Failed to add new resident":"Failed to update resident";t&&t.data&&t.data.exceptionMessage&&(n+=": "+t.data.exceptionMessage),alert(n)};this.editUser.userId?(i=!1,analytics.track("editResident"),this.$http.put("/api/Residents",this.editUser).then(t,n)):(i=!0,analytics.track("addNewResident"),this.$http.post("/api/Residents",this.editUser).then(t,n)),this.fellowResidents.clearResidentCache()}},t.prototype.OnAdminSetPassword=function(){var e={userName:this.adminSetPass_Username,password:this.adminSetPass_Password},t=this;this.$http.post("/api/AdminHelper/SetPassword",e).success(function(e){t.adminSetPass_ResultMessage=e}).error(function(e){var t=e.exceptionMessage?e.exceptionMessage:e;alert("Failed to set password: "+t)})},t.prototype.loadSettings=function(){var e=this;this.isLoadingSettings=!0;var t=this;this.$http.get("/api/Settings").success(function(i){t.isLoadingSettings=!1,e.residentSettings=i}).error(function(e){t.isLoadingSettings=!1,console.log("Failed to retrieve settings")})},t.prototype.exportResidentCsv=function(){"undefined"!=typeof analytics&&analytics.track("exportResidentCsv");var t=this,i=[{headerText:"First Name",fieldName:"firstName"},{headerText:"Last Name",fieldName:"lastName"},{headerText:"Phone",fieldName:"phoneNumber"},{headerText:"E-mail",fieldName:"email"},{headerText:"Unit",fieldName:"unitGridLabel"},{headerText:"Is Renter",fieldName:"isRenter"},{headerText:"Is Admin",fieldName:"isSiteManager"},{headerText:"Board Position",fieldName:"boardPosition",dataMapper:function(e){return t.getBoardPositionName(e)}},{headerText:"Last Login Date",fieldName:"lastLoginDateUtc",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD HH:mm:00"):"Has not logged-in"}}],n=e.createCsvString(this.residentGridOptions.data,i);n="data:text/csv;charset=utf-8,"+n;var o=encodeURI(n),s=document.createElement("a");s.setAttribute("href",o),s.setAttribute("download","Residents.csv"),document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s)},500)},t.prototype.saveResidentSettings=function(){analytics.track("editResidentSettings"),this.isLoadingSettings=!0;var e=this;this.$http.put("/api/Settings",this.residentSettings).success(function(){e.isLoadingSettings=!1,e.fellowResidents.clearResidentCache(),e.siteInfo.privateSiteInfo.canHideContactInfo=e.residentSettings.canHideContactInfo}).error(function(){e.isLoadingSettings=!1,alert("Failed to update settings, please try again or contact support.")})},t.prototype.onDeleteResident=function(){if(confirm("Are you sure you want to remove this person from your building?")&&(this.siteInfo.userInfo.userId!==this.editUser.userId||confirm("If you remove your own account you won't be able to login anymore. Are you still sure?"))){this.isSavingUser=!0;var e=this;this.$http.delete("/api/Residents?userId="+this.editUser.userId).success(function(){e.isSavingUser=!1,e.editUser=null,e.fellowResidents.clearResidentCache(),e.refresh()}).error(function(){alert("Failed to remove the resident. Please let support know if this continues to happen."),e.isSavingUser=!1,e.editUser=null})}},t.prototype.onSendAllWelcome=function(){if(confirm("This will e-mail all of the residents in your association. Do you want to proceed?")){this.isLoading=!0;var e=this;this.$http.put("/api/Residents?userId&action=launchsite",null).success(function(t){e.isLoading=!1,e.sentWelcomeEmail=!0,e.allEmailsSent=!0}).error(function(){e.isLoading=!1,alert("Failed to send welcome e-mail, please contact support if this problem persists.")})}},t.prototype.parseBulkCsv=function(){var e=$.csv.toArrays(this.bulkImportCsv);this.bulkImportRows=[];for(var t=function(e){e||(e="");var t=e.toLowerCase();return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/0th /g,"0 ").replace(/1st /g,"1 ")).replace(/2nd /g,"2 ").replace(/3rd /g,"3 ")).replace(/4th /g,"4 ").replace(/5th /g,"5 ")).replace(/6th /g,"6 ").replace(/7th /g,"7 ")).replace(/8th /g,"8 ").replace(/9th /g,"9 ")).replace(/\./g,"").replace(/ /g,"")).replace(/street/g,"st").replace(/road/g,"rd").replace(/drive/g,"dr")).replace(/place/g,"pl").replace(/avenue/g,"ave")},i=0;i<this.allUnits.length;++i)this.allUnits[i].csvTestName=t(this.allUnits[i].name);for(i=0;i<e.length;++i){for(var n=e[i];n.length<7;)n.push("");for(var o=0;o<n.length;++o)HtmlUtil.isNullOrWhitespace(n[o])?n[o]=null:n[o]=n[o].trim();var s={unitName:n[0]||null,unitId:void 0,email:n[1],firstName:n[2],lastName:n[3],phoneNumber:n[4],isRenter:!HtmlUtil.isNullOrWhitespace(n[5]),isAdmin:!HtmlUtil.isNullOrWhitespace(n[6]),csvTestName:""};if(HtmlUtil.isNullOrWhitespace(s.unitName))s.unitId=null;else{s.csvTestName=t(s.unitName);var a=_.find(this.allUnits,function(e){return e.csvTestName===s.csvTestName});s.unitId=a?a.unitId:void 0}this.bulkImportRows.push(s)}},t.prototype.submitBulkRows=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Residents/BulkLoad",this.bulkImportRows).success(function(){e.isLoading=!1,e.bulkImportRows=[{}],e.bulkImportCsv="",alert("Success")}).error(function(){e.isLoading=!1,alert("Bulk upload failed")})},t.prototype.addBulkRow=function(){var e={unitName:"",unitId:null,email:"",firstName:"",lastName:"",phoneNumber:"",isRenter:!1,isAdmin:!1};if(this.bulkImportRows.length>0){var t=this.bulkImportRows[this.bulkImportRows.length-1].unitId,i=_.findIndex(this.allUnits,function(e){return e.unitId===t});++i<this.allUnits.length&&(e.unitName=this.allUnits[i].name,e.unitId=this.allUnits[i].unitId)}this.bulkImportRows.push(e)},t.$inject=["$http","$rootScope","$interval","fellowResidents","uiGridConstants","SiteInfo"],t}();e.ManageResidentsController=r}(Ally||(Ally={})),CA.angularApp.component("manageResidents",{templateUrl:"/ngApp/chtn/manager/manage-residents.html",controller:Ally.ManageResidentsController});!function(e){var t=function(){function e(e,t,i,n){this.$http=e,this.siteInfo=t,this.$timeout=i,this.$scope=n}return e.prototype.$onInit=function(){this.settings={},this.defaultBGImage=$(document.documentElement).css("background-image"),this.showQaButton="president@mycondoally.com"===this.siteInfo.userInfo.emailAddress,this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl;var e=this;this.$timeout(function(){return e.hookUpFileUpload()},200),this.refreshData()},e.prototype.refreshData=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Settings").then(function(t){e.isLoading=!1,e.settings=t.data})},e.prototype.removeLoginImage=function(){analytics.track("clearLoginImage"),this.isLoading=!0;var e=this;this.$http.get("/api/Settings/ClearLoginImage").then(function(){e.isLoading=!1,e.siteInfo.publicSiteInfo.loginImageUrl="",e.loginImageUrl=""},function(t){e.isLoading=!1,alert("Failed to remove loading image: "+t.data.exceptionMessage)})},e.prototype.saveSettings=function(e){void 0===e&&(e=!1),analytics.track("editSettings"),this.isLoading=!0;var t=this;this.$http.put("/api/Settings",this.settings).then(function(){t.isLoading=!1,t.siteInfo.privateSiteInfo.homeRightColumnType=t.settings.homeRightColumnType,e&&location.reload()})},e.prototype.onSiteTitleChange=function(){analytics.track("editSiteTitle"),this.isLoading=!0;this.$http.put("/api/Settings",{siteTitle:this.settings.siteTitle}).then(function(){location.reload()})},e.prototype.onWelcomeMessageUpdate=function(){analytics.track("editWelcomeMessage"),this.isLoading=!0;var e=this;this.$http.put("/api/Settings",{welcomeMessage:this.settings.welcomeMessage}).then(function(){e.isLoading=!1,e.siteInfo.privateSiteInfo.welcomeMessage=e.settings.welcomeMessage})},e.prototype.onImageClick=function(e){this.settings.bgImageFileName=e;var t=this;this.$http.put("/api/Settings",{BGImageFileName:this.settings.bgImageFileName}).then(function(){$(".test-bg-image").removeClass("test-bg-image-selected"),t.isLoading=!1})},e.prototype.onImageHoverOver=function(e){},e.prototype.onImageHoverOut=function(){},e.prototype.onQaDeleteSite=function(){this.$http.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(e){alert("Failed to delete site: "+e.data.exceptionMessage)})},e.prototype.hookUpFileUpload=function(){var e=this;$(function(){$("#JQFileUploader").fileupload({autoUpload:!0,add:function(t,i){e.$scope.$apply(function(){this.isLoading=!0}),analytics.track("setLoginImage"),$("#FileUploadProgressContainer").show(),i.url="api/DocumentUpload/LoginImage?ApiAuthToken="+e.siteInfo.authToken;i.submit().done(function(t){e.$scope.$apply(function(){e.isLoading=!1,e.loginImageUrl=t.newUrl+"?cacheBreaker="+(new Date).getTime(),e.siteInfo.publicSiteInfo.loginImageUrl=this.loginImageUrl}),$("#FileUploadProgressContainer").hide()})},progressall:function(e,t){var i=Math.floor(100*t.loaded/t.total);$("#FileUploadProgressBar").css("width",i+"%"),100===i?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(i+"%")}})})},e.$inject=["$http","SiteInfo","$timeout","$scope"],e}();e.ChtnSettingsController=t}(Ally||(Ally={})),CA.angularApp.component("chtnSettings",{templateUrl:"/ngApp/chtn/manager/settings.html",controller:Ally.ChtnSettingsController});!function(e){var t=function(){function e(e){this.siteInfo=e,this.hideDocuments=!1,this.hideVendors=!1}return e.prototype.$onInit=function(){this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideVendors="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName,this.hideDocuments?this.selectedView="info":this.selectedView="docs"},e.$inject=["SiteInfo"],e}();e.AssociationInfoController=t}(Ally||(Ally={})),CA.condoAllyControllers.directive("contenteditable",["$sce",function(e){return{restrict:"A",require:"?ngModel",link:function(t,i,n,o){o&&(o.$render=function(){i.html(e.getTrustedHtml(o.$viewValue||""))},i.on("blur keyup change",function(){t.$evalAsync(s)}),s());function s(){var e=i.html();n.stripBr&&"<br>"===e&&(e=""),o.$setViewValue(e)}}}}]),CA.angularApp.filter("highlight",["$sce",function(e){return function(t,i){return t=t||"",i&&(t=t.replace(new RegExp("("+i+")","gi"),'<span class="fileSearchHighlight">$1</span>')),e.trustAsHtml(t)}}]),CA.angularApp.component("associationInfo",{templateUrl:"/ngApp/chtn/member/association-info.html",controller:Ally.AssociationInfoController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.$scope=o}return e.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.canMakePayment=this.siteInfo.privateSiteInfo.isPaymentEnabled&&!this.siteInfo.userInfo.isRenter,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.allyAppName=AppConfig.appName,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");HtmlUtil.getSubdomain(window.location.host);var e=this;this.$scope.$on("homeHasActivePolls",function(){return e.shouldShowAlertSection=!0})},e.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},e.$inject=["$http","$rootScope","SiteInfo","$timeout","$scope"],e}();e.ChtnHomeController=t}(Ally||(Ally={})),CA.angularApp.component("chtnHome",{templateUrl:"/ngApp/chtn/member/chtn-home.html",controller:Ally.ChtnHomeController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e,i,n,o){this.$scope=e,this.$timeout=i,this.$http=n,this.siteInfo=o,this.editingTip=new t,this.hoaHomes=[],this.tips=[],this.isLoading=!1}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager;var e=void 0;if(this.siteInfo.privateSiteInfo.googleGpsPosition){e={bounds:new google.maps.Circle({center:this.siteInfo.privateSiteInfo.googleGpsPosition,radius:40234}).getBounds()}}var t=document.getElementById("edit-location-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(t,e);var i=this;google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var e=i.addressAutocomplete.getPlace();i.editingTip.address=e.formatted_address}),"hoa"===AppConfig.appShortName?this.retrieveHoaHomes():this.refresh();i=this;this.$timeout(function(){return i.getWalkScore()},1e3),MapCtrlMapMgr.Init(this.siteInfo,this.$scope,this)},e.prototype.refresh=function(){this.isLoading=!0;var e=this;this.$http.get("/api/WelcomeTip").then(function(t){e.tips=t.data,MapCtrlMapMgr.ClearAllMarkers(),"condo"===AppConfig.appShortName&&MapCtrlMapMgr.AddMarker(MapCtrlMapMgr._homeGpsPos.lat(),MapCtrlMapMgr._homeGpsPos.lng(),"Home",MapCtrlMapMgr.MarkerNumber_Home);for(var i=0;i<e.tips.length;++i){var n=e.tips[i];null!==n.gpsPos&&(n.markerIndex=MapCtrlMapMgr.AddMarker(n.gpsPos.lat,n.gpsPos.lon,n.name,n.markerNumber))}_.each(e.hoaHomes,function(e){e.fullAddress&&e.fullAddress.gpsPos&&MapCtrlMapMgr.AddMarker(e.fullAddress.gpsPos.lat,e.fullAddress.gpsPos.lon,e.name,MapCtrlMapMgr.MarkerNumber_Home)}),MapCtrlMapMgr.OnMarkersReady(),e.isLoading=!1})},e.prototype.onEditTip=function(e){this.editingTip=jQuery.extend({},e),window.scrollTo(0,document.body.scrollHeight)},e.prototype.onMoveMarker=function(e){MapCtrlMapMgr.SetMarkerDraggable(e.markerIndex,!0)},e.prototype.onDeleteTip=function(e){if(confirm("Are you sure you want to delete this item?")){this.isLoading=!0;var t=this;this.$http.delete("/api/WelcomeTip/"+e.itemId).then(function(){t.isLoading=!1,t.refresh()})}},e.prototype.onSaveTip=function(){if(null!==this.editingTip){var e=this,i=function(){e.isLoading=!1,e.editingTip=new t,e.refresh()};this.isLoading=!0,this.editingTip.itemId?this.$http.put("/api/WelcomeTip",this.editingTip).then(i):this.$http.post("/api/WelcomeTip",this.editingTip).then(i)}},e.prototype.isLocationTip=function(e){return null!==e.gpsPos},e.prototype.isNotLocationTip=function(e){return null===e.gpsPos},e.prototype.getMarkerIconUrl=function(e){var t="/assets/images/MapMarkers/";return e>=1&&e<=10?t+="green_"+e:-2===e?t+="MapMarker_Home":-3===e?t+="MapMarker_Hospital":-4===e&&(t+="MapMarker_PostOffice"),t+=".png"},e.prototype.updateItemGpsLocation=function(e,t,i){var n={itemId:_.find(this.tips,function(t){return t.markerIndex===e}).itemId,newLat:t,newLon:i};this.isLoading=!0;var o=this;this.$http.put("/api/WelcomeTip/UpdateGpsLocation",n).then(function(){o.isLoading=!1})},e.prototype.getWalkScore=function(){var e=function(e){e&&e.data&&"Error"!==e.data?$("#WalkScorePanel").html(e.data):($("#WalkScorePanel").html("Failed to load Walk Score."),$("#WalkScorePanel").hide())};this.$http.get("/api/WelcomeTip/GetWalkScore").then(e,e)},e.prototype.retrieveHoaHomes=function(){var e=this;this.$http.get("/api/BuildingResidents/FullUnits").then(function(t){e.hoaHomes=t.data,e.refresh()},function(){e.refresh()})},e.$inject=["$scope","$timeout","$http","SiteInfo"],e}();e.ChtnMapController=i}(Ally||(Ally={})),CA.angularApp.component("chtnMap",{templateUrl:"/ngApp/chtn/member/chtn-map.html",controller:Ally.ChtnMapController});var MapCtrlMapMgr=function(){function e(){}return e.Init=function(t,i,n){if(e.ngScope=i,e.mapCtrl=n,"undefined"!=typeof google){e._homeGpsPos=t.privateSiteInfo.googleGpsPosition,e._groupGpsBounds=t.publicSiteInfo.gpsBounds;var o={center:e._homeGpsPos,zoom:25,mapTypeId:google.maps.MapTypeId.ROADMAP};e._mainMap=new google.maps.Map(document.getElementById("map_canvas"),o),"condo"===AppConfig.appShortName&&e.AddMarker(e._homeGpsPos.lat(),e._homeGpsPos.lng(),"Home",e.MarkerNumber_Home),e.OnMapReady()}},e.OnMapReady=function(){e._isMapReady=!0,e._areMarkersReady&&e.OnMapAndMarkersReady()},e.OnMarkersReady=function(){e._areMarkersReady=!0,e._isMapReady&&e.OnMapAndMarkersReady()},e.OnMapAndMarkersReady=function(){for(var t=0;t<e._tempMarkers.length;++t){var i=e._tempMarkers[t],n=null;i.markerNumber>=1&&i.markerNumber<=10?n="/assets/images/MapMarkers/green_"+i.markerNumber+".png":i.markerNumber===e.MarkerNumber_Home?n="/assets/images/MapMarkers/MapMarker_Home.png":i.markerNumber===e.MarkerNumber_Hospital?n="/assets/images/MapMarkers/MapMarker_Hospital.png":i.markerNumber===e.MarkerNumber_PostOffice&&(n="/assets/images/MapMarkers/MapMarker_PostOffice.png");var o=new google.maps.Marker({position:new google.maps.LatLng(i.lat,i.lon),map:e._mainMap,animation:google.maps.Animation.DROP,title:i.name,icon:n});o.markerIndex=t,google.maps.event.addListener(o,"dragend",function(){var t=this,i=t.getPosition();e.ngScope.$apply(function(){e.mapCtrl.updateItemGpsLocation(t.markerIndex,i.lat(),i.lng())})}),e._markers.push(o)}if(e._tempMarkers=[],e._groupGpsBounds){var s={paths:Ally.MapUtil.gpsBoundsToGooglePoly(e._groupGpsBounds),map:e._mainMap,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1};e._groupBoundsShape=new google.maps.Polygon(s)}e.ZoomMapToFitMarkers()},e.ClearAllMarkers=function(){for(var t=0;t<e._markers.length;t++)e._markers[t].setMap(null);e._markers=[]},e.SetMarkerDraggable=function(t,i){e._markers[t].setDraggable(i)},e.AddMarker=function(t,i,n,o){return e._tempMarkers.push({lat:t,lon:i,name:n,markerNumber:o}),e._tempMarkers.length-1},e.ZoomMapToFitMarkers=function(){for(var t=new google.maps.LatLngBounds,i=0;i<e._markers.length;++i)t.extend(e._markers[i].getPosition());if(e._groupBoundsShape)for(var n=e._groupBoundsShape.getPath(),o=0;o<n.getLength();++o)t.extend(n.getAt(o));e._mainMap.fitBounds(t)},e._mainMap=null,e._homeGpsPos=null,e._groupGpsBounds=null,e._groupBoundsShape=null,e._markers=[],e.MarkerNumber_Home=-2,e.MarkerNumber_Hospital=-3,e.MarkerNumber_PostOffice=-4,e._isMapReady=!1,e._areMarkersReady=!1,e._tempMarkers=[],e.ngScope=null,e.mapCtrl=null,e}();!function(e){var t=function(){function t(t,i){this.$http=t,this.appCacheService=i,this.isLoading=!1,this.loginInfo=new e.LoginInfo,this.shouldHideControls=!1}return t.prototype.$onInit=function(){this.loginInfo.emailAddress=this.appCacheService.getAndClear("forgotEmail")},t.prototype.onSubmitEmail=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Login/Forgot",this.loginInfo).then(function(){e.shouldHideControls=!0,e.isLoading=!1,e.resultText="Please check your e-mail for updated login information.",e.resultTextColor="#00F"},function(t){e.isLoading=!1,e.resultText="Failed to process your request: "+t.data,e.resultTextColor="#F00"})},t.$inject=["$http","appCacheService"],t}();e.ForgotPasswordController=t}(Ally||(Ally={})),CA.angularApp.component("forgotPassword",{templateUrl:"/ngApp/chtn/member/forgot-password.html",controller:Ally.ForgotPasswordController});!function(e){var t=function(){function e(e,t){this.fellowResidents=e,this.siteInfo=t,this.isLoading=!0,this.emailLists=[],this.allyAppName=AppConfig.appName,this.groupShortName=HtmlUtil.getSubdomain(),this.showMemberList="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName}return e.prototype.$onInit=function(){var e=this;this.fellowResidents.getByUnitsAndResidents().then(function(t){if(e.isLoading=!1,e.unitList=t.byUnit,e.allResidents=t.residents,e.committees=t.committees,e.allResidents=_.sortBy(e.allResidents,function(e){return e.lastName}),e.boardMembers=_.filter(t.residents,function(e){return 0!==e.boardPosition}),e.boardMessageRecipient=null,e.boardMembers.length>0){_.some(e.boardMembers,function(e){return e.hasEmail})&&(e.boardMessageRecipient={fullName:"Entire Board",firstName:"everyone on the board",hasEmail:!0,userId:"af615460-d92f-4878-9dfa-d5e4a9b1f488"})}"neighborhood"!==AppConfig.appShortName&&"block-club"!==AppConfig.appShortName||(e.allResidents=_.filter(e.allResidents,function(e){return 0===e.boardPosition}));for(var i=[{id:0,name:"None"},{id:1,name:"President"},{id:2,name:"Treasurer"},{id:4,name:"Secretary"},{id:8,name:"Director"},{id:16,name:"Vice President"},{id:32,name:"Property Manager"}],n=0;n<e.boardMembers.length;++n)e.boardMembers[n].boardPositionName=_.find(i,function(t){return t.id===e.boardMembers[n].boardPosition}).name;var o=[1,16,2,4,8,32];e.boardMembers=_.sortBy(e.boardMembers,function(e){var t=_.indexOf(o,e.boardPosition);return-1===t&&(t=100),t});e.allOwners=_.reduce(e.unitList,function(e,t){return Array.prototype.push.apply(e,t.owners),e},[]),e.allOwners=_.map(_.groupBy(e.allOwners,function(e){return e.email}),function(e){return e[0]}),e.allOwnerEmails=_.reduce(e.allOwners,function(e,t){return HtmlUtil.isValidString(t.email)&&e.push(t.email),e},[]);_.every(e.unitList,function(e){return HtmlUtil.isNumericString(e.name)})&&(e.unitList=_.sortBy(e.unitList,function(e){return+e.name})),e.setupGroupEmails()})},e.prototype.setupGroupEmails=function(){var e=this;this.hasMissingEmails=_.some(this.allResidents,function(e){return!e.hasEmail});this.fellowResidents.getGroupEmailObject().then(function(t){e.emailLists=t,setTimeout(function(){var e=new Clipboard(".clipboard-button"),t=function(e,t){$(e).qtip({style:{classes:"qtip-light qtip-shadow"},position:{my:"leftMiddle",at:"rightMiddle"},content:{text:t},events:{hide:function(e){$(e.originalEvent.currentTarget).qtip("destroy")}}}),$(e).qtip("show")};e.on("success",function(e){t(e.trigger,"Copied!"),e.clearSelection()}),e.on("error",function(e){t(e.trigger,"Auto-copy failed, press CTRL+C now")})},750)})},e.$inject=["fellowResidents","SiteInfo"],e}();e.GroupMembersController=t}(Ally||(Ally={})),CA.angularApp.component("groupMembers",{templateUrl:"/ngApp/chtn/member/group-members.html",controller:Ally.GroupMembersController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e,i){this.$http=e,this.siteInfo=i,this.sendInfo=new t,this.isLoading=!1,this.wasMessageSent=!1,this.onSendHelp=function(){if($("#help-form").validate(),$("#help-form").valid()){this.isLoading=!0;var e=this;this.$http.post("/api/Help",this.sendInfo).then(function(){e.isLoading=!1,e.sendInfo={},e.wasMessageSent=!0,e.resultStyle.color="#00F",e.sendResult="Your message has been sent. We'll do our best to get back to you within 24 hours."},function(){e.isLoading=!1,e.resultStyle.color="#F00",e.sendResult="Failed to send message."})}},this.resultStyle={"text-align":"center","font-size":"large","font-weight":"bold"}}return e.prototype.$onInit=function(){this.siteInfo.isLoggedIn&&(this.sendInfo.emailAddress=this.siteInfo.userInfo.emailAddress)},e.$inject=["$http","SiteInfo"],e}();e.HelpFormController=i}(Ally||(Ally={})),CA.angularApp.component("helpForm",{templateUrl:"/ngApp/chtn/member/Help.html",controller:Ally.HelpFormController});!function(e){var t=function(){function e(e,t,i,n,o,s){this.$scope=e,this.$timeout=t,this.$http=i,this.$rootScope=n,this.$q=o,this.fellowResidents=s,this.showBadNotificationDateWarning=!1,this.isLoadingNews=!1,this.isLoadingLogbookForCalendar=!1,this.isLoadingPolls=!1,this.isLoadingCalendarEvents=!1,this.onlyRefreshCalendarEvents=!1,this.showExpandedCalendarEventModel=!1,this.onResidentClicked=function(e){if(!e.hasEmail)return alert("That user cannot be included because they do not have an e-mail address on file."),void(e.isAssociated=!1);_.contains(this.editEvent.associatedUserIds,e.userId)?this.editEvent.associatedUserIds=_.without(this.editEvent.associatedUserIds,e.userId):this.editEvent.associatedUserIds.push(e.userId)},this.clearViewEvent=function(){this.viewEvent=null}}return e.prototype.$onInit=function(){var t=this;this.fellowResidents.getResidents().then(function(e){t.residents=e,t.residents=_.sortBy(t.residents,function(e){return e.lastName})});var i={height:600,editable:!1,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},viewRender:function(e,t){$(t).css("cursor","pointer")},dayClick:function(i){if(t.$rootScope.isSiteManager){var n=moment(moment.utc(i).format(e.DateFormat)).toDate();t.$scope.$apply(function(){var e={date:n,dateOnly:n,associatedUserIds:[],notificationEmailDaysBefore:null};t.setEditEvent(e,!1)})}},eventClick:function(e){t.$scope.$apply(function(){e.calendarEventObject&&(t.$rootScope.isSiteManager?t.setEditEvent(e.calendarEventObject,!0):t.viewEvent=e.calendarEventObject)})},eventRender:function(e,t){$(t).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:e.fullDescription,title:e.toolTipTitle}})},eventSources:[{events:function(e,i,n,o){t.getAssociationEvents(e,i,n,o)}},{events:function(e,i,n,o){t.getCalendarEvents(e,i,n,o)}}]};$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(i),$("#calendar-event-time").timepicker({scrollDefault:"10:00am"}),$(".fc-bg td.fc-today").append("<div class='today-note'>Today</div>")})},e.prototype.getAllEvents=function(t,i){var n=t.format(e.DateFormat),o=i.format(e.DateFormat),s=this.$q.defer(),a=this.$q.defer(),r=this.$q.defer();s.resolve(),this.isLoadingLogbookForCalendar=!0;var l=this;this.$http.get("/api/Logbook?startDate="+n+"&endDate="+o).then(function(e){var t=e.data;l.isLoadingLogbookForCalendar=!1,_.each(t,function(e){var t=e.text;t.length>10&&(t=t.substring(0,10)+"...");var i="Posted by: "+e.authorName+"<br><p>"+e.text+"</p>";l.calendarEvents.push({title:"Logbook: "+t,start:e.postDate.substring(0,10),toolTipTitle:"Logbook Entry Added",fullDescription:i})}),a.resolve()},function(){l.isLoadingLogbookForCalendar=!1,a.resolve()}),this.isLoadingPolls=!0;l=this;return this.$http.get("/api/Poll?startDate="+n+"&endDate="+o).then(function(e){var t=e.data;l.isLoadingPolls=!1,_.each(t,function(e){var t=e.text;t.length>10&&(t=t.substring(0,10)+"...");var i="Posted by: "+e.authorName+"<br><p>"+e.text+"</p>";l.calendarEvents.push({title:"Poll: "+t,start:e.postDate.substring(0,10),toolTipTitle:"Poll Added",fullDescription:i})}),r.resolve()},function(){l.isLoadingPolls=!1,r.resolve()}),this.$q.all([s.promise,a.promise,r.promise])},e.prototype.getAssociationEvents=function(e,t,i,n){if(this.onlyRefreshCalendarEvents)return this.onlyRefreshCalendarEvents=void 0,void n(this.calendarEvents);this.calendarEvents=[];var o=this;this.getAllEvents(e,t).then(function(){n(o.calendarEvents)})},e.prototype.getCalendarEvents=function(t,i,n,o){this.isLoadingCalendarEvents=!0;var s=t.format(e.DateFormat),a=i.format(e.DateFormat),r=this;this.$http.get("/api/CalendarEvent?startDate="+s+"&endDate="+a).then(function(t){var i=t.data,n=[];r.isLoadingCalendarEvents=!1,_.each(i,function(t){var i,o=moment.utc(t.eventDateUtc),s=o.format(e.TimeFormat)==e.NoTime;if(s)t.timeOnly="",t.dateOnly=new Date(o.year(),o.month(),o.date()),i=new Date(o.year(),o.month(),o.date());else{var a=moment.utc(t.eventDateUtc).local();t.timeOnly=a.format(e.TimeFormat),t.dateOnly=a.clone().startOf("day").toDate(),i=a.toDate()}var r=t.title;r&&r.length>10&&(r=r.substring(0,10)+"...");var l="Posted by: "+t.authorName+"<br><p>"+t.title+"</p>";n.push({title:r,start:i,toolTipTitle:"Event",fullDescription:l,calendarEventObject:t,allDay:s})}),o(n)},function(){r.isLoadingCalendarEvents=!1})},e.prototype.isUserAssociated=function(e){return!(!this.editEvent||!this.editEvent.associatedUserIds)&&_.contains(this.editEvent.associatedUserIds,e)},e.prototype.isDateInPast=function(e){var t=moment(e),i=moment();return t.isBefore(i,"day")||t.isSame(i,"day")},e.prototype.onShouldSendChange=function(){this.editEvent.shouldSendNotification&&this.isDateInPast(this.editEvent.dateOnly)&&(this.editEvent.shouldSendNotification=!1)},e.prototype.onChangeEmailDaysBefore=function(){var e=moment(this.editEvent.dateOnly).subtract(this.editEvent.notificationEmailDaysBefore,"day"),t=moment();if(this.showBadNotificationDateWarning=e.isBefore(t,"day")||e.isSame(t,"day"),this.showBadNotificationDateWarning){this.maxDaysBack=moment(this.editEvent.dateOnly).diff(t,"day"),this.editEvent.notificationEmailDaysBefore=this.maxDaysBack;var i=this;this.$timeout(function(){i.showBadNotificationDateWarning=!1},1e4)}},e.prototype.expandCalendarEventModel=function(){this.showExpandedCalendarEventModel=!0},e.prototype.setEditEvent=function(e,t){if(this.showExpandedCalendarEventModel=t||!1,this.editEvent=e,this.showBadNotificationDateWarning=!1,this.editEvent){var i=this;_.each(this.residents,function(e){e.isAssociated=i.isUserAssociated(e.userId)}),this.editEvent.shouldSendNotification=null!==this.editEvent.notificationEmailDaysBefore,setTimeout(function(){$("#calendar-event-title").focus()},10)}},e.prototype.deleteCalendarEvent=function(e){if(confirm("Are you sure you want to remove this event?")){this.isLoadingCalendarEvents=!0;var t=this;this.$http.delete("/api/CalendarEvent?eventId="+e).then(function(){t.isLoadingCalendarEvents=!1,t.editEvent=null,t.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){t.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")})}},e.prototype.saveCalendarEvent=function(){var t=_.filter(this.residents,function(e){return e.isAssociated});this.editEvent.associatedUserIds=_.map(t,function(e){return e.userId});var i="";"string"==typeof this.editEvent.timeOnly&&this.editEvent.timeOnly.length>1?(i=moment(this.editEvent.dateOnly).format(e.DateFormat)+" "+this.editEvent.timeOnly,this.editEvent.eventDateUtc=moment(i,e.DateFormat+" "+e.TimeFormat).utc().toDate()):(i=moment(this.editEvent.dateOnly).format(e.DateFormat)+" "+e.NoTime,this.editEvent.eventDateUtc=moment.utc(i,e.DateFormat+" "+e.TimeFormat).toDate()),this.editEvent.shouldSendNotification||(this.editEvent.notificationEmailDaysBefore=null);var n;n=this.editEvent.eventId?this.$http.put:this.$http.post,analytics.track("addCalendarEvent"),this.isLoadingCalendarEvents=!0;var o=this;n("/api/CalendarEvent",this.editEvent).then(function(){o.isLoadingCalendarEvents=!1,o.editEvent=null,o.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(e){o.isLoadingCalendarEvents=!1;var t=e.data.exceptionMessage?e.data.exceptionMessage:e.data;alert("Failed to save the calendar event: "+t)})},e.$inject=["$scope","$timeout","$http","$rootScope","$q","fellowResidents"],e.DateFormat="YYYY-MM-DD",e.TimeFormat="h:mma",e.NoTime="12:37am",e}();e.LogbookController=t}(Ally||(Ally={})),CA.angularApp.component("logbookPage",{templateUrl:"/ngApp/chtn/member/logbook.html",controller:Ally.LogbookController});!function(e){var t=function(){return function(){this.emailAddress="",this.password=""}}();e.LoginInfo=t;var i=function(){function e(e,i,n,o,s,a){this.$http=e,this.$rootScope=i,this.$location=n,this.appCacheService=o,this.siteInfo=s,this.xdLocalStorage=a,this.isDemoSite=!1,this.loginInfo=new t}return e.prototype.$onInit=function(){HtmlUtil.isLocalStorageAllowed()||(this.loginResult="You have cookies/local storage disabled. Condo Ally requires these features, please enable to continue. You may be in private browsing mode.");var e=navigator.userAgent.toLowerCase(),t=-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):0;t>0&&t<10&&(document.getElementById("bad-browser-panel").style.display="block"),this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),"1"===HtmlUtil.GetQueryStringParameter("s")&&(this.isDemoSite=!1),this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl,this.sectionStyle={position:"relative"},this.isDemoSite||(this.sectionStyle.left="50%",this.loginImageUrl?(this.sectionStyle.width="760px",this.sectionStyle["margin-left"]="-380px"):(this.sectionStyle.width="450px",this.sectionStyle["margin-left"]="-225px")),"true"===this.appCacheService.getAndClear(this.appCacheService.Key_WasLoggedIn403)?this.$rootScope.isSiteManager?this.loginResult="You are not authorized to perform that action. Please contact support.":this.loginResult="You are not authorized to perform that action. Please contact an admin.":"true"===this.appCacheService.getAndClear(this.appCacheService.Key_WasLoggedIn401)&&(this.loginResult="Please login first."),setTimeout(function(){$("#login-email-textbox").focus()},200)},e.prototype.onForgotPassword=function(){this.appCacheService.set("forgotEmail",this.loginInfo.emailAddress),this.$location.path("/ForgotPassword")},e.prototype.demoLogin=function(){this.loginInfo={emailAddress:"testuser",password:"demosite"},this.onLogin()},e.prototype.onLogin=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Login",this.loginInfo).then(function(t){e.isLoading=!1;var i=t.data,n=e.appCacheService.getAndClear(e.appCacheService.Key_AfterLoginRedirect);e.siteInfo.setAuthToken(i.authToken),e.siteInfo.handleSiteInfo(i.siteInfo,e.$rootScope),e.rememberMe?(window.localStorage.rememberMe_Email=e.loginInfo.emailAddress,window.localStorage.rememberMe_Password=btoa(e.loginInfo.password)):(window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null),null!==i.siteInfo.userInfo.acceptedTermsDate||e.isDemoSite?(HtmlUtil.isValidString(n)||"/Login"===n||(n="/Home"),e.$location.path(n)):e.$location.path("/MyProfile")},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;e.loginResult="Failed to log in: "+i})},e.$inject=["$http","$rootScope","$location","appCacheService","SiteInfo","xdLocalStorage"],e}();e.LoginController=i}(Ally||(Ally={})),CA.angularApp.component("loginPage",{templateUrl:"/ngApp/chtn/member/login.html",controller:Ally.LoginController});!function(e){var t=function(){function e(e,t,i,n,o){this.$rootScope=e,this.$http=t,this.$location=i,this.appCacheService=n,this.siteInfo=o}return e.prototype.$onInit=function(){this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),this.siteInfo.privateSiteInfo&&(this.canHideContactInfo=this.siteInfo.privateSiteInfo.canHideContactInfo),this.retrieveProfileData()},e.prototype.retrieveProfileData=function(){var e=this;this.isLoading=!0;this.$http.get("/api/MyProfile").then(function(t){e.isLoading=!1,e.profileInfo=t.data,e.profileImageType="blank",e.profileInfo.avatarUrl&&-1!==e.profileInfo.avatarUrl.indexOf("gravatar")&&(e.profileImageType="gravatar"),e.gravatarUrl="https://www.gravatar.com/avatar/"+md5((e.profileInfo.email||"").toLowerCase())+"?s=80&d=identicon",HtmlUtil.endsWith(e.profileInfo.email,"@condoally.com")&&(e.profileInfo.email=""),e.needsToAcceptTerms=null===e.profileInfo.acceptedTermsDate&&!e.isDemoSite,e.hasAcceptedTerms=!e.needsToAcceptTerms,e.$rootScope.hideMenu=e.needsToAcceptTerms,e.saveButtonStyle={width:"100px","font-size":"1em"}})},e.prototype.onSaveInfo=function(){this.isLoading=!0;var e=this;this.$http.put("/api/MyProfile",this.profileInfo).then(function(){e.resultMessage="Your changes have been saved.",e.$rootScope.hideMenu&&(e.$rootScope.hideMenu=!1,e.$location.path("/Home")),e.isLoading=!1},function(t){e.isLoading=!1,alert("Failed to save: "+t.data.exceptionMessage)})},e.$inject=["$rootScope","$http","$location","appCacheService","SiteInfo"],e}();e.MyProfileController=t}(Ally||(Ally={})),CA.angularApp.component("myProfile",{templateUrl:"/ngApp/chtn/member/my-profile.html",controller:Ally.MyProfileController});!function(e){var t=function(){function e(e,t,i,n){this.$scope=e,this.$http=t,this.$timeout=i,this.WizardHandler=n,this.unitNumberingType="Numbered",this.numUnits=3,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.signUpInfo={buildings:[{units:[]}],signerUpInfo:{buildingIndex:0,boardPositionValue:"1"}}}return e.prototype.$onInit=function(){var e=this;this.$timeout(function(){e.init()},500)},e.prototype.onNumUnitsChanged=function(){if(this.numUnits){this.numUnits<1?this.numUnits=1:this.numUnits>100&&(this.numUnits=100);var e=this.numUnits-this.signUpInfo.buildings[0].units.length;if(this.signUpInfo.buildings[0].units.length=this.numUnits,e>0)for(var t=this.numUnits-e;t<this.numUnits;++t)this.signUpInfo.buildings[0].units[t]={name:this.getUnitName(t),residents:[{}]}}},e.prototype.addResident=function(e){e.residents||(e.residents=[]),e.residents.push({})},e.prototype.getUnitName=function(e){if("Numbered"===this.unitNumberingType)return(e+1).toString();if("Lettered"===this.unitNumberingType){var t="",i=Math.floor(e/26);i>0&&(t+=String.fromCharCode("A".charCodeAt(0)+(i-1)));var n=e%26;return t+=String.fromCharCode("A".charCodeAt(0)+n)}return"EW"===this.unitNumberingType||"NS"===this.unitNumberingType?e%2==0?(e/2+1).toString()+("EW"===this.unitNumberingType?"E":"N"):Math.ceil(e/2).toString()+("EW"===this.unitNumberingType?"W":"S"):(e+1).toString()},e.prototype.onNumberingTypeChange=function(){for(var e=0;e<this.signUpInfo.buildings[0].units.length;++e)this.signUpInfo.buildings[0].units[e]||(this.signUpInfo.buildings[0].units[e]={}),this.signUpInfo.buildings[0].units[e].name=this.getUnitName(e)},e.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},e.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},e.prototype.init=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted",{category:"SignUp",label:"Started"});var e=document.getElementById("address-map");this.map=new google.maps.Map(e,{center:{lat:41.869638,lng:-87.657423},zoom:9});var t=document.getElementById("building-0-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(t),this.addressAutocomplete.bindTo("bounds",this.map),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"});var i=this;this.addressAutocomplete.addListener("place_changed",function(){i.setPlaceWasSelected(),i.mapMarker.setVisible(!1);var e=i.addressAutocomplete.getPlace(),t=e.formatted_address;t.indexOf(", USA")===t.length-", USA".length&&(t=t.substring(0,t.length-", USA".length)),i.signUpInfo.buildings[0].streetAddress=t,HtmlUtil.isNullOrWhitespace(i.signUpInfo.name)&&i.$scope.$apply(function(){i.signUpInfo.name=e.name+" Condo Association"}),e.geometry&&(i.centerMap(e.geometry),$("#association-name-text-box").focus())}),i.onNumUnitsChanged()},e.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForBuildingAddress())},e.prototype.refreshMapForBuildingAddress=function(){this.isLoadingMap=!0;var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.buildings[0].streetAddress,function(t,i){e.$scope.$apply(function(){if(e.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;if(n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.buildings[0].streetAddress=n,e.centerMap(t[0].geometry),HtmlUtil.isNullOrWhitespace(e.signUpInfo.name)){var o=HtmlUtil.getStringUpToFirst(n,",");e.signUpInfo.name=o+" Condo Association"}}})})},e.prototype.addBuilding=function(){this.signUpInfo.buildings.length+1>=25?alert("We do not support more than 25 buildings."):this.signUpInfo.buildings.push({})},e.prototype.onFinishedWizard=function(){this.isLoading=!0;var e=this;this.$http.post("/api/SignUpWizard",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete",{category:"SignUp",label:"Success"}),HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl):(alert("Failed to complete sign-up: "+i.errorMessage),e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to complete sign-up: "+i)})},e.$inject=["$scope","$http","$timeout","WizardHandler"],e}();e.CondoSignUpWizardController=t}(Ally||(Ally={})),CA.angularApp.component("condoSignUpWizard",{templateUrl:"/ngApp/chtn/public/condo-sign-up-wizard.html",controller:Ally.CondoSignUpWizardController});!function(e){var t=function(){return function(){}}();e.DiscussionThread=t;var i=function(){function e(e,t){this.$http=e,this.$routeParams=t,this.isLoading=!1,this.activeView="loading"}return e.prototype.$onInit=function(){this.unsubscribeUser()},e.prototype.loadDiscussion=function(){var e=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0;var t=this;this.$http.get("/Discussion/"+e).then(function(e){t.isLoading=!1,t.discussion=e.data},function(e){t.isLoading=!1,t.errorMessage="Failed to find the discussion details. Please contact support to alert them to the issue."})},e.prototype.unsubscribeUser=function(){var e=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0,this.activeView="loading";var t=this;this.$http.put("/api/Discussion/Unsubscribe/"+e,null).then(function(e){t.isLoading=!1,t.activeView="unsubscribed",t.discussion=e.data},function(e){t.isLoading=!1,t.activeView="error",t.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},e.prototype.resubscribeUser=function(){var e=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0,this.activeView="loading";var t=this;this.$http.put("/api/Discussion/Resubscribe/"+e,null).then(function(e){t.isLoading=!1,t.activeView="resubscribed"},function(e){t.isLoading=!1,t.activeView="error",t.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},e.$inject=["$http","$routeParams"],e}();e.DiscussionManageController=i}(Ally||(Ally={})),CA.angularApp.component("discussionManage",{templateUrl:"/ngApp/chtn/public/discussion-manage.html",controller:Ally.DiscussionManageController});!function(e){var t=function(){function e(e,t){this.$http=e,this.$routeParams=t,this.isLoading=!1,this.showButtons=!0}return e.prototype.$onInit=function(){},e.prototype.reportAbuse=function(e){var t={abuseReason:e,idVal:decodeURIComponent(this.$routeParams.idValue),otherReasonText:this.otherReasonText};this.isLoading=!0;var i=this;this.$http.post("/api/EmailAbuse/v3",t).then(function(){i.isLoading=!1,i.showButtons=!1})},e.$inject=["$http","$routeParams"],e}();e.EmailAbuseController=t}(Ally||(Ally={})),CA.angularApp.component("emailAbuse",{templateUrl:"/ngApp/chtn/public/email-abuse.html",controller:Ally.EmailAbuseController});!function(e){var t=function(){return function(){this.boardPositionValue=1}}();e.HoaSignerUpInfo=t;var i=function(){return function(){this.name="",this.streetAddress="",this.isResident=!0,this.signerUpInfo=new t}}();e.HoaSignUpInfo=i;var n=function(){function t(t,i,n,o){this.$scope=t,this.$http=i,this.$timeout=n,this.WizardHandler=o,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.hoaPoly={vertices:[]},this.showMap=!1,this.signUpInfo=new e.HoaSignUpInfo}return t.prototype.$onInit=function(){var e=this;e=this;this.$scope.$on("wizard:stepChanged",function(t,i){1===i.index?e.$timeout(function(){return e.showMap=!0},50):e.showMap=!1})},t.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},t.prototype.initMapStep=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted"),this.showMap=!0;var e=document.getElementById("association-address-text-box");if(e&&(this.addressAutocomplete=new google.maps.places.Autocomplete(e),this.addressAutocomplete.bindTo("bounds",this.map)),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this.addressAutocomplete){var t=this,i=function(){t.setPlaceWasSelected(),t.mapMarker.setVisible(!1);var e=t.addressAutocomplete.getPlace(),i=e.formatted_address;i.indexOf(", USA")===i.length-", USA".length&&(i=i.substring(0,i.length-", USA".length)),t.signUpInfo.streetAddress=i,e.geometry&&(t.setEditPolyForAddress(e.geometry.location),t.centerMap(e.geometry))};this.addressAutocomplete.addListener("place_changed",function(){t.$scope.$apply(i)})}},t.prototype.onMapEditorReady=function(e){this.map=e,this.initMapStep()},t.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForAddress())},t.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},t.prototype.setEditPolyForAddress=function(e){this.hoaPoly={vertices:[{lat:e.lat()-.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()+.0014},{lat:e.lat()-.001,lon:e.lng()+.0014}]}},t.prototype.refreshMapForAddress=function(){this.isLoadingMap=!0;var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){e.$scope.$apply(function(){if(e.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.streetAddress=n,t[0].geometry&&(e.setEditPolyForAddress(t[0].geometry.location),e.centerMap(t[0].geometry))}})})},t.prototype.onFinishedWizard=function(){this.isLoading=!0,this.signUpInfo.boundsGpsVertices=this.hoaPoly.vertices;var e=this;this.$http.post("/api/SignUpWizard/Hoa",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete"),void 0!==window.goog_report_conversion&&window.goog_report_conversion(),HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl):(alert("Failed to complete sign-up: "+i.errorMessage),e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1,alert("Failed to complete sign-up: "+t.data.exceptionMessage)})},t.$inject=["$scope","$http","$timeout","WizardHandler"],t}();e.HoaSignUpWizardController=n}(Ally||(Ally={})),CA.angularApp.component("hoaSignUpWizard",{templateUrl:"/ngApp/chtn/public/hoa-sign-up-wizard.html",controller:Ally.HoaSignUpWizardController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e){this.$http=e,this.isLoading=!1,this.signUpInfo=new t,this.resultIsError=!1}return e.prototype.$onInit=function(){setTimeout(function(){var e=document.getElementById("address-text-box");new google.maps.places.Autocomplete(e)},750)},e.prototype.onSubmitInfo=function(){if(HtmlUtil.isNullOrWhitespace(this.signUpInfo.emailAddress))alert("Please enter an e-mail address");else{this.isLoading=!0;var e=this;this.$http.post("/api/NeighborSignUp/SignUpNewUser",this.signUpInfo).then(function(t){e.isLoading=!1,e.resultIsError=!1,e.resultMessage="Your information has been successfully submitted. Look for a welcome email soon."},function(){e.isLoading=!1,e.resultIsError=!0,e.resultMessage="There was an error submitting your information. Please try again."})}},e.prototype.goBack=function(){this.resultMessage=null},e.$inject=["$http"],e}();e.NeighborSignUpController=i}(Ally||(Ally={})),CA.angularApp.component("neighborSignUp",{templateUrl:"/ngApp/chtn/public/neighbor-sign-up.html",controller:Ally.NeighborSignUpController});!function(e){var t=function(){return function(){this.fullName="",this.email="",this.address="",this.neighborhoodName="",this.notes=""}}(),i=function(){function i(i,n,o,s){this.$scope=i,this.$http=n,this.$timeout=o,this.WizardHandler=s,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.hoaPoly={vertices:[]},this.showMap=!1,this.tempSignUpInfo=new t,this.signUpInfo=new e.HoaSignUpInfo}return i.prototype.$onInit=function(){var e=this;e=this;this.$scope.$on("wizard:stepChanged",function(t,i){1===i.index?e.$timeout(function(){return e.showMap=!0},50):e.showMap=!1}),setTimeout(function(){var e=document.getElementById("signUpAddress");e&&new google.maps.places.Autocomplete(e)},500)},i.prototype.onSubmitTempInfo=function(){this.isLoading=!0;var e=this;this.$http.post("/api/SignUpWizard/TempNeighborhood",this.tempSignUpInfo).then(function(){e.isLoading=!1,e.submitTempResult="Thank you for your submission. We'll be in touch shortly."},function(t){e.isLoading=!1,e.submitTempResult="Submission failed: "+t.data.exceptionMessage+". Feel free to refresh the page to try again or use the contact form at the bottom of the Community Ally home page."})},i.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},i.prototype.initMapStep=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted"),this.showMap=!0;var e=document.getElementById("association-address-text-box");if(e&&(this.addressAutocomplete=new google.maps.places.Autocomplete(e),this.addressAutocomplete.bindTo("bounds",this.map)),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this.addressAutocomplete){var t=this,i=function(){t.setPlaceWasSelected(),t.mapMarker.setVisible(!1);var e=t.addressAutocomplete.getPlace(),i=e.formatted_address;i.indexOf(", USA")===i.length-", USA".length&&(i=i.substring(0,i.length-", USA".length)),t.signUpInfo.streetAddress=i,e.geometry&&(t.setEditPolyForAddress(e.geometry.location),t.centerMap(e.geometry))};this.addressAutocomplete.addListener("place_changed",function(){t.$scope.$apply(i)})}},i.prototype.onMapEditorReady=function(e){this.map=e,this.initMapStep()},i.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForAddress())},i.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},i.prototype.setEditPolyForAddress=function(e){this.hoaPoly={vertices:[{lat:e.lat()-.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()+.0014},{lat:e.lat()-.001,lon:e.lng()+.0014}]}},i.prototype.refreshMapForAddress=function(){this.isLoadingMap=!0;var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){e.$scope.$apply(function(){if(e.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.streetAddress=n,t[0].geometry&&(e.setEditPolyForAddress(t[0].geometry.location),e.centerMap(t[0].geometry))}})})},i.prototype.onFinishedWizard=function(){this.isLoading=!0,this.signUpInfo.boundsGpsVertices=this.hoaPoly.vertices;var e=this;this.$http.post("/api/SignUpWizard/Hoa",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete"),void 0!==window.goog_report_conversion&&window.goog_report_conversion(),HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl):(alert("Failed to complete sign-up: "+i.errorMessage),e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1,alert("Failed to complete sign-up: "+t.data.exceptionMessage)})},i.$inject=["$scope","$http","$timeout","WizardHandler"],i}();e.NeighborhoodSignUpWizardController=i}(Ally||(Ally={})),CA.angularApp.component("neighborhoodSignUpWizard",{templateUrl:"/ngApp/chtn/public/neighborhood-sign-up-wizard.html",controller:Ally.NeighborhoodSignUpWizardController});!function(e){var t=function(){function e(e,t,i,n){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$cacheFactory=n}return e.prototype.$onInit=function(){},e.$inject=["$http","$rootScope","SiteInfo","$cacheFactory"],e}();e.CommitteeHomeController=t}(Ally||(Ally={})),CA.angularApp.component("committeeHome",{bindings:{committee:"<"},templateUrl:"/ngApp/committee/committee-home.html",controller:Ally.CommitteeHomeController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.fellowResidents=t,this.$cacheFactory=i,this.isLoading=!1}return e.prototype.$onInit=function(){this.populateAllMembers()},e.prototype.populateAllMembers=function(){var e=this;this.isLoading=!0,this.fellowResidents.getResidents().then(function(t){e.allGroupMembers=t,e.getMembers()})},e.prototype.setContactMember=function(){var e=this;this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/SetContactMember?userId="+this.contactUser.userId,null).then(function(t){e.isLoading=!1,e.committee.contactMemberUserId=e.contactUser.userId,e.$cacheFactory.get("$http").remove("/api/Committee/"+e.committee.committeeId),e.fellowResidents.clearResidentCache()},function(t){e.isLoading=!1,alert("Failed to set contact member: "+t.data.exceptionMessage)})},e.prototype.getMembers=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Committee/"+this.committee.committeeId+"/Members").then(function(t){e.isLoading=!1,e.members=t.data;e.filteredGroupMembers=_.filter(e.allGroupMembers,function(t){return i=t,!_.some(e.members,function(e){return e.userId===i.userId});var i}),e.filteredGroupMembers=_.sortBy(e.filteredGroupMembers,function(e){return e.fullName}),e.contactUser=_.find(e.members,function(t){return t.userId==e.committee.contactMemberUserId})},function(t){e.isLoading=!1,alert("Failed to retrieve committee members, please refresh the page to try again")})},e.prototype.addSelectedMember=function(){var e=this;this.userForAdd&&(this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/AddMember?userId="+this.userForAdd.userId,null).then(function(t){e.isLoading=!1,e.getMembers()},function(t){e.isLoading=!1,alert("Failed to add member, please refresh the page to try again: "+t.data.exceptionMessage)}))},e.prototype.removeMember=function(e){var t=this;confirm("Are you sure you want to remove this person from this committee?")&&(this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/RemoveMember?userId="+e.userId,null).then(function(e){t.isLoading=!1,t.getMembers()},function(e){t.isLoading=!1,alert("Failed to remove member, please refresh the page to try again: "+e.data.exceptionMessage)}))},e.$inject=["$http","fellowResidents","$cacheFactory"],e}();e.CommitteeMembersController=t}(Ally||(Ally={})),CA.angularApp.component("committeeMembers",{bindings:{committee:"<"},templateUrl:"/ngApp/committee/committee-members.html",controller:Ally.CommitteeMembersController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.$cacheFactory=n,this.$rootScope=o,this.canManage=!1,this.initialView="Home",this.selectedView=null,this.isLoading=!1,this.committeeId=this.$routeParams.committeeId,this.initialView=this.$routeParams.viewName||"Home"}return e.prototype.$onInit=function(){this.canManage=this.siteInfo.userInfo.isSiteManager,this.retrieveCommittee()},e.prototype.retrieveCommittee=function(){var e=this;this.isLoading=!0,this.$rootScope.dontHandle403=!0,this.$http.get("/api/Committee/"+this.committeeId,{cache:!0}).then(function(t){e.$rootScope.dontHandle403=!1,e.isLoading=!1,e.committee=t.data,e.selectedView=e.initialView},function(t){e.$rootScope.dontHandle403=!1,e.isLoading=!1,403===t.status?(alert("You are not authorized to view this private committee. You must be a member of the committee to view its contents. Reach out to a board member to inquire about joining the committiee."),window.location.href="/#!/Home"):alert("Failed to load committee: "+t.data.exceptionMessage)})},e.prototype.onUpdateCommitteeName=function(){var e=this;this.isLoading=!0;var t="/api/Committee/"+this.committeeId+"?newName="+this.committee.name;this.$http.put(t,null).then(function(){e.isLoading=!1,e.$cacheFactory.get("$http").remove("/api/Committee/"+e.committeeId)},function(t){e.isLoading=!1,alert("Failed to update the committee name: "+t.data.exceptionMessage)})},e.$inject=["$http","SiteInfo","$routeParams","$cacheFactory","$rootScope"],e}();e.CommitteeParentController=t}(Ally||(Ally={})),CA.angularApp.component("committeeParent",{templateUrl:"/ngApp/committee/committee-parent.html",controller:Ally.CommitteeParentController});!function(e){var t=function(){return function(){}}();e.InfoItem=t;var i=function(){function e(e,i,n,o){this.$http=e,this.$rootScope=i,this.siteInfo=n,this.$cacheFactory=o,this.isBodyMissing=!1,this.isSiteManager=!1,this.editingInfoItem=new t}return e.prototype.$onInit=function(){this.hideDocuments=this.$rootScope.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.isSiteManager=this.$rootScope.isSiteManager,this.retrieveInfo(),window.setTimeout(function(){!function(){var e=$("[title=Font]").siblings(".dropdown-menu");if($.each(["Serif","Sans","Arial","Arial Black","Courier","Courier New","Comic Sans MS","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],function(t,i){e.append($('<li><a data-edit="fontName '+i+'" style="font-family:\''+i+"'\">"+i+"</a></li>"))}),$("a[title]").tooltip({container:"body"}),$(".dropdown-menu input").click(function(){return!1}).change(function(){$(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="",$(this).change()}),$("[data-role=magic-overlay]").each(function(){var e=$(this),t=$(e.data("target"));e.css("opacity",0).css("position","absolute").offset(t.offset()).width(t.outerWidth()).height(t.outerHeight())}),"onwebkitspeechchange"in document.createElement("input")){var t=$("#editor").offset();$("#voiceBtn").css("position","absolute").offset({top:t.top,left:t.left+$("#editor").innerWidth()-35})}else $("#voiceBtn").hide()}();$("#editor").wysiwyg({fileUploadError:function(e,t){var i="";"unsupported-file-type"===e?i="Unsupported format "+t:console.log("error uploading file",e,t),$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button><strong>File upload error</strong> '+i+" </div>").prependTo("#alerts")}})},10)},e.prototype.retrieveInfo=function(){var e=this;this.isLoadingInfo=!0,this.getUri||(this.getUri="/api/InfoItem",this.committee&&(this.getUri="/api/InfoItem/Committee/"+this.committee.committeeId)),this.$http.get(this.getUri,{cache:!0}).then(function(t){e.isLoadingInfo=!1,e.infoItems=t.data})},e.prototype.scrollToInfo=function(e){document.getElementById("info-item-title-"+e).scrollIntoView()},e.prototype.onStartEditInfoItem=function(e){this.editingInfoItem=jQuery.extend({},e),$("#editor").html(this.editingInfoItem.body),window.scrollTo(0,document.body.scrollHeight)},e.prototype.onSubmitItem=function(){this.editingInfoItem.body=$("#editor").html(),this.isBodyMissing=HtmlUtil.isNullOrWhitespace(this.editingInfoItem.body);var e=$("#info-item-edit-form");if(e.validate(),e.valid()&&!this.isBodyMissing){this.committee&&(this.editingInfoItem.committeeId=this.committee.committeeId),this.isLoadingInfo=!0;var i=this,n=function(){i.isLoadingInfo=!1,$("#editor").html(""),i.editingInfoItem=new t,i.$cacheFactory.get("$http").remove(i.getUri),i.retrieveInfo()};"number"==typeof this.editingInfoItem.infoItemId?this.$http.put("/api/InfoItem",this.editingInfoItem).then(n):this.$http.post("/api/InfoItem",this.editingInfoItem).then(n)}},e.prototype.onDeleteInfoItem=function(e){var t=this;confirm("Are you sure you want to delete this information?")&&(this.isLoadingInfo=!0,this.$http.delete("/api/InfoItem/"+e.infoItemId).then(function(){t.isLoadingInfo=!1,t.$cacheFactory.get("$http").remove(t.getUri),t.retrieveInfo()}))},e.$inject=["$http","$rootScope","SiteInfo","$cacheFactory"],e}();e.FAQsController=i}(Ally||(Ally={})),CA.angularApp.component("faqs",{bindings:{committee:"<?"},templateUrl:"/ngApp/common/FAQs.html",controller:Ally.FAQsController});!function(e){var t=function(){function e(e,t,i,n){this.$http=e,this.siteInfo=t,this.$timeout=i,this.$rootScope=n,this.isLoading=!1}return e.prototype.$onInit=function(){this.refreshPolls()},e.prototype.populatePollData=function(e){this.polls=e,e&&e.length>0&&this.$rootScope.$broadcast("homeHasActivePolls");for(var t=0;t<this.polls.length;++t){var i=this.polls[t];if(i.hasUsersUnitVoted&&i.canViewResults){var n=_.groupBy(i.responses,"answerId");i.chartData=[],i.chartLabels=[];for(var o in n)n.hasOwnProperty(o)&&(i.chartLabels.push(_.find(i.answers,function(e){return e.pollAnswerId==o}).answerText),i.chartData.push(n[o].length));i.responses&&i.responses.length<this.siteInfo.privateSiteInfo.numUnits&&(i.chartLabels.push("No Response"),i.chartData.push(this.siteInfo.privateSiteInfo.numUnits-i.responses.length))}}},e.prototype.refreshPolls=function(){this.isLoading=!0;var e=this;this.$http({method:"GET",url:"/api/Poll?getActive=1"}).then(function(t){e.isLoading=!1,e.$timeout(function(){e.populatePollData(t.data)},100)},function(){e.isLoading=!1})},e.prototype.onPollAnswer=function(e,t,i){this.isLoading=!0;var n="/api/PollResponse?pollId="+e.pollId+"&answerId="+(t?t.pollAnswerId:"")+"&writeInAnswer="+i,o=this;this.$http.put(n,null).then(function(e){o.polls=e.data,o.isLoading=!1,o.refreshPolls()},function(){o.isLoading=!1})},e.$inject=["$http","SiteInfo","$timeout","$rootScope"],e}();e.ActivePollsController=t}(Ally||(Ally={})),CA.angularApp.component("activePolls",{templateUrl:"/ngApp/common/active-polls.html",controller:Ally.ActivePollsController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$rootScope=i,this.isLoading_Payment=!1}return e.prototype.$onInit=function(){this.allyAppName=AppConfig.appName,this.isAutoPayActive=this.siteInfo.userInfo.isAutoPayActive,this.assessmentCreditCardFeeLabel=this.siteInfo.privateSiteInfo.payerPaysCCFee?"Service fee applies":"No service fee",this.assessmentAchFeeLabel=this.siteInfo.privateSiteInfo.payerPaysAchFee?"Service fee applies":"No service fee",this.payerPaysAchFee=this.siteInfo.privateSiteInfo.payerPaysAchFee,this.errorPayInfoText="Is the amount incorrect?",this.isWePaySetup=this.siteInfo.privateSiteInfo.isPaymentEnabled,this.hasAssessments=this.siteInfo.privateSiteInfo.hasAssessments,this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,!this.isAutoPayActive&&HtmlUtil.isNumericString(HtmlUtil.GetQueryStringParameter("preapproval_id"))&&(this.isAutoPayActive=!0),this.nextAutoPayText=this.siteInfo.userInfo.nextAutoPayText,null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0?this.assessmentAmount=this.siteInfo.userInfo.usersUnits[0].assessment:this.assessmentAmount=0,this.paymentInfo={paymentType:"other",amount:this.assessmentAmount,note:"",fundingType:null};if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments&&this.recentPayments.length>0)for(this.recentPayments.length>6&&(this.recentPayments=this.recentPayments.slice(0,6)),this.numRecentPayments=this.recentPayments.length;this.recentPayments.length<6;)this.recentPayments.push({});null!=this.siteInfo.privateSiteInfo.assessmentFrequency&&null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())),setTimeout(function(){$("#btn_view_pay_history").click(function(){$("#pm_info").collapse("hide"),$("#payment_history").collapse("show")}),$("#btn_view_pay_info").click(function(){$("#payment_history").collapse("hide"),$("#pm_info").collapse("show")}),$(".hide").click(function(){$(this).parent().hide("")})},400)},e.prototype.makePayment=function(e){this.isLoading_Payment=!0,this.paymentInfo.fundingType=e,analytics.track("makePayment",{fundingType:e});var t=this;this.$http.post("/api/WePayPayment",this.paymentInfo).then(function(e){var i=e.data;null!==i&&"string"==typeof i.checkoutUri&&i.checkoutUri.length>0?window.location.href=i.checkoutUri:(t.isLoading_Payment=!1,alert("Unable to initiate WePay checkout"))},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)})},e.prototype.onIncorrectPayDetails=function(){var e=this.assessmentAmount.toString();Math.round(this.assessmentAmount)!=this.assessmentAmount&&(e=this.assessmentAmount.toFixed(2));var t=e;this.knowsNextPayment&&HtmlUtil.isValidString(this.nextPaymentText)&&(t+="|"+this.nextPaymentText),this.$rootScope.$broadcast("prepAssessmentEmailToBoard",t)},e.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},e.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"==e?this.assessmentAmount:0,this.updatePaymentText()},e.prototype.getNextPaymentText=function(e,t){if(null==e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];if("month"===n.intervalName){i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]}else if("quarter"===n.intervalName){i=["Q1","Q2","Q3","Q4"][s.period-1]}else if("half-year"===n.intervalName){i=["First Half","Second Half"][s.period-1]}i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},e.prototype.onSetupAutoPay=function(e){this.isLoading_Payment=!0;var t=this;this.$http.get("/api/WePayPayment/SetupAutoPay?fundingType="+e).then(function(e){var i=e.data;"string"==typeof i&&i.length>0?window.location.href=i:(t.isLoading_Payment=!1,alert("Unable to initiate WePay auto-pay setup"))},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)})},e.prototype.onDisableAutoPay=function(){if(confirm("Just to double check, this will disable your auto-payment. You need to make sure to manually make your regular payments to avoid any late fees your association may enforce.")){this.isLoading_Payment=!0;var e=this;this.$http.get("/api/WePayPayment/DisableAutoPay").then(function(){e.isLoading_Payment=!1,e.isAutoPayActive=!1},function(t){e.isLoading_Payment=!1,t.data&&t.data.exceptionMessage&&alert(t.data.exceptionMessage)})}},e.$inject=["$http","SiteInfo","$rootScope"],e}();e.AssessmentPaymentFormController=t}(Ally||(Ally={})),CA.angularApp.component("assessmentPaymentForm",{templateUrl:"/ngApp/common/assessment-payment-form.html",controller:Ally.AssessmentPaymentFormController});!function(e){var t=function(){return function(){}}();e.DocumentTreeFile=t;var i=function(){function e(){}return e.prototype.getSubDirectoryByName=function(e){if(!this.subdirectories)return null;for(var t=0;t<this.subdirectories.length;++t)if(this.subdirectories[t].name===e)return this.subdirectories[t];return null},e}();e.DocumentDirectory=i;var n=function(){function e(t,i,n,o){this.$http=t,this.$rootScope=i,this.$cacheFactory=n,this.$scope=o,this.isLoading=!1,this.filesSortDescend=!1,this.title="Documents",this.getDocsUri="/api/ManageDocuments",this.fileSortType=window.localStorage[e.LocalStorageKey_SortType],this.fileSortType||(this.fileSortType="title"),this.filesSortDescend="true"===window.localStorage[e.LocalStorageKey_SortDirection],this.fileSearch={all:""},this.isSiteManager=i.isSiteManager}return e.prototype.$onInit=function(){this.apiAuthToken=this.$rootScope.authToken,this.Refresh();var e=this;setTimeout(function(){$(function(){$("#JQFileUploader").fileupload({autoUpload:!0,add:function(t,i){var n=e.getSelectedDirectoryPath();$("#FileUploadProgressContainer").show(),i.url="api/DocumentUpload?dirPath="+encodeURIComponent(n)+"&ApiAuthToken="+e.apiAuthToken,i.submit().done(function(t){e.$cacheFactory.get("$http").remove(e.getDocsUri),$("#FileUploadProgressContainer").hide(),e.Refresh()})},progressall:function(e,t){var i=parseInt((t.loaded/t.total*100).toString(),10);$("#FileUploadProgressBar").css("width",i+"%"),100===i?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(i+"%")}})})},100),this.committee&&(this.title="Committee Documents")},e.prototype.getSelectedDirectoryPath=function(){return this.getDirectoryFullPath(this.selectedDirectory)},e.prototype.getDirectoryFullPath=function(t){for(var i=t.name,n=t.parentDirectory;n;)i=n.name+"/"+i,n=n.parentDirectory;return this.committee&&(i=e.DirName_Committees+"/"+this.committee.committeeId+"/"+i),i},e.prototype.FindDirectoryByPath=function(t){if(this.documentTree){if(this.committee&&HtmlUtil.startsWith(t,e.DirName_Committees)){var i=(t=t.substr(e.DirName_Committees.length+1)).indexOf("/");-1!==i&&(t=t.substr(i+1))}for(var n=t.split("/"),o=this.documentTree,s=0;s<n.length&&(o=o.getSubDirectoryByName(n[s]));++s);return o}},e.prototype.updateFileFilter=function(){var e=angular.lowercase(this.fileSearch.all)||"";this.searchFileList=_.filter(this.fullSearchFileList,function(t){return-1!==angular.lowercase(t.localFilePath||"").indexOf(e)||-1!==angular.lowercase(t.uploadDateString||"").indexOf(e)||-1!==angular.lowercase(t.uploaderFullName||"").indexOf(e)}),setTimeout(function(){var e=document.getElementById("documents-area"),t=e.style.display;e.style.display="none";e.offsetHeight;e.style.display=t},50)},e.prototype.hookUpFileDragging=function(){if(this.isSiteManager){var e=this;setTimeout(function(){$(".droppable").droppable({drop:function(t,i){var n=e.getSelectedDirectoryPath();$(i.draggable).draggable("option","revert","false");var o=$(this).attr("data-folder-path").trim();e.$scope.$apply(function(){e.isLoading=!0;var t={relativeS3Path:e.selectedFile.relativeS3Path,action:"move",newFileName:"",sourceFolderPath:n,destinationFolderPath:o};e.selectedFile=null,e.$http.put("/api/ManageDocuments/MoveFile",t).then(function(){e.isLoading=!1,e.$cacheFactory.get("$http").remove(e.getDocsUri),e.Refresh()},function(t){e.isLoading=!1;var i=t.exceptionMessage||t.message||t;alert("Failed to move file: "+i)})})},hoverClass:"Document_Folder_DropHover"});$(".draggable").draggable({distance:10,revert:!0,helper:"clone",opacity:.7,containment:"document",appendTo:"body",start:function(t,i){var n=$(this).attr("id").substring("File_".length),o=parseInt(n);e.$scope.$apply(function(){var t=e.selectedDirectory.files[o];e.selectedFile=t})}})},250)}},e.prototype.onDirectoryClicked=function(e){this.selectedDirectory=e,this.selectedFile=null,this.fileSearch.all=null,this.hookUpFileDragging(),this.SortFiles()},e.prototype.CreateDirectory=function(){this.createUnderParentDirName=null,this.committee&&(this.createUnderParentDirName=e.DirName_Committees+"/"+this.committee.committeeId),this.shouldShowCreateFolderModal=!0,setTimeout(function(){$("#CreateDirectoryNameTextBox").focus()},50)},e.prototype.CreateSubDirectory=function(){this.createUnderParentDirName=this.selectedDirectory.name,this.committee&&(this.createUnderParentDirName=e.DirName_Committees+"/"+this.committee.committeeId+"/"+this.createUnderParentDirName),this.shouldShowCreateFolderModal=!0,setTimeout(function(){$("#CreateDirectoryNameTextBox").focus()},50)},e.prototype.SetFileSortType=function(t){this.fileSortType===t?this.filesSortDescend=!this.filesSortDescend:this.filesSortDescend=!1,this.fileSortType=t,window.localStorage[e.LocalStorageKey_SortType]=this.fileSortType,window.localStorage[e.LocalStorageKey_SortDirection]=this.filesSortDescend,this.SortFiles()},e.prototype.SortFiles=function(){this.selectedDirectory&&this.selectedDirectory.files&&("title"!==this.fileSortType&&"uploadDate"!==this.fileSortType||(this.selectedDirectory.files=_.sortBy(this.selectedDirectory.files,this.fileSortType)),this.filesSortDescend&&this.selectedDirectory.files.reverse())},e.prototype.onCreateDirectoryClicked=function(){this.isLoading=!0,$("#CreateDirectoryButtonsPanel").hide();var e="/api/ManageDocuments/CreateDirectory?folderName="+encodeURIComponent(this.newDirectoryName);e+="&parentFolderPath=",this.createUnderParentDirName&&(e+=encodeURIComponent(this.createUnderParentDirName));var t=this;this.$http.put(e,null).then(function(){t.$cacheFactory.get("$http").remove(t.getDocsUri),t.newDirectoryName="",t.Refresh(),t.shouldShowCreateFolderModal=!1,$("#CreateDirectoryButtonsPanel").show()},function(e){var i=e.data.exceptionMessage||e.data.message||e.data;alert("Failed to create the folder: "+i),t.isLoading=!1,$("#CreateDirectoryButtonsPanel").show()})},e.prototype.onCancelAddDirectory=function(){this.shouldShowCreateFolderModal=!1,this.newDirectoryName=""},e.prototype.onFileClicked=function(e){this.selectedFile=e},e.prototype.RenameDocument=function(e){if(e){var t=prompt("Enter the new name for the file",e.title);if(null!==t){t.length>64&&(t=t.substr(0,64)),this.isLoading=!0;var i={relativeS3Path:e.relativeS3Path,action:"rename",newTitle:t,sourceFolderPath:this.getSelectedDirectoryPath(),destinationFolderPath:""},n=this;this.$http.put("/api/ManageDocuments/RenameFile",i).then(function(){n.$cacheFactory.get("$http").remove(n.getDocsUri),n.Refresh()},function(){n.Refresh()})}}},e.prototype.DeleteDocument=function(e){if(confirm("Are you sure you want to delete this file?")){this.isLoading=!0;var t=this;this.$http.delete("/api/ManageDocuments?docPath="+e.relativeS3Path).then(function(){t.$cacheFactory.get("$http").remove(t.getDocsUri),t.Refresh()},function(){t.Refresh()})}},e.prototype.RenameSelectedDirectory=function(){if(this.selectedDirectory){var e=prompt("Enter the new name for the directory",this.selectedDirectory.name);if(null!==e){e.length>32&&(e=e.substr(0,32)),this.isLoading=!0;var t=encodeURIComponent(this.getSelectedDirectoryPath()),i=encodeURIComponent(e),n=this;this.$http.put("/api/ManageDocuments/RenameDirectory?directoryPath="+t+"&newDirectoryName="+i,null).then(function(){n.$cacheFactory.get("$http").remove(n.getDocsUri),n.selectedDirectory.name=e,n.Refresh()},function(){n.Refresh()})}}},e.prototype.DeleteSelectedDirectory=function(){if(this.selectedDirectory)if(this.selectedDirectory.files.length>0)alert("You can not delete a folder that contains files. Please delete or move all files from the folder.");else if(confirm("Are you sure you want to delete this folder?")){this.isLoading=!0;var e=this,t=this.getSelectedDirectoryPath();this.$http.delete("/api/ManageDocuments/DeleteDirectory?directoryPath="+encodeURIComponent(t)).then(function(){e.$cacheFactory.get("$http").remove(e.getDocsUri),e.Refresh()},function(t){e.isLoading=!1,alert("Failed to delete the folder: "+t.data.exceptionMessage)})}},e.prototype.getFileIcon=function(e){if(!e)return"";var t=null;switch(e.split(".").pop().toLowerCase()){case"pdf":t="PdfIcon.png";break;case"doc":case"docx":t="WordIcon.png";break;case"xls":case"xlsx":t="ExcelIcon.png";break;case"jpeg":case"jpe":case"jpg":case"png":t="ImageIcon.png";break;case"zip":t="ZipIcon.png";break;default:t="GenericFileIcon.png"}return"/assets/images/FileIcons/"+t},e.prototype.hookupParentDirs=function(e){var t=this;e.fullDirectoryPath=this.getDirectoryFullPath(e),e.getSubDirectoryByName=i.prototype.getSubDirectoryByName,e.subdirectories&&e.subdirectories.forEach(function(i){i.parentDirectory=e,t.hookupParentDirs(i)})},e.prototype.Refresh=function(){var e=null;this.selectedDirectory&&(e=this.getSelectedDirectoryPath()),this.isLoading=!0,this.selectedDirectory=null,this.selectedFile=null,this.getDocsUri="/api/ManageDocuments",this.committee&&(this.getDocsUri+="/Committee/"+this.committee.committeeId);var t=this;this.$http.get(this.getDocsUri,{cache:!0}).then(function(n){t.isLoading=!1,t.documentTree=n.data,t.documentTree.getSubDirectoryByName=i.prototype.getSubDirectoryByName,t.documentTree.subdirectories.forEach(function(e){t.hookupParentDirs(e)});var o=[],s=function(e){_.each(e.files,function(t){t.localFilePath=e.name+"/"+t.title,t.uploadDateString=moment(t.uploadDate).format("MMMM D, YYYY")}),Array.prototype.push.apply(o,e.files),_.each(e.subdirectories,s)};s(t.documentTree),t.fullSearchFileList=o,e&&(t.selectedDirectory=t.FindDirectoryByPath(e),t.SortFiles()),t.hookUpFileDragging()},function(e){t.isLoading=!1})},e.$inject=["$http","$rootScope","$cacheFactory","$scope"],e.LocalStorageKey_SortType="DocsInfo_FileSortType",e.LocalStorageKey_SortDirection="DocsInfo_FileSortDirection",e.DirName_Committees="Committees_Root",e}();e.DocumentsController=n}(Ally||(Ally={})),CA.angularApp.component("documents",{bindings:{committee:"<"},templateUrl:"/ngApp/common/documents.html",controller:Ally.DocumentsController});!function(e){var t=function(){return function(){this.recipientType="board"}}(),i=function(){function e(e,t,i,n,o){this.$http=e,this.fellowResidents=t,this.$rootScope=i,this.siteInfo=n,this.$scope=o,this.isLoadingEmail=!1,this.defaultMessageRecipient="board",this.showDiscussionEveryoneWarning=!1,this.showDiscussionLargeWarning=!1,this.showSendConfirmation=!1,this.showEmailForbidden=!1,this.showRestrictedGroupWarning=!1,this.defaultSubject="A message from your neighbor"}return e.prototype.$onInit=function(){var e=this;this.messageObject=new t,this.showSendEmail=!0,this.committee?(this.messageObject.committeeId=this.committee.committeeId,this.defaultSubject="A message from a committee member"):(this.loadGroupEmails(),this.$scope.$on("prepAssessmentEmailToBoard",function(t,i){return e.prepBadAssessmentEmailForBoard(i)}),this.defaultSubject="A message from your neighbor"),this.messageObject.subject=this.defaultSubject},e.prototype.loadGroupEmails=function(){this.isLoadingEmail=!0;var e=this;this.fellowResidents.getGroupEmailObject().then(function(t){e.isLoadingEmail=!1,e.availableEmailGroups=t,e.availableEmailGroups.length>0&&(e.defaultMessageRecipient=e.availableEmailGroups[0].recipientType,e.messageObject.recipientType=e.defaultMessageRecipient,e.onSelectEmailGroup())})},e.prototype.prepBadAssessmentEmailForBoard=function(e){var t=e.split("|"),i=t[0],n=null;t.length>1&&(n=t[1]),this.messageObject.recipientType="board",this.messageObject.subject="Question About Assessment Amount",this.messageObject.message=n?"Hello Boardmembers,\n\nOur association's home page says my next payment of $"+i+" will cover "+n+", but I believe that is incorrect. My records indicate my next payment of $"+i+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:"Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+i+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},e.prototype.onSendEmail=function(){var e=this;$("#message-form").validate(),$("#message-form").valid()&&(this.isLoadingEmail=!0,this.$rootScope.dontHandle403=!0,analytics.track("sendEmail",{recipientId:this.messageObject.recipientType}),this.$http.post("/api/Email/v2",this.messageObject).then(function(){e.$rootScope.dontHandle403=!1,e.isLoadingEmail=!1,e.messageObject=new t,e.messageObject.recipientType=e.defaultMessageRecipient,e.messageObject.subject=e.defaultSubject,e.committee&&(e.messageObject.committeeId=e.committee.committeeId),e.showSendConfirmation=!0,e.showSendEmail=!1},function(t){e.isLoadingEmail=!1,e.$rootScope.dontHandle403=!1,403===t.status?e.showEmailForbidden=!0:alert("Unable to send e-mail, please contact technical support.")}))},e.prototype.onSelectEmailGroup=function(){var e=this,t=HtmlUtil.getSubdomain(window.location.host).toLowerCase();this.groupEmailAddress=this.messageObject.recipientType+"."+t+"@inmail.condoally.com",this.showDiscussionEveryoneWarning=!1;var i=-1!==this.messageObject.recipientType.toLowerCase().indexOf("owners");!this.showDiscussionEveryoneWarning&&i&&this.siteInfo.privateSiteInfo.numUnits>30?this.showDiscussionLargeWarning=!0:this.showDiscussionLargeWarning=!1;var n=_.find(this.availableEmailGroups,function(t){return t.recipientType===e.messageObject.recipientType});this.showRestrictedGroupWarning=n.isRestrictedGroup},e.$inject=["$http","fellowResidents","$rootScope","SiteInfo","$scope"],e}();e.GroupSendEmailController=i}(Ally||(Ally={})),CA.angularApp.component("groupSendEmail",{bindings:{committee:"<?"},templateUrl:"/ngApp/common/group-send-email.html",controller:Ally.GroupSendEmailController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$timeout=i,this.isLoading=!1}return e.prototype.$onInit=function(){this.isLoading=!0;var e=this;this.$timeout(function(){return e.loadNewsStories()},200)},e.prototype.loadNewsStories=function(){HtmlUtil.getSubdomain(window.location.host);this.isLoading=!0;var e,t;"US"===this.siteInfo.privateSiteInfo.country?(e="https://localnewsally.org/api/LocalNews",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.publicSiteInfo.chicagoWard,zipCode:this.siteInfo.publicSiteInfo.zipCode,cityNeighborhood:this.siteInfo.publicSiteInfo.localNewsNeighborhoodQuery}):(e="https://localnewsally.org/api/LocalNews/International/MajorCity",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city});var i=this;this.$http.get(e,{cache:!0,params:t}).then(function(e){i.isLoading=!1,i.localNewStories=e.data})},e.$inject=["$http","SiteInfo","$timeout"],e}();e.LocalNewsFeedController=t}(Ally||(Ally={})),CA.angularApp.component("localNewsFeed",{templateUrl:"/ngApp/common/local-news-feed.html",controller:Ally.LocalNewsFeedController});!function(e){var t=function(){return function(){}}();e.SplitAddress=t;var i=function(){return function(){}}();e.GpsPoint=i;var n=function(){return function(){}}();e.GpsPolygon=n;var o=function(){return function(){}}();e.FullAddress=o;var s=function(){function e(){}return e.parseAddressComponents=function(e){for(var i=new t,n="",o="",s=0,a=e;s<a.length;s++){var r=a[s];-1!==r.types.indexOf("street_number")?n=r.short_name:-1!==r.types.indexOf("route")?o=r.short_name:-1!==r.types.indexOf("locality")?i.city=r.short_name:-1!==r.types.indexOf("administrative_area_level_1")?i.state=r.short_name:-1!==r.types.indexOf("postal_code")?i.zip=r.short_name:-1!==r.types.indexOf("country")&&(i.country=r.short_name)}return i.street=n+" "+o,i},e.gpsBoundsToGooglePoly=function(e){return _.map(e.vertices,function(e){return new google.maps.LatLng(e.lat,e.lon)})},e}();e.MapUtil=s}(Ally||(Ally={}));!function(e){var t=function(){function t(e,t){this.$http=e,this.siteInfo=t,this.isLoading=!1,this.isSiteManager=!1,this.isInEditMode=!1}return t.prototype.$onInit=function(){if(this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.isAddForm=null==this.vendorItem,this.isAddForm){this.isInEditMode=!0,this.vendorItem=new e.PreferredVendor,this.editVendorItem=new e.PreferredVendor;var t=this;window.setTimeout(function(){t.hookupAddressAutocomplete()},500)}},t.prototype.hookupAddressAutocomplete=function(){if("US"===this.siteInfo.privateSiteInfo.country||"CA"===this.siteInfo.privateSiteInfo.country){$(".mask-phone").mask("(999) 999-9999 ?x999")}var t=void 0;if(this.siteInfo.privateSiteInfo.googleGpsPosition){t={bounds:new google.maps.Circle({center:this.siteInfo.privateSiteInfo.googleGpsPosition,radius:40234}).getBounds()}}var i=document.getElementById("vendor-"+(this.vendorItem.preferredVendorId||"")+"-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(i,t);var n=this;google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var t=n.addressAutocomplete.getPlace();n.editVendorItem.fullAddress||(n.editVendorItem.fullAddress=new e.FullAddress),n.editVendorItem.fullAddress.oneLiner=t.formatted_address})},t.prototype.onSaveVendor=function(){var t=this;if(HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyName))alert("Please enter a company name");else if(this.editVendorItem.servicesTagArray&&0!==this.editVendorItem.servicesTagArray.length){HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyWeb)||0!==this.editVendorItem.companyWeb.indexOf("http")&&(this.editVendorItem.companyWeb="http://"+this.editVendorItem.companyWeb);var i=null==this.editVendorItem.preferredVendorId?this.$http.post:this.$http.put;this.isLoading=!0;var n="";_.each(this.editVendorItem.servicesTagArray,function(e){n+="|"+e.text}),n+="|",this.editVendorItem.servicesProvided=n;var o=this;i("/api/PreferredVendors",this.editVendorItem).success(function(){o.isLoading=!1,t.isAddForm?(o.editVendorItem=new e.PreferredVendor,o.onAddNewVendor&&o.onAddNewVendor()):o.isInEditMode=!1,o.onParentDataNeedsRefresh&&o.onParentDataNeedsRefresh()}).error(function(e){o.isLoading=!1,alert("Failed to save the vendor information: "+e.exceptionMessage)})}else alert("Please enter at least one service provided")},t.prototype.onCancelEdit=function(){this.isInEditMode=!1},t.prototype.onEditItem=function(){this.editVendorItem=JSON.parse(JSON.stringify(this.vendorItem)),this.isInEditMode=!0;var e=this;window.setTimeout(function(){e.hookupAddressAutocomplete()},500)},t.prototype.deleteItem=function(){if(confirm("Are you sure you want to remove this vendor?")){this.isLoading=!0;var e=this;this.$http.delete("/api/PreferredVendors/"+this.vendorItem.preferredVendorId).success(function(){e.isLoading=!1,e.onParentDataNeedsRefresh&&e.onParentDataNeedsRefresh()}).error(function(t){e.isLoading=!1,alert("Failed to delete the vendor: "+t.exceptionMessage)})}},t.prototype.getServiceAutocomplete=function(e){return _.where(t.AutocompleteServiceOptions,function(t){return-1!==t.text.toLowerCase().indexOf(e.toLowerCase())})},t.$inject=["$http","SiteInfo"],t.AutocompleteServiceOptions=[{text:"Additions & Remodels"},{text:"Appliances"},{text:"Cabinets & Countertops"},{text:"Cleaning"},{text:"Concrete & Masonry"},{text:"Deck, Porch, & Gazebo"},{text:"Drywall & Insulation"},{text:"Electrical"},{text:"Fencing"},{text:"Flooring"},{text:"Garages"},{text:"Gutters"},{text:"Handy Man"},{text:"HVAC"},{text:"Landscaping, Lawn Care & Sprinklers"},{text:"Painting & Staining"},{text:"Pest Control"},{text:"Plumbing"},{text:"Remodeling"},{text:"Roofing"},{text:"Siding"},{text:"Snow Removal"},{text:"Solar Electric, Heating & Cooling"},{text:"Swimming Pools"},{text:"Windows & Doors"}],t}();e.PreferredVendorItemController=t}(Ally||(Ally={})),CA.angularApp.component("preferredVendorItem",{bindings:{vendorItem:"=?",onParentDataNeedsRefresh:"&?",onAddNewVendor:"&?"},templateUrl:"/ngApp/common/preferred-vendor-item.html",controller:Ally.PreferredVendorItemController});!function(e){var t=function(){return function(){this.fullAddress=new e.FullAddress}}();e.PreferredVendor=t;var i=function(){function e(e,i){this.$http=e,this.siteInfo=i,this.allVendors=[],this.filteredVendors=[],this.editVendor=new t,this.isLoading=!1,this.isSiteManager=!1,this.usedServiceTags=[],this.filterTags=[]}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.retrieveVendors()},e.prototype.retrieveVendors=function(){this.isLoading=!0;var e=this;this.$http.get("/api/PreferredVendors").success(function(t){e.isLoading=!1,e.allVendors=t,e.filteredVendors=t,e.usedServiceTags=[],_.each(e.allVendors,function(t){t.servicesTagArray=[],_.each(t.servicesProvidedSplit,function(e){return t.servicesTagArray.push({text:e})}),e.usedServiceTags=e.usedServiceTags.concat(t.servicesProvidedSplit),t.addedDateUtc=moment.utc(t.addedDateUtc).toDate()}),e.usedServiceTags=_.uniq(e.usedServiceTags),e.usedServiceTags.sort()})},e.prototype.onTagFilterToggle=function(e){var t=this.filterTags.indexOf(e);if(-1===t?this.filterTags.push(e):this.filterTags.splice(t,1),0===this.filterTags.length)this.filteredVendors=this.allVendors;else{this.filteredVendors=[];var i=this;_.each(this.allVendors,function(e){_.intersection(e.servicesProvidedSplit,i.filterTags).length>0&&i.filteredVendors.push(e)})}},e.prototype.onAddedNewVendor=function(){this.retrieveVendors()},e.$inject=["$http","SiteInfo"],e}();e.PreferredVendorsController=i}(Ally||(Ally={})),CA.angularApp.component("preferredVendors",{templateUrl:"/ngApp/common/preferred-vendors.html",controller:Ally.PreferredVendorsController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.isSiteManager=!1,this.hideDocuments=!1,this.selectedView="docs"}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideDocuments?this.selectedView="info":this.selectedView="docs"},e.$inject=["$http","SiteInfo","$cacheFactory"],e}();e.HoaInfoController=t}(Ally||(Ally={})),CA.angularApp.component("hoaInfo",{templateUrl:"/ngApp/hoa/member/HoaInfo.html",controller:Ally.HoaInfoController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.isSiteManager=!1}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager},e.$inject=["$http","SiteInfo","$cacheFactory"],e}();e.HoaHomeController=t}(Ally||(Ally={})),CA.angularApp.component("hoaHome",{templateUrl:"/ngApp/hoa/member/Home.html",controller:Ally.HoaHomeController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.appCacheService=o}return e.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");HtmlUtil.getSubdomain(window.location.host);this.allyAppName=AppConfig.appName;if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments)for(this.recentPayments.length>6&&(this.recentPayments=this.recentPayments.slice(0,6)),this.numRecentPayments=this.recentPayments.length;this.recentPayments.length<6;)this.recentPayments.push({});this.messageObject={},null!==this.siteInfo.privateSiteInfo.assessmentFrequency&&null!==this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())),this.refreshData()},e.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},e.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"===e?this.siteInfo.userInfo.assessmentAmount:0,this.updatePaymentText()},e.prototype.getNextPaymentText=function(e,t){if(null===e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];if("month"===n.intervalName){i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]}else if("quarter"===n.intervalName){i=["Q1","Q2","Q3","Q4"][s.period-1]}else if("half-year"===n.intervalName){i=["First Half","Second Half"][s.period-1]}i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},e.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},e.prototype.onIncorrectPayDetails=function(){this.messageObject.recipientType="board",this.knowsNextPayment?this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" will cover "+this.nextPaymentText+", but I believe that is incorrect. My records indicate my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+this.siteInfo.userInfo.assessmentAmount+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},e.prototype.refreshData=function(){HtmlUtil.getSubdomain(window.location.host);if(!1,"localnews"===this.homeRightColumnType){this.isLoading_LocalNews=!0;var e,t;"US"===this.siteInfo.privateSiteInfo.country?(e="https://localnewsally.org/api/LocalNews",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.publicSiteInfo.chicagoWard,zipCode:this.siteInfo.publicSiteInfo.zipCode,cityNeighborhood:this.siteInfo.publicSiteInfo.localNewsNeighborhoodQuery}):(e="https://localnewsally.org/api/LocalNews/International/MajorCity",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city});var i=this;this.$http.get(e,{cache:!0,params:t}).then(function(e){i.localNews=e.data,i.isLoading_LocalNews=!1})}},e.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService"],e}();e.HomeGroupHomeController=t}(Ally||(Ally={})),CA.angularApp.component("homeGroupHome",{templateUrl:"/ngApp/home/home-group-home.html",controller:Ally.HomeGroupHomeController});!function(e){var t=function(){return function(){}}(),i=function(){return function(){this.streetAddress="",this.signerUpInfo=new t,this.homeInfo={}}}(),n="Acres",o=function(){function t(e,t,o){this.$http=e,this.$scope=t,this.WizardHandler=o,this.lotSizeUnit=n,this.lotSquareUnits=0,this.signUpInfo=new i,this.isLoadingHomeInfo=!1,this.didLoadHomeInfo=!1,this.isLoading=!1,this.hideWizard=!1}return t.prototype.$onInit=function(){var e=this;setTimeout(function(){e.initMap()},300)},t.prototype.initMap=function(){var t=document.getElementById("address-map");this.map=new google.maps.Map(t,{center:{lat:41.869638,lng:-87.657423},zoom:9}),this.mapMarker=new google.maps.Marker({map:this.map,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png",position:null});var i=document.getElementById("home-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(i),this.addressAutocomplete.bindTo("bounds",this.map);var n=this;this.addressAutocomplete.addListener("place_changed",function(){n.mapMarker.setVisible(!1);var t=n.addressAutocomplete.getPlace(),i=t.formatted_address;i.indexOf(", USA")===i.length-", USA".length&&(i=i.substring(0,i.length-", USA".length)),n.signUpInfo.streetAddress=i,n.selectedSplitAddress=e.MapUtil.parseAddressComponents(t.address_components),n.prepopulateHomeInfo(),t.geometry&&n.centerMap(t.geometry),$("#association-name-text-box").focus()})},t.prototype.onFinishedWizard=function(){this.lotSizeUnit===n?this.signUpInfo.homeInfo.lotSquareFeet=43560*this.lotSquareUnits:this.signUpInfo.homeInfo.lotSquareFeet=this.lotSquareUnits,this.isLoading=!0;var e=this;this.$http.post("/api/HomeSignUp",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl:(alert("Failed to complete sign-up: "+i.errorMessage),i.stepIndex>=0&&e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to complete sign-up: "+i)})},t.prototype.onHomeAddressChanged=function(){var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){e.$scope.$apply(function(){if(i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.streetAddress=n,e.centerMap(t[0].geometry)}})})},t.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},t.prototype.prepopulateHomeInfo=function(){if(this.selectedSplitAddress){this.isLoadingHomeInfo=!0;var e="/api/PropertyResearch/HomeInfo?street="+encodeURIComponent(this.selectedSplitAddress.street)+"&city="+encodeURIComponent(this.selectedSplitAddress.city)+"&state="+this.selectedSplitAddress.state+"&zip="+this.selectedSplitAddress.zip,t=this;this.$http.get(e).then(function(e){t.isLoadingHomeInfo=!1;var i=e.data;i&&(t.didLoadHomeInfo=!0,t.signUpInfo.homeInfo=i,i.lotSquareFeet&&(i.lotSquareFeet>43560?(t.lotSizeUnit=n,t.lotSquareUnits=i.lotSquareFeet/43560,t.lotSquareUnits=parseFloat((Math.round(4*t.lotSquareUnits)/4).toFixed(2))):(t.lotSizeUnit="SquareFeet",t.lotSquareUnits=i.lotSquareFeet)))},function(){t.isLoadingHomeInfo=!1})}},t.$inject=["$http","$scope","WizardHandler"],t}();e.HomeSignUpController=o}(Ally||(Ally={})),CA.angularApp.component("homeSignUp",{templateUrl:"/ngApp/home/public/SignUp.html",controller:Ally.HomeSignUpController});function ServiceBankInfoCtrl(e){}ServiceBankInfoCtrl.$inject=["$http"];function ServiceBusinessInfoCtrl(e){}ServiceBusinessInfoCtrl.$inject=["$http"];function ServiceJobsCtrl(e){}ServiceJobsCtrl.$inject=["$http"],CA.angularApp.directive("googleMapPolyEditor",["$http",function(e){return{scope:{editPolyVerts:"=",visiblePolys:"=",visiblePoints:"=",groupBoundsPoly:"=",mapCenter:"=",onMapEditorReady:"&",enableMapControls:"="},restrict:"E",replace:"true",templateUrl:"/ngApp/Services/GoogleMapPolyEditorTemplate.html",link:function(e,t,i){e.mapInfo={center:{lat:39.5,lng:-98.35},zoom:4,disableDefaultUI:!e.enableMapControls,mapTypeId:google.maps.MapTypeId.HYBRID,events:{tilesloaded:function(e,t,i){google.maps.event.clearListeners(e,"tilesloaded")}}},e.googlePolyToGpsBounds=function(e){return e=_.map(e,function(e){return{lat:e.lat(),lon:e.lng()}})},e.centerMapOnPoly=function(t){if(t&&0!==t.length){var i=new google.maps.LatLngBounds;_.map(t,function(e){i.extend(e)}),e.mapInstance.fitBounds(i)}},e.setGroupBounds=function(t){if(t){var i={paths:Ally.MapUtil.gpsBoundsToGooglePoly(t),map:e.mapInstance,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1};e.activeShape&&e.activeShape.setMap(null),e.groupBoundsShape=new google.maps.Polygon(i)}else e.groupBoundsShape&&(e.groupBoundsShape.setMap(null),e.groupBoundsShape=null)},e.fitBoundsForPolys=function(){var t=new google.maps.LatLngBounds;(e.groupBoundsShape||e.currentVisiblePolys&&0!==e.currentVisiblePolys.length)&&(e.groupBoundsShape&&_.each(e.groupBoundsShape.getPath().getArray(),function(e){t.extend(e)}),_.each(e.currentVisiblePolys,function(e){_.each(e.getPath().getArray(),function(e){t.extend(e)})}),e.mapInstance.fitBounds(t))},e.fitBoundsForPoints=function(){if(e.currentVisiblePoints&&0!==e.currentVisiblePoints.length){var t=new google.maps.LatLngBounds;_.each(e.currentVisiblePoints,function(e){t.extend(e.position)}),e.mapInstance.fitBounds(t)}};var n=function(e){var t=function(e){return $("img[src$='"+e+"']")},i=this,n=t(i.btnDeleteImageUrl);if(0===n.length){var o=$("img[src$='http://maps.gstatic.com/mapfiles/undo_poly.png']");o.parent().css("height","21px !important"),o.parent().parent().append('<div style="overflow-x: hidden; overflow-y: hidden; position: absolute; width: 30px; height: 27px;top:21px;"><img src="'+i.btnDeleteImageUrl+'" class="deletePoly" style="height:auto; width:auto; position: absolute; left:0;"/></div>'),(n=t(i.btnDeleteImageUrl)).hover(function(){return $(this).css("left","-30px"),!1},function(){return $(this).css("left","0px"),!1}),n.mousedown(function(){return $(this).css("left","-60px"),!1})}i.btnDeleteClickHandler&&n.unbind("click",i.btnDeleteClickHandler),i.btnDeleteClickHandler=function(){return i.removeAt(e),!1},n.click(i.btnDeleteClickHandler)};e.currentVisiblePolys=[],e.currentVisiblePoints=[],e.onVisiblePolysChange=function(t){_.each(e.currentVisiblePolys,function(e){e.setMap(null)}),e.currentVisiblePolys=[],_.each(t,function(t){var i={paths:Ally.MapUtil.gpsBoundsToGooglePoly(t),clickable:"function"==typeof t.onClick,map:e.mapInstance,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.35},n=new google.maps.Polygon(i);n.polyInfo=t,t.mapShapeObject=n,e.currentVisiblePolys.push(n),i.clickable&&google.maps.event.addListener(n,"click",function(){n.polyInfo.onClick()})}),e.fitBoundsForPolys()},e.onVisiblePointsChange=function(t){_.each(e.currentVisiblePoints,function(e){e.setMap(null)}),e.currentVisiblePoints=[],_.each(t,function(t){var i=new google.maps.Marker({position:{lat:t.lat,lng:t.lon},map:e.mapInstance,title:t.fullAddress});i.pointSource=t,e.currentVisiblePoints.push(i),"function"==typeof t.onClick&&google.maps.event.addListener(i,"click",function(){i.pointSource.onClick()})}),e.fitBoundsForPoints()},e.onEditPolyChange=function(t){if(!t)return e.activeShape&&e.activeShape.setMap(null),void(e.activeShape=null);var i=_.map(t.vertices,function(e){return new google.maps.LatLng(e.lat,e.lon)});e.centerMapOnPoly(i);var o={paths:i,editable:!0,draggable:!0,clickable:!0,map:e.mapInstance,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35};e.activeShape&&e.activeShape.setMap(null),e.activeShape=new google.maps.Polygon(o);var s=function(){e.editPolyVerts.vertices=e.googlePolyToGpsBounds(e.activeShape.getPath().getArray())};return google.maps.event.addListener(e.activeShape.getPath(),"set_at",s),google.maps.event.addListener(e.activeShape.getPath(),"insert_at",s),function(e,t){var i=e.getPath();i.btnDeleteClickHandler={},i.btnDeleteImageUrl=t,google.maps.event.addListener(e.getPath(),"set_at",n),google.maps.event.addListener(e.getPath(),"insert_at",n)}(e.activeShape,"http://i.imgur.com/RUrKV.png"),e.activeShape},e.$watch("editPolyVerts",function(t){e.onEditPolyChange(t)}),e.$watch("visiblePolys",function(t){e.onVisiblePolysChange(t)}),e.$watch("visiblePoints",function(t){e.onVisiblePointsChange(t)}),e.$watch("groupBoundsPoly",function(t){e.setGroupBounds(t)}),e.$watch("mapCenter",function(t){t&&(t=new google.maps.LatLng(t.lat,t.lon),e.mapInstance.setCenter(t))}),e.mapInstance=new google.maps.Map($(t).children(".google-map-canvas")[0],e.mapInfo),e.onMapEditorReady&&e.onMapEditorReady({mapInstance:e.mapInstance}),google.maps.event.addListener(e.mapInstance,"click",function(t){var i={lat:t.latLng.lat(),lon:t.latLng.lng()},n={lat:t.latLng.lat()+.01,lon:t.latLng.lng()+.01},o=[i,{lat:n.lat,lon:i.lon},n,{lat:i.lat,lon:n.lon}];e.editPolyVerts&&(e.editPolyVerts.vertices=o),e.onEditPolyChange(e.editPolyVerts)})}}}]),CA.angularApp.directive("sendMessage",["$rootScope","fellowResidents",function(e,t){return{scope:{recipientInfo:"="},restrict:"E",replace:"true",controllerAs:"vm",templateUrl:"/ngApp/services/SendMessageTemplate.html",controller:function(){var e=this;e.shouldShowSendModal=!1,e.shouldShowButtons=!0,e.showSendModal=function(){e.shouldShowSendModal=!0,e.sendResultMessage="",e.shouldShowButtons=!0,setTimeout(function(){document.getElementById("message-text-box").focus()},50)},e.hideModal=function(){e.shouldShowSendModal=!1,e.messageBody=""},e.sendMessage=function(){e.shouldShowButtons=!1,e.isSending=!0,e.sendResultMessage="",t.sendMessage(e.recipientInfo.userId,e.messageBody).then(function(t){e.isSending=!1,e.sendResultIsError=!1,e.messageBody="",e.sendResultMessage="Message sent successfully!"},function(t){e.shouldShowButtons=!0,e.isSending=!1,e.sendResultIsError=!0;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;e.sendResultMessage="Failed to send: "+i})}},bindToController:!0}}]),angular.module("CondoAlly").directive("ngEnter",function(){return function(e,t,i){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(i.ngEnter,{event:t})}),t.preventDefault())})}}),angular.module("CondoAlly").directive("ngEscape",function(){return function(e,t,i){t.bind("keydown keypress",function(t){27===t.which&&(e.$apply(function(){e.$eval(i.ngEscape,{event:t})}),t.preventDefault())})}}),CA.angularApp.filter("iif",function(){return function(e,t,i){return e?t:i}}),CA.angularApp.filter("tel",function(){return function(e){if(!e)return"";var t=e.toString().trim().replace(/^\+/,"");if(t.match(/[^0-9]/))return e;var i,n,o;switch(t.length){case 7:i=1,n="",o=t;break;case 10:i=1,n=t.slice(0,3),o=t.slice(3);break;case 11:i=t[0],n=t.slice(1,4),o=t.slice(4);break;case 12:i=t.slice(0,3),n=t.slice(3,5),o=t.slice(5);break;default:return n="",e}return 1===i&&(i=""),o=o.slice(0,3)+"-"+o.slice(3),n.length>0&&(n="("+n+")"),(i+" "+n+" "+o).trim()}});function TodoCtrl(e){var t=this;t.todoLists=[],t.loadTodos=function(){t.isLoading=!0,e.get("/api/Todo").then(function(e){t.isLoading=!1,t.todoLists=e.data})},t.onAddList=function(){t.isLoading=!0,e.post("/api/Todo/newList?listName="+encodeURIComponent(t.newListName)).then(function(){t.isLoading=!1,t.loadTodos()})},t.onAddItem=function(i){t.isLoading=!0,e.post("/api/Todo/newItem/"+i+"?description="+encodeURIComponent(t.newItemDescription)).then(function(){t.isLoading=!1,t.newItemDescription="",t.loadTodos()})},t.onToggleComplete=function(i,n){t.isLoading=!0,e.put("/api/Todo/toggleComplete/"+i+"/"+n).then(function(){t.isLoading=!1,t.loadTodos()})},t.loadTodos()}TodoCtrl.$inject=["$http"],CA.angularApp.component("todos",{bindings:{},templateUrl:"/ngApp/Services/TodoDirectiveTemplate.html",controller:TodoCtrl});!function(e){var t=function(){return function(){}}();e.ExceptionResult=t}(Ally||(Ally={}));var AppCacheService=function(){function e(){this.Key_WasLoggedIn403="wasLoggedIn403",this.Key_WasLoggedIn401="wasLoggedIn401",this.Key_AfterLoginRedirect="afterLoginRedirect",this.KeyPrefix="AppCacheService_"}return e.prototype.set=function(e,t){window.sessionStorage[this.KeyPrefix+e]=t},e.prototype.get=function(e){return window.sessionStorage[this.KeyPrefix+e]},e.prototype.clear=function(e){window.sessionStorage[this.KeyPrefix+e]=void 0,delete window.sessionStorage[this.KeyPrefix+e]},e.prototype.getAndClear=function(e){var t;return t=this.get(e),this.clear(e),t},e}();angular.module("CondoAlly").service("appCacheService",[AppCacheService]);!function(e){var t=function(){return function(){}}();e.CsvColumnDescriptor=t;function i(e){if(!e)return"";var t=e.toString();if(HtmlUtil.isNullOrWhitespace(t))return"";return(-1!==t.indexOf('"')||-1!==t.indexOf(",")||-1!==t.indexOf("\r")||-1!==t.indexOf("\n"))&&(t='"'+(t=t.replace('"','""'))+'"'),t}e.ValueToCsvValue=i;e.createCsvString=function(e,t){for(var n="",o=0;o<t.length;++o)o>0&&(n+=","),n+=i(t[o].headerText);for(var s=0;s<e.length;++s){n+="\n";for(var a=e[s],r=0;r<t.length;++r){r>0&&(n+=",");var l=t[r],p=a[l.fieldName];l.dataMapper&&(p=l.dataMapper(p)),n+=i(p)}}return n}}(Ally||(Ally={}));!function(e){var t=function(){return function(){}}();e.GroupEmailInfo=t;var i=function(){return function(){}}();e.FellowChtnResident=i;var n=function(){return function(){}}();e.CommitteeListingInfo=n;var o=function(){return function(){}}();e.FellowResidents=o;var s=function(){function e(e,t,i){this.$http=e,this.$q=t,this.$cacheFactory=i}return e.prototype.getResidents=function(){var e=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(e){return e.data.residents},function(t){return e.$q.reject(t)})},e.prototype.getByUnits=function(){var e=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(e){return e.data.byUnit},function(t){return e.$q.reject(t)})},e.prototype.getByUnitsAndResidents=function(){var e=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(e){return e.data},function(t){return e.$q.reject(t)})},e.prototype.getGroupEmailObject=function(){return this.$http.get("/api/BuildingResidents/EmailGroups",{cache:!0}).then(function(e){return e.data},function(e){return this.$q.reject(e)})},e.prototype._setupGroupEmailObject=function(e,t){var i={};i={everyone:[],owners:[],renters:[],board:[],residentOwners:[],nonResidentOwners:[],residentOwnersAndRenters:[],propertyManagers:[],discussion:[]};for(var n=0;n<e.length;++n){var o=e[n],s=o.fullName+(o.hasEmail?"":"*");i.everyone.push(s);0!==o.boardPosition&&32!==o.boardPosition&&i.board.push(s),32===o.boardPosition&&i.propertyManagers.push(s),o.includeInDiscussionEmail&&i.discussion.push(s);for(var a=!1,r=!1,l=!1,p=0;p<o.homes.length;++p){var c=o.homes[p];if(!c.isRenter){a=!0;l=_.find(t,function(e){return e.unitId===c.unitId}).renters.length>0}c.isRenter&&(r=!0)}a&&(i.owners.push(s),l?i.nonResidentOwners.push(s):(i.residentOwners.push(s),i.residentOwnersAndRenters.push(s))),r&&(i.renters.push(s),i.residentOwnersAndRenters.push(s))}return 0===i.renters.length&&(i.residentOwners=[],i.residentOwnersAndRenters=[],i.nonResidentOwners=[]),i},e.prototype.sendMessage=function(e,t){var i={recipientUserId:e,messageBody:t};return this.$http.post("/api/BuildingResidents/SendMessage",i)},e.prototype.clearResidentCache=function(){this.$cacheFactory.get("$http").remove("/api/BuildingResidents"),this.$cacheFactory.get("$http").remove("/api/BuildingResidents/EmailGroups")},e}();e.FellowResidentsService=s}(Ally||(Ally={})),angular.module("CondoAlly").service("fellowResidents",["$http","$q","$cacheFactory",Ally.FellowResidentsService]);!function(e){var t=function(){function e(e,t){this.$http=e,this.$rootScope=t,this.isLoading=!1,this.showDiscussModal=!1}return e.prototype.$onInit=function(){this.isQaSite=!1,this.threadId||(this.threadId="Home"),this.editComment={threadId:this.threadId,commentText:"",replyToCommentId:null},this.refreshComments()},e.prototype.displayDiscussModal=function(){this.showDiscussModal=!0},e.prototype.hideDiscussModal=function(){this.showDiscussModal=!1},e.prototype.refreshComments=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Comment?threadId="+this.threadId).then(function(t){e.isLoading=!1,e.commentList=t.data;var i=function(t){t.postDateUtc=moment.utc(t.postDateUtc).toDate(),t.lastEditDateUtc&&(t.lastEditDateUtc=moment.utc(t.lastEditDateUtc).toDate()),t.deletedDateUtc&&(t.deletedDateUtc=moment.utc(t.deletedDateUtc).toDate()),t.isMyComment=t.authorUserId===e.$rootScope.userInfo.userId,t.replies&&_.each(t.replies,i)};_.each(e.commentList,i)},function(t){e.isLoading=!1})},e.prototype.postComment=function(e){var t=this;this.isLoading=!0;var i=this.$http.post;"number"==typeof e.existingCommentId&&(i=this.$http.put),i("/api/Comment",e).then(function(){t.isLoading=!1,t.editComment={},t.showReplyBoxId=-1,t.refreshComments()},function(e){t.isLoading=!1,alert("Failed to post comment: "+e.data.exceptionMessage)})},e.prototype.onPostCommentClicked=function(){if(0!==this.editComment.commentText.length){var e={threadId:this.threadId,commentText:this.editComment.commentText,replyToCommentId:null,existingCommentId:this.editComment.existingCommentId};this.postComment(e)}},e.prototype.editMyComment=function(e){this.editComment={commentText:e.commentText,existingCommentId:e.commentId}},e.prototype.deleteMyComment=function(e){this.isLoading=!0,this.$http.delete("/api/Comment?commentId="+e.commentId).then(function(){this.isLoading=!1,this.refreshComments()},function(e){this.isLoading=!1;var t=e.data.exceptionMessage?e.data.exceptionMessage:e.data;alert("Failed to post comment: "+t)})},e.prototype.onPostReplyCommentClicked=function(){if(0!==this.editComment.replyText.length){var e={threadId:this.threadId,commentText:this.editComment.replyText,replyToCommentId:this.editComment.replyToCommentId};this.postComment(e)}},e.prototype.clickReplyToComment=function(e){this.showReplyBoxId=e,this.editComment={commentText:"",replyToCommentId:e}},e.$inject=["$http","$rootScope"],e}();e.GroupCommentsController=t}(Ally||(Ally={})),CA.angularApp.component("groupComments",{bindings:{threadId:"@?"},templateUrl:"/ngApp/services/group-comments.html",controller:Ally.GroupCommentsController});!function(e){var t=function(){return function(){}}();e.ExceptionResult=t}(Ally||(Ally={}));var Ally;__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}();e.UserInfo=t;var i=function(){return function(){}}();e.PrivateSiteInfo=i;var n=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(i);e.ChtnPrivateSiteInfo=n;var o=function(){function t(){this.publicSiteInfo={},this.privateSiteInfo=new n,this.userInfo=new e.UserInfo,this.isLoggedIn=!1}return t.prototype.refreshSiteInfo=function(e,t,i){this._rootScope=e;var n=i.defer();e.isLoadingSite=!0;var o=this,s=function(t){e.isLoadingSite=!1,o.handleSiteInfo(t,e),n.resolve()},a=function(){e.isLoadingSite=!1,n.reject()};return t.get("/api/GroupSite").then(function(e){e.data&&!e.data.userInfo?o.xdLocalStorage.getItem("allyApiAuthToken").then(function(i){i&&HtmlUtil.isValidString(i.value)?(o.setAuthToken(i.value),t.get("/api/GroupSite").then(function(e){s(e.data)},a)):s(e.data)},function(){s(e.data)}):s(e.data)},a),n.promise},t.prototype.testIfIsNeutralPage=function(e){if(!HtmlUtil.startsWith(e,"#!/"))return!1;e="/"+e.substring("#!/".length);return"object"==typeof _.find(AppConfig.menu,function(t){return t.path===e})},t.prototype.handleSiteInfo=function(e,t){var i=HtmlUtil.getSubdomain(window.location.host);if(!this.authToken&&t.authToken&&this.setAuthToken(t.authToken),null===e||"null"===e){var n=null===i||"www"===i||"login"===i,o=this.testIfIsNeutralPage(window.location.hash);if(!n||!o)return void GlobalRedirect("https://login."+AppConfig.baseTld+"/#!/Login");(e={}).publicSiteInfo={bgImagePath:"",fullName:AppConfig.appName,siteLogo:"<span style='font-size: 22pt; color: #FFF;'>Welcome to "+AppConfig.appName+"</span>"}}t.publicSiteInfo=e.publicSiteInfo,this.publicSiteInfo=e.publicSiteInfo;var s=e.privateSiteInfo;if(s||(s={}),s.gpsPosition&&"undefined"!=typeof google&&(s.googleGpsPosition=new google.maps.LatLng(s.gpsPosition.lat,s.gpsPosition.lon)),this.privateSiteInfo=s,document.title=this.publicSiteInfo.fullName,this.userInfo=e.userInfo,t.userInfo=e.userInfo,HtmlUtil.isLocalStorageAllowed()&&window.localStorage.setItem("siteInfo",angular.toJson(this.publicSiteInfo)),this.isLoggedIn=null!==t.userInfo&&void 0!==t.userInfo,t.isLoggedIn=this.isLoggedIn,this.isLoggedIn)"undefined"!=typeof $zopim&&$zopim(function(){$zopim.livechat.setName(t.userInfo.firstName+" "+t.userInfo.lastName),-1!==t.userInfo.emailAddress.indexOf("@")&&$zopim.livechat.setEmail(t.userInfo.emailAddress)}),t.isAdmin=t.userInfo.isAdmin,t.isSiteManager=t.userInfo.isSiteManager,"undefined"!=typeof analytics&&analytics.identify(t.userInfo.emailAddress,{name:t.userInfo.fullName});else{t.userInfo=null;"#!/Login"==window.location.hash||AppConfig.isPublicRoute(window.location.hash)||(this.publicSiteInfo&&this.publicSiteInfo.baseUrl?window.location.hash="#!/Login":GlobalRedirect(AppConfig.baseUrl+"#!/Login"))}HtmlUtil.isNullOrWhitespace(this.publicSiteInfo.bgImagePath)||$(document.documentElement).css("background-image","url("+t.bgImagePath+this.publicSiteInfo.bgImagePath+")"),this.publicSiteInfo.baseUrl&&(null!==i&&i===this.publicSiteInfo.shortName||!HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||GlobalRedirect(this.publicSiteInfo.baseUrl+"/#!/Home"))},t.prototype.setAuthToken=function(e){window.localStorage&&window.localStorage.setItem("ApiAuthToken",e),this._rootScope.authToken=e,this.xdLocalStorage.setItem("allyApiAuthToken",e).then(function(e){}),this.authToken=e},t}();e.SiteInfoService=o;var s=function(){function e(){}return e.loginInit=function(e,t,i,n,o){var s=e.defer();return a.siteInfo.xdLocalStorage=o,a.isSiteInfoLoaded?s.resolve(a.siteInfo):a.siteInfo.refreshSiteInfo(i,t,e).then(function(){a.isSiteInfoLoaded=!0,i.isSiteInfoLoaded=!0,i.siteTitle={text:i.publicSiteInfo.siteTitleText},i.publicSiteInfo.siteLogo&&(i.siteTitle.logoHtml=n.trustAsHtml(i.publicSiteInfo.siteLogo)),i.onUpdateSiteTitleText=function(){analytics.track("updateSiteTitle"),t.put("/api/Settings",{siteTitle:i.siteTitle.text})},s.resolve(a.siteInfo)}),s.promise},e}();e.SiteInfoHelper=s;var a=function(){function t(){}return t.prototype.$get=function(){return t.isSiteInfoLoaded||alert("Not yet loaded!"),t.siteInfo},t.isSiteInfoLoaded=!1,t.siteInfo=new e.SiteInfoService,t}();e.SiteInfoProvider=a}(Ally||(Ally={})),angular.module("CondoAlly").provider("SiteInfo",Ally.SiteInfoProvider);function ManageMembersCtrl(e,t,i,n,t){e.members=[],e.newMember={boardPosition:0,isRenter:!1},e.editUser=null,e.setEdit=function(t){if(e.sentWelcomeEmail=!1,null!==t){e.editUserForm.$setPristine();var i=jQuery.extend({},t);e.editUser=i,e.memberGridOptions.selectAll(!1),setTimeout("$( '#edit-user-first-text-box' ).focus();",100)}else e.editUser=null},e.onSendWelcome=function(){e.isSavingUser=!0,t.put("/api/Member/"+e.editUser.userId+"/SendWelcome").then(function(){e.isSavingUser=!1,e.sentWelcomeEmail=!0},function(){alert("Failed to send the welcome e-mail, please contact support if this problem persists."),e.isSavingUser=!1})};$resource("/api/Member",null,{update:{method:"PUT"}});var o={fields:["lastName"],directions:["asc"]},s=o;if(window.localStorage){var a=window.localStorage.getItem("memberSort");a&&(s=JSON.parse(a)),0===s.fields.length&&(s=o),n(function(){var t={fields:e.memberGridOptions.sortInfo.fields,directions:e.memberGridOptions.sortInfo.directions};window.localStorage.setItem("memberSort",JSON.stringify(t))},2e3)}e.memberGridOptions={data:"members",plugins:[new ngGridFlexibleHeightPlugin],columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first"},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last"},{field:"email",displayName:"E-mail",cellClass:"resident-cell-email"},{field:"isSiteManager",displayName:"Admin",width:60,cellClass:"resident-cell-site-manager",cellTemplate:'<div style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" ng-checked="row.getProperty(col.field)"></div>'},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.getProperty(col.field) | tel }}</span></div>'}],afterSelectionChange:function(t){t.selected&&e.setEdit(t.entity)},sortInfo:s,multiSelect:!1},e.refresh=function(){e.isLoading=!0,t.get("/api/Member").then(function(t){e.members=t.data,_.forEach(e.members,function(e){e.fullName=e.firstName+" "+e.lastName,"string"==typeof e.email&&-1!==e.email.indexOf("@condoally.com")&&(e.email="")}),e.isLoading=!1})},e.onSaveMember=function(){if(null!=e.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid())){e.isSavingUser=!0;var i=function(){e.editUser=null,e.isSavingUser=!1,e.refresh()},n=i;e.editUser.userId?t.put("/api/Member",e.editUser).then(i,n):t.post("/api/Member",e.editUser).then(i,n)}},e.OnAdminSetPassword=function(){var i={userName:e.adminSetPass_Username,password:e.adminSetPass_Password};t.post("/api/AdminHelper/SetPassword",i).then(function(t){e.adminSetPass_ResultMessage=t.data},function(){})},e.onDeleteMember=function(){confirm("Are you sure you want to remove this person from your neighborhood watch group?")&&t.delete("/api/Member",{userId:e.editUser.userId,unitId:e.editUser.unitId}).then(function(){e.editUser=null,e.refresh()})},e.onSendAllWelcome=function(){e.isLoading=!0,t.put("/api/Member?userId&action=launchsite").then(function(){e.isLoading=!1,e.sentWelcomeEmail=!0,e.allEmailsSent=!0},function(){alert("Failed to send welcome e-mail, please contact support if this problem persists."),e.isLoading=!1})},e.refresh()}ManageMembersCtrl.$inject=["$scope","$http","$rootScope","$interval","$http"];function WatchSettingsCtrl(e,t,i,n){var o=this;o.settings={},o.defaultBGImage=$(document.documentElement).css("background-image"),o.showQaButton="president@mycondoally.com"===t.userInfo.emailAddress;var s=i("/api/Settings",null,{update:{method:"PUT"}});o.refreshData=function(){o.isLoading=!0,o.settings=s.get(function(){o.isLoading=!1})},o.onSiteTitleChange=function(){o.isLoading=!0,s.update({siteTitle:o.settings.siteTitle},function(){location.reload(),o.isLoading=!1})},o.onWelcomeMessageUpdate=function(){o.isLoading=!0,s.update({welcomeMessage:o.settings.welcomeMessage},function(){n.privateSiteInfo.welcomeMessage=o.settings.welcomeMessage,o.isLoading=!1})},o.onImageClick=function(e){o.settings.bgImageFileName=e,SettingsJS._defaultBG=e,s.update({BGImageFileName:o.settings.bgImageFileName},function(){$(".test-bg-image").removeClass("test-bg-image-selected"),$("img[src='"+t.bgImagePath+e+"']").addClass("test-bg-image-selected"),o.isLoading=!1})},o.onImageHoverOver=function(e){$(document.documentElement).css("background-image","url("+t.bgImagePath+e+")")},o.onImageHoverOut=function(){"string"==typeof o.settings.bgImageFileName&&o.settings.bgImageFileName.length>0?$(document.documentElement).css("background-image","url("+t.bgImagePath+o.settings.bgImageFileName+")"):$(document.documentElement).css("background-image",o.defaultBGImage)},o.onQaDeleteSite=function(){e.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(e){alert("Failed to delete site: "+e.data.message)})},o.mapInstance=new google.maps.Map(document.getElementById("map-canvas"),o.mapInfo),o.refreshData()}WatchSettingsCtrl.$inject=["$http","$rootScope","$resource","SiteInfo"];function WatchCalendarCtrl(e,t,i,n,o){var s="YYYY-MM-DD";e.today=new Date;var a={height:600,editable:!1,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},viewRender:function(e,t){n.isSiteManager&&$(t).css("cursor","pointer")},dayClick:function(t){if(n.isSiteManager){var i=moment(moment.utc(t).format(s)).toDate();e.$apply(function(){e.setEditEvent({date:i,dateOnly:i,associatedUserIds:[]})})}},eventClick:function(t){e.$apply(function(){t.calendarEventObject&&e.setEditEvent(t.calendarEventObject,!0)})},eventRender:function(e,t){$(t).css("cursor","default"),$(t).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:e.fullDescription,title:e.toolTipTitle}})},eventSources:[{events:function(t,n,o,a){e.isLoadingCalendarEvents=!0;var r=t.format(s),l=n.format(s);i.get("/api/CalendarEvent?startDate="+r+"&endDate="+l).then(function(t){var i=[],n=t.data;e.isLoadingCalendarEvents=!1,_.each(n,function(e){e.timeOnly=moment.utc(e.date).format("h:mma"),e.dateOnly=e.date,"12:37am"==e.timeOnly&&(e.timeOnly="");var t=e.title;t.length>17&&(t=t.substring(0,17)+"...");var n="Posted by: "+e.authorName+"<br><p>"+e.title+"</p>";i.push({title:t,start:e.date.substring(0,10),toolTipTitle:"Event",fullDescription:n,calendarEventObject:e})}),a(i)},function(){e.isLoadingCalendarEvents=!1})}}]};$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(a)}),e.onResidentClicked=function(t){_.contains(e.editEvent.associatedUserIds,t)?e.editEvent.associatedUserIds=_.without(e.editEvent.associatedUserIds,t):e.editEvent.associatedUserIds.push(t)},e.isUserAssociated=function(t){return!(!e.editEvent||!e.editEvent.associatedUserIds)&&_.contains(e.editEvent.associatedUserIds,t)},e.expandCalendarEventModel=function(){e.showExpandedCalendarEventModel=!0},e.setEditEvent=function(t,i){e.showExpandedCalendarEventModel=i||!1,e.editEvent=t,t&&setTimeout(function(){$("#calendar-event-title").focus()},10)},e.deleteCalendarEvent=function(t){confirm("Are you sure you want to remove this calendar event?")&&(e.isLoadingCalendarEvents=!0,i.delete("/api/CalendarEvent?eventId="+t).then(function(){e.isLoadingCalendarEvents=!1,e.editEvent=null,e.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){e.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")}))},e.saveCalendarEvent=function(){var t="";t="string"==typeof e.editEvent.timeOnly&&e.editEvent.timeOnly.length>1?moment.utc(e.editEvent.date).format(s)+" "+e.editEvent.timeOnly:moment.utc(e.editEvent.date).format(s)+" 12:37am",e.editEvent.date=moment.utc(t,s+" h:mma").toDate();var n;n=e.editEvent.eventId?i.put:i.post,e.isLoadingCalendarEvents=!0,n("/api/CalendarEvent",e.editEvent).then(function(){e.isLoadingCalendarEvents=!1,e.editEvent=null,e.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){e.isLoadingCalendarEvents=!1})},e.onDeleteItem=function(t){confirm("Are you sure you want to delete this information?")&&(e.isLoading=!0,LogEntryResource.delete({logEntryId:t.logEntryId},function(){e.RetrieveItems()}))},$("#calendar-event-time").timepicker({scrollDefault:"10:00am"})}WatchCalendarCtrl.$inject=["$scope","$timeout","$http","$rootScope","$q"];function WatchHomeCtrl(e,t,i){var n=this,o=t("/api/Watch/Home"),s=t("https://localnewsally.org/api/LocalNews",null,{cache:!0});n.refreshData=function(){n.isLoading=!0,n.watchMembers=o.get(function(){n.isLoading=!1})},s.query({clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:i.publicSiteInfo.chicagoWard,zipCode:i.publicSiteInfo.zipCode,cityNeighborhood:i.publicSiteInfo.localNewsNeighborhoodQuery},function(e){n.localNews=e,n.isLoading_LocalNews=!1})}WatchHomeCtrl.$inject=["$rootScope","$resource","SiteInfo"];function WatchMembersCtrl(e,t,i){var n=this,o=t("/api/Watch/MemberList");n.refreshData=function(){n.isLoading=!0,n.memberList=o.query(function(){n.isLoading=!1,n.housePolys=function(e){var t=[],i=[];return _.each(e,function(e){e.houseGpsBounds&&(_.some(t,function(t){return t==e.addressId})||(t.push(e.addressId),i.push(e.houseGpsBounds)))}),i}(n.memberList)})},n.mapCenter=i.privateSiteInfo.gpsPosition,n.groupBounds=i.publicSiteInfo.gpsBounds,n.refreshData()}WatchMembersCtrl.$inject=["$rootScope","$resource","SiteInfo"];