/*! CommunityAllyWebApp 2020-01-10 */

!function(e){var t=function(){function e(e,t){this.$http=e,this.$q=t,this.isLoading=!1}return e.prototype.$onInit=function(){this.refreshAddresses()},e.prototype.getPolyInfo=function(e,t){var i=this.$q.defer();this.isLoading=!0;var n=this;return this.$http.get(e).then(function(e){n.isLoading=!1;var o=e.data;_.each(o,function(e){e.polyType=t,"Group"==t&&(e.oneLiner=e.shortName+", "+e.appName)}),$.merge(n.addresses,o),i.resolve(n.addresses)},function(e){this.isLoading=!1;var t=e.data.exceptionMessage?e.data.exceptionMessage:e.data;alert("Failed to retrieve addresses: "+t),i.reject()}),i.promise},e.prototype.getGroupBoundPolys=function(){return this.getPolyInfo("/api/AdminMap/GetGroupBounds?filter="+this.filterAddresses,"Group")},e.prototype.getAddressPolys=function(){return this.getPolyInfo("/api/AdminMap?filter="+this.filterAddresses,"Address")},e.prototype.refreshAddresses=function(){this.isLoading=!0,this.addresses=[];var e=this;this.getAddressPolys().then(function(){return e.getGroupBoundPolys()}).then(function(t){e.addressPoints=[],_.each(t,function(t){t.gpsPos&&(t.gpsPos.fullAddress=t.oneLiner,e.addressPoints.push(t.gpsPos))})})},e.prototype.onSavePoly=function(){this.isLoading=!0;var e={vertices:this.selectedAddress.gpsBounds.vertices},t="Address"===this.selectedAddress.polyType?"/api/AdminMap?addressId="+this.selectedAddress.addressId:"/api/AdminMap?groupId="+this.selectedAddress.groupId,i=this;this.$http.put(t,e).then(function(){i.isLoading=!1},function(){i.isLoading=!1})},e.prototype.onAddressSelected=function(e){if(this.selectedAddress=e,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&e.gpsPos){new google.maps.LatLng(e.gpsPos.lat,e.gpsPos.lon),new google.maps.LatLng(e.gpsPos.lat+.001,e.gpsPos.lon+.001);e.gpsBounds.vertices=[{lat:e.gpsPos.lat,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon+.001},{lat:e.gpsPos.lat,lon:e.gpsPos.lon+.001}]}this.selectedGpsPoly=e.gpsBounds},e.$inject=["$http","$q"],e}();e.ManageAddressPolysController=t}(Ally||(Ally={})),CA.angularApp.component("manageAddressPolys",{templateUrl:"/ngApp/admin/manage-address-polys.html",controller:Ally.ManageAddressPolysController});!function(e){var t=function(){return function(){}}(),i=(function(){}(),function(){function e(e,i,n){this.$timeout=e,this.$http=i,this.siteInfo=n,this.newAssociation=new t,this.changeShortNameData={appName:"Condo"},this.sendTestFromInmail=!1,this.noReplyEmailInfo={to:"",subject:"",body:""},this.retrieveGroups=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Association/adminList").then(function(t){e.isLoading=!1,e.groups=t.data,_.each(e.groups,function(e){0===e.appName?(e.appNameString="Condo",e.baseUrl="https://"+e.shortName+".CondoAlly.com/"):1===e.appName?(e.appNameString="NeighborhoodWatch",e.baseUrl="https://"+e.shortName+".WatchAlly.com/"):2===e.appName?(e.appNameString="Home",e.baseUrl="https://"+e.shortName+".HomeAlly.org/"):3===e.appName?(e.appNameString="Hoa",e.baseUrl="https://"+e.shortName+".HoaAlly.org/"):4===e.appName?(e.appNameString="Neighborhood",e.baseUrl="https://"+e.shortName+".NeighborhoodAlly.org/"):5===e.appName?(e.appNameString="PTA",e.baseUrl="https://"+e.shortName+".PTAAlly.org/"):6===e.appName&&(e.appNameString="BlockClub",e.baseUrl="https://"+e.shortName+".BlockClubAlly.org/")})},function(){e.isLoading=!1,alert("Failed to retrieve groups")})}}return e.prototype.$onInit=function(){},e.prototype.changeShortName=function(){var e=this;this.changeShortNameResult=null,/[^a-zA-Z0-9]/.test(this.changeShortNameData.newShortName)?alert("The new short name must be alphanumeric"):this.changeShortNameData.newShortName===this.changeShortNameData.newShortName.toLowerCase()?0!==this.changeShortNameData.newShortName.length?(this.isLoading=!0,this.$http.put("/api/AdminHelper/ChangeShortName?oldShortName="+this.changeShortNameData.old+"&newShortName="+this.changeShortNameData.newShortName+"&appName="+this.changeShortNameData.appName,null).then(function(t){e.isLoading=!1,e.changeShortNameResult="Successfully changed"},function(t){e.isLoading=!1,e.changeShortNameResult="Failed to change: "+t.data.exceptionMessage})):alert("New short name must not be empty"):alert("The new short name must be lower-case")},e.prototype.findAssociationsForUser=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Admin/findAssociationsForUser?email="+this.findUserAssociationsEmail).then(function(t){e.isLoading=!1,e.foundUserAssociations=t.data,_.forEach(e.foundUserAssociations,function(e){e.viewUrl="https://"+e.shortName+".condoally.com/",3===e.appName&&(e.viewUrl="https://"+e.shortName+".hoaally.org/")})},function(){e.isLoading=!1,alert("Failed to find associations for user")})},e.prototype.deleteAssociation=function(e){if(confirm("Are you sure you want to delete this association?")){this.isLoading=!0;var t=this;this.$http.delete("/api/Association/chtn/"+e.groupId).then(function(){t.isLoading=!1,t.retrieveGroups()},function(e){t.isLoading=!1,console.log(e.data.exceptionMessage),alert("Failed to delete group: "+e.data.exceptionMessage)})}},e.prototype.addAddress=function(){this.newAddressId=null,this.isLoading=!0;var e=this;this.$http.post("/api/AdminHelper/AddAddress?address="+encodeURIComponent(this.newAddress),null).success(function(t){e.isLoading=!1,e.newAddressId=t.data.newAddressId}).error(function(t){e.isLoading=!1,alert("Failed to add address: "+t.data.exceptionMessage)})},e.prototype.onCreateAssociationClick=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Association",this.newAssociation).then(function(){e.isLoading=!1,e.newAssociation=new t,e.retrieveGroups()})},e.prototype.onSendTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendTestEmail?testEmailRecipient="+encodeURIComponent(this.testEmailRecipient)+"&sendFromInmail="+(this.sendTestFromInmail?"true":"false"))},e.prototype.onSendTaylorTestEmail=function(){this.makeHelperRequest("/api/AdminHelper/SendFromTaylorEmail?testEmailRecipient="+encodeURIComponent(this.testTaylorEmailRecipient))},e.prototype.onSendTestPostmarkEmail=function(){this.isLoading=!0;var e=this;this.$http.get("/api/AdminHelper/SendTestPostmarkEmail?email="+this.testPostmarkEmail).success(function(){e.isLoading=!1,alert("Successfully sent email")}).error(function(){e.isLoading=!1,alert("Failed to send email")})},e.prototype.onSendNoReplyEmail=function(){var e=this;this.isLoading=!0,this.$http.post("/api/AdminHelper/SendNoReplyPostmarkEmail",this.noReplyEmailInfo).then(function(){e.isLoading=!1,alert("Successfully sent email")},function(t){e.isLoading=!1,alert("Failed to send email: "+t.data.exceptionMessage)})},e.prototype.makeHelperRequest=function(e,t){void 0===t&&(t=null),this.isLoadingHelper=!0;var i=this;(t?this.$http.post(e,t):this.$http.get(e)).then(function(){return i.isLoadingHelper=!1},function(){i.isLoadingHelper=!1,alert("Failed")})},e.prototype.onTestException=function(){this.makeHelperRequest("/api/Association/testException")},e.prototype.onClearElmahLogs=function(){this.makeHelperRequest("/api/Admin/clearElmah")},e.prototype.onClearAppGroupCache=function(){this.makeHelperRequest("/api/AdminHelper/ClearGroupCache")},e.prototype.onSendInactiveGroupsMail=function(){var e={shortNameLines:this.inactiveShortNames};this.makeHelperRequest("/api/AdminHelper/SendInactiveGroupsMail",e)},e.prototype.logInAs=function(){var e=this;this.isLoading=!0,this.$http.get("/api/AdminHelper/LogInAs?email="+this.logInAsEmail).then(function(t){e.siteInfo.setAuthToken(t.data),window.location.href="/#!/Home",window.location.reload(!1)},function(e){alert("Failed to perform login: "+e.data.exceptionMessage)}).finally(function(){return e.isLoading=!1})},e.$inject=["$timeout","$http","SiteInfo"],e}());e.ManageGroupsController=i}(Ally||(Ally={})),CA.angularApp.component("manageGroups",{templateUrl:"/ngApp/admin/manage-groups.html",controller:Ally.ManageGroupsController});!function(e){var t=function(){function t(t,i){this.$http=t,this.siteInfo=i,this.isLoading=!1,this.unitToEdit=new e.Unit,this.isEdit=!1,this.isHoaAlly=!1,this.isCondoAlly=!1}return t.prototype.$onInit=function(){this.isAdmin=this.siteInfo.userInfo.isAdmin,this.homeName=AppConfig.homeName||"Unit",this.isCondoAlly="condo"===AppConfig.appShortName,this.refresh()},t.prototype.refresh=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Unit?includeAddressData=true").then(function(t){e.isLoading=!1,e.units=t.data},function(t){e.isLoading=!1,alert("Failed to load homes: "+t.data.exceptionMessage)})},t.prototype.onCreateUnitClick=function(){var t=this;if($("#AddUnitForm").validate(),$("#AddUnitForm").valid()){this.isLoading=!0;var i=function(){t.isLoading=!1,t.isEdit=!1,t.unitToEdit=new e.Unit,t.refresh()},n=function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)};this.isEdit?this.$http.put("/api/Unit",this.unitToEdit).then(i,n):this.$http.post("/api/Unit",this.unitToEdit).then(i,n)}},t.prototype.onEditUnitClick=function(e){this.isEdit=!0,this.unitToEdit=_.clone(e),e.fullAddress&&(this.unitToEdit.streetAddress=e.fullAddress.oneLiner),document.getElementById("unit-edit-panel").scrollIntoView()},t.prototype.onRefreshUnitFromGoogle=function(e){var t=this;this.isLoading=!0,this.$http.put("/api/Unit/ForceRefreshAddressFromGoogle?unitId="+e.unitId,null).then(function(){t.isLoading=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed to refresh: "+e.data.exceptionMessage)})},t.prototype.onDeleteUnitClick=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Unit/"+e.unitId).then(function(){t.isLoading=!1,t.refresh()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)})},t.prototype.onFastAddUnits=function(){var e=this;this.isLoading=!0,this.$http.post("/api/Unit/FastAdd?fastAdd="+this.lastFastAddName,null).then(function(){e.isLoading=!1,e.refresh()},function(t){e.isLoading=!1,alert("Failed fast add: "+t.data.exceptionMessage)})},t.prototype.onAddUnitsPerLine=function(){var e=this,t={action:"onePerLine",lines:this.unitNamePerLine};this.isLoading=!0,this.$http.post("/api/Unit?onePerLine=1",t).then(function(){e.isLoading=!1,e.refresh()},function(){e.isLoading=!1,alert("Failed")})},t.prototype.onAddUnitsByAddressPerLine=function(){var e=this,t={action:"onePerLine",lines:this.unitAddressPerLine};this.isLoading=!0,this.$http.post("/api/Unit/FromAddresses",t).then(function(){e.isLoading=!1,e.unitAddressPerLine="",e.refresh()},function(t){e.isLoading=!1,alert("Failed to add: "+t.data.exceptionMessage)})},t.prototype.onDeleteAllClick=function(){var e=this;confirm("This will delete every unit! This should only be used for new sites!")&&(this.isLoading=!0,this.$http.get("/api/Unit?deleteAction=all").then(function(){e.isLoading=!1,e.refresh()},function(t){e.isLoading=!1,alert("Failed to delete units: "+t.data.exceptionMessage)}))},t.$inject=["$http","SiteInfo"],t}();e.ManageHomesController=t}(Ally||(Ally={})),CA.angularApp.component("manageHomes",{templateUrl:"/ngApp/admin/manage-homes.html",controller:Ally.ManageHomesController});!function(e){var t=function(){function e(e){this.$http=e,this.isLoading=!1}return e.prototype.$onInit=function(){this.retrieveEntries()},e.prototype.retrieveEntries=function(){this.isLoading=!0;var e=this;this.$http.get("/api/ActivityLog").then(function(t){e.isLoading=!1,e.logEntries=t.data,_.each(e.logEntries,function(e){return e.postDate=moment(e.postDate).toDate()})},function(t){e.isLoading=!1,alert("Failed to load activity log: "+t.data.exceptionMessage)})},e.$inject=["$http"],e}();e.ViewActivityLogController=t}(Ally||(Ally={})),CA.angularApp.component("viewActivityLog",{templateUrl:"/ngApp/admin/view-activity-log.html",controller:Ally.ViewActivityLogController});!function(e){var t=function(){function e(e){this.$http=e,this.isLoading=!1}return e.prototype.$onInit=function(){this.refreshAddresses()},e.prototype.findCenter=function(e){for(var t={lat:0,lng:0},i=0;i<e.length;++i){var n=e[i];if(n){for(var o={lat:0,lng:0},s=0;s<n.vertices.length;++s){var a=n.vertices[s];o.lat+=a.lat,o.lng+=a.lng}o.lat/=n.vertices.length,o.lng/=n.vertices.length,t.lat+=o.lat,t.lng+=o.lng}}return t.lat/=e.length,t.lng/=e.length,t},e.prototype.refreshAddresses=function(){var e=this;this.isLoading=!0,this.neighborhoodPolys=[];var t=this;this.$http.get("/api/Neighborhood").then(function(i){t.isLoading=!1,t.neighborhoods=i.data,t.neighborhoodPolys=_.select(t.neighborhoods,function(e){return e.Bounds}),t.mapCenter=t.findCenter(e.neighborhoodPolys)},function(e){t.isLoading=!1,alert("Failed to retrieve neighborhoods: "+e.data.exceptionMessage)})},e.$inject=["$http","$q"],e}();e.ViewPolysController=t}(Ally||(Ally={})),CA.angularApp.component("viewPolys",{templateUrl:"/ngApp/admin/view-polys.html",controller:Ally.ViewPolysController});!function(e){var t=function(){function e(e){this.$http=e,this.isLoading=!1}return e.prototype.$onInit=function(){this.mapCenter={lat:41.99114,lng:-87.690425},this.refreshCells()},e.prototype.addLine=function(e,t,i,n,o){var s=[{lat:t,lng:i},{lat:n,lng:o}];new google.maps.Polyline({path:s,geodesic:!1,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(e)},e.prototype.onBuildingSelected=function(e){},e.prototype.onCellSelected=function(e){e.gpsBounds.mapShapeObject.setOptions({fillOpacity:.1}),this.selectedCell&&this.selectedCell.gpsBounds.mapShapeObject.setOptions({fillOpacity:.35}),this.selectedCell=e,_.each(this.selectedCell.streets,function(t){0!=t.minLat&&this.addLine(e.gpsBounds.mapShapeObject.map,t.minLat,t.minLon,t.maxLat,t.maxLon)})},e.prototype.refreshCells=function(){this.isLoading=!0;var e=this;this.$http.get("/api/ResearchMap").then(function(t){e.isLoading=!1,e.cells=t.data,e.isLoading=!0,e.$http.get("/api/ResearchMap/Buildings").then(function(t){e.isLoading=!1,e.buildings=t.data,e.buildingPoints=_.map(e.buildings,function(e){var t=e.addressPos;return t.ownerBuilding=e,t.onClick=function(){},t})})},function(t){e.isLoading=!1,alert("Failed to retrieve cells: "+t.data.exceptionMessage)})},e.prototype.onAddressSelected=function(e){if(this.selectedAddress=e,this.selectedAddress.gpsBounds||(this.selectedAddress.gpsBounds={vertices:[]}),this.selectedAddress.gpsBounds.vertices||(this.selectedAddress.gpsBounds.vertices=[]),0==this.selectedAddress.gpsBounds.vertices.length&&e.gpsPos){new google.maps.LatLng(e.gpsPos.lat,e.gpsPos.lon),new google.maps.LatLng(e.gpsPos.lat+.001,e.gpsPos.lon+.001);e.gpsBounds.vertices=[{lat:e.gpsPos.lat,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon},{lat:e.gpsPos.lat+.001,lon:e.gpsPos.lon+.001},{lat:e.gpsPos.lat,lon:e.gpsPos.lon+.001}]}this.selectedGpsPoly=e.gpsBounds},e.$inject=["$http"],e}();e.ViewResearchController=t}(Ally||(Ally={})),CA.angularApp.component("viewResearch",{templateUrl:"/ngApp/admin/view-research.html",controller:Ally.ViewResearchController});var OverrideBaseApiPath=null;CA.angularApp.config(["$routeProvider","$httpProvider","$provide","SiteInfoProvider","$locationProvider",function(e,t,i,n,o){o.hashPrefix("!");for(var s={app:["$q","$http","$rootScope","$sce","$location","xdLocalStorage","appCacheService",function(e,t,i,n,o,s,a){return Ally.SiteInfoHelper.loginInit(e,t,i,n,s).then(function(t){return function(e,t,i,n){var o=t.defer();return i.userInfo?o.resolve():("/Home"!==e.path()&&"/Login"!==e.path()&&(n.set(n.Key_AfterLoginRedirect,e.path()),n.set(n.Key_WasLoggedIn401,"true")),o.reject(),e.path("/Login")),o.promise}(o,e,t,a)})}]},a={app:["$q","$http","$rootScope","$sce","xdLocalStorage",Ally.SiteInfoHelper.loginInit]},r=angular.extend({},e,{when:function(t,i){return i.resolve=i.resolve?i.resolve:{},i.allyRole===Role_All?angular.extend(i.resolve,a):angular.extend(i.resolve,s),e.when(t,i),this}}),l=0;l<AppConfig.menu.length;++l){var d=AppConfig.menu[l],p={controller:d.controller,allyRole:d.role};d.templateUrl?p.templateUrl=d.templateUrl:p.template=d.templateHtml,d.controllerAs&&(p.controllerAs=d.controllerAs),r.when(d.path,p)}e.otherwise({redirectTo:"/Home"}),i.factory("http403Interceptor",["$q","$location","$rootScope","appCacheService","$injector",function(e,t,i,n,o){return{response:function(e){return e},responseError:function(s){var a=s.status;if(401===a||403===a){if(403===a&&i.dontHandle403)return e.reject(s);if(403===a&&i.isLoggedIn&&n.set(n.Key_WasLoggedIn403,"true"),401===a&&HtmlUtil.isValidString(window.localStorage.rememberMe_Email)){var r=o.get("$http");if(!i.retryLoginDeffered){i.retryLoginDeffered=e.defer();var l={emailAddress:window.localStorage.rememberMe_Email,password:atob(window.localStorage.rememberMe_Password)};setTimeout(function(){r.post("/api/Login",l).then(function(e){var t=e.data;o.get("SiteInfo").setAuthToken(t.authToken),i.retryLoginDeffered.resolve()},function(){var e=i.retryLoginDeffered;i.onLogOut_ClearData(),e.reject()}).finally(function(){i.retryLoginDeffered=null})},1e3)}var d=e.defer();return i.retryLoginDeffered.promise.then(function(){d.resolve(r(s.config))},function(){d.reject(s)}),d.promise}"/Home"!==t.path()&&"/Login"!==t.path()&&(n.set(n.Key_AfterLoginRedirect,t.path()),n.set(n.Key_WasLoggedIn401,"true")),i.onLogOut_ClearData()}return e.reject(s)}}}]),t.interceptors.push("http403Interceptor"),t.defaults.transformResponse.push(function(e){return Ally.HtmlUtil2.isString(e)&&e.length>30?e:(Ally.HtmlUtil2.convertStringsToDates(e),e)}),i.factory("apiUriInterceptor",["$rootScope","SiteInfo",function(e,t){return"string"!=typeof e.authToken&&window.localStorage&&(e.authToken=window.localStorage.getItem("ApiAuthToken")),{request:function(t){return HtmlUtil.startsWith(t.url,"/api/")&&(HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||(t.url=OverrideBaseApiPath+t.url),t.headers.Authorization="Bearer "+e.authToken),t}}}]),t.interceptors.push("apiUriInterceptor")}]),CA.angularApp.run(["$rootScope","$http","$sce","$location","$templateCache","$cacheFactory","xdLocalStorage",function(e,t,i,n,o,s,a){e.bgImagePath="/assets/images/Backgrounds/",e.appConfig=AppConfig,e.isLoggedIn=!1,e.publicSiteInfo={},e.hideMenu=!1,e.isAdmin=!1,e.isSiteManager=!1,e.menuItems=_.where(AppConfig.menu,function(e){return!HtmlUtil.isNullOrWhitespace(e.menuTitle)}),e.mainMenuItems=_.where(e.menuItems,function(e){return e.role===Role_Authorized}),e.manageMenuItems=_.where(e.menuItems,function(e){return e.role===Role_Manager}),e.adminMenuItems=_.where(e.menuItems,function(e){return e.role===Role_Admin}),HtmlUtil.isLocalStorageAllowed()&&window.localStorage&&(e.publicSiteInfo=angular.fromJson(window.localStorage.getItem("siteInfo")),e.authToken=window.localStorage.getItem("ApiAuthToken"),null!==e.publicSiteInfo&&void 0!==e.publicSiteInfo||(e.publicSiteInfo={})),a.init({iframeUrl:"https://communityally.org/xd-local-storage.html"}).then(function(){}),e.onLogOut_ClearData=function(){e.userInfo={},e.isLoggedIn=!1,e.isAdmin=!1,e.isSiteManager=!1,e.authToken="",window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null,a.removeItem("allyApiAuthToken"),s.get("$http").removeAll(),window.localStorage&&window.localStorage.removeItem("siteInfo"),n.path("/Login")},e.onLogOut=function(){t.get("/api/Login/Logout").then(e.onLogOut_ClearData,e.onLogOut_ClearData)},e.$on("$routeChangeStart",function(){CA.clearTemplateCacheIfNeeded&&CA.clearTemplateCacheIfNeeded(o)}),e.$on("$routeChangeSuccess",function(t,i,o,s){e.curPath=n.path();var a="",r=n.path();-1!==r.indexOf("?")&&(a=r.substring(r.indexOf("?"),r.length));var l="";s&&s.name&&(l=n.protocol()+"://"+n.host()+"/#"+s.url),analytics.page({path:r,referrer:l,search:a,url:n.absUrl()})})}]);!function(e){var t=function(){return function(){}}();e.MenuItem_v3=t}(Ally||(Ally={}));function RoutePath(e,t,i,n,o){void 0===o&&(o=null),"/"!==e[0]&&(e="/"+e),this.path=e,this.templateUrl=t,this.controller=i,this.menuTitle=n,this.role=o||Role_Authorized,this.controllerAs="function"==typeof i?"vm":null}function RoutePath_v2(e){"/"!==e.path[0]&&(e.path="/"+e.path),this.path=e.path,this.templateUrl=e.templateUrl,this.templateHtml=e.templateHtml,this.controller=e.controller,this.menuTitle=e.menuTitle,this.role=e.role||Role_Authorized,this.controllerAs="function"==typeof e.controller?"vm":null}!function(e){var t=function(){return function(){}}();e.RouteOptions_v3=t;var i=function(){return function(e){"/"!==e.path[0]&&(e.path="/"+e.path),this.path=e.path,this.templateHtml=e.templateHtml,this.menuTitle=e.menuTitle,this.role=e.role||Role_Authorized}}();e.RoutePath_v3=i;var n=function(){return function(){}}();e.AppConfigInfo=n}(Ally||(Ally={}));var Role_Authorized="authorized",Role_All="all",Role_Manager="manager",Role_Admin="admin",PeriodicPaymentFrequencies=[{name:"Monthly",intervalName:"month",id:50},{name:"Quarterly",intervalName:"quarter",id:51},{name:"Semiannually",intervalName:"half-year",id:52},{name:"Annually",intervalName:"year",id:53}];function FrequencyIdToInfo(e){return PeriodicPaymentFrequencies[e-50]}var CondoAllyAppConfig={appShortName:"condo",appName:"Condo Ally",baseTld:"condoally.com",baseUrl:"https://condoally.com/",isChtnSite:!0,segmentWriteKey:"GnlZNd8jKCpDgFqRKbA4nftkuFIaqKPQ",homeName:"Unit",memberTypeLabel:"Resident",menu:[new Ally.RoutePath_v3({path:"Home",templateHtml:"<chtn-home></chtn-home>",menuTitle:"Home"}),new Ally.RoutePath_v3({path:"Info/Docs",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info"}),new Ally.RoutePath_v3({path:"Info/:viewName",templateHtml:"<association-info></association-info>"}),new Ally.RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",menuTitle:"Calendar"}),new Ally.RoutePath_v3({path:"Map",templateHtml:"<chtn-map></chtn-map>",menuTitle:"Map"}),new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Residents"}),new Ally.RoutePath_v3({path:"Committee/:committeeId/:viewName",templateHtml:"<committee-parent></committee-parent>"}),new Ally.RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"SignUp",templateHtml:"<condo-sign-up-wizard></condo-sign-up-wizard>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"EmailAbuse/:idValue",templateHtml:"<email-abuse></email-abuse>",role:Role_All}),new Ally.RoutePath_v3({path:"DiscussionManage/:idValue",templateHtml:"<discussion-manage></discussion-manage>"}),new Ally.RoutePath_v3({path:"NeighborSignUp",templateHtml:"<neighbor-sign-up></neighbor-sign-up>",role:Role_All}),new Ally.RoutePath_v3({path:"GroupRedirect/:appName/:shortName",templateHtml:"<group-redirect></group-redirect>",role:Role_All}),new Ally.RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManageCommittees",templateHtml:"<manage-committees></manage-committees>",menuTitle:"Committees",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManagePolls",templateHtml:"<manage-polls></manage-polls>",menuTitle:"Polls",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManagePayments",templateHtml:"<manage-payments></manage-payments>",menuTitle:"Online Payments",role:Role_Manager}),new Ally.RoutePath_v3({path:"AssessmentHistory",templateHtml:"<assessment-history></assessment-history>",menuTitle:"Assessment History",role:Role_Manager}),new Ally.RoutePath_v3({path:"Mailing/Invoice",templateHtml:"<mailing-parent></mailing-parent>",menuTitle:"Mailing",role:Role_Manager}),new Ally.RoutePath_v3({path:"Mailing/:viewName",templateHtml:"<mailing-parent></mailing-parent>",role:Role_Manager}),new Ally.RoutePath_v3({path:"Settings",templateHtml:"<chtn-settings></chtn-settings>",menuTitle:"Settings",role:Role_Manager}),new Ally.RoutePath_v3({path:"/Admin/ManageGroups",templateHtml:"<manage-groups></manage-groups>",menuTitle:"All Groups",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ManageHomes",templateHtml:"<manage-homes></manage-homes>",menuTitle:"Homes",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"Activity Log",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"View Groups on Map",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewPolys",templateHtml:"<view-polys></view-polys>",menuTitle:"View Polygons",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewResearch",templateHtml:"<view-research></view-research>",menuTitle:"View Research",role:Role_Admin})]},HomeAppConfig={appShortName:"home",appName:"Home Ally",baseTld:"homeally.org",baseUrl:"https://homeally.org/",isChtnSite:!1,homeName:"Home",memberTypeLabel:"User",menu:[new Ally.RoutePath_v3({path:"SignUp",templateHtml:"<home-sign-up></home-sign-up>",role:Role_All}),new Ally.RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new Ally.RoutePath_v3({path:"Home",templateHtml:"<home-group-home></home-group-home>",menuTitle:"Home"}),new Ally.RoutePath_v3({path:"Info/Docs",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info"}),new Ally.RoutePath_v3({path:"Info/:viewName",templateHtml:"<association-info></association-info>"}),new Ally.RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",menuTitle:"Calendar"}),new Ally.RoutePath_v3({path:"Users",templateHtml:"<home-users></home-users>",menuTitle:"Users",role:Role_Manager}),new Ally.RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"View Activity Log",role:Role_Admin})]},HOAAppConfig=_.clone(CondoAllyAppConfig);HOAAppConfig.appShortName="hoa",HOAAppConfig.appName="HOA Ally",HOAAppConfig.baseTld="hoaally.org",HOAAppConfig.baseUrl="https://hoaally.org/",HOAAppConfig.homeName="Home",HOAAppConfig.menu.push(new Ally.RoutePath_v3({path:"HoaSignUp",templateHtml:"<hoa-sign-up-wizard></hoa-sign-up-wizard>",role:Role_All}));var NeighborhoodAppConfig=_.clone(CondoAllyAppConfig);NeighborhoodAppConfig.appShortName="neighborhood",NeighborhoodAppConfig.appName="Neighborhood Ally",NeighborhoodAppConfig.baseTld="neighborhoodally.org",NeighborhoodAppConfig.baseUrl="https://neighborhoodally.org/",NeighborhoodAppConfig.homeName="Home",NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(e){return"Residents"===e.menuTitle}),NeighborhoodAppConfig.menu.push(new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"})),NeighborhoodAppConfig.menu.splice(0,0,new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager})),NeighborhoodAppConfig.menu=_.reject(NeighborhoodAppConfig.menu,function(e){return"Assessment History"===e.menuTitle}),NeighborhoodAppConfig.menu.splice(3,0,new Ally.RoutePath_v3({path:"DuesHistory",menuTitle:"Dues History",templateHtml:"<dues-history></dues-history>",role:Role_Manager})),NeighborhoodAppConfig.menu.push(new Ally.RoutePath_v3({path:"NeighborhoodSignUp",templateHtml:"<neighborhood-sign-up-wizard></neighborhood-sign-up-wizard>",role:Role_All})),NeighborhoodAppConfig.menu.push(new Ally.RoutePath_v3({path:"MemberSignUp",templateHtml:"<pending-member-sign-up></pending-member-sign-up>",role:Role_All}));var BlockClubAppConfig=_.clone(CondoAllyAppConfig);BlockClubAppConfig.appShortName="block-club",BlockClubAppConfig.appName="Block Club Ally",BlockClubAppConfig.baseTld="blockclubally.org",BlockClubAppConfig.baseUrl="https://blockclubally.org/",BlockClubAppConfig.homeName="Home",BlockClubAppConfig.memberTypeLabel="Member",BlockClubAppConfig.menu=_.reject(BlockClubAppConfig.menu,function(e){return"Residents"===e.menuTitle}),BlockClubAppConfig.menu.push(new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"})),BlockClubAppConfig.menu.splice(0,0,new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Residents",role:Role_Manager})),BlockClubAppConfig.menu=_.reject(BlockClubAppConfig.menu,function(e){return"Assessment History"===e.menuTitle}),BlockClubAppConfig.menu.splice(3,0,new Ally.RoutePath_v3({path:"AssessmentHistory",menuTitle:"Membership Dues History",templateHtml:"<assessment-history></assessment-history>",role:Role_Manager})),BlockClubAppConfig.menu.push(new Ally.RoutePath_v3({path:"NeighborhoodSignUp",templateHtml:"<neighborhood-sign-up-wizard></neighborhood-sign-up-wizard>",role:Role_All})),BlockClubAppConfig.menu.push(new Ally.RoutePath_v3({path:"MemberSignUp",templateHtml:"<pending-member-sign-up></pending-member-sign-up>",role:Role_All}));var PtaAppConfig=_.clone(CondoAllyAppConfig);PtaAppConfig.appShortName="pta",PtaAppConfig.appName="PTA Ally",PtaAppConfig.baseTld="ptaally.org",PtaAppConfig.baseUrl="https://ptaally.org/",PtaAppConfig.isChtnSite=!1,PtaAppConfig.homeName="Home",PtaAppConfig.memberTypeLabel="Member",PtaAppConfig.menu=[new Ally.RoutePath_v3({path:"Home",templateHtml:"<chtn-home></chtn-home>",menuTitle:"Home"}),new Ally.RoutePath_v3({path:"Info/Docs",templateHtml:"<association-info></association-info>",menuTitle:"Documents & Info"}),new Ally.RoutePath_v3({path:"Info/:viewName",templateHtml:"<association-info></association-info>"}),new Ally.RoutePath_v3({path:"Logbook",templateHtml:"<logbook-page></logbook-page>",menuTitle:"Calendar"}),new Ally.RoutePath_v3({path:"BuildingResidents",templateHtml:"<group-members></group-members>",menuTitle:"Members"}),new Ally.RoutePath_v3({path:"Committee/:committeeId/:viewName",templateHtml:"<committee-parent></committee-parent>"}),new Ally.RoutePath_v3({path:"ForgotPassword",templateHtml:"<forgot-password></forgot-password>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Login",templateHtml:"<login-page></login-page>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"Help",templateHtml:"<help-form></help-form>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"MemberSignUp",templateHtml:"<pending-member-sign-up></pending-member-sign-up>",menuTitle:null,role:Role_All}),new Ally.RoutePath_v3({path:"MyProfile",templateHtml:"<my-profile></my-profile>"}),new Ally.RoutePath_v3({path:"ManageResidents",templateHtml:"<manage-residents></manage-residents>",menuTitle:"Members",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManageCommittees",templateHtml:"<manage-committees></manage-committees>",menuTitle:"Committees",role:Role_Manager}),new Ally.RoutePath_v3({path:"ManagePolls",templateHtml:"<manage-polls></manage-polls>",menuTitle:"Polls",role:Role_Manager}),new Ally.RoutePath_v3({path:"AssessmentHistory",templateHtml:"<assessment-history></assessment-history>",menuTitle:"Membership Dues History",role:Role_Manager}),new Ally.RoutePath_v3({path:"Settings",templateHtml:"<chtn-settings></chtn-settings>",menuTitle:"Settings",role:Role_Manager}),new Ally.RoutePath_v3({path:"/Admin/ManageGroups",templateHtml:"<manage-groups></manage-groups>",menuTitle:"All Groups",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ViewActivityLog",templateHtml:"<view-activity-log></view-activity-log>",menuTitle:"Activity Log",role:Role_Admin}),new Ally.RoutePath_v3({path:"/Admin/ManageAddressPolys",templateHtml:"<manage-address-polys></manage-address-polys>",menuTitle:"View Groups on Map",role:Role_Admin})];var AppConfig=null,lowerDomain=document.domain.toLowerCase();HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||(lowerDomain=OverrideBaseApiPath.toLowerCase()),-1!==lowerDomain.indexOf("condoally")||-1!==lowerDomain.indexOf("hellocondo")?AppConfig=CondoAllyAppConfig:-1!==lowerDomain.indexOf("homeally")||-1!==lowerDomain.indexOf("helloathome")?AppConfig=HomeAppConfig:-1!==lowerDomain.indexOf("hoaally")||-1!==lowerDomain.indexOf("hellohoa")?AppConfig=HOAAppConfig:-1!==lowerDomain.indexOf("neighborhoodally")||-1!==lowerDomain.indexOf("helloneighborhood")?AppConfig=NeighborhoodAppConfig:-1!==lowerDomain.indexOf("chicagoblock")||-1!==lowerDomain.indexOf("blockclub")?AppConfig=BlockClubAppConfig:-1!==lowerDomain.indexOf("ptaally")?AppConfig=PtaAppConfig:(console.log("Unknown ally app"),AppConfig=CondoAllyAppConfig),window.AppConfig=AppConfig,AppConfig.isPublicRoute=function(e){e||(e=window.location.hash),HtmlUtil.startsWith(e,"#!")&&(e=e.substr(2));var t=-1!==e.indexOf("/",1);t&&(e=e.substr(0,e.indexOf("/",1)));var i=_.find(AppConfig.menu,function(i){var n=i.path;return!!n&&(t&&-1!==n.indexOf("/",1)&&(n=n.substr(0,n.indexOf("/",1))),n===e)});return!!i&&i.role===Role_All},document.title=AppConfig.appName,$(document).ready(function(){$("header").css("background-image","url(/assets/images/header-img-"+AppConfig.appShortName+".jpg)")});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t;(i=t||(t={}))[i.Monthly=50]="Monthly",i[i.Quarterly=51]="Quarterly",i[i.Semiannually=52]="Semiannually",i[i.Annually=53]="Annually";!function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}}(function(){return function(){this.isEmptyEntry=!1}}());var i,n=function(){function e(e,t,i,n){var o=this;this.$http=e,this.$location=t,this.siteInfo=i,this.appCacheService=n,this.LocalStorageKey_ShowPaymentInfo="AssessmentHistory_ShowPaymentInfo",this.LocalStorageKey_ShouldColorCodePayments="AssessmentHistory_ColorCodePayment",this.NumPeriodsVisible=10,this.shouldShowCreateSpecialAssessment=!1,this.unitPayments={},this.showRowType="unit",this.isForMemberGroup=!1,this.isSavingPayment=!1,this.shouldColorCodePayments=!1,this.onSavePayment=function(){var e=function(){o.isSavingPayment=!1,o.editPayment=null,o.retrievePaymentHistory()},t=function(e){o.isSavingPayment=!1,alert(e.data.message),o.editPayment=null};o.isSavingPayment=!0,o.editPayment.payment.paymentId?(analytics.track("editAssessmentHistoryPayment"),o.$http.put("/api/PaymentHistory",o.editPayment.payment).then(e,t)):(analytics.track("addAssessmentHistoryPayment"),o.$http.post("/api/PaymentHistory",o.editPayment.payment).then(e,t))}}return e.prototype.$onInit=function(){this.isForMemberGroup="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"pta"===AppConfig.appShortName,this.isForMemberGroup?this.pageTitle="Membership Dues Payment History":this.pageTitle="Assessment Payment History",this.isForMemberGroup&&(this.NumPeriodsVisible=8),this.authToken=window.localStorage.getItem("ApiAuthToken"),this.isForMemberGroup?this.showRowType="member":AppConfig.isChtnSite?this.showRowType="unit":console.log("Unhandled app type for payment history: "+AppConfig.appShortName);this.showPaymentInfo="true"===window.localStorage[this.LocalStorageKey_ShowPaymentInfo],this.shouldColorCodePayments="true"===window.localStorage[this.LocalStorageKey_ShouldColorCodePayments];this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,this.isForMemberGroup&&(this.assessmentFrequency=53),this.payPeriodName="month",51===this.assessmentFrequency?this.payPeriodName="quarter":52===this.assessmentFrequency?this.payPeriodName="half-year":53===this.assessmentFrequency&&(this.payPeriodName="year"),this.maxPeriodRange=12,51===this.assessmentFrequency?this.maxPeriodRange=4:52===this.assessmentFrequency?this.maxPeriodRange=2:53===this.assessmentFrequency&&(this.maxPeriodRange=1),this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this.periodNames=this.monthNames,this.shortPeriodNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],51===this.assessmentFrequency?(this.periodNames=["Quarter 1","Quarter 2","Quarter 3","Quarter 4"],this.shortPeriodNames=["Q1","Q2","Q3","Q4"]):52===this.assessmentFrequency?(this.periodNames=["First Half","Second Half"],this.shortPeriodNames=["1st Half","2nd Half"]):53===this.assessmentFrequency&&(this.periodNames=[""],this.shortPeriodNames=[""]),this.startPeriodValue=(new Date).getMonth()+2,this.startYearValue=(new Date).getFullYear(),51===this.assessmentFrequency?this.startPeriodValue=Math.floor((new Date).getMonth()/4)+2:52===this.assessmentFrequency?this.startPeriodValue=Math.floor((new Date).getMonth()/6)+2:53===this.assessmentFrequency&&(this.startPeriodValue=1,this.startYearValue=(new Date).getFullYear()+1),this.startPeriodValue>this.maxPeriodRange&&(this.startPeriodValue=1,this.startYearValue+=1),this.isPeriodicPaymentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled,this.retrievePaymentHistory()},e.prototype.onChangePeriodicPaymentTracking=function(){var e=this;this.isPeriodicPaymentTrackingEnabled!==this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.isPeriodicPaymentTrackingEnabled,this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled=this.isPeriodicPaymentTrackingEnabled,this.isLoading=!0,this.$http.put("/api/Association/updatePeriodicPaymentTracking?isPeriodicPaymentTrackingEnabled="+this.isPeriodicPaymentTrackingEnabled,null).then(function(){e.isLoading=!1},function(){alert("Failed to update the payment tracking"),e.isLoading=!1}))},e.prototype.fillInEmptyPaymentsForUnit=function(e){for(var t=null!==e.owners&&e.owners.length>0?e.owners[0].userId:null,i=[],n=this.startPeriodValue,o=this.startYearValue,s=0;s<this.NumPeriodsVisible;++s){n<1&&(n=this.maxPeriodRange,--o);var a=_.find(e.allPayments,function(e){return e.period===n&&e.year===o});(void 0===a||a.isEmptyEntry)&&(a={isPaid:!1,period:n,year:o,amount:e.assessment,payerUserId:t,paymentDate:new Date,isEmptyEntry:!0}),i.push(a),n--}return i},e.prototype.fillInEmptyPaymentsForMember=function(e){for(var t=[],i=this.startPeriodValue,n=this.startYearValue,o=0;o<this.NumPeriodsVisible;++o){i<1&&(i=this.maxPeriodRange,--n);var s=_.find(e.enteredPayments,function(e){return e.period===i&&e.year===n});(void 0===s||s.isEmptyEntry)&&(s={isPaid:!1,paymentId:null,period:i,year:n,amount:0,payerUserId:e.userId,paymentDate:new Date,isEmptyEntry:!0,wePayCheckoutId:null,checkNumber:null,notes:null,payerNotes:null,wePayStatus:null,groupId:null}),t.push(s),i--}return t},e.prototype.viewWePayDetails=function(e){this.appCacheService.set("hwpid",e),this.$location.path("/ManagePayments")},e.prototype.addSpecialAssessment=function(){var e=this;this.createSpecialAssessment=parseInt(this.createSpecialAssessment)+1,this.isLoading=!0,this.$http.post("/api/PaymentHistory/SpecialAssessment",this.createSpecialAssessment).then(function(){e.isLoading=!1,e.shouldShowCreateSpecialAssessment=!1,e.retrievePaymentHistory()},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to add special assessment: "+i)})},e.prototype.showCreateSpecialAssessment=function(){this.shouldShowCreateSpecialAssessment=!0,this.createSpecialAssessment={year:(new Date).getFullYear(),month:(new Date).getMonth().toString(),notes:"",amount:null}},e.prototype.browsePast=function(){for(this.startPeriodValue=this.startPeriodValue-6;this.startPeriodValue<1;)this.startPeriodValue=this.maxPeriodRange+this.startPeriodValue,--this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},e.prototype.browseFuture=function(){for(this.startPeriodValue=this.startPeriodValue+6;this.startPeriodValue>this.maxPeriodRange;)this.startPeriodValue-=this.maxPeriodRange,++this.startYearValue;this.displayPaymentsForRange(this.startYearValue,this.startPeriodValue)},e.prototype.displayPaymentsForRange=function(e,t){var i=this;this.startYearValue=e,this.startPeriodValue=t,this.visiblePeriodNames=[];for(var n=this.startYearValue,o=this.startPeriodValue,s=0;s<this.NumPeriodsVisible;++s){o<1&&(o=this.maxPeriodRange,--n);var a=this.shortPeriodNames[o-1];1!==o&&o!==this.maxPeriodRange||(a+=" "+n),this.isForMemberGroup&&(a=n+" - "+(n+1)),this.visiblePeriodNames.push({name:a,periodIndex:o,arrayIndex:s,year:n}),--o}this.isForMemberGroup?_.each(this.payers,function(e){return e.displayPayments=i.fillInEmptyPaymentsForMember(e)}):_.each(this.unitPayments,function(e){return e.payments=i.fillInEmptyPaymentsForUnit(e)})},e.prototype.retrievePaymentHistory=function(){var e=this;this.isLoading=!0,this.$http.get("/api/PaymentHistory?oldestDate=").then(function(t){var i=t.data;e.unitPayments={},_.each(i.units,function(t){for(e.unitPayments[t.unitId]=t,e.unitPayments[t.unitId].displayOwners=_.first(t.owners,2);e.unitPayments[t.unitId].displayOwners.length<2;)e.unitPayments[t.unitId].displayOwners.push({name:""});e.unitPayments[t.unitId].payments=[]}),e.isForMemberGroup&&t.data.payers&&_.each(t.data.payers,function(e){e.enteredPayments=_.filter(i.payments,function(t){return t.payerUserId===e.userId})}),_.each(i.payments,function(t){e.unitPayments[t.unitId]&&e.unitPayments[t.unitId].payments.push(t)}),_.each(i.units,function(e){e.allPayments=e.payments});var n=[];for(var o in e.unitPayments)n.push(e.unitPayments[o]);e.unitPayments=_.sortBy(n,function(e){return e.name}),e.payers=_.sortBy(i.payers,function(e){return e.name}),e.displayPaymentsForRange(e.startYearValue,e.startPeriodValue),e.isLoading=!1},function(t){e.isLoading=!1,alert("Failed to retrieve payment history: "+t.data.exceptionMessage)})},e.prototype.getPaymentSumForPayPeriod=function(e){var t=0;if(AppConfig.isChtnSite)for(var i=_.keys(this.unitPayments),n=0;n<i.length;++n){var o=i[n];(s=this.unitPayments[o].payments[e])&&s.isPaid&&(t+=s.amount)}else for(n=0;n<this.payers.length;++n){var s;(s=this.payers[n].displayPayments[e])&&s.isPaid&&(t+=s.amount)}return t},e.prototype.onshowPaymentInfo=function(){window.localStorage[this.LocalStorageKey_ShowPaymentInfo]=this.showPaymentInfo,window.localStorage[this.LocalStorageKey_ShouldColorCodePayments]=this.shouldColorCodePayments},e.prototype.onUnitPaymentCellClick=function(e,t){t.unitId=e.unitId,this.editPayment={unit:e,payment:_.clone(t),periodName:this.periodNames[t.period-1],filteredPayers:_.filter(this.payers,function(t){return!_.some(e.owners,function(e){return e.userId===t.userId})})},setTimeout(function(){$("#paid-amount-textbox").focus()},10)},e.prototype.onMemberPaymentCellClick=function(e,t){t.payerUserId=e.userId,this.editPayment={unit:null,payment:_.clone(t),periodName:this.periodNames[t.period-1],filteredPayers:null},setTimeout(function(){$("#paid-amount-textbox").focus()},10)},e.$inject=["$http","$location","SiteInfo","appCacheService"],e}();e.AssessmentHistoryController=n}(Ally||(Ally={})),CA.angularApp.component("assessmentHistory",{templateUrl:"/ngApp/chtn/manager/assessment-history.html",controller:Ally.AssessmentHistoryController});!function(e){var t=function(){return function(){}}();e.DuesHistoryController=t}(Ally||(Ally={})),CA.angularApp.component("duesHistory",{templateUrl:"/ngApp/chtn/manager/dues-history.html",controller:Ally.DuesHistoryController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.$cacheFactory=n,this.$rootScope=o,this.initialView="Home",this.selectedView=null,this.isLoading=!1,this.initialView=this.$routeParams.viewName||"Transactions"}return e.prototype.$onInit=function(){},e.$inject=["$http","SiteInfo","$routeParams","$cacheFactory","$rootScope"],e}();e.FinancialParentController=t}(Ally||(Ally={})),CA.angularApp.component("financialParent",{templateUrl:"/ngApp/chtn/manager/financial/financial-parent.html",controller:Ally.CommitteeParentController});!function(e){var t=function(){return function(){this.isPrivate=!1}}();e.Committee=t;var i=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.includeInactive=!1,this.activeCommittees=[],this.inactiveCommittees=[],this.showInactiveCommittees=!1,this.editCommittee=null,this.isLoading=!1}return e.prototype.$onInit=function(){this.retrieveCommittees()},e.prototype.startEditCommittee=function(e){this.editCommittee=e},e.prototype.showCreateModal=function(){this.editCommittee=new t,this.editCommittee.committeeType="Ongoing"},e.prototype.toggleCommitteeActive=function(e){this.isLoading=!0;var t=(e.deactivationDateUtc?"/api/Committee/Reactivate/":"/api/Committee/Deactivate/")+e.committeeId,i=this;this.$http.put(t,null).success(function(e){i.isLoading=!1,i.retrieveCommittees()}).error(function(e){i.isLoading=!1,alert("Failed to retrieve the modify committee: "+e.exceptionMessage)})},e.prototype.retrieveCommittees=function(){var e=this;this.isLoading=!0;this.$http.get("/api/Committee?includeInactive=true").success(function(t){e.isLoading=!1,e.activeCommittees=_.filter(t,function(e){return!e.deactivationDateUtc}),e.inactiveCommittees=_.filter(t,function(e){return!!e.deactivationDateUtc}),e.activeCommittees=_.sortBy(e.activeCommittees,function(e){return e.name.toLowerCase()}),e.inactiveCommittees=_.sortBy(e.inactiveCommittees,function(e){return e.name.toLowerCase()})}).error(function(t){e.isLoading=!1,alert("Failed to retrieve the committee listing")})},e.prototype.saveCommittee=function(){var e=this;if(HtmlUtil.isNullOrWhitespace(this.editCommittee.name))alert("Please enter a name for the new committee.");else if(this.editCommittee.committeeType){this.isLoading=!0;var t="/api/Committee"+(this.editCommittee.committeeId?"/"+this.editCommittee.committeeId.toString():"")+"?name="+encodeURIComponent(this.editCommittee.name)+"&type="+encodeURIComponent(this.editCommittee.committeeType)+"&isPrivate="+this.editCommittee.isPrivate.toString();(this.editCommittee.committeeId?this.$http.put:this.$http.post)(t,null).success(function(){e.isLoading=!1,e.editCommittee=null,e.retrieveCommittees()}).error(function(t){e.isLoading=!1,alert("Failed to save the committee: "+t.exceptionMessage)})}else alert("Please select a type for the new committee.")},e.$inject=["$http","SiteInfo","$cacheFactory"],e}();e.ManageCommitteesController=i}(Ally||(Ally={})),CA.angularApp.component("manageCommittees",{templateUrl:"/ngApp/chtn/manager/manage-committees.html",controller:Ally.ManageCommitteesController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.appCacheService=i,this.PaymentHistory=[],this.message="",this.showPaymentPage=!0,this.PeriodicPaymentFrequencies=PeriodicPaymentFrequencies,this.AssociationPaysAch=!0,this.AssociationPaysCC=!1,this.lateFeeInfo={},this.hasLoadedPage=!1,this.isLoading=!1,this.isLoadingUnits=!1,this.isLoadingPayment=!1,this.isLoadingLateFee=!1,this.isLoadingCheckoutDetails=!1,this.allowNewWePaySignUp=!1}return e.prototype.$onInit=function(){this.highlightWePayCheckoutId=this.appCacheService.getAndClear("hwpid"),this.isAssessmentTrackingEnabled=this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled;this.allowNewWePaySignUp=["tigertrace","7mthope"].indexOf(this.siteInfo.publicSiteInfo.shortName)>-1,this.payments=[{Date:"",Unit:"",Resident:"",Amount:"",Status:""}],this.testFee={amount:200},this.signUpStep=0,this.signUpInfo={hasAssessments:null,assessmentFrequency:0,allPayTheSame:!0,allPayTheSameAmount:null,units:[]},this.refresh()},e.prototype.refresh=function(){var e=this;this.isLoading=!0,this.$http.get("/api/OnlinePayment").then(function(t){e.isLoading=!1,e.hasLoadedPage=!0,e.hasAssessments=e.siteInfo.privateSiteInfo.hasAssessments;var i=t.data;e.paymentInfo=i,e.lateFeeInfo={lateFeeDayOfMonth:i.lateFeeDayOfMonth,lateFeeAmount:i.lateFeeAmount},HtmlUtil.isNullOrWhitespace(e.lateFeeInfo.lateFeeAmount)||HtmlUtil.endsWith(e.lateFeeInfo.lateFeeAmount,"%")||(e.lateFeeInfo.lateFeeAmount="$"+e.lateFeeInfo.lateFeeAmount),e.refreshUnits(),e.updateTestFee()})},e.prototype.refreshUnits=function(){this.isLoadingUnits=!0;var e=this;this.$http.get("/api/Unit").then(function(t){e.units=t.data,_.each(e.units,function(e){null===e.adjustedAssessment&&(e.adjustedAssessment=e.assessment)}),e.assessmentSum=_.reduce(e.units,function(e,t){return e+t.assessment},0),e.adjustedAssessmentSum=_.reduce(e.units,function(e,t){return e+(t.adjustedAssessment||0)},0),e.isLoadingUnits=!1})},e.prototype.getLateFeeDateSuper=function(){var e=this.lateFeeInfo.lateFeeDayOfMonth;if("string"==typeof e){if(HtmlUtil.isNullOrWhitespace(e))return"";e=parseInt(e),this.lateFeeInfo.lateFeeDayOfMonth=e}if(NaN==e||e<1)return e="","";if(e>31)return e="","";if(e>=10&&e<=20)return"th";var t=e%10;return 1===t?"st":2===t?"nd":3===t?"rd":"th"},e.prototype.updatePayPalCredentials=function(){this.isUpdatingPayPalCredentials=!0,this.payPalSignUpClientSecret="",this.payPalSignUpErrorMessage=""},e.prototype.saveAllowSetting=function(){var e=this;this.isLoading=!0,this.$http.put("/api/OnlinePayment/SaveAllow?allowPayments="+this.paymentInfo.areOnlinePaymentsAllowed,null).then(function(e){window.location.reload()},function(t){e.isLoading=!1,alert("Failed to save: "+t.data.exceptionMessage)})},e.prototype.enablePayPal=function(){var e=this;this.isLoading=!0,this.payPalSignUpErrorMessage=null;var t={clientId:this.payPalSignUpClientId,clientSecret:this.payPalSignUpClientSecret};this.$http.put("/api/OnlinePayment/EnablePayPal",t).then(function(t){e.payPalSignUpClientId="",e.payPalSignUpClientSecret="",window.location.reload()},function(t){e.isLoading=!1,e.payPalSignUpErrorMessage=t.data.exceptionMessage})},e.prototype.selectText=function(){setTimeout(function(){$(".editable-input").select()},50)},e.prototype.onWithdrawalClick=function(){var e=this;this.message="",this.$http.get("/api/OnlinePayment?action=withdrawal").then(function(t){var i=t.data;i.redirectUri?window.location.href=i.redirectUri:e.message=i.message},function(t){t.data&&t.data.exceptionMessage&&(e.message=t.data.exceptionMessage)})},e.prototype.onUnitAssessmentChanged=function(e){this.isLoadingUnits=!0;var t={unitId:e.unitId,assessment:"string"==typeof e.adjustedAssessment?parseFloat(e.adjustedAssessment):e.adjustedAssessment,assessmentNote:e.adjustedAssessmentReason},i=this;this.$http.put("/api/Unit/UpdateAssessment",t).then(function(){i.isLoadingUnits=!1,i.assessmentSum=_.reduce(i.units,function(e,t){return e+t.assessment},0),i.adjustedAssessmentSum=_.reduce(i.units,function(e,t){return e+(t.adjustedAssessment||0)},0)})},e.prototype.onChangeFeePayerInfo=function(e){var t=this,i=!1,n=!1;if(this.paymentInfo.usersWithAutoPay&&this.paymentInfo.usersWithAutoPay.length>0){var o=[];if("ach"===e?o=_.where(this.paymentInfo.usersWithAutoPay,function(e){return"ACH"===e.wePayAutoPayFundingSource}):"cc"===e&&(o=_.where(this.paymentInfo.usersWithAutoPay,function(e){return"Credit Card"===e.wePayAutoPayFundingSource})),o.length>0){n=void 0!==_.find(o,function(e){return e.userId===t.siteInfo.userInfo.userId}),i=!0;var s="Adjusting the fee payer type will cause the follow units to have their auto-pay cancelled and they will be informed by e-mail:\n";if(_.each(o,function(e){return s+=e.ownerName+"\n"}),s+="\nDo you want to continue?",!confirm(s))return void("ach"===e?this.paymentInfo.payerPaysAchFee=!this.paymentInfo.payerPaysAchFee:this.paymentInfo.payerPaysCCFee=!this.paymentInfo.payerPaysCCFee)}}this.isLoadingPayment=!0;var a=this;this.$http.put("/api/OnlinePayment",this.paymentInfo).then(function(){n?window.location.reload():(a.isLoadingPayment=!1,i&&a.refresh())}),this.updateTestFee()},e.prototype.getSignUpSum=function(){return _.reduce(this.signUpInfo.units,function(e,t){return e+parseFloat(t.assessment)},0)},e.prototype.signUp_HasAssessments=function(e){var t=this;this.signUpInfo.hasAssessments=e,this.signUpInfo.hasAssessments?(this.signUpInfo.units=[],_.each(this.units,function(e){t.signUpInfo.units.push({unitId:e.unitId,name:e.name,assessment:0})}),this.signUpStep=1):this.signUp_Commit()},e.prototype.signUp_AssessmentFrequency=function(e){this.signUpInfo.frequencyIndex=e,this.signUpInfo.assessmentFrequency=PeriodicPaymentFrequencies[e].name,this.signUpStep=2},e.prototype.saveLateFee=function(){var e=this;this.isLoadingLateFee=!0,this.$http.put("/api/OnlinePayment/LateFee?dayOfMonth="+this.lateFeeInfo.lateFeeDayOfMonth+"&lateFeeAmount="+this.lateFeeInfo.lateFeeAmount,null).then(function(t){e.isLoadingLateFee=!1;var i=t.data;i&&i.feeAmount&&0!==i.feeType?(e.lateFeeInfo.lateFeeAmount=i.feeAmount,1===i.feeType?e.lateFeeInfo.lateFeeAmount="$"+e.lateFeeInfo.lateFeeAmount:2===i.feeType&&(e.lateFeeInfo.lateFeeAmount=e.lateFeeInfo.lateFeeAmount+"%")):(""!==e.lateFeeInfo.lateFeeDayOfMonth&&alert("Failed to save the late fee. Please enter only a number for the date (ex. 5) and an amount (ex. 12.34) or percent (ex. 5%) for the fee. To disable late fees, clear the date field and hit save."),e.lateFeeInfo.lateFeeDayOfMonth="",e.lateFeeInfo.lateFeeAmount=null)},function(t){e.isLoadingLateFee=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to update late fee: "+i)})},e.prototype.showPayPalCheckoutInfo=function(e){var t=this;this.viewingPayPalCheckoutId=e,this.viewingPayPalCheckoutId&&(this.isLoadingCheckoutDetails=!0,this.checkoutInfo={},this.$http.get("/api/OnlinePayment/PayPalCheckoutInfo?checkoutId="+e,{cache:!0}).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1,alert("Failed to retrieve checkout details: "+e.data.exceptionMessage)}))},e.prototype.showWePayCheckoutInfo=function(e){var t=this;this.viewingWePayCheckoutId=e,this.viewingWePayCheckoutId&&(this.isLoadingCheckoutDetails=!0,this.checkoutInfo={},this.$http.get("/api/OnlinePayment/CheckoutInfo?checkoutId="+e,{cache:!0}).then(function(e){t.isLoadingCheckoutDetails=!1,t.checkoutInfo=e.data},function(e){t.isLoadingCheckoutDetails=!1,alert("Failed to retrieve checkout details: "+e.data.exceptionMessage)}))},e.prototype.signUp_Commit=function(){var e=this;this.isLoading=!0,this.$http.post("/api/OnlinePayment/BasicInfo",this.signUpInfo).then(function(){e.isLoading=!1,e.refreshUnits(),e.hasAssessments=e.signUpInfo.hasAssessments,e.siteInfo.privateSiteInfo.hasAssessments=e.hasAssessments},function(t){e.isLoading=!1,t.data&&t.data.exceptionMessage&&(e.message=t.data.exceptionMessage)})},e.prototype.updateTestFee=function(){var e=parseFloat(this.testFee.amount);this.paymentInfo.payerPaysAchFee?(this.testFee.achResidentPays=e+1.5,this.testFee.achAssociationReceives=e):(this.testFee.achResidentPays=e,this.testFee.achAssociationReceives=e-1.5);var t=1.3+.029*e;this.paymentInfo.payerPaysCCFee?(this.testFee.ccResidentPays=e+t,this.testFee.ccAssociationReceives=e):(this.testFee.ccResidentPays=e,this.testFee.ccAssociationReceives=e-t)},e.prototype.admin_ClearAccessToken=function(){alert("TODO hook this up")},e.$inject=["$http","SiteInfo","appCacheService"],e}();e.ManagePaymentsController=t}(Ally||(Ally={})),CA.angularApp.component("managePayments",{templateUrl:"/ngApp/chtn/manager/manage-payments.html",controller:Ally.ManagePaymentsController});!function(e){var t=function(){return function(){this.isAnonymous=!0,this.whoCanVote="Owners"}}();e.Poll=t;var i=function(){return function(){}}();e.PollResponse=i;var n=function(){function e(e,i){this.$http=e,this.siteInfo=i,this.editingItem=new t,this.pollHistory=[],this.isLoading=!1}return e.prototype.$onInit=function(){var e=new Date;e.setDate((new Date).getDate()+3),this.defaultPoll=new t,this.defaultPoll.expirationDate=e,this.defaultPoll.answers=[{answerText:"Yes"},{answerText:"No"}],this.editingItem=angular.copy(this.defaultPoll),this.retrieveItems()},e.prototype.retrieveItems=function(){this.isLoading=!0;var e=this;this.$http.get("/api/Poll").then(function(t){e.pollHistory=t.data;for(var i=0;i<e.pollHistory.length;++i)e.pollHistory[i].expirationDate=new Date(e.pollHistory[i].expirationDate),e.pollHistory[i].fullResultAnswers=e.pollHistory[i].answers,e.pollHistory[i].answers=_.reject(e.pollHistory[i].answers,function(e){return 101===e.sortOrder});e.isLoading=!1})},e.prototype.addAnswer=function(){this.editingItem.answers||(this.editingItem.answers=[]),this.editingItem.answers.length>19?alert("You can only have 20 answers maxiumum per poll."):this.editingItem.answers.push({answerText:""})},e.prototype.cancelEdit=function(){this.editingItem=angular.copy(this.defaultPoll)},e.prototype.onSaveItem=function(){if(null!==this.editingItem){this.isLoading=!0;var e=this,t=function(){e.isLoading=!1,e.editingItem=angular.copy(e.defaultPoll),e.retrieveItems()},i=function(t){e.isLoading=!1,alert("Failed to save poll: "+t.data.exceptionMessage)};"number"==typeof this.editingItem.pollId?(analytics.track("editPoll"),this.$http.put("/api/Poll",this.editingItem).then(t,i)):(analytics.track("addPoll"),this.$http.post("/api/Poll",this.editingItem).then(t,i))}},e.prototype.onEditItem=function(e){this.editingItem=angular.copy(e),window.scrollTo(0,0)},e.prototype.onDeleteItem=function(e){this.isLoading=!0;var t=this;this.$http.delete("/api/Poll?pollId="+e.pollId).then(function(){t.retrieveItems()},function(e){t.isLoading=!1,403===e.status&&alert("You cannot authorized to delete this poll.")})},e.prototype.onViewResults=function(e){if(e){var t=_.groupBy(e.responses,"answerId");e.chartData=[],e.chartLabels=[];var i,n=function(){if(!t.hasOwnProperty(o))return"continue";var n=parseInt(o);(i=_.find(e.fullResultAnswers,function(e){return e.pollAnswerId===n}))&&(e.chartLabels.push(i.answerText),e.chartData.push(t[o].length))};for(var o in t)n();e.responses&&e.responses.length<this.siteInfo.privateSiteInfo.numUnits&&(e.chartLabels.push("No Response"),e.chartData.push(this.siteInfo.privateSiteInfo.numUnits-e.responses.length)),e.answerCounts=[];for(var s=0;s<e.chartLabels.length;++s)e.answerCounts.push({label:e.chartLabels[s],count:e.chartData[s]});this.chartLabels=e.chartLabels,this.chartData=e.chartData,this.viewingPollResults=e}else this.viewingPollResults=null},e.$inject=["$http","SiteInfo"],e}();e.ManagePollsController=n}(Ally||(Ally={})),CA.angularApp.component("managePolls",{templateUrl:"/ngApp/chtn/manager/manage-polls.html",controller:Ally.ManagePollsController});__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}();e.Unit=t;var i=function(){return function(){}}();e.PayerInfo=i;var n=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(t);e.UnitWithOwner=n;var o=function(){return function(){}}();e.HomeEntry=o;var s=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(e.HomeEntry);e.HomeEntryWithName=s;var a=function(){return function(){}}();e.Member=a;var r=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(a);e.MemberWithBoard=r;var l=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(r);e.Resident=l;var d=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(l);e.UpdateResident=d;var p=function(){return function(){}}(),h=function(){return function(){}}();e.PendingMember=h;var c=function(){function t(e,t,i,n,o,s){this.$http=e,this.$rootScope=t,this.$interval=i,this.fellowResidents=n,this.uiGridConstants=o,this.siteInfo=s,this.isAdmin=!1,this.showEmailSettings=!0,this.shouldShowHomePicker=!0,this.showKansasPtaExport=!1,this.multiselectMulti="single",this.isSavingUser=!1,this.isLoading=!1,this.isLoadingSettings=!1,this.shouldSortUnitsNumerically=!1,this.showEmailHistory=!1,this.bulkParseNormalizeNameCase=!1,this.showLaunchSite=!0,this.showPendingMembers=!1,this.isLoadingPending=!1,this.selectedResidentDetailsView="Primary",this.showAddHomeLink=!1,this.hasMemberNotOwnerRenter=!1}return t.prototype.$onInit=function(){var t=this;this.isAdmin=this.siteInfo.userInfo.isAdmin,this.siteLaunchedDateUtc=this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.bulkImportRows=[new p],this.multiselectOptions="",this.allUnits=null,this.homeName=AppConfig.homeName||"Unit",this.showIsRenter="condo"===AppConfig.appShortName||"hoa"===AppConfig.appShortName,this.shouldShowResidentPermissions=this.showIsRenter||"block-club"===AppConfig.appShortName,this.shouldShowHomePicker="pta"!==AppConfig.appShortName,this.showKansasPtaExport="pta"===AppConfig.appShortName&&"KS"===this.siteInfo.privateSiteInfo.groupAddress.state,this.showEmailSettings=!this.siteInfo.privateSiteInfo.isEmailSendingRestricted,this.memberTypeLabel=AppConfig.memberTypeLabel,this.showLaunchSite="pta"!==AppConfig.appShortName,this.showPendingMembers="pta"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"neighborhood"===AppConfig.appShortName,this.hasMemberNotOwnerRenter="pta"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"neighborhood"===AppConfig.appShortName,this.showAddHomeLink=!this.siteInfo.privateSiteInfo.siteLaunchedDateUtc&&moment().isBefore(moment(this.siteInfo.privateSiteInfo.creationDate).add(5,"days")),this.showPendingMembers&&(this.pendingMemberSignUpUrl="https://"+HtmlUtil.getSubdomain()+"."+AppConfig.baseTld+"/#!/MemberSignUp",setTimeout(function(){var t=new Clipboard(".clipboard-button");t.on("success",function(t){e.HtmlUtil2.showTooltip(t.trigger,"Copied!"),t.clearSelection()}),t.on("error",function(t){e.HtmlUtil2.showTooltip(t.trigger,"Auto-copy failed, press CTRL+C now")})},750)),this.boardPositions=e.FellowResidentsService.BoardPositionNames,this.newResident={boardPosition:0,isRenter:!1},this.editUser=null;var i="residentSort_v2",n={field:"lastName",direction:this.uiGridConstants.ASC};if(this.residentSortInfo=n,window.localStorage){var o=window.localStorage.getItem(i);o&&(this.residentSortInfo=JSON.parse(o)),this.residentSortInfo.field||(this.residentSortInfo=n)}var s="hoa"===AppConfig.appShortName?140:this.showIsRenter?62:175,a=this;if(this.residentGridOptions={data:[],enableFiltering:!1,columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first",enableFiltering:!0},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last",enableFiltering:!0},{field:"email",displayName:"E-mail",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text class="resident-cell-email" data-ng-style="{ \'color\': row.entity.postmarkReportedBadEmailUtc ? \'#F00\' : \'auto\' }">{{ row.entity.email }}</span></div>',enableFiltering:!0},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.phoneNumber | tel }}</span></div>',enableFiltering:!0},{field:"unitGridLabel",displayName:"condo"===AppConfig.appShortName?"Unit":"Residence",cellClass:"resident-cell-unit",width:s,visible:AppConfig.isChtnSite,sortingAlgorithm:function(e,t){return a.shouldSortUnitsNumerically?parseInt(e)-parseInt(t):e.toString().localeCompare(t.toString())},enableFiltering:!0},{field:"isRenter",displayName:"Renter",width:80,cellClass:"resident-cell-is-renter",visible:this.showIsRenter,cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isRenter"></div>',enableFiltering:!1},{field:"boardPosition",displayName:"Board",width:125,cellClass:"resident-cell-board",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ grid.appScope.$ctrl.getBoardPositionName(row.entity.boardPosition) }}</span></div>',enableFiltering:!1},{field:"isSiteManager",displayName:"Admin",width:80,cellClass:"resident-cell-site-manager",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" data-ng-checked="row.entity.isSiteManager"></div>',enableFiltering:!1}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableFullRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,onRegisterApi:function(e){a.gridApi=e,e.selection.on.rowSelectionChanged(a.$rootScope,function(e){e.isSelected;a.setEdit(e.entity)}),e.core.on.sortChanged(a.$rootScope,function(e,t){t&&0!==t.length&&(a.residentSortInfo={field:t[0].field,direction:t[0].sort.direction},window.localStorage.setItem(i,JSON.stringify(a.residentSortInfo)))}),HtmlUtil.uiGridFixScroll()}},this.pendingMemberGridOptions={data:[],columnDefs:[{field:"firstName",displayName:"First Name"},{field:"lastName",displayName:"Last Name"},{field:"email",displayName:"E-mail"},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.phoneNumber | tel }}</span></div>'}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableFullRowSelection:!0,enableColumnMenus:!1,enableRowHeaderSelection:!1,onRegisterApi:function(e){a.pendingMemberGridApi=e,e.selection.on.rowSelectionChanged(a.$rootScope,function(e){a.selectPendingMember(e.entity)}),HtmlUtil.uiGridFixScroll()}},window.innerWidth<769)for(var r=2;r<this.residentGridOptions.columnDefs.length;++r)this.residentGridOptions.columnDefs[r].visible=!1;this.emailHistoryGridOptions={columnDefs:[{field:"senderName",displayName:"Sender",width:150},{field:"recipientGroup",displayName:"Sent To",width:100},{field:"messageSource",displayName:"Source",width:100},{field:"subject",displayName:"Subject"},{field:"sendDateUtc",displayName:"Send Date",width:140,type:"date",cellFilter:"date:'short'"},{field:"numRecipients",displayName:"#Recip.",width:70},{field:"numAttachments",displayName:"#Attach.",width:80}],enableSorting:!0,enableHorizontalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableVerticalScrollbar:this.uiGridConstants.scrollbars.NEVER,enableColumnMenus:!1,enablePaginationControls:!0,paginationPageSize:20,paginationPageSizes:[20],enableRowHeaderSelection:!1,onRegisterApi:function(e){HtmlUtil.uiGridFixScroll()}},this.refreshResidents().then(function(){return t.loadSettings()}).then(function(){t.showPendingMembers&&t.loadPendingMembers()})},t.prototype.getBoardPositionName=function(t){if(!t)return"";var i=jQuery.grep(e.FellowResidentsService.BoardPositionNames,function(e,i){return e.id===t})[0];return i?i.name:""},t.prototype.selectPendingMember=function(e){this.pendingMemberGridApi.selection.clearSelectedRows();var t=new d;t.firstName=e.firstName,t.lastName=e.lastName,t.email=e.email,t.phoneNumber=e.phoneNumber,t.pendingMemberId=e.pendingMemberId,t.boardPosition=0,t.shouldSendWelcomeEmail=!1,this.setEdit(t)},t.prototype.setEdit=function(t){var i=this;if(this.sentWelcomeEmail=!1,null!==t){this.selectedResidentDetailsView="Primary",this.editUserForm.$setPristine();var n=jQuery.extend({},t);if(this.editUser=n,this.editUser.showAdvancedHomePicker=!!this.allUnits&&this.allUnits.length>20,this.multiselectMulti="single","object"==typeof this.editUser.units&&(this.editUser.units.length>0&&(this.editUser.singleUnitId=this.editUser.units[0].unitId),this.editUser.units.length>1&&(this.editUser.showAdvancedHomePicker=!0,this.multiselectMulti="multiple")),this.allUnits&&this.allUnits.length>20&&"single"===this.multiselectMulti&&-5!==this.allUnits[0].unitId){var o=new e.Unit;o.name="None Selected",o.unitId=-5,this.allUnits.unshift(o)}_.each(this.allUnits,function(e){var t=void 0!==_.find(i.editUser.units,function(t){return t.unitId===e.unitId});e.isSelectedForEditUser=t}),this.gridApi.selection.clearSelectedRows(),setTimeout("$( '#edit-user-first-text-box' ).focus();",100)}else this.editUser=null},t.prototype.onSendWelcome=function(){this.isSavingUser=!0;var e=this;this.$http.put("/api/Residents/"+this.editUser.userId+"/SendWelcome",null).success(function(){e.isSavingUser=!1,e.sentWelcomeEmail=!0}).error(function(){e.isSavingUser=!1,alert("Failed to send the welcome e-mail, please contact support if this problem persists.")})},t.prototype.populateGridUnitLabels=function(){_.each(this.residentGridOptions.data,function(e){var t=_.reduce(e.units,function(e,t){return e.length>0?e+","+t.name:t.name},"");e.unitGridLabel=t})},t.prototype.refreshResidents=function(){var e=this;this.isLoading=!0;var t=this;return this.$http.get("/api/Residents").success(function(i){if(t.isLoading=!1,t.residentGridOptions.data=i,t.residentGridOptions.minRowsToShow=i.length,t.residentGridOptions.virtualizationThreshold=i.length,t.residentGridOptions.enableFiltering=i.length>15,t.gridApi.core.notifyDataChange(e.uiGridConstants.dataChange.COLUMN),t.hasOneAdmin=1===_.filter(i,function(e){return e.isSiteManager}).length&&i.length>1,t.residentSortInfo){var n=_.find(t.gridApi.grid.columns,function(e){return e.field===t.residentSortInfo.field});n&&t.gridApi.grid.sortColumn(n,t.residentSortInfo.direction,!1)}_.forEach(i,function(e){e.fullName=e.firstName+" "+e.lastName,"string"==typeof e.email&&-1!==e.email.indexOf("@condoally.com")&&(e.email=""),e.lastLoginDateUtc&&(e.lastLoginDateUtc=moment.utc(e.lastLoginDateUtc).toDate())}),t.populateGridUnitLabels(),!t.allUnits&&AppConfig.isChtnSite&&(t.isLoading=!0,t.$http.get("/api/Unit").then(function(e){t.isLoading=!1,t.allUnits=e.data,t.shouldSortUnitsNumerically=_.every(t.allUnits,function(e){return HtmlUtil.isNumericString(e.name)}),t.shouldSortUnitsNumerically&&(t.allUnits=_.sortBy(t.allUnits,function(e){return parseFloat(e.name)})),t.multiselectOptions=t.allUnits.length>20?"filter":""},function(){t.isLoading=!1,alert("Failed to retrieve your association's home listing, please contact support.")}))})},t.prototype.loadPendingMembers=function(){var e=this;this.isLoadingPending=!0,this.$http.get("/api/Member/Pending").then(function(t){e.isLoadingPending=!1,e.pendingMemberGridOptions.data=t.data,e.pendingMemberGridOptions.minRowsToShow=t.data.length,e.pendingMemberGridOptions.virtualizationThreshold=t.data.length},function(t){e.isLoadingPending=!1})},t.prototype.enableMultiHomePicker=function(){this.editUser&&(this.editUser.showAdvancedHomePicker=!0),this.multiselectMulti="multiple",this.allUnits&&this.allUnits.length>0&&null===this.allUnits[0].unitId&&this.allUnits.shift()},t.prototype.rejectPendingMember=function(){var e=this;this.editUser.pendingMemberId&&confirm("Are you sure you want to remove this pending member? This action cannot be undone.")&&(this.isLoading=!1,this.$http.put("/api/Member/Pending/Deny/"+this.editUser.pendingMemberId,null).then(function(){e.isLoading=!1,e.editUser=null,e.loadPendingMembers()},function(t){e.isLoading=!1,alert("Failed to reject pending member: "+t.data.exceptionMessage)}))},t.prototype.onSaveResident=function(){if(this.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid()&&(this.editUser.userId!==this.$rootScope.userInfo.userId||!this.siteInfo.userInfo.isSiteManager||this.editUser.isSiteManager||confirm("If you remove yourself as a site admin you won't be able to continue making changes. Are you sure you want to remove yourself as a site admin?")))){this.editUser.showAdvancedHomePicker||(this.editUser.units=[{unitId:this.editUser.singleUnitId,name:null,memberHomeId:null,userId:this.editUser.userId,isRenter:null}]),this.isSavingUser=!0;var e=this,t=function(t){e.isSavingUser=!1,"string"!=typeof t.data.errorMessage?(e.editUser.pendingMemberId&&e.loadPendingMembers(),e.editUser=null,e.refreshResidents()):alert("Failed to add resident: "+t.data.errorMessage)},i=!1,n=function(t){e.isSavingUser=!1;var n=i?"Failed to add new resident":"Failed to update resident";t&&t.data&&t.data.exceptionMessage&&(n+=": "+t.data.exceptionMessage),alert(n)};this.editUser.userId?(i=!1,analytics.track("editResident"),this.$http.put("/api/Residents",this.editUser).then(t,n)):(i=!0,analytics.track("addNewResident"),this.$http.post("/api/Residents",this.editUser).then(t,n)),this.fellowResidents.clearResidentCache()}},t.prototype.OnAdminSetPassword=function(){var e={userName:this.adminSetPass_Username,password:this.adminSetPass_Password},t=this;this.$http.post("/api/AdminHelper/SetPassword",e).success(function(e){t.adminSetPass_ResultMessage=e}).error(function(e){var t=e.exceptionMessage?e.exceptionMessage:e;alert("Failed to set password: "+t)})},t.prototype.loadSettings=function(){var e=this;this.isLoadingSettings=!0;var t=this;this.$http.get("/api/Settings").success(function(i){t.isLoadingSettings=!1,e.residentSettings=i,e.siteInfo.privateSiteInfo.rentersCanViewDocs=e.residentSettings.rentersCanViewDocs,e.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads=e.residentSettings.whoCanCreateDiscussionThreads}).error(function(e){t.isLoadingSettings=!1,console.log("Failed to retrieve settings")})},t.prototype.exportResidentCsv=function(){"undefined"!=typeof analytics&&analytics.track("exportResidentCsv");var t=this,i=[{headerText:"First Name",fieldName:"firstName"},{headerText:"Last Name",fieldName:"lastName"},{headerText:"Phone",fieldName:"phoneNumber"},{headerText:"E-mail",fieldName:"email"},{headerText:"Unit",fieldName:"unitGridLabel"},{headerText:"Is Renter",fieldName:"isRenter"},{headerText:"Is Admin",fieldName:"isSiteManager"},{headerText:"Board Position",fieldName:"boardPosition",dataMapper:function(e){return t.getBoardPositionName(e)}},{headerText:"Alternate Mailing",fieldName:"mailingAddressObject",dataMapper:function(e){return e?e.oneLiner:""}},{headerText:"Alternate Phone",fieldName:"alternatePhoneNumber"},{headerText:"Manager Notes",fieldName:"managerNotes"},{headerText:"Last Login Date",fieldName:"lastLoginDateUtc",dataMapper:function(e){return e?moment(e).format("YYYY-MM-DD HH:mm:00"):"Has not logged-in"}}],n=e.createCsvString(this.residentGridOptions.data,i);e.HtmlUtil2.downloadCsv(n,"Residents.csv")},t.prototype.exportKansasPtaCsv=function(){if(this.siteInfo.privateSiteInfo.ptaUnitId){"undefined"!=typeof analytics&&analytics.track("exportKansasPtaCsv");for(var t=0,i=_.clone(this.residentGridOptions.data);t<i.length;t++){var n=i[t];n.Local_Unit=this.siteInfo.privateSiteInfo.ptaUnitId.toString(),n.Membership_Name=n.firstName&&"N/A"!==n.firstName?n.firstName:n.lastName,0!==n.boardPosition&&(n.Position=this.getBoardPositionName(n.boardPosition))}var o=e.createCsvString(this.residentGridOptions.data,[{headerText:"Local_Unit",fieldName:"Local_Unit"},{headerText:"First_Name",fieldName:"firstName"},{headerText:"Last_Name",fieldName:"lastName"},{headerText:"Number_of_Members",fieldName:"Number_of_Members"},{headerText:"Membership_Name",fieldName:"Membership_Name"},{headerText:"Name_Prefix",fieldName:"Name_Prefix"},{headerText:"Middle_Name",fieldName:"Middle_Name"},{headerText:"Name_Suffix",fieldName:"Name_Suffix"},{headerText:"Email",fieldName:"email"},{headerText:"Address_1",fieldName:"Address_1"},{headerText:"Address_2",fieldName:"Address_2"},{headerText:"Address_3",fieldName:"Address_3"},{headerText:"City",fieldName:"City"},{headerText:"State",fieldName:"State"},{headerText:"Zip",fieldName:"Zip"},{headerText:"Home_Telephone",fieldName:"phoneNumber"},{headerText:"Work_Telephone",fieldName:"Work_Telephone"},{headerText:"Mobile_Number",fieldName:"Mobile_Number"},{headerText:"Position",fieldName:"Position"},{headerText:"Begin_Date",fieldName:"Begin_Date"},{headerText:"End_Date",fieldName:"End_Date"},{headerText:"Second_Name",fieldName:"Second_Name"},{headerText:"Second_Email",fieldName:"Second_Email"},{headerText:"Teacher1",fieldName:"Teacher1"},{headerText:"Teacher2",fieldName:"Teacher2"},{headerText:"Teacher3",fieldName:"Teacher3"},{headerText:"Children_Names",fieldName:"Children_Names"}]);o="data:text/csv;charset=utf-8,"+o;var s=encodeURI(o),a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download","pta-members.csv"),document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a)},500)}else alert("You must first set your PTA unit ID in Manage -> Settings before you can export in this format.")},t.prototype.saveResidentSettings=function(){var e=this;analytics.track("editResidentSettings"),this.isLoadingSettings=!0,this.$http.put("/api/Settings",this.residentSettings).success(function(){e.isLoadingSettings=!1,e.fellowResidents.clearResidentCache(),e.siteInfo.privateSiteInfo.canHideContactInfo=e.residentSettings.canHideContactInfo,e.siteInfo.privateSiteInfo.isDiscussionEmailGroupEnabled=e.residentSettings.isDiscussionEmailGroupEnabled}).error(function(){e.isLoadingSettings=!1,alert("Failed to update settings, please try again or contact support.")})},t.prototype.onDeleteResident=function(){if(confirm("Are you sure you want to remove this person from your building?")&&(this.siteInfo.userInfo.userId!==this.editUser.userId||confirm("If you remove your own account you won't be able to login anymore. Are you still sure?"))){this.isSavingUser=!0;var e=this;this.$http.delete("/api/Residents?userId="+this.editUser.userId).success(function(){e.isSavingUser=!1,e.editUser=null,e.fellowResidents.clearResidentCache(),e.refreshResidents()}).error(function(){alert("Failed to remove the resident. Please let support know if this continues to happen."),e.isSavingUser=!1,e.editUser=null})}},t.prototype.onSendAllWelcome=function(){if(confirm("This will e-mail all of the residents in your association. Do you want to proceed?")){this.isLoading=!0;var e=this;this.$http.put("/api/Residents?userId&action=launchsite",null).success(function(t){e.isLoading=!1,e.sentWelcomeEmail=!0,e.allEmailsSent=!0}).error(function(){e.isLoading=!1,alert("Failed to send welcome e-mail, please contact support if this problem persists.")})}},t.prototype.parseBulkCsv=function(){var e=$.csv.toArrays(this.bulkImportCsv);this.bulkImportRows=[];var t=function(e){e||(e="");var t=e.toLowerCase();return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/0th /g,"0 ").replace(/1st /g,"1 ")).replace(/2nd /g,"2 ").replace(/3rd /g,"3 ")).replace(/4th /g,"4 ").replace(/5th /g,"5 ")).replace(/6th /g,"6 ").replace(/7th /g,"7 ")).replace(/8th /g,"8 ").replace(/9th /g,"9 ")).replace(/\./g,"").replace(/ /g,"")).replace(/street/g,"st").replace(/road/g,"rd").replace(/drive/g,"dr")).replace(/place/g,"pl").replace(/avenue/g,"ave")};if(this.allUnits)for(var i=0;i<this.allUnits.length;++i)this.allUnits[i].csvTestName=t(this.allUnits[i].name);var n,o,s=function(){for(var s=e[i];s.length<10;)s.push("");if("unit name"===s[0]&&"e-mail address"===s[1]&&"first name"===s[2])return"continue";for(var r=0;r<s.length;++r)HtmlUtil.isNullOrWhitespace(s[r])?s[r]=null:s[r]=s[r].trim();var l={unitName:s[0]||null,unitId:void 0,email:s[1],firstName:s[2],lastName:s[3],phoneNumber:s[4],isRenter:!HtmlUtil.isNullOrWhitespace(s[5]),isAdmin:!HtmlUtil.isNullOrWhitespace(s[6]),csvTestName:"",mailingAddress:s[7],alternatePhone:s[8],managerNotes:s[9]};HtmlUtil.isNullOrWhitespace(l.unitName)?l.unitId=null:(l.csvTestName=t(l.unitName),n=_.find(a.allUnits,function(e){return e.csvTestName===l.csvTestName}),l.unitId=n?n.unitId:void 0);var d=null;if(l.firstName&&-1!==l.firstName.toLowerCase().indexOf(" and ")){if(d=_.clone(l),o=l.firstName.split(" and "),l.firstName=o[0],d.firstName=o[1],l.email&&-1!==l.email.indexOf(" / ")){var p=l.email.split(" / ");l.email=p[0],d.email=p[1]}else d.email="";d.phoneNumber=""}if(a.bulkParseNormalizeNameCase){var h=function(e){return e?1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():e};l.firstName=h(l.firstName),l.lastName=h(l.lastName),d&&(d.firstName=h(d.firstName),d.lastName=h(d.lastName))}a.bulkImportRows.push(l),d&&a.bulkImportRows.push(d)},a=this;for(i=0;i<e.length;++i)s()},t.prototype.submitBulkRows=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Residents/BulkLoad",this.bulkImportRows).success(function(){e.isLoading=!1,e.bulkImportRows=[new p],e.bulkImportCsv="",alert("Success"),e.refreshResidents()}).error(function(){e.isLoading=!1,alert("Bulk upload failed")})},t.prototype.addBulkRow=function(){var e={unitName:"",unitId:null,email:"",firstName:"",lastName:"",phoneNumber:"",isRenter:!1,isAdmin:!1,csvTestName:void 0,mailingAddress:"",alternatePhone:"",managerNotes:""};if(this.allUnits&&this.bulkImportRows.length>0){var t=this.bulkImportRows[this.bulkImportRows.length-1].unitId,i=_.findIndex(this.allUnits,function(e){return e.unitId===t});++i<this.allUnits.length&&(e.unitName=this.allUnits[i].name,e.unitId=this.allUnits[i].unitId)}this.bulkImportRows.push(e)},t.prototype.toggleEmailHistoryVisible=function(){var e=this;this.showEmailHistory=!this.showEmailHistory,this.showEmailHistory&&!this.emailHistoryGridOptions.data&&(this.isLoadingSettings=!0,this.$http.get("/api/Email/RecentGroupEmails").then(function(t){e.isLoadingSettings=!1,e.emailHistoryGridOptions.data=t.data},function(t){e.isLoadingSettings=!1,alert("Failed to load e-mails: "+t.data.exceptionMessage)}))},t.$inject=["$http","$rootScope","$interval","fellowResidents","uiGridConstants","SiteInfo"],t}();e.ManageResidentsController=c}(Ally||(Ally={})),CA.angularApp.component("manageResidents",{templateUrl:"/ngApp/chtn/manager/manage-residents.html",controller:Ally.ManageResidentsController});__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}();e.BaseSiteSettings=t;var i=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(t);e.ChtnSiteSettings=i;var n=function(){function t(e,t,n,o){this.$http=e,this.siteInfo=t,this.$timeout=n,this.$scope=o,this.settings=new i,this.originalSettings=new i,this.showRightColumnSetting=!0,this.showLocalNewsSetting=!1,this.isPta=!1}return t.prototype.$onInit=function(){var t=this;this.defaultBGImage=$(document.documentElement).css("background-image"),this.showQaButton="president@mycondoally.com"===this.siteInfo.userInfo.emailAddress,this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl,this.showRightColumnSetting=this.siteInfo.privateSiteInfo.creationDate<e.SiteInfoService.AlwaysDiscussDate,this.showLocalNewsSetting=!this.showRightColumnSetting,this.isPta="pta"===AppConfig.appShortName,this.$timeout(function(){return t.hookUpLoginImageUpload()},200),this.refreshData()},t.prototype.refreshData=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Settings").then(function(t){e.isLoading=!1,e.settings=t.data,e.originalSettings=_.clone(t.data)})},t.prototype.removeLoginImage=function(){analytics.track("clearLoginImage"),this.isLoading=!0;var e=this;this.$http.get("/api/Settings/ClearLoginImage").then(function(){e.isLoading=!1,e.siteInfo.publicSiteInfo.loginImageUrl="",e.loginImageUrl=""},function(t){e.isLoading=!1,alert("Failed to remove loading image: "+t.data.exceptionMessage)})},t.prototype.saveAllSettings=function(){var e=this;analytics.track("editSettings"),this.isLoading=!0,this.$http.put("/api/Settings",this.settings).then(function(){e.isLoading=!1,e.siteInfo.privateSiteInfo.homeRightColumnType=e.settings.homeRightColumnType,e.siteInfo.privateSiteInfo.welcomeMessage=e.settings.welcomeMessage,e.siteInfo.privateSiteInfo.ptaUnitId=e.settings.ptaUnitId;e.settings.fullName!==e.originalSettings.fullName&&location.reload()},function(t){e.isLoading=!1,alert("Failed to save: "+t.data)})},t.prototype.onImageClick=function(e){var t=this;this.settings.bgImageFileName=e;var i=this;this.$http.put("/api/Settings",{BGImageFileName:this.settings.bgImageFileName}).then(function(){$(".test-bg-image").removeClass("test-bg-image-selected"),i.isLoading=!1},function(e){t.isLoading=!1,alert("Failed to save: "+e.data)})},t.prototype.onImageHoverOver=function(e){},t.prototype.onImageHoverOut=function(){},t.prototype.onQaDeleteSite=function(){this.$http.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(e){alert("Failed to delete site: "+e.data.exceptionMessage)})},t.prototype.hookUpLoginImageUpload=function(){var e=this;$(function(){$("#JQLoginImageFileUploader").fileupload({autoUpload:!0,add:function(t,i){e.$scope.$apply(function(){e.isLoading=!0}),analytics.track("setLoginImage"),$("#FileUploadProgressContainer").show(),i.url="api/DocumentUpload/LoginImage?ApiAuthToken="+e.siteInfo.authToken;i.submit().done(function(t){e.$scope.$apply(function(){e.isLoading=!1,e.loginImageUrl=t.newUrl+"?cacheBreaker="+(new Date).getTime(),e.siteInfo.publicSiteInfo.loginImageUrl=e.loginImageUrl}),$("#FileUploadProgressContainer").hide()})},progressall:function(e,t){var i=Math.floor(100*t.loaded/t.total);$("#FileUploadProgressBar").css("width",i+"%"),100===i?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(i+"%")}})})},t.$inject=["$http","SiteInfo","$timeout","$scope"],t}();e.ChtnSettingsController=n}(Ally||(Ally={})),CA.angularApp.component("chtnSettings",{templateUrl:"/ngApp/chtn/manager/settings.html",controller:Ally.ChtnSettingsController});!function(e){var t=function(){function e(e,t){this.siteInfo=e,this.$routeParams=t,this.hideDocuments=!1,this.hideVendors=!1,this.showMaintenance=!1,this.showVendors=!0,this.faqMenuText="Info/FAQs","home"===AppConfig.appShortName&&(this.faqMenuText="Notes")}return e.prototype.$onInit=function(){this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideVendors="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName,this.showMaintenance="home"===AppConfig.appShortName||"condo"===AppConfig.appShortName||"hoa"===AppConfig.appShortName,this.showVendors="pta"!==AppConfig.appShortName,this.hideDocuments?this.selectedView="Info":this.selectedView="Docs",HtmlUtil.isValidString(this.$routeParams.viewName)&&(this.selectedView=this.$routeParams.viewName)},e.$inject=["SiteInfo","$routeParams"],e}();e.AssociationInfoController=t}(Ally||(Ally={})),CA.condoAllyControllers.directive("contenteditable",["$sce",function(e){return{restrict:"A",require:"?ngModel",link:function(t,i,n,o){o&&(o.$render=function(){i.html(e.getTrustedHtml(o.$viewValue||""))},i.on("blur keyup change",function(){t.$evalAsync(s)}),s());function s(){var e=i.html();n.stripBr&&"<br>"===e&&(e=""),o.$setViewValue(e)}}}}]),CA.angularApp.filter("highlight",["$sce",function(e){return function(t,i){return t=t||"",i&&(t=t.replace(new RegExp("("+i+")","gi"),'<span class="fileSearchHighlight">$1</span>')),e.trustAsHtml(t)}}]),CA.angularApp.component("associationInfo",{templateUrl:"/ngApp/chtn/member/association-info.html",controller:Ally.AssociationInfoController});!function(e){var t=function(){function t(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.$scope=o,this.showDiscussionThreads=!1,this.showLocalNews=!1,this.testPay_ShouldShow=!1,this.testPay_isValid=!1}return t.prototype.$onInit=function(){var t=this;this.testPay_ShouldShow="qa"===this.siteInfo.publicSiteInfo.shortName||"localtest"===this.siteInfo.publicSiteInfo.shortName,this.testPay_ShouldShow&&(this.testPay_ReturnUrl=window.location.href,this.testPay_IpnUrl=this.siteInfo.publicSiteInfo.baseUrl+"/api/PayPalIpn",this.testPay_UserFirst=this.siteInfo.userInfo.firstName,this.testPay_UserLast=this.siteInfo.userInfo.lastName,this.testPay_Description="Assessment for "+this.siteInfo.publicSiteInfo.fullName),this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.canMakePayment=this.siteInfo.privateSiteInfo.isPaymentEnabled&&!this.siteInfo.userInfo.isRenter,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.allyAppName=AppConfig.appName,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||""===this.homeRightColumnType||(this.homeRightColumnType="localnews"),this.siteInfo.privateSiteInfo.creationDate>e.SiteInfoService.AlwaysDiscussDate?(this.showDiscussionThreads=!0,this.showLocalNews=this.homeRightColumnType.indexOf("localnews")>-1):(this.showDiscussionThreads=this.homeRightColumnType.indexOf("chatwall")>-1,this.showLocalNews=this.homeRightColumnType.indexOf("localnews")>-1);HtmlUtil.getSubdomain(window.location.host);var i=this;this.$scope.$on("homeHasActivePolls",function(){return i.shouldShowAlertSection=!0}),this.$http.get("/api/Committee/MyCommittees",{cache:!0}).then(function(e){t.usersCommittees=e.data,t.usersCommittees&&(t.usersCommittees=_.sortBy(t.usersCommittees,function(e){return e.name.toLowerCase()}))})},t.prototype.onTestPayAmtChange=function(){this.testPay_isValid=this.testPay_Amt>5&&this.testPay_Amt<5e3},t.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},t.$inject=["$http","$rootScope","SiteInfo","$timeout","$scope"],t}();e.ChtnHomeController=t}(Ally||(Ally={})),CA.angularApp.component("chtnHome",{templateUrl:"/ngApp/chtn/member/chtn-home.html",controller:Ally.ChtnHomeController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e,i,n,o,s){this.$scope=e,this.$timeout=i,this.$http=n,this.siteInfo=o,this.appCacheService=s,this.editingTip=new t,this.hoaHomes=[],this.tips=[],this.isLoading=!1}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager;var e=void 0;if(this.siteInfo.publicSiteInfo.googleGpsPosition){e={bounds:new google.maps.Circle({center:this.siteInfo.publicSiteInfo.googleGpsPosition,radius:40234}).getBounds()}}var t=document.getElementById("edit-location-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(t,e);var i=this;google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var e=i.addressAutocomplete.getPlace();i.editingTip.address=e.formatted_address}),this.retrieveHoaHomes();i=this;this.$timeout(function(){return i.getWalkScore()},1e3),MapCtrlMapMgr.Init(this.siteInfo,this.$scope,this)},e.prototype.refresh=function(){var e=this;this.isLoading=!0,this.$http.get("/api/WelcomeTip").then(function(t){e.tips=t.data,MapCtrlMapMgr.ClearAllMarkers(),"condo"===AppConfig.appShortName&&MapCtrlMapMgr.AddMarker(MapCtrlMapMgr._homeGpsPos.lat(),MapCtrlMapMgr._homeGpsPos.lng(),"Home",MapCtrlMapMgr.MarkerNumber_Home,null);for(var i=0;i<e.tips.length;++i){var n=e.tips[i];null!==n.gpsPos&&(n.markerIndex=MapCtrlMapMgr.AddMarker(n.gpsPos.lat,n.gpsPos.lon,n.name,n.markerNumber,null))}_.each(e.hoaHomes,function(t){if(t.fullAddress&&t.fullAddress.gpsPos){var i=MapCtrlMapMgr.MarkerNumber_Home,n=t.name;_.any(e.siteInfo.userInfo.usersUnits,function(e){return e.unitId===t.unitId})&&(i=MapCtrlMapMgr.MarkerNumber_MyHome,n="Your home: "+n),MapCtrlMapMgr.AddMarker(t.fullAddress.gpsPos.lat,t.fullAddress.gpsPos.lon,n,i,t.unitId)}}),MapCtrlMapMgr.OnMarkersReady(),e.isLoading=!1})},e.prototype.onEditTip=function(e){this.editingTip=jQuery.extend({},e),window.scrollTo(0,document.body.scrollHeight)},e.prototype.onMoveMarker=function(e){MapCtrlMapMgr.SetMarkerDraggable(e.markerIndex,!0)},e.prototype.onDeleteTip=function(e){var t=this;confirm("Are you sure you want to delete this item?")&&(this.isLoading=!0,this.$http.delete("/api/WelcomeTip/"+e.itemId).then(function(){t.isLoading=!1,t.refresh()}))},e.prototype.onSaveTip=function(){var e=this;if(null!==this.editingTip){var i=function(){e.isLoading=!1,e.editingTip=new t,e.refresh()},n=function(t){e.isLoading=!1,alert("Failed to save item: "+t.data.exceptionMessage)};this.isLoading=!0,this.editingTip.itemId?this.$http.put("/api/WelcomeTip",this.editingTip).then(i,n):this.$http.post("/api/WelcomeTip",this.editingTip).then(i,n)}},e.prototype.isLocationTip=function(e){return null!==e.gpsPos},e.prototype.isNotLocationTip=function(e){return null===e.gpsPos},e.prototype.getMarkerIconUrl=function(e){var t="/assets/images/MapMarkers/";return t+=e>=1&&e<=10?"green_"+e:-2===e?"MapMarker_Home":-3===e?"MapMarker_Hospital":-4===e?"MapMarker_PostOffice":"green_blank",t+=".png"},e.prototype.updateItemGpsLocation=function(e,t,i){var n={itemId:_.find(this.tips,function(t){return t.markerIndex===e}).itemId,newLat:t,newLon:i};this.isLoading=!0;var o=this;this.$http.put("/api/WelcomeTip/UpdateGpsLocation",n).then(function(){o.isLoading=!1})},e.prototype.getWalkScore=function(){var e=function(e){e&&e.data&&"Error"!==e.data?$("#WalkScorePanel").html(e.data):($("#WalkScorePanel").html("Failed to load Walk Score."),$("#WalkScorePanel").hide())};this.$http.get("/api/WelcomeTip/GetWalkScore").then(e,e)},e.prototype.retrieveHoaHomes=function(){var e=this;this.$http.get("/api/BuildingResidents/FullUnits").then(function(t){if(t.data)if("condo"===AppConfig.appShortName){var i=_.filter(t.data,function(e){return e.addressId&&!!e.fullAddress});(i=_.filter(i,function(t){return t.fullAddress.oneLiner!=e.siteInfo.privateSiteInfo.groupAddress.oneLiner})).length>0&&(e.hoaHomes=t.data)}else"hoa"===AppConfig.appShortName&&(e.hoaHomes=t.data);e.refresh()},function(){e.refresh()})},e.$inject=["$scope","$timeout","$http","SiteInfo","appCacheService"],e}();e.ChtnMapController=i}(Ally||(Ally={})),CA.angularApp.component("chtnMap",{templateUrl:"/ngApp/chtn/member/chtn-map.html",controller:Ally.ChtnMapController});var MapCtrlMapMgr=function(){function e(){}return e.Init=function(t,i,n){if(e.ngScope=i,e.mapCtrl=n,"undefined"!=typeof google){e._homeGpsPos=t.publicSiteInfo.googleGpsPosition,e._groupGpsBounds=t.publicSiteInfo.gpsBounds;var o={center:e._homeGpsPos,zoom:25,mapTypeId:google.maps.MapTypeId.ROADMAP};e._mainMap=new google.maps.Map(document.getElementById("map_canvas"),o),"condo"===AppConfig.appShortName&&e.AddMarker(e._homeGpsPos.lat(),e._homeGpsPos.lng(),"Home",e.MarkerNumber_Home,null),e.OnMapReady()}},e.OnMapReady=function(){e._isMapReady=!0,e._areMarkersReady&&e.OnMapAndMarkersReady()},e.OnMarkersReady=function(){e._areMarkersReady=!0,e._isMapReady&&e.OnMapAndMarkersReady()},e.OnMapAndMarkersReady=function(){for(var t=0;t<e._tempMarkers.length;++t){var i=e._tempMarkers[t],n=null;n=i.markerNumber>=1&&i.markerNumber<=10?"/assets/images/MapMarkers/green_"+i.markerNumber+".png":i.markerNumber===e.MarkerNumber_Home?"/assets/images/MapMarkers/MapMarker_Home.png":i.markerNumber===e.MarkerNumber_Hospital?"/assets/images/MapMarkers/MapMarker_Hospital.png":i.markerNumber===e.MarkerNumber_PostOffice?"/assets/images/MapMarkers/MapMarker_PostOffice.png":i.markerNumber===e.MarkerNumber_MyHome?"/assets/images/MapMarkers/MapMarker_MyHome.png":"/assets/images/MapMarkers/green_blank.png";var o=new google.maps.Marker({position:new google.maps.LatLng(i.lat,i.lon),map:e._mainMap,animation:google.maps.Animation.DROP,title:i.name,icon:n});o.markerIndex=t,google.maps.event.addListener(o,"dragend",function(){var t=this,i=t.getPosition();e.ngScope.$apply(function(){e.mapCtrl.updateItemGpsLocation(t.markerIndex,i.lat(),i.lng())})}),i.unitId&&(o.unitId=i.unitId,o.addListener("click",function(t){return function(){e.mapCtrl.appCacheService.set("scrollToUnitId",t.unitId.toString()),window.location.hash="#!/BuildingResidents"}}(o))),e._markers.push(o)}if(e._tempMarkers=[],e._groupGpsBounds){var s={paths:Ally.MapUtil.gpsBoundsToGooglePoly(e._groupGpsBounds),map:e._mainMap,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1};e._groupBoundsShape=new google.maps.Polygon(s)}e.ZoomMapToFitMarkers()},e.ClearAllMarkers=function(){for(var t=0;t<e._markers.length;t++)e._markers[t].setMap(null);e._markers=[]},e.SetMarkerDraggable=function(t,i){e._markers[t].setDraggable(i)},e.AddMarker=function(t,i,n,o,s){return e._tempMarkers.push({lat:t,lon:i,name:n,markerNumber:o,unitId:s}),e._tempMarkers.length-1},e.ZoomMapToFitMarkers=function(){for(var t=new google.maps.LatLngBounds,i=0;i<e._markers.length;++i)t.extend(e._markers[i].getPosition());if(e._groupBoundsShape)for(var n=e._groupBoundsShape.getPath(),o=0;o<n.getLength();++o)t.extend(n.getAt(o));e._mainMap.fitBounds(t)},e._mainMap=null,e._homeGpsPos=null,e._groupGpsBounds=null,e._groupBoundsShape=null,e._markers=[],e.MarkerNumber_Home=-2,e.MarkerNumber_MyHome=-5,e.MarkerNumber_Hospital=-3,e.MarkerNumber_PostOffice=-4,e._isMapReady=!1,e._areMarkersReady=!1,e._tempMarkers=[],e.ngScope=null,e.mapCtrl=null,e}();!function(e){var t=function(){function t(t,i){this.$http=t,this.appCacheService=i,this.isLoading=!1,this.loginInfo=new e.LoginInfo,this.shouldHideControls=!1}return t.prototype.$onInit=function(){this.loginInfo.emailAddress=this.appCacheService.getAndClear("forgotEmail")},t.prototype.onSubmitEmail=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Login/Forgot",this.loginInfo).then(function(){e.shouldHideControls=!0,e.isLoading=!1,e.resultText="Please check your e-mail for updated login information.",e.resultTextColor="#00F"},function(t){e.isLoading=!1,e.resultText="Failed to process your request: "+t.data,e.resultTextColor="#F00"})},t.$inject=["$http","appCacheService"],t}();e.ForgotPasswordController=t}(Ally||(Ally={})),CA.angularApp.component("forgotPassword",{templateUrl:"/ngApp/chtn/member/forgot-password.html",controller:Ally.ForgotPasswordController});!function(e){var t=function(){function t(e,t,i){this.fellowResidents=e,this.siteInfo=t,this.appCacheService=i,this.isLoading=!0,this.emailLists=[],this.unitPrefix="Unit ",this.groupEmailDomain="",this.allyAppName=AppConfig.appName,this.groupShortName=HtmlUtil.getSubdomain(),this.showMemberList="neighborhood"===AppConfig.appShortName||"block-club"===AppConfig.appShortName||"pta"===AppConfig.appShortName,this.groupEmailDomain="inmail."+AppConfig.baseTld,this.unitPrefix="condo"===AppConfig.appShortName?"Unit ":""}return t.prototype.$onInit=function(){var t=this;this.fellowResidents.getByUnitsAndResidents().then(function(i){if(t.isLoading=!1,t.unitList=i.byUnit,t.allResidents=i.residents,t.committees=i.committees,!t.allResidents&&i.ptaMembers&&(t.allResidents=i.ptaMembers),t.allResidents=_.sortBy(t.allResidents,function(e){return e.lastName}),t.boardMembers=_.filter(t.allResidents,function(e){return 0!==e.boardPosition}),t.boardMessageRecipient=null,t.boardMembers.length>0){_.some(t.boardMembers,function(e){return e.hasEmail})&&(t.boardMessageRecipient={fullName:"Entire Board",firstName:"everyone on the board",hasEmail:!0,userId:"af615460-d92f-4878-9dfa-d5e4a9b1f488"})}"neighborhood"!==AppConfig.appShortName&&"block-club"!==AppConfig.appShortName||(t.allResidents=_.filter(t.allResidents,function(e){return 0===e.boardPosition}));for(var n=0;n<t.boardMembers.length;++n)t.boardMembers[n].boardPositionName=_.find(e.FellowResidentsService.BoardPositionNames,function(e){return e.id===t.boardMembers[n].boardPosition}).name;var o=[1,64,16,2,4,8,32];t.boardMembers=_.sortBy(t.boardMembers,function(e){var t=_.indexOf(o,e.boardPosition);return-1===t&&(t=100),t});if(t.allOwners=_.reduce(t.unitList,function(e,t){return Array.prototype.push.apply(e,t.owners),e},[]),t.allOwners=_.map(_.groupBy(t.allOwners,function(e){return e.email}),function(e){return e[0]}),t.allOwnerEmails=_.reduce(t.allOwners,function(e,t){return HtmlUtil.isValidString(t.email)&&e.push(t.email),e},[]),t.unitList&&t.unitList.length>0){if(_.every(t.unitList,function(e){return HtmlUtil.isNumericString(e.name)}))t.unitList=_.sortBy(t.unitList,function(e){return+e.name});else{var s=t.unitList[0].name.substr(t.unitList[0].name.indexOf(" ")),a=_.every(t.unitList,function(t){return e.HtmlUtil2.startsWithNumber(t.name)}),r=_.every(t.unitList,function(e){return HtmlUtil.endsWith(e.name,s)});if(a&&r)t.unitList=_.sortBy(t.unitList,function(e){return parseInt(e.name.substr(0,e.name.indexOf(" ")))});else if(a){t.unitList=_.sortBy(t.unitList,function(e){return[(t=e.name,t.substring(t.search(/\s/)+1)),parseInt(e.name.substr(0,e.name.search(/\s/)))];var t})}}}t.committees&&(t.committees=_.sortBy(t.committees,function(e){return e.committeeName.toLowerCase()}));var l=t.appCacheService.getAndClear("scrollToUnitId");if(l){var d="unit-id-"+l;setTimeout(function(){document.getElementById(d).scrollIntoView(),$("#"+d).effect("pulsate",{times:3},2e3)},300)}t.setupGroupEmails()},function(e){alert("Failed to retrieve group members. Please let tech support know via the contact form in the bottom right.")})},t.prototype.updateMemberFilter=function(){angular.lowercase(this.memberSearchTerm)},t.prototype.setupGroupEmails=function(){var t=this;this.hasMissingEmails=_.some(this.allResidents,function(e){return!e.hasEmail});this.fellowResidents.getGroupEmailObject().then(function(i){t.emailLists=i,setTimeout(function(){var t=new Clipboard(".clipboard-button");t.on("success",function(t){e.HtmlUtil2.showTooltip(t.trigger,"Copied!"),t.clearSelection()}),t.on("error",function(t){e.HtmlUtil2.showTooltip(t.trigger,"Auto-copy failed, press CTRL+C now")})},750)})},t.$inject=["fellowResidents","SiteInfo","appCacheService"],t}();e.GroupMembersController=t}(Ally||(Ally={})),CA.angularApp.component("groupMembers",{templateUrl:"/ngApp/chtn/member/group-members.html",controller:Ally.GroupMembersController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e,i){this.$http=e,this.siteInfo=i,this.sendInfo=new t,this.isLoading=!1,this.wasMessageSent=!1,this.onSendHelp=function(){if($("#help-form").validate(),$("#help-form").valid()){this.isLoading=!0;var e=this;this.$http.post("/api/Help",this.sendInfo).then(function(){e.isLoading=!1,e.sendInfo={},e.wasMessageSent=!0,e.resultStyle.color="#00F",e.sendResult="Your message has been sent. We'll do our best to get back to you within 24 hours."},function(){e.isLoading=!1,e.resultStyle.color="#F00",e.sendResult="Failed to send message."})}},this.resultStyle={"text-align":"center","font-size":"large","font-weight":"bold"}}return e.prototype.$onInit=function(){this.siteInfo.isLoggedIn&&(this.sendInfo.emailAddress=this.siteInfo.userInfo.emailAddress)},e.$inject=["$http","SiteInfo"],e}();e.HelpFormController=i}(Ally||(Ally={})),CA.angularApp.component("helpForm",{templateUrl:"/ngApp/chtn/member/Help.html",controller:Ally.HelpFormController});!function(e){var t=function(){function e(e,t,i,n,o,s,a){this.$scope=e,this.$timeout=t,this.$http=i,this.$rootScope=n,this.$q=o,this.fellowResidents=s,this.siteInfo=a,this.showBadNotificationDateWarning=!1,this.isLoadingNews=!1,this.isLoadingLogbookForCalendar=!1,this.isLoadingPolls=!1,this.isLoadingCalendarEvents=!1,this.onlyRefreshCalendarEvents=!1,this.showExpandedCalendarEventModel=!1,this.currentTimeZoneAbbreviation="CT",this.localTimeZoneDiffersFromGroup=!1,this.onResidentClicked=function(e){if(!e.hasEmail)return alert("That user cannot be included because they do not have an e-mail address on file."),void(e.isAssociated=!1);_.contains(this.editEvent.associatedUserIds,e.userId)?this.editEvent.associatedUserIds=_.without(this.editEvent.associatedUserIds,e.userId):this.editEvent.associatedUserIds.push(e.userId)},this.clearViewEvent=function(){this.viewEvent=null}}return e.prototype.$onInit=function(){var t=this,i=moment(),n=moment.tz.guess();this.currentTimeZoneAbbreviation=i.tz(n).format("z"),this.siteInfo.privateSiteInfo.groupAddress&&this.siteInfo.privateSiteInfo.groupAddress.timeZoneIana&&(this.groupTimeZoneAbbreviation=i.tz(this.siteInfo.privateSiteInfo.groupAddress.timeZoneIana).format("z"),this.groupTimeZoneAbbreviation!=this.currentTimeZoneAbbreviation&&(this.localTimeZoneDiffersFromGroup=!0)),AppConfig.isChtnSite&&this.fellowResidents.getResidents().then(function(e){t.residents=e,t.residents=_.sortBy(t.residents,function(e){return e.lastName})});var o=this,s={height:600,editable:!1,header:{left:"prevYear prev next nextYear today",center:"title",right:"month listYear"},viewRender:function(e,t){$(t).css("cursor","pointer")},dayClick:function(t){if(o.$rootScope.isSiteManager){var i=moment(moment.utc(t).format(e.DateFormat)).toDate();o.$scope.$apply(function(){var e={date:i,dateOnly:i,associatedUserIds:[],notificationEmailDaysBefore:null};o.setEditEvent(e,!1)})}},eventClick:function(e){o.$scope.$apply(function(){e.calendarEventObject&&(o.$rootScope.isSiteManager?o.setEditEvent(e.calendarEventObject,!0):o.viewEvent=e.calendarEventObject)})},eventRender:function(e,t){$(t).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:e.fullDescription,title:e.toolTipTitle}})},eventSources:[{events:function(e,t,i,n){o.getAssociationEvents(e,t,i,n)}},{events:function(e,t,i,n){o.getCalendarEvents(e,t,i,n)}}]};$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(s),$("#calendar-event-time").timepicker({scrollDefault:"10:00am"}),$(".fc-bg td.fc-today").append("<div class='today-note'>Today</div>")})},e.prototype.getAllEvents=function(t,i){var n=this,o=AppConfig.isChtnSite,s=t.format(e.DateFormat),a=i.format(e.DateFormat),r=this.$q.defer(),l=this.$q.defer(),d=this.$q.defer();r.resolve(),this.isLoadingLogbookForCalendar=!0;var p=this;return this.$http.get("/api/Logbook?startDate="+s+"&endDate="+a).then(function(e){var t=e.data;p.isLoadingLogbookForCalendar=!1,_.each(t,function(e){var t=e.text;t.length>10&&(t=t.substring(0,10)+"...");var i="Posted by: "+e.authorName+"<br><p>"+e.text+"</p>";p.calendarEvents.push({title:"Logbook: "+t,start:moment(e.postDate).format("YYYY-MM-DD"),toolTipTitle:"Logbook Entry Added",fullDescription:i})}),l.resolve()},function(){p.isLoadingLogbookForCalendar=!1,l.resolve()}),o?(this.isLoadingPolls=!0,this.$http.get("/api/Poll?startDate="+s+"&endDate="+a).then(function(e){var t=e.data;n.isLoadingPolls=!1,_.each(t,function(e){var t=e.text;t.length>10&&(t=t.substring(0,10)+"...");var i="Posted by: "+e.authorName+"<br><p>"+e.text+"</p>";n.calendarEvents.push({title:"Poll: "+t,start:moment(e.postDate).format("YYYY-MM-DD"),toolTipTitle:"Poll Added",fullDescription:i})}),d.resolve()},function(){n.isLoadingPolls=!1,d.resolve()})):d.resolve(),this.$q.all([r.promise,l.promise,d.promise])},e.prototype.getAssociationEvents=function(e,t,i,n){if(this.onlyRefreshCalendarEvents)return this.onlyRefreshCalendarEvents=void 0,void n(this.calendarEvents);this.calendarEvents=[];var o=this;this.getAllEvents(e,t).then(function(){n(o.calendarEvents)})},e.prototype.getCalendarEvents=function(t,i,n,o){this.isLoadingCalendarEvents=!0;var s=t.format(e.DateFormat),a=i.format(e.DateFormat),r=this;this.$http.get("/api/CalendarEvent?startDate="+s+"&endDate="+a).then(function(t){var i=t.data,n=[];r.isLoadingCalendarEvents=!1,_.each(i,function(t){var i,o=moment.utc(t.eventDateUtc),s=o.format(e.TimeFormat)==e.NoTime;if(s)t.timeOnly="",t.dateOnly=new Date(o.year(),o.month(),o.date()),i=new Date(o.year(),o.month(),o.date());else{var a=moment.utc(t.eventDateUtc).local();t.timeOnly=a.format(e.TimeFormat),t.dateOnly=a.clone().startOf("day").toDate(),i=a.toDate()}var r=t.title;r&&r.length>10&&(r=r.substring(0,10)+"...");var l="Posted by: "+t.authorName+"<br><p>"+t.title+"</p>";n.push({title:r,start:i,toolTipTitle:"Event",fullDescription:l,calendarEventObject:t,allDay:s})}),o(n)},function(){r.isLoadingCalendarEvents=!1})},e.prototype.isUserAssociated=function(e){return!(!this.editEvent||!this.editEvent.associatedUserIds)&&_.contains(this.editEvent.associatedUserIds,e)},e.prototype.isDateInPast=function(e){var t=moment(e),i=moment();return t.isBefore(i,"day")||t.isSame(i,"day")},e.prototype.onShouldSendChange=function(){this.editEvent.shouldSendNotification&&this.isDateInPast(this.editEvent.dateOnly)&&(this.editEvent.shouldSendNotification=!1)},e.prototype.onChangeEmailDaysBefore=function(){var e=moment(this.editEvent.dateOnly).subtract(this.editEvent.notificationEmailDaysBefore,"day"),t=moment();if(this.showBadNotificationDateWarning=e.isBefore(t,"day")||e.isSame(t,"day"),this.showBadNotificationDateWarning){this.maxDaysBack=moment(this.editEvent.dateOnly).diff(t,"day"),this.editEvent.notificationEmailDaysBefore=this.maxDaysBack;var i=this;this.$timeout(function(){i.showBadNotificationDateWarning=!1},1e4)}},e.prototype.expandCalendarEventModel=function(){this.showExpandedCalendarEventModel=!0},e.prototype.setEditEvent=function(e,t){var i=this;this.showExpandedCalendarEventModel=t||!1,this.editEvent=e,this.showBadNotificationDateWarning=!1,this.editEvent&&(this.residents&&_.each(this.residents,function(e){return e.isAssociated=i.isUserAssociated(e.userId)}),this.editEvent.shouldSendNotification=null!==this.editEvent.notificationEmailDaysBefore,setTimeout(function(){$("#calendar-event-title").focus()},10))},e.prototype.deleteCalendarEvent=function(e){var t=this;confirm("Are you sure you want to remove this event?")&&(this.isLoadingCalendarEvents=!0,this.$http.delete("/api/CalendarEvent?eventId="+e).then(function(){t.isLoadingCalendarEvents=!1,t.editEvent=null,t.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){t.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")}))},e.prototype.saveCalendarEvent=function(){var t=this;if(this.residents){var i=_.filter(this.residents,function(e){return e.isAssociated});this.editEvent.associatedUserIds=_.map(i,function(e){return e.userId})}var n="";"string"==typeof this.editEvent.timeOnly&&this.editEvent.timeOnly.length>1?(n=moment(this.editEvent.dateOnly).format(e.DateFormat)+" "+this.editEvent.timeOnly,this.editEvent.eventDateUtc=moment(n,e.DateFormat+" "+e.TimeFormat).utc().toDate()):(n=moment(this.editEvent.dateOnly).format(e.DateFormat)+" "+e.NoTime,this.editEvent.eventDateUtc=moment.utc(n,e.DateFormat+" "+e.TimeFormat).toDate()),this.editEvent.shouldSendNotification||(this.editEvent.notificationEmailDaysBefore=null);var o;o=this.editEvent.eventId?this.$http.put:this.$http.post,analytics.track("addCalendarEvent"),this.isLoadingCalendarEvents=!0,o("/api/CalendarEvent",this.editEvent).then(function(){t.isLoadingCalendarEvents=!1,t.editEvent=null,t.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(e){t.isLoadingCalendarEvents=!1;var i=e.data.exceptionMessage?e.data.exceptionMessage:e.data;alert("Failed to save the calendar event: "+i)})},e.$inject=["$scope","$timeout","$http","$rootScope","$q","fellowResidents","SiteInfo"],e.DateFormat="YYYY-MM-DD",e.TimeFormat="h:mma",e.NoTime="12:37am",e}();e.LogbookController=t}(Ally||(Ally={})),CA.angularApp.component("logbookPage",{templateUrl:"/ngApp/chtn/member/logbook.html",controller:Ally.LogbookController});!function(e){var t=function(){return function(){this.emailAddress="",this.password=""}}();e.LoginInfo=t;var i=function(){function e(e,i,n,o,s,a){this.$http=e,this.$rootScope=i,this.$location=n,this.appCacheService=o,this.siteInfo=s,this.xdLocalStorage=a,this.isDemoSite=!1,this.loginInfo=new t}return e.prototype.$onInit=function(){HtmlUtil.isLocalStorageAllowed()||(this.loginResult="You have cookies/local storage disabled. Condo Ally requires these features, please enable to continue. You may be in private browsing mode.");var e=navigator.userAgent.toLowerCase(),t=-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):0;t>0&&t<10&&(document.getElementById("bad-browser-panel").style.display="block"),this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),"1"===HtmlUtil.GetQueryStringParameter("s")&&(this.isDemoSite=!1),this.loginImageUrl=this.siteInfo.publicSiteInfo.loginImageUrl,this.sectionStyle={position:"relative"},this.isDemoSite||(this.loginImageUrl?(this.sectionStyle["max-width"]="760px",this.sectionStyle["margin-left"]="auto",this.sectionStyle["margin-right"]="auto"):(this.sectionStyle["max-width"]="500px",this.sectionStyle["margin-left"]="auto",this.sectionStyle["margin-right"]="auto")),"true"===this.appCacheService.getAndClear(this.appCacheService.Key_WasLoggedIn403)?this.$rootScope.isSiteManager?this.loginResult="You are not authorized to perform that action. Please contact support.":this.loginResult="You are not authorized to perform that action. Please contact an admin.":"true"===this.appCacheService.getAndClear(this.appCacheService.Key_WasLoggedIn401)&&(this.loginResult="Please login first."),setTimeout(function(){$("#login-email-textbox").focus()},200)},e.prototype.onForgotPassword=function(){this.appCacheService.set("forgotEmail",this.loginInfo.emailAddress),this.$location.path("/ForgotPassword")},e.prototype.demoLogin=function(){this.loginInfo={emailAddress:"testuser",password:"demosite"},this.onLogin()},e.prototype.onLogin=function(){this.isLoading=!0;var e=this;this.$http.post("/api/Login",this.loginInfo).then(function(t){e.isLoading=!1;var i=t.data,n=e.appCacheService.getAndClear(e.appCacheService.Key_AfterLoginRedirect);e.siteInfo.setAuthToken(i.authToken),e.siteInfo.handleSiteInfo(i.siteInfo,e.$rootScope),e.rememberMe?(window.localStorage.rememberMe_Email=e.loginInfo.emailAddress,window.localStorage.rememberMe_Password=btoa(e.loginInfo.password)):(window.localStorage.rememberMe_Email=null,window.localStorage.rememberMe_Password=null),null!==i.siteInfo.userInfo.acceptedTermsDate||e.isDemoSite?(HtmlUtil.isValidString(n)||"/Login"===n||(n="/Home"),e.$location.path(n)):e.$location.path("/MyProfile")},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;e.loginResult="Failed to log in: "+i})},e.$inject=["$http","$rootScope","$location","appCacheService","SiteInfo","xdLocalStorage"],e}();e.LoginController=i}(Ally||(Ally={})),CA.angularApp.component("loginPage",{templateUrl:"/ngApp/chtn/member/login.html",controller:Ally.LoginController});__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}();e.SimpleUserEntry=t;var i=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(t);e.SimpleUserEntryWithTerms=i;!function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}}(i);var n=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(t);e.PtaMember=n;var o=function(){function e(e,t,i,n,o,s){this.$rootScope=e,this.$http=t,this.$location=i,this.appCacheService=n,this.siteInfo=o,this.$scope=s,this.showPassword=!1,this.shouldShowPassword=!1,this.selectedProfileView="Primary"}return e.prototype.$onInit=function(){var e=this;this.isDemoSite="demosite"===HtmlUtil.getSubdomain(),this.siteInfo.privateSiteInfo&&(this.canHideContactInfo=this.siteInfo.privateSiteInfo.canHideContactInfo),this.retrieveProfileData();setTimeout(function(){$("#JQFileUploader").fileupload({beforeSend:function(t,i){t.setRequestHeader("Authorization","Bearer "+e.siteInfo.authToken)},add:function(t,i){i.url="api/DocumentUpload/ProfileImage?ApiAuthToken="+e.siteInfo.authToken,e.$scope.$apply(function(){return e.isLoading=!0}),i.submit().done(function(t){e.$scope.$apply(function(){window.location.reload()})})},fail:function(t,i){e.$scope.$apply(function(){e.isLoading=!1,alert("Upload Failed: "+i.jqXHR.responseJSON.exceptionMessage)})}})},500)},e.prototype.saveProfilePhoto=function(e){var t=this;"upload"!==this.initialProfileImageType||confirm("Are you sure you want to change your profile image away from your uploaded photo? Your uploaded photo will be deleted.")?(this.isLoading=!0,this.$http.put("/api/MyProfile/ProfileImage?type="+e,null).then(function(){t.isLoading=!1,t.initialProfileImageType=t.profileImageType},function(e){t.isLoading=!1,alert("Failed to save: "+e.data.exceptionMessage)})):this.profileImageType=this.initialProfileImageType},e.prototype.onShowPassword=function(){document.getElementById("passwordTextBox").type=this.shouldShowPassword?"text":"password"},e.prototype.retrieveProfileData=function(){var e=this;this.isLoading=!0,this.$http.get("/api/MyProfile").then(function(t){e.isLoading=!1,e.profileInfo=t.data,e.initialProfileImageType="blank",e.profileInfo.avatarUrl&&-1===e.profileInfo.avatarUrl.indexOf("blank-headshot")?e.profileInfo.avatarUrl&&-1!==e.profileInfo.avatarUrl.indexOf("gravatar")?e.initialProfileImageType="gravatar":e.profileInfo.avatarUrl&&e.profileInfo.avatarUrl.length>0&&(e.initialProfileImageType="upload"):e.initialProfileImageType="blank","upload"!==e.initialProfileImageType&&(e.profileInfo.avatarUrl=null),e.profileImageType=e.initialProfileImageType,e.gravatarUrl="https://www.gravatar.com/avatar/"+md5((e.profileInfo.email||"").toLowerCase())+"?s=80&d=identicon",HtmlUtil.endsWith(e.profileInfo.email,"@condoally.com")&&(e.profileInfo.email=""),e.needsToAcceptTerms=null===e.profileInfo.acceptedTermsDate&&!e.isDemoSite,e.hasAcceptedTerms=!e.needsToAcceptTerms,e.$rootScope.hideMenu=e.needsToAcceptTerms,e.saveButtonStyle={width:"100px","font-size":"1em"}})},e.prototype.onSaveInfo=function(){var e=this;this.isLoading=!0,this.$http.put("/api/MyProfile",this.profileInfo).then(function(){e.resultMessage="Your changes have been saved.",e.$rootScope.hideMenu&&(e.$rootScope.hideMenu=!1,e.$location.path("/Home")),e.isLoading=!1},function(t){e.isLoading=!1,alert("Failed to save: "+t.data.exceptionMessage)})},e.$inject=["$rootScope","$http","$location","appCacheService","SiteInfo","$scope"],e}();e.MyProfileController=o}(Ally||(Ally={})),CA.angularApp.component("myProfile",{templateUrl:"/ngApp/chtn/member/my-profile.html",controller:Ally.MyProfileController});!function(e){var t=function(){function e(e,t,i,n){this.$scope=e,this.$http=t,this.$timeout=i,this.WizardHandler=n,this.unitNumberingType="Numbered",this.numUnits=3,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.shouldShowHoaMessage=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.signUpInfo={buildings:[{units:[]}],signerUpInfo:{buildingIndex:0,boardPositionValue:"1"}}}return e.prototype.$onInit=function(){var e=this;this.$timeout(function(){e.init()},500)},e.prototype.onNumUnitsChanged=function(){if(this.numUnits){this.numUnits<1?this.numUnits=1:this.numUnits>100&&(this.numUnits=100);var e=this.numUnits-this.signUpInfo.buildings[0].units.length;if(this.signUpInfo.buildings[0].units.length=this.numUnits,e>0)for(var t=this.numUnits-e;t<this.numUnits;++t)this.signUpInfo.buildings[0].units[t]={name:this.getUnitName(t),residents:[{}]}}},e.prototype.onAssociationNameChanged=function(){this.signUpInfo&&this.signUpInfo.name?this.shouldShowHoaMessage=-1!==this.signUpInfo.name.toLowerCase().indexOf("hoa")||-1!==this.signUpInfo.name.toLowerCase().indexOf("home"):this.shouldShowHoaMessage=!1},e.prototype.addResident=function(e){e.residents||(e.residents=[]),e.residents.push({})},e.prototype.getUnitName=function(e){if("Numbered"===this.unitNumberingType)return(e+1).toString();if("Lettered"===this.unitNumberingType){var t="",i=Math.floor(e/26);i>0&&(t+=String.fromCharCode("A".charCodeAt(0)+(i-1)));var n=e%26;return t+=String.fromCharCode("A".charCodeAt(0)+n)}return"EW"===this.unitNumberingType||"NS"===this.unitNumberingType?e%2==0?(e/2+1).toString()+("EW"===this.unitNumberingType?"E":"N"):Math.ceil(e/2).toString()+("EW"===this.unitNumberingType?"W":"S"):(e+1).toString()},e.prototype.onNumberingTypeChange=function(){for(var e=0;e<this.signUpInfo.buildings[0].units.length;++e)this.signUpInfo.buildings[0].units[e]||(this.signUpInfo.buildings[0].units[e]={}),this.signUpInfo.buildings[0].units[e].name=this.getUnitName(e)},e.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},e.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},e.prototype.init=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted",{category:"SignUp",label:"Started"});var e=document.getElementById("address-map");this.map=new google.maps.Map(e,{center:{lat:41.869638,lng:-87.657423},zoom:9});var t=document.getElementById("building-0-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(t),this.addressAutocomplete.bindTo("bounds",this.map),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"});var i=this;this.addressAutocomplete.addListener("place_changed",function(){i.setPlaceWasSelected(),i.mapMarker.setVisible(!1);var e=i.addressAutocomplete.getPlace(),t=e.formatted_address;t.indexOf(", USA")===t.length-", USA".length&&(t=t.substring(0,t.length-", USA".length)),i.signUpInfo.buildings[0].streetAddress=t,HtmlUtil.isNullOrWhitespace(i.signUpInfo.name)&&i.$scope.$apply(function(){i.signUpInfo.name=e.name+" Condo Association"}),e.geometry&&(i.centerMap(e.geometry),$("#association-name-text-box").focus())}),i.onNumUnitsChanged()},e.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForBuildingAddress())},e.prototype.refreshMapForBuildingAddress=function(){this.isLoadingMap=!0;var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.buildings[0].streetAddress,function(t,i){e.$scope.$apply(function(){if(e.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;if(n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.buildings[0].streetAddress=n,e.centerMap(t[0].geometry),HtmlUtil.isNullOrWhitespace(e.signUpInfo.name)){var o=HtmlUtil.getStringUpToFirst(n,",");e.signUpInfo.name=o+" Condo Association"}}})})},e.prototype.addBuilding=function(){this.signUpInfo.buildings.length+1>=25?alert("We do not support more than 25 buildings."):this.signUpInfo.buildings.push({})},e.prototype.onFinishedWizard=function(){this.isLoading=!0;var e=this;this.$http.post("/api/SignUpWizard",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete",{category:"SignUp",label:"Success"}),HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl):(alert("Failed to complete sign-up: "+i.errorMessage),e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to complete sign-up: "+i)})},e.$inject=["$scope","$http","$timeout","WizardHandler"],e}();e.CondoSignUpWizardController=t}(Ally||(Ally={})),CA.angularApp.component("condoSignUpWizard",{templateUrl:"/ngApp/chtn/public/condo-sign-up-wizard.html",controller:Ally.CondoSignUpWizardController});!function(e){var t=function(){return function(){}}();e.DiscussionThread=t;var i=function(){function e(e,t){this.$http=e,this.$routeParams=t,this.isLoading=!1,this.activeView="loading"}return e.prototype.$onInit=function(){this.unsubscribeUser()},e.prototype.loadDiscussion=function(){var e=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0;var t=this;this.$http.get("/Discussion/"+e).then(function(e){t.isLoading=!1,t.discussion=e.data},function(e){t.isLoading=!1,t.errorMessage="Failed to find the discussion details. Please contact support to alert them to the issue."})},e.prototype.unsubscribeUser=function(){var e=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0,this.activeView="loading";var t=this;this.$http.put("/api/Discussion/Unsubscribe/"+e,null).then(function(e){t.isLoading=!1,t.activeView="unsubscribed",t.discussion=e.data},function(e){t.isLoading=!1,t.activeView="error",t.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},e.prototype.resubscribeUser=function(){var e=decodeURIComponent(this.$routeParams.idValue);this.isLoading=!0,this.activeView="loading";var t=this;this.$http.put("/api/Discussion/Resubscribe/"+e,null).then(function(e){t.isLoading=!1,t.activeView="resubscribed"},function(e){t.isLoading=!1,t.activeView="error",t.errorMessage="Failed to unsubscribe you from the discussion due to a server error."})},e.$inject=["$http","$routeParams"],e}();e.DiscussionManageController=i}(Ally||(Ally={})),CA.angularApp.component("discussionManage",{templateUrl:"/ngApp/chtn/public/discussion-manage.html",controller:Ally.DiscussionManageController});!function(e){var t=function(){function e(e,t){this.$http=e,this.$routeParams=t,this.isLoading=!1,this.showButtons=!0}return e.prototype.$onInit=function(){this.boardEmail="board."+HtmlUtil.getSubdomain()+"@inmail."+AppConfig.baseTld},e.prototype.reportAbuse=function(e){if("not-member"!==e||confirm("You should reach out to the board rather than contact technical support. Click 'OK' to still proceed with contacting technical support anyway.")){var t={abuseReason:e,idVal:decodeURIComponent(this.$routeParams.idValue),otherReasonText:this.otherReasonText};this.isLoading=!0;var i=this;this.$http.post("/api/EmailAbuse/v3",t).then(function(){i.isLoading=!1,i.showButtons=!1})}},e.$inject=["$http","$routeParams"],e}();e.EmailAbuseController=t}(Ally||(Ally={})),CA.angularApp.component("emailAbuse",{templateUrl:"/ngApp/chtn/public/email-abuse.html",controller:Ally.EmailAbuseController});!function(e){var t=function(){return function(){this.boardPositionValue=1}}();e.HoaSignerUpInfo=t;var i=function(){return function(){this.name="",this.streetAddress="",this.isResident=!0,this.signerUpInfo=new t}}();e.HoaSignUpInfo=i;var n=function(){function t(t,i,n,o){this.$scope=t,this.$http=i,this.$timeout=n,this.WizardHandler=o,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.shouldShowCondoMessage=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.hoaPoly={vertices:[]},this.showMap=!1,this.didSignUpForHoaAlert=!1,this.signUpInfo=new e.HoaSignUpInfo}return t.prototype.$onInit=function(){var e=this;this.$scope.$on("wizard:stepChanged",function(t,i){1===i.index?e.$timeout(function(){return e.showMap=!0},50):e.showMap=!1})},t.prototype.onHoaNameChanged=function(){if(this.signUpInfo&&this.signUpInfo.name){var e=-1!==this.signUpInfo.name.toLowerCase().indexOf("condo");e&&!this.shouldShowCondoMessage&&$("#suggestCondoMessageLabel").css("font-size","1.3em").css("margin","25px auto").fadeIn(200).fadeOut(200).fadeIn(200).fadeOut(200).fadeIn(200),this.shouldShowCondoMessage=e}else this.shouldShowCondoMessage=!1},t.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},t.prototype.initMapStep=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted"),this.showMap=!0;var e=document.getElementById("association-address-text-box");if(e&&(this.addressAutocomplete=new google.maps.places.Autocomplete(e),this.addressAutocomplete.bindTo("bounds",this.map)),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this.addressAutocomplete){var t=this,i=function(){t.setPlaceWasSelected(),t.mapMarker.setVisible(!1);var e=t.addressAutocomplete.getPlace(),i=e.formatted_address;i.indexOf(", USA")===i.length-", USA".length&&(i=i.substring(0,i.length-", USA".length)),t.signUpInfo.streetAddress=i,e.geometry&&(t.setEditPolyForAddress(e.geometry.location),t.centerMap(e.geometry))};this.addressAutocomplete.addListener("place_changed",function(){t.$scope.$apply(i)})}},t.prototype.onMapEditorReady=function(e){this.map=e,this.initMapStep()},t.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForAddress())},t.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},t.prototype.setEditPolyForAddress=function(e){this.hoaPoly={vertices:[{lat:e.lat()-.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()+.0014},{lat:e.lat()-.001,lon:e.lng()+.0014}]}},t.prototype.refreshMapForAddress=function(){this.isLoadingMap=!0;var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){e.$scope.$apply(function(){if(e.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.streetAddress=n,t[0].geometry&&(e.setEditPolyForAddress(t[0].geometry.location),e.centerMap(t[0].geometry))}})})},t.prototype.onFinishedWizard=function(){this.isLoading=!0,this.signUpInfo.boundsGpsVertices=this.hoaPoly.vertices;var e=this;this.$http.post("/api/SignUpWizard/Hoa",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete"),void 0!==window.goog_report_conversion&&window.goog_report_conversion(),void 0!==window.capterra_report_conversion&&window.capterra_report_conversion(),HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl):(alert("Failed to complete sign-up: "+i.errorMessage),e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1,alert("Failed to complete sign-up: "+t.data.exceptionMessage)})},t.prototype.submitEmailForHoaNotify=function(){var e=this;HtmlUtil.isNullOrWhitespace(this.hoaAlertEmail)?alert("Please enter a valid e-mail address"):(this.isLoading=!0,this.$http.get("/api/PublicEmail/SignUpForHoaAllyAlert?email="+encodeURIComponent(this.hoaAlertEmail)+"&numHomes="+encodeURIComponent(this.hoaAlertNumHomes)).then(function(t){e.isLoading=!1,e.didSignUpForHoaAlert=!0},function(t){e.isLoading=!1,alert("Failed to submit: "+t.data.exceptionMessage)}))},t.$inject=["$scope","$http","$timeout","WizardHandler"],t}();e.HoaSignUpWizardController=n}(Ally||(Ally={})),CA.angularApp.component("hoaSignUpWizard",{templateUrl:"/ngApp/chtn/public/hoa-sign-up-wizard.html",controller:Ally.HoaSignUpWizardController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e,i){this.$http=e,this.siteInfo=i,this.isLoading=!1,this.signUpInfo=new t,this.resultIsError=!1}return e.prototype.$onInit=function(){var e=this;setTimeout(function(){var t=void 0;if(e.siteInfo.publicSiteInfo.googleGpsPosition){t={bounds:new google.maps.Circle({center:e.siteInfo.publicSiteInfo.googleGpsPosition,radius:40234}).getBounds()}}var i=document.getElementById("address-text-box");new google.maps.places.Autocomplete(i,t)},750)},e.prototype.onSubmitInfo=function(){if(HtmlUtil.isNullOrWhitespace(this.signUpInfo.emailAddress))alert("Please enter an e-mail address");else{this.isLoading=!0;var e=this;this.$http.post("/api/NeighborSignUp/SignUpNewUser",this.signUpInfo).then(function(t){e.isLoading=!1,e.resultIsError=!1,e.resultMessage="Your information has been successfully submitted. Look for a welcome email soon."},function(){e.isLoading=!1,e.resultIsError=!0,e.resultMessage="There was an error submitting your information. Please try again."})}},e.prototype.goBack=function(){this.resultMessage=null},e.$inject=["$http"],e}();e.NeighborSignUpController=i}(Ally||(Ally={})),CA.angularApp.component("neighborSignUp",{templateUrl:"/ngApp/chtn/public/neighbor-sign-up.html",controller:Ally.NeighborSignUpController});!function(e){var t=function(){return function(){this.fullName="",this.email="",this.address="",this.neighborhoodName="",this.notes=""}}(),i=function(){function i(i,n,o,s){this.$scope=i,this.$http=n,this.$timeout=o,this.WizardHandler=s,this.placeWasSelected=!1,this.shouldCheckAddress=!1,this.isLoading=!1,this.map=null,this.isLoadingMap=!1,this.hideWizard=!1,this.hoaPoly={vertices:[]},this.showMap=!1,this.tempSignUpInfo=new t,this.signUpInfo=new e.HoaSignUpInfo}return i.prototype.$onInit=function(){var e=this;e=this;this.$scope.$on("wizard:stepChanged",function(t,i){1===i.index?e.$timeout(function(){return e.showMap=!0},50):e.showMap=!1}),setTimeout(function(){var e=document.getElementById("signUpAddress");e&&new google.maps.places.Autocomplete(e)},500)},i.prototype.onSubmitTempInfo=function(){this.isLoading=!0;var e=this;this.$http.post("/api/SignUpWizard/TempNeighborhood",this.tempSignUpInfo).then(function(){e.isLoading=!1,e.submitTempResult="Thank you for your submission. We'll be in touch shortly."},function(t){e.isLoading=!1,e.submitTempResult="Submission failed: "+t.data.exceptionMessage+". Feel free to refresh the page to try again or use the contact form at the bottom of the Community Ally home page."})},i.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},i.prototype.initMapStep=function(){void 0!==window.analytics&&window.analytics.track("condoSignUpStarted"),this.showMap=!0;var e=document.getElementById("association-address-text-box");if(e&&(this.addressAutocomplete=new google.maps.places.Autocomplete(e),this.addressAutocomplete.bindTo("bounds",this.map)),this.mapMarker=new google.maps.Marker({map:this.map,position:null,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png"}),this.addressAutocomplete){var t=this,i=function(){t.setPlaceWasSelected(),t.mapMarker.setVisible(!1);var e=t.addressAutocomplete.getPlace(),i=e.formatted_address;i.indexOf(", USA")===i.length-", USA".length&&(i=i.substring(0,i.length-", USA".length)),t.signUpInfo.streetAddress=i,e.geometry&&(t.setEditPolyForAddress(e.geometry.location),t.centerMap(e.geometry))};this.addressAutocomplete.addListener("place_changed",function(){t.$scope.$apply(i)})}},i.prototype.onMapEditorReady=function(e){this.map=e,this.initMapStep()},i.prototype.checkAddress=function(){!this.placeWasSelected&&this.shouldCheckAddress&&(this.shouldCheckAddress=!1,this.refreshMapForAddress())},i.prototype.setPlaceWasSelected=function(){this.placeWasSelected=!0,this.shouldCheckAddress=!1;var e=this;setTimeout(function(){e.placeWasSelected=!0},500)},i.prototype.setEditPolyForAddress=function(e){this.hoaPoly={vertices:[{lat:e.lat()-.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()-.0014},{lat:e.lat()+.001,lon:e.lng()+.0014},{lat:e.lat()-.001,lon:e.lng()+.0014}]}},i.prototype.refreshMapForAddress=function(){this.isLoadingMap=!0;var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){e.$scope.$apply(function(){if(e.isLoadingMap=!1,i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.streetAddress=n,t[0].geometry&&(e.setEditPolyForAddress(t[0].geometry.location),e.centerMap(t[0].geometry))}})})},i.prototype.onFinishedWizard=function(){this.isLoading=!0,this.signUpInfo.boundsGpsVertices=this.hoaPoly.vertices;var e=this;this.$http.post("/api/SignUpWizard/Hoa",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?(void 0!==window.analytics&&window.analytics.track("condoSignUpComplete"),void 0!==window.goog_report_conversion&&window.goog_report_conversion(),HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl):(alert("Failed to complete sign-up: "+i.errorMessage),e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1,alert("Failed to complete sign-up: "+t.data.exceptionMessage)})},i.$inject=["$scope","$http","$timeout","WizardHandler"],i}();e.NeighborhoodSignUpWizardController=i}(Ally||(Ally={})),CA.angularApp.component("neighborhoodSignUpWizard",{templateUrl:"/ngApp/chtn/public/neighborhood-sign-up-wizard.html",controller:Ally.NeighborhoodSignUpWizardController});!function(e){var t=function(){return function(){}}(),i=function(){function e(e,i,n,o,s){this.$http=e,this.$rootScope=i,this.siteInfo=n,this.$timeout=o,this.appCacheService=s,this.isLoading=!1,this.signUpInfo=new t,this.showInputForm=!0,this.showSchoolField=!1}return e.prototype.$onInit=function(){var e=this;this.groupName=this.siteInfo.publicSiteInfo.fullName,this.showSchoolField="pta"===AppConfig.appShortName,window.setTimeout(function(){return e.hookupAddressAutocomplete()},300)},e.prototype.hookupAddressAutocomplete=function(){var e=void 0;if(this.siteInfo.publicSiteInfo.googleGpsPosition){$(".mask-phone").mask("(999) 999-9999? x999",{autoclear:!1});e={bounds:new google.maps.Circle({center:this.siteInfo.publicSiteInfo.googleGpsPosition,radius:40234}).getBounds()}}var t=document.getElementById("member-home-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(t,e);var i=this;google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var e=i.addressAutocomplete.getPlace();i.signUpInfo.streetAddress=e.formatted_address})},e.prototype.submitInfo=function(){var e=this;this.signUpInfo.recaptchaKey=grecaptcha.getResponse(),HtmlUtil.isNullOrWhitespace(this.signUpInfo.recaptchaKey)?this.errorMessage="Please complete the reCAPTCHA field":(this.isLoading=!0,this.errorMessage=null,this.$http.post("/api/PublicPendingUser",this.signUpInfo).then(function(t){e.isLoading=!1,e.showInputForm=!1},function(t){e.isLoading=!1,e.errorMessage="Failed to submit: "+t.data.exceptionMessage}))},e.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService"],e}();e.PendingMemberSignUpController=i}(Ally||(Ally={})),CA.angularApp.component("pendingMemberSignUp",{templateUrl:"/ngApp/chtn/public/pending-member-sign-up.html",controller:Ally.PendingMemberSignUpController});!function(e){var t=function(){function e(e,t){this.siteInfo=e,this.fellowResidents=t,this.canManage=!1}return e.prototype.$onInit=function(){var e=this;this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId,this.siteInfo.userInfo.userId).then(function(t){return e.canManage=t})},e.$inject=["SiteInfo","fellowResidents"],e}();e.CommitteeHomeController=t}(Ally||(Ally={})),CA.angularApp.component("committeeHome",{bindings:{committee:"<"},templateUrl:"/ngApp/committee/committee-home.html",controller:Ally.CommitteeHomeController});!function(e){var t=function(){function e(e,t,i,n){this.$http=e,this.fellowResidents=t,this.$cacheFactory=i,this.siteInfo=n,this.isLoading=!1,this.canManage=!1}return e.prototype.$onInit=function(){this.populateAllMembers()},e.prototype.populateAllMembers=function(){var e=this;this.isLoading=!0,this.fellowResidents.getResidents().then(function(t){e.allGroupMembers=t,e.getMembers()})},e.prototype.setContactMember=function(){var e=this;this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/SetContactMember?userId="+this.contactUser.userId,null).then(function(t){e.isLoading=!1,e.committee.contactMemberUserId=e.contactUser.userId,e.$cacheFactory.get("$http").remove("/api/Committee/"+e.committee.committeeId),e.fellowResidents.clearResidentCache()},function(t){e.isLoading=!1,alert("Failed to set contact member: "+t.data.exceptionMessage)})},e.prototype.getMembers=function(){var e=this;this.isLoading=!0,this.fellowResidents.getCommitteeMembers(this.committee.committeeId).then(function(t){e.isLoading=!1,e.members=t,e.members=_.sortBy(e.members,function(e){return(e.fullName||"").toLowerCase()});e.filteredGroupMembers=_.filter(e.allGroupMembers,function(t){return i=t,!_.some(e.members,function(e){return e.userId===i.userId});var i}),e.filteredGroupMembers=_.sortBy(e.filteredGroupMembers,function(e){return(e.fullName||"").toLowerCase()}),e.contactUser=_.find(e.members,function(t){return t.userId==e.committee.contactMemberUserId}),e.canManage=e.siteInfo.userInfo.isAdmin||e.siteInfo.userInfo.isSiteManager||_.any(e.members,function(t){return t.userId===e.siteInfo.userInfo.userId})},function(t){e.isLoading=!1,alert("Failed to retrieve committee members, please refresh the page to try again")})},e.prototype.addSelectedMember=function(){var e=this;this.userForAdd&&(this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/AddMember?userId="+this.userForAdd.userId,null).then(function(t){e.isLoading=!1,e.getMembers()},function(t){e.isLoading=!1,alert("Failed to add member, please refresh the page to try again: "+t.data.exceptionMessage)}))},e.prototype.removeMember=function(e){var t=this;confirm("Are you sure you want to remove this person from this committee?")&&(this.isLoading=!0,this.$http.put("/api/Committee/"+this.committee.committeeId+"/RemoveMember?userId="+e.userId,null).then(function(e){t.isLoading=!1,t.getMembers()},function(e){t.isLoading=!1,alert("Failed to remove member, please refresh the page to try again: "+e.data.exceptionMessage)}))},e.$inject=["$http","fellowResidents","$cacheFactory","SiteInfo"],e}();e.CommitteeMembersController=t}(Ally||(Ally={})),CA.angularApp.component("committeeMembers",{bindings:{committee:"<"},templateUrl:"/ngApp/committee/committee-members.html",controller:Ally.CommitteeMembersController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.$cacheFactory=n,this.$rootScope=o,this.canManage=!1,this.initialView="Home",this.selectedView=null,this.isLoading=!1,this.committeeId=this.$routeParams.committeeId,this.initialView=this.$routeParams.viewName||"Home"}return e.prototype.$onInit=function(){this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.retrieveCommittee()},e.prototype.retrieveCommittee=function(){var e=this;this.isLoading=!0,this.$rootScope.dontHandle403=!0,this.$http.get("/api/Committee/"+this.committeeId,{cache:!0}).then(function(t){e.$rootScope.dontHandle403=!1,e.isLoading=!1,e.committee=t.data,e.selectedView=e.initialView},function(t){e.$rootScope.dontHandle403=!1,e.isLoading=!1,403===t.status?(alert("You are not authorized to view this private committee. You must be a member of the committee to view its contents. Reach out to a board member to inquire about joining the committiee."),window.location.href="/#!/Home"):alert("Failed to load committee: "+t.data.exceptionMessage)})},e.prototype.onUpdateCommitteeName=function(){var e=this;this.isLoading=!0;var t="/api/Committee/"+this.committeeId+"?newName="+this.committee.name;this.$http.put(t,null).then(function(){e.isLoading=!1,e.$cacheFactory.get("$http").remove("/api/Committee/"+e.committeeId)},function(t){e.isLoading=!1,alert("Failed to update the committee name: "+t.data.exceptionMessage)})},e.$inject=["$http","SiteInfo","$routeParams","$cacheFactory","$rootScope"],e}();e.CommitteeParentController=t}(Ally||(Ally={})),CA.angularApp.component("committeeParent",{templateUrl:"/ngApp/committee/committee-parent.html",controller:Ally.CommitteeParentController});!function(e){var t=function(){return function(){}}();e.InfoItem=t;var i=function(){function e(e,i,n,o,s){this.$http=e,this.$rootScope=i,this.siteInfo=n,this.$cacheFactory=o,this.fellowResidents=s,this.isBodyMissing=!1,this.canManage=!1,this.headerText="Information and Frequently Asked Questions (FAQs)",this.editingInfoItem=new t,"home"===AppConfig.appShortName&&(this.headerText="Home Notes")}return e.prototype.$onInit=function(){var e=this;this.hideDocuments=this.$rootScope.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId,this.siteInfo.userInfo.userId).then(function(t){return e.canManage=t}),this.retrieveInfo(),window.setTimeout(function(){!function(){var e=$("[title=Font]").siblings(".dropdown-menu");if($.each(["Serif","Sans","Arial","Arial Black","Courier","Courier New","Comic Sans MS","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],function(t,i){e.append($('<li><a data-edit="fontName '+i+'" style="font-family:\''+i+"'\">"+i+"</a></li>"))}),$("a[title]").tooltip({container:"body"}),$(".dropdown-menu input").click(function(){return!1}).change(function(){$(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="",$(this).change()}),$("[data-role=magic-overlay]").each(function(){var e=$(this),t=$(e.data("target"));e.css("opacity",0).css("position","absolute").offset(t.offset()).width(t.outerWidth()).height(t.outerHeight())}),"onwebkitspeechchange"in document.createElement("input")){var t=$("#editor").offset();$("#voiceBtn").css("position","absolute").offset({top:t.top,left:t.left+$("#editor").innerWidth()-35})}else $("#voiceBtn").hide()}();$("#editor").wysiwyg({fileUploadError:function(e,t){var i="";"unsupported-file-type"===e?i="Unsupported format "+t:console.log("error uploading file",e,t),$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button><strong>File upload error</strong> '+i+" </div>").prependTo("#alerts")}})},10)},e.prototype.retrieveInfo=function(){var e=this;this.isLoadingInfo=!0,this.getUri||(this.getUri="/api/InfoItem",this.committee&&(this.getUri="/api/InfoItem/Committee/"+this.committee.committeeId)),this.$http.get(this.getUri,{cache:!0}).then(function(t){e.isLoadingInfo=!1,e.infoItems=t.data})},e.prototype.scrollToInfo=function(e){document.getElementById("info-item-title-"+e).scrollIntoView()},e.prototype.onStartEditInfoItem=function(e){this.editingInfoItem=jQuery.extend({},e),$("#editor").html(this.editingInfoItem.body),window.scrollTo(0,document.body.scrollHeight)},e.prototype.onSubmitItem=function(){this.editingInfoItem.body=$("#editor").html(),this.isBodyMissing=HtmlUtil.isNullOrWhitespace(this.editingInfoItem.body);var e=$("#info-item-edit-form");if(e.validate(),e.valid()&&!this.isBodyMissing){this.committee&&(this.editingInfoItem.committeeId=this.committee.committeeId),this.isLoadingInfo=!0;var i=this,n=function(){i.isLoadingInfo=!1,$("#editor").html(""),i.editingInfoItem=new t,i.$cacheFactory.get("$http").remove(i.getUri),i.retrieveInfo()};"number"==typeof this.editingInfoItem.infoItemId?this.$http.put("/api/InfoItem",this.editingInfoItem).then(n):this.$http.post("/api/InfoItem",this.editingInfoItem).then(n)}},e.prototype.onDeleteInfoItem=function(e){var t=this;confirm("Are you sure you want to delete this information?")&&(this.isLoadingInfo=!0,this.$http.delete("/api/InfoItem/"+e.infoItemId).then(function(){t.isLoadingInfo=!1,t.$cacheFactory.get("$http").remove(t.getUri),t.retrieveInfo()}))},e.$inject=["$http","$rootScope","SiteInfo","$cacheFactory","fellowResidents"],e}();e.FAQsController=i}(Ally||(Ally={})),CA.angularApp.component("faqs",{bindings:{committee:"<?"},templateUrl:"/ngApp/common/FAQs.html",controller:Ally.FAQsController});!function(e){var t=function(){function e(e,t,i,n){this.$http=e,this.siteInfo=t,this.$timeout=i,this.$rootScope=n,this.isLoading=!1}return e.prototype.$onInit=function(){this.refreshPolls()},e.prototype.populatePollData=function(e){this.polls=e,e&&e.length>0&&this.$rootScope.$broadcast("homeHasActivePolls");for(var t=0;t<this.polls.length;++t){var i=this.polls[t];if(i.hasUsersUnitVoted&&i.canViewResults){var n=_.groupBy(i.responses,"answerId");i.chartData=[],i.chartLabels=[];for(var o in n)n.hasOwnProperty(o)&&(i.chartLabels.push(_.find(i.answers,function(e){return e.pollAnswerId==o}).answerText),i.chartData.push(n[o].length));i.responses&&i.responses.length<this.siteInfo.privateSiteInfo.numUnits&&(i.chartLabels.push("No Response"),i.chartData.push(this.siteInfo.privateSiteInfo.numUnits-i.responses.length))}}},e.prototype.refreshPolls=function(){this.isLoading=!0;var e=this;this.$http({method:"GET",url:"/api/Poll?getActive=1"}).then(function(t){e.isLoading=!1,e.$timeout(function(){e.populatePollData(t.data)},100)},function(){e.isLoading=!1})},e.prototype.onPollAnswer=function(e,t,i){this.isLoading=!0;var n="/api/PollResponse?pollId="+e.pollId+"&answerId="+(t?t.pollAnswerId:"")+"&writeInAnswer="+i,o=this;this.$http.put(n,null).then(function(e){o.polls=e.data,o.isLoading=!1,o.refreshPolls()},function(){o.isLoading=!1})},e.$inject=["$http","SiteInfo","$timeout","$rootScope"],e}();e.ActivePollsController=t}(Ally||(Ally={})),CA.angularApp.component("activePolls",{templateUrl:"/ngApp/common/active-polls.html",controller:Ally.ActivePollsController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$rootScope=i,this.isLoading_Payment=!1}return e.prototype.$onInit=function(){this.allyAppName=AppConfig.appName,this.isAutoPayActive=this.siteInfo.userInfo.isAutoPayActive,this.assessmentCreditCardFeeLabel=this.siteInfo.privateSiteInfo.payerPaysCCFee?"Service fee applies":"No service fee",this.assessmentAchFeeLabel=this.siteInfo.privateSiteInfo.payerPaysAchFee?"Service fee applies":"No service fee",this.payerPaysAchFee=this.siteInfo.privateSiteInfo.payerPaysAchFee,this.errorPayInfoText="Is the amount incorrect?",this.isWePaySetup=this.siteInfo.privateSiteInfo.isPaymentEnabled,this.hasAssessments=this.siteInfo.privateSiteInfo.hasAssessments,this.assessmentFrequency=this.siteInfo.privateSiteInfo.assessmentFrequency,!this.isAutoPayActive&&HtmlUtil.isNumericString(HtmlUtil.GetQueryStringParameter("preapproval_id"))&&(this.isAutoPayActive=!0),this.nextAutoPayText=this.siteInfo.userInfo.nextAutoPayText,null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0?this.assessmentAmount=this.siteInfo.userInfo.usersUnits[0].assessment:this.assessmentAmount=0,this.paymentInfo={paymentType:"other",amount:this.assessmentAmount,note:"",fundingType:null};if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments&&this.recentPayments.length>0)for(this.recentPayments.length>6&&(this.recentPayments=this.recentPayments.slice(0,6));this.recentPayments.length<6;)this.recentPayments.push({});null!=this.siteInfo.privateSiteInfo.assessmentFrequency&&null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())),setTimeout(function(){$("#btn_view_pay_history").click(function(){$("#pm_info").collapse("hide"),$("#payment_history").collapse("show")}),$("#btn_view_pay_info").click(function(){$("#payment_history").collapse("hide"),$("#pm_info").collapse("show")}),$(".hide").click(function(){$(this).parent().hide("")})},400)},e.prototype.makePayment=function(e){this.isLoading_Payment=!0,this.paymentInfo.fundingType=e,HtmlUtil.isValidString(this.paymentInfo.amount)&&"$"===this.paymentInfo.amount[0]&&(this.paymentInfo.amount=this.paymentInfo.amount.substr(1)),analytics.track("makePayment",{fundingType:e});var t=this;this.$http.post("/api/WePayPayment",this.paymentInfo).then(function(e){var i=e.data;null!==i&&"string"==typeof i.checkoutUri&&i.checkoutUri.length>0?window.location.href=i.checkoutUri:(t.isLoading_Payment=!1,alert("Unable to initiate WePay checkout"))},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)})},e.prototype.onIncorrectPayDetails=function(){var e=this.assessmentAmount.toString();Math.round(this.assessmentAmount)!=this.assessmentAmount&&(e=this.assessmentAmount.toFixed(2));var t=e;this.knowsNextPayment&&HtmlUtil.isValidString(this.nextPaymentText)&&(t+="|"+this.nextPaymentText),this.$rootScope.$broadcast("prepAssessmentEmailToBoard",t)},e.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},e.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"==e?this.assessmentAmount:0,this.updatePaymentText()},e.prototype.getNextPaymentText=function(e,t){if(null==e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];if("month"===n.intervalName){i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]}else if("quarter"===n.intervalName){i=["Q1","Q2","Q3","Q4"][s.period-1]}else if("half-year"===n.intervalName){i=["First Half","Second Half"][s.period-1]}i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},e.prototype.onSetupAutoPay=function(e){this.isLoading_Payment=!0;var t=this;this.$http.get("/api/WePayPayment/SetupAutoPay?fundingType="+e).then(function(e){var i=e.data;"string"==typeof i&&i.length>0?window.location.href=i:(t.isLoading_Payment=!1,alert("Unable to initiate WePay auto-pay setup"))},function(e){t.isLoading_Payment=!1,e.data&&e.data.exceptionMessage&&alert(e.data.exceptionMessage)})},e.prototype.onDisableAutoPay=function(){if(confirm("Just to double check, this will disable your auto-payment. You need to make sure to manually make your regular payments to avoid any late fees your association may enforce.")){this.isLoading_Payment=!0;var e=this;this.$http.get("/api/WePayPayment/DisableAutoPay").then(function(){e.isLoading_Payment=!1,e.isAutoPayActive=!1},function(t){e.isLoading_Payment=!1,t.data&&t.data.exceptionMessage&&alert(t.data.exceptionMessage)})}},e.$inject=["$http","SiteInfo","$rootScope"],e}();e.AssessmentPaymentFormController=t}(Ally||(Ally={})),CA.angularApp.component("assessmentPaymentForm",{templateUrl:"/ngApp/common/assessment-payment-form.html",controller:Ally.AssessmentPaymentFormController});!function(e){var t=function(){return function(){}}();e.DocumentTreeFile=t;var i=function(){function e(){}return e.prototype.getSubDirectoryByName=function(e){if(!this.subdirectories)return null;for(var t=0;t<this.subdirectories.length;++t)if(this.subdirectories[t].name===e)return this.subdirectories[t];return null},e}();e.DocumentDirectory=i;var n=function(){function e(t,i,n,o,s,a){var r=this;this.$http=t,this.$rootScope=i,this.$cacheFactory=n,this.$scope=o,this.siteInfo=s,this.fellowResidents=a,this.isLoading=!1,this.filesSortDescend=!1,this.title="Documents",this.getDocsUri="/api/ManageDocuments",this.showPopUpWarning=!1,this.shouldShowSubdirectories=!0,this.fileSortType=window.localStorage[e.LocalStorageKey_SortType],this.fileSortType||(this.fileSortType="title"),this.filesSortDescend="true"===window.localStorage[e.LocalStorageKey_SortDirection],this.fileSearch={all:""},this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId,this.siteInfo.userInfo.userId).then(function(e){return r.canManage=e})}return e.prototype.$onInit=function(){this.apiAuthToken=this.$rootScope.authToken,this.Refresh();var e=this;setTimeout(function(){$(function(){$("#JQDocsFileUploader").fileupload({autoUpload:!0,add:function(t,i){if(i.files[0].size>52428800){var n=Math.round(i.files[0].size/1048576)+1;alert("The selected file is too large ("+n+"MB). The maximum file size allowed is 50MB.")}else{var o=e.getSelectedDirectoryPath();$("#FileUploadProgressContainer").show(),i.url="api/DocumentUpload?dirPath="+encodeURIComponent(o),i.submit().done(function(t){e.$cacheFactory.get("$http").remove(e.getDocsUri),$("#FileUploadProgressContainer").hide(),e.Refresh()})}},beforeSend:function(t){t.setRequestHeader("ApiAuthToken",e.apiAuthToken)},progressall:function(e,t){var i=parseInt((t.loaded/t.total*100).toString(),10);$("#FileUploadProgressBar").css("width",i+"%"),100===i?$("#FileUploadProgressLabel").text("Finalizing Upload..."):$("#FileUploadProgressLabel").text(i+"%")},fail:function(e){$("#FileUploadProgressContainer").hide(),alert("Failed to upload document due led to upload document due to unexpected server error. Please re-log-in and try again.")}})})},100),this.committee&&(this.title="Committee Documents")},e.prototype.getSelectedDirectoryPath=function(){return this.getDirectoryFullPath(this.selectedDirectory)},e.prototype.viewDoc=function(e,t){var i=this;this.isLoading=!0,this.showPopUpWarning=!1;var n;if(!t){!(n=window.open("","_blank"))||n.closed||void 0===n.closed?(alert("Looks like your browser may be blocking pop-ups which are required to view documents. Please see the right of the address bar or your browser settings to enable pop-ups for "+AppConfig.appName+"."),this.showPopUpWarning=!0):n.document.write("Loading document...")}this.$http.get("/api/DocumentLink/"+e.docId).then(function(o){i.isLoading=!1;var s=e.url+"?vid="+o.data.vid;if(t){var a=document.createElement("a");a.setAttribute("type","hidden"),a.href=s,a.download=e.fileName,document.body.appendChild(a),a.click(),a.remove()}else n.location.href=s},function(e){i.isLoading=!1,alert("Failed to open document: "+e.data.exceptionMessage)})},e.prototype.getDirectoryFullPath=function(t){for(var i=t.name,n=t.parentDirectory;n;)i=n.name+"/"+i,n=n.parentDirectory;return this.committee&&(i=e.DirName_Committees+"/"+this.committee.committeeId+"/"+i),i},e.prototype.FindDirectoryByPath=function(t){if(this.documentTree){if(this.committee&&HtmlUtil.startsWith(t,e.DirName_Committees)){var i=(t=t.substr(e.DirName_Committees.length+1)).indexOf("/");-1!==i&&(t=t.substr(i+1))}for(var n=t.split("/"),o=this.documentTree,s=0;s<n.length&&(o=o.getSubDirectoryByName(n[s]));++s);return o}},e.prototype.updateFileFilter=function(){var e=angular.lowercase(this.fileSearch.all)||"";this.searchFileList=_.filter(this.fullSearchFileList,function(t){return-1!==angular.lowercase(t.localFilePath||"").indexOf(e)||-1!==angular.lowercase(t.uploadDateString||"").indexOf(e)||-1!==angular.lowercase(t.uploaderFullName||"").indexOf(e)}),setTimeout(function(){var e=document.getElementById("documents-area"),t=e.style.display;e.style.display="none";e.offsetHeight;e.style.display=t},50)},e.prototype.hookUpFileDragging=function(){if(this.canManage){var e=this;setTimeout(function(){$(".droppable").droppable({drop:function(t,i){var n=e.getSelectedDirectoryPath();$(i.draggable).draggable("option","revert","false");var o=$(this).attr("data-folder-path").trim();e.$scope.$apply(function(){e.isLoading=!0;var t={relativeS3Path:e.selectedFile.relativeS3Path,action:"move",newFileName:"",sourceFolderPath:n,destinationFolderPath:o};e.selectedFile=null,e.$http.put("/api/ManageDocuments/MoveFile",t).then(function(){e.isLoading=!1,e.$cacheFactory.get("$http").remove(e.getDocsUri),e.Refresh()},function(t){e.isLoading=!1;var i=t.exceptionMessage||t.message||t;alert("Failed to move file: "+i)})})},hoverClass:"Document_Folder_DropHover"});$(".draggable").draggable({distance:10,revert:!0,helper:"clone",opacity:.7,containment:"document",appendTo:"body",start:function(t,i){var n=$(this).attr("id").substring("File_".length),o=parseInt(n);e.$scope.$apply(function(){var t=e.selectedDirectory.files[o];e.selectedFile=t})}})},250)}},e.prototype.onDirectoryClicked=function(e){this.selectedDirectory===e?this.shouldShowSubdirectories=!this.shouldShowSubdirectories:this.shouldShowSubdirectories=!0,this.selectedDirectory=e,this.selectedFile=null,this.fileSearch.all=null,this.hookUpFileDragging(),this.SortFiles()},e.prototype.createDirectory=function(){this.createUnderParentDirName=null,this.committee&&(this.createUnderParentDirName=e.DirName_Committees+"/"+this.committee.committeeId),this.shouldShowCreateFolderModal=!0,setTimeout(function(){return $("#CreateDirectoryNameTextBox").focus()},50)},e.prototype.CreateSubDirectory=function(){this.createUnderParentDirName=this.selectedDirectory.name,this.committee&&(this.createUnderParentDirName=e.DirName_Committees+"/"+this.committee.committeeId+"/"+this.createUnderParentDirName),this.shouldShowCreateFolderModal=!0,setTimeout(function(){return $("#CreateDirectoryNameTextBox").focus()},50)},e.prototype.SetFileSortType=function(t){this.fileSortType===t?this.filesSortDescend=!this.filesSortDescend:this.filesSortDescend=!1,this.fileSortType=t,window.localStorage[e.LocalStorageKey_SortType]=this.fileSortType,window.localStorage[e.LocalStorageKey_SortDirection]=this.filesSortDescend,this.SortFiles()},e.prototype.SortFiles=function(){this.selectedDirectory&&this.selectedDirectory.files&&("title"!==this.fileSortType&&"uploadDate"!==this.fileSortType||(this.selectedDirectory.files=_.sortBy(this.selectedDirectory.files,this.fileSortType)),this.filesSortDescend&&this.selectedDirectory.files.reverse())},e.prototype.onCreateDirectoryClicked=function(){var e=this;this.isLoading=!0;var t="/api/ManageDocuments/CreateDirectory?folderName="+encodeURIComponent(this.newDirectoryName);t+="&parentFolderPath=",this.createUnderParentDirName&&(t+=encodeURIComponent(this.createUnderParentDirName)),this.$http.put(t,null).then(function(){e.$cacheFactory.get("$http").remove(e.getDocsUri),e.newDirectoryName="",e.Refresh(),e.shouldShowCreateFolderModal=!1},function(t){alert("Failed to create the folder: "+t.data.exceptionMessage),e.isLoading=!1})},e.prototype.onCancelAddDirectory=function(){this.shouldShowCreateFolderModal=!1,this.newDirectoryName=""},e.prototype.onFileClicked=function(e){this.selectedFile=e},e.prototype.RenameDocument=function(e){var t=this;if(e){var i=prompt("Enter the new name for the file",e.title);if(null!==i){i.length>64&&(i=i.substr(0,64)),this.isLoading=!0;var n={relativeS3Path:e.relativeS3Path,action:"rename",newTitle:i,sourceFolderPath:this.getSelectedDirectoryPath(),destinationFolderPath:""};this.$http.put("/api/ManageDocuments/RenameFile",n).then(function(){t.$cacheFactory.get("$http").remove(t.getDocsUri),t.Refresh()},function(e){t.isLoading=!1,alert("Failed to rename: "+e.data.exceptionMessage),t.Refresh()})}}},e.prototype.DeleteDocument=function(e){var t=this;confirm("Are you sure you want to delete this file?")&&(this.isLoading=!0,this.$http.delete("/api/ManageDocuments?docPath="+e.relativeS3Path).then(function(){t.$cacheFactory.get("$http").remove(t.getDocsUri),t.Refresh()},function(e){t.isLoading=!1,alert("Failed to delete file: "+e.data.exceptionMessage),t.Refresh()}))},e.prototype.RenameSelectedDirectory=function(){var e=this;if(this.selectedDirectory){var t=prompt("Enter the new name for the directory",this.selectedDirectory.name);if(null!==t){t.length>32&&(t=t.substr(0,32)),this.isLoading=!0;var i=encodeURIComponent(this.getSelectedDirectoryPath()),n=encodeURIComponent(t);this.$http.put("/api/ManageDocuments/RenameDirectory?directoryPath="+i+"&newDirectoryName="+n,null).then(function(){e.$cacheFactory.get("$http").remove(e.getDocsUri),e.selectedDirectory.name=t,e.Refresh()},function(t){e.isLoading=!1,alert("Failed to rename directory: "+t.data.exceptionMessage)})}}},e.prototype.DeleteSelectedDirectory=function(){var e=this;if(this.selectedDirectory)if(this.selectedDirectory.files.length>0)alert("You can not delete a folder that contains files. Please delete or move all files from the folder.");else if(confirm("Are you sure you want to delete this folder?")){this.isLoading=!0;var t=this.getSelectedDirectoryPath();this.$http.delete("/api/ManageDocuments/DeleteDirectory?directoryPath="+encodeURIComponent(t)).then(function(){e.$cacheFactory.get("$http").remove(e.getDocsUri),e.Refresh()},function(t){e.isLoading=!1,alert("Failed to delete the folder: "+t.data.exceptionMessage)})}},e.prototype.getFileIcon=function(e){if(!e)return"";var t=null;switch(e.split(".").pop().toLowerCase()){case"pdf":t="PdfIcon.png";break;case"doc":case"docx":t="WordIcon.png";break;case"xls":case"xlsx":t="ExcelIcon.png";break;case"jpeg":case"jpe":case"jpg":case"png":case"bmp":t="ImageIcon.png";break;case"zip":t="ZipIcon.png";break;default:t="GenericFileIcon.png"}return"/assets/images/FileIcons/"+t},e.prototype.hookupParentDirs=function(e){var t=this;e.fullDirectoryPath=this.getDirectoryFullPath(e),e.getSubDirectoryByName=i.prototype.getSubDirectoryByName,e.subdirectories&&e.subdirectories.forEach(function(i){i.parentDirectory=e,t.hookupParentDirs(i)})},e.prototype.Refresh=function(){var e=null;this.selectedDirectory&&(e=this.getSelectedDirectoryPath()),this.isLoading=!0,this.selectedDirectory=null,this.selectedFile=null,this.getDocsUri="/api/ManageDocuments",this.committee&&(this.getDocsUri+="/Committee/"+this.committee.committeeId);var t=this;this.$http.get(this.getDocsUri,{cache:!0}).then(function(n){t.isLoading=!1,t.documentTree=n.data,t.documentTree.getSubDirectoryByName=i.prototype.getSubDirectoryByName,t.documentTree.subdirectories.forEach(function(e){t.hookupParentDirs(e)});var o=[],s=function(e){_.each(e.files,function(t){t.localFilePath=e.name+"/"+t.title,t.uploadDateString=moment(t.uploadDate).format("MMMM D, YYYY")}),Array.prototype.push.apply(o,e.files),_.each(e.subdirectories,s)};s(t.documentTree),t.fullSearchFileList=o,e&&(t.selectedDirectory=t.FindDirectoryByPath(e),t.SortFiles()),t.hookUpFileDragging()},function(e){t.isLoading=!1})},e.$inject=["$http","$rootScope","$cacheFactory","$scope","SiteInfo","fellowResidents"],e.LocalStorageKey_SortType="DocsInfo_FileSortType",e.LocalStorageKey_SortDirection="DocsInfo_FileSortDirection",e.DirName_Committees="Committees_Root",e}();e.DocumentsController=n}(Ally||(Ally={})),CA.angularApp.component("documents",{bindings:{committee:"<"},templateUrl:"/ngApp/common/documents.html",controller:Ally.DocumentsController});!function(e){var t=function(){function e(e){this.$routeParams=e}return e.prototype.$onInit=function(){for(var e=(this.$routeParams.appName||"").toLowerCase(),t=[CondoAllyAppConfig,HomeAppConfig,HOAAppConfig,NeighborhoodAppConfig,BlockClubAppConfig],i=null,n=0;n<t.length;++n)if(t[n].appShortName.toLowerCase()===e){i=t[n].baseTld;break}i||(i="condoally.com"),i="myhoaally.org";var o="https://"+this.$routeParams.shortName+"."+i+"/";window.location.href=o},e.$inject=["$routeParams"],e}();e.GroupRedirectController=t}(Ally||(Ally={})),CA.angularApp.component("groupRedirect",{templateUrl:"/ngApp/common/group-redirect.html",controller:Ally.GroupRedirectController});!function(e){var t=function(){return function(){this.recipientType="board"}}(),i=function(){function e(e,t,i,n,o){this.$http=e,this.fellowResidents=t,this.$rootScope=i,this.siteInfo=n,this.$scope=o,this.isLoadingEmail=!1,this.defaultMessageRecipient="board",this.showDiscussionEveryoneWarning=!1,this.showDiscussionLargeWarning=!1,this.showUseDiscussSuggestion=!1,this.showSendConfirmation=!1,this.showEmailForbidden=!1,this.showRestrictedGroupWarning=!1,this.defaultSubject="A message from your neighbor",this.memberLabel="resident",this.memberPageName="Residents"}return e.prototype.$onInit=function(){var e=this;this.groupEmailDomain="inmail."+AppConfig.baseTld,this.messageObject=new t,this.showSendEmail=!0,this.committee?(this.messageObject.committeeId=this.committee.committeeId,this.defaultSubject="A message from a committee member"):(this.loadGroupEmails(),this.$scope.$on("prepAssessmentEmailToBoard",function(t,i){return e.prepBadAssessmentEmailForBoard(i)}),"pta"===AppConfig.appShortName?(this.defaultSubject="A message from a PTA member",this.memberLabel="member",this.memberPageName="Members"):this.defaultSubject="A message from your neighbor"),this.messageObject.subject=this.defaultSubject},e.prototype.loadGroupEmails=function(){this.isLoadingEmail=!0;var e=this;this.fellowResidents.getGroupEmailObject().then(function(t){e.isLoadingEmail=!1,e.availableEmailGroups=t,e.availableEmailGroups.length>0&&(e.defaultMessageRecipient=e.availableEmailGroups[0].recipientType,e.messageObject.recipientType=e.defaultMessageRecipient,e.onSelectEmailGroup())})},e.prototype.prepBadAssessmentEmailForBoard=function(e){var t=e.split("|"),i=t[0],n=null;t.length>1&&(n=t[1]),this.messageObject.recipientType="board",this.messageObject.subject="Question About Assessment Amount",this.messageObject.message=n?"Hello Boardmembers,\n\nOur association's home page says my next payment of $"+i+" will cover "+n+", but I believe that is incorrect. My records indicate my next payment of $"+i+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:"Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+i+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},e.prototype.onSendEmail=function(){var e=this;$("#message-form").validate(),$("#message-form").valid()&&(this.isLoadingEmail=!0,this.$rootScope.dontHandle403=!0,analytics.track("sendEmail",{recipientId:this.messageObject.recipientType}),this.$http.post("/api/Email/v2",this.messageObject).then(function(){e.$rootScope.dontHandle403=!1,e.isLoadingEmail=!1,e.messageObject=new t,e.messageObject.recipientType=e.defaultMessageRecipient,e.messageObject.subject=e.defaultSubject,e.committee&&(e.messageObject.committeeId=e.committee.committeeId),e.showSendConfirmation=!0,e.showSendEmail=!1},function(t){e.isLoadingEmail=!1,e.$rootScope.dontHandle403=!1,403===t.status?e.showEmailForbidden=!0:alert("Unable to send e-mail, please contact technical support.")}))},e.prototype.onSelectEmailGroup=function(){var e=this,t=HtmlUtil.getSubdomain(window.location.host).toLowerCase();this.groupEmailAddress=this.messageObject.recipientType+"."+t+"@inmail."+AppConfig.baseTld,this.showDiscussionEveryoneWarning=!1;var i=-1!==this.messageObject.recipientType.toLowerCase().indexOf("owners");!this.showDiscussionEveryoneWarning&&i&&this.siteInfo.privateSiteInfo.numUnits>30?this.showDiscussionLargeWarning=!0:this.showDiscussionLargeWarning=!1;var n=-1!==this.messageObject.recipientType.toLowerCase().indexOf("discussion"),o=-1!==this.messageObject.recipientType.toLowerCase().indexOf("board"),s=-1!==this.messageObject.recipientType.toLowerCase().indexOf("propertymanagers");this.showDiscussionEveryoneWarning=!1,this.showDiscussionLargeWarning=!1,this.showUseDiscussSuggestion=!n&&!o&&!s&&AppConfig.isChtnSite;var a=_.find(this.availableEmailGroups,function(t){return t.recipientType===e.messageObject.recipientType});this.showRestrictedGroupWarning=a.isRestrictedGroup},e.$inject=["$http","fellowResidents","$rootScope","SiteInfo","$scope"],e}();e.GroupSendEmailController=i}(Ally||(Ally={})),CA.angularApp.component("groupSendEmail",{bindings:{committee:"<?"},templateUrl:"/ngApp/common/group-send-email.html",controller:Ally.GroupSendEmailController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$timeout=i,this.isLoading=!1}return e.prototype.$onInit=function(){this.isLoading=!0;var e=this;this.$timeout(function(){return e.loadNewsStories()},200)},e.prototype.loadNewsStories=function(){HtmlUtil.getSubdomain(window.location.host);this.isLoading=!0;var e,t;"US"===this.siteInfo.privateSiteInfo.country?(e="https://localnewsally.org/api/LocalNews",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.publicSiteInfo.chicagoWard,zipCode:this.siteInfo.publicSiteInfo.zipCode,cityNeighborhood:this.siteInfo.publicSiteInfo.localNewsNeighborhoodQuery,city:this.siteInfo.privateSiteInfo.groupAddress.city,state2Char:this.siteInfo.privateSiteInfo.groupAddress.state}):(e="https://localnewsally.org/api/LocalNews/International/MajorCity",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city});var i=this;this.$http.get(e,{cache:!0,params:t}).then(function(e){i.isLoading=!1,i.localNewStories=e.data})},e.$inject=["$http","SiteInfo","$timeout"],e}();e.LocalNewsFeedController=t}(Ally||(Ally={})),CA.angularApp.component("localNewsFeed",{templateUrl:"/ngApp/common/local-news-feed.html",controller:Ally.LocalNewsFeedController});__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}(),i=(function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}}(t),function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}}(t),function(){}(),function(){function e(e,t,i){var n=this;this.$http=e,this.siteInfo=t,this.$timeout=i,this.isLoading=!1,this.viewingResults=null,this.historyGridOptions={data:[],columnDefs:[{field:"sendDateUtc",displayName:"Sent",cellFilter:"date:'short'",type:"date"},{field:"numPaperLettersSent",displayName:"# Letters",type:"number",width:100},{field:"numEmailsSent",displayName:"# E-mails",type:"number",width:100},{field:"amountPaid",displayName:"Amount Paid",cellFilter:"currency",type:"number",width:110},{field:"sendingReason",displayName:"Reason",width:150},{field:"mailingResultObject",displayName:"",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><span data-ng-click="grid.appScope.$ctrl.showMailingResults( row.entity )" class="text-link">View Results</span></div>'}],enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableColumnMenus:!1,minRowsToShow:5,onRegisterApi:function(e){n.historyGridApi=e,HtmlUtil.uiGridFixScroll()}},this.resultsGridOptions={data:[],columnDefs:[{field:"mailingType",displayName:"Type",width:100},{field:"recipient",displayName:"Recipient",width:300,cellTemplate:'<div class="ui-grid-cell-contents"><span title="{{row.entity.recipient}}">{{ row.entity.recipientEmail || row.entity.recipientStreetAddress.oneLiner }}</span></div>'},{field:"didSuccessfullySend",displayName:"Successful",width:100,type:"boolean"},{field:"resultMessage",displayName:"Result Message",cellTemplate:'<div class="ui-grid-cell-contents"><span title="{{row.entity.resultMessage}}">{{row.entity.resultMessage}}</span></div>'}],enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableColumnMenus:!1,minRowsToShow:5,onRegisterApi:function(e){HtmlUtil.uiGridFixScroll()}}}return e.prototype.$onInit=function(){this.refreshHistory()},e.prototype.showMailingResults=function(e){var t=this;this.$timeout(function(){_.forEach(e.mailingResultObject.emailResults,function(e){return e.mailingType="E-mail"}),_.forEach(e.mailingResultObject.paperMailResults,function(e){return e.mailingType="Paper Letter"});var i=[];i=i.concat(e.mailingResultObject.emailResults,e.mailingResultObject.paperMailResults),t.resultsGridOptions.data=i,t.resultsGridOptions.minRowsToShow=i.length,t.resultsGridOptions.virtualizationThreshold=i.length,t.resultsGridheight=(i.length+1)*t.resultsGridOptions.rowHeight,t.$timeout(function(){t.viewingResults=e.mailingResultObject},10)},0)},e.prototype.refreshHistory=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Mailing/History").then(function(t){e.isLoading=!1,e.historyGridOptions.data=t.data,e.historyGridOptions.minRowsToShow=t.data.length,e.historyGridOptions.virtualizationThreshold=t.data.length},function(t){e.isLoading=!1,alert("Failed to load mailing history: "+t.data.exceptionMessage)})},e.$inject=["$http","SiteInfo","$timeout"],e}());e.MailingHistoryController=i}(Ally||(Ally={})),CA.angularApp.component("mailingHistory",{templateUrl:"/ngApp/common/mailing/mailing-history.html",controller:Ally.MailingHistoryController});!function(e){var t=function(){return function(){}}(),i=(function(){}(),function(){function e(e,t,i,n,o,s,a){var r=this;this.$http=e,this.siteInfo=t,this.fellowResidents=i,this.wizardHandler=n,this.$scope=o,this.$timeout=s,this.$location=a,this.isLoading=!1,this.selectedEntries=[],this.numEmailsToSend=0,this.numPaperLettersToSend=0,this.paperInvoiceDollars=2,this.isAdmin=!1,this.numInvalidMailingAddresses=0,this.numAddressesToBulkValidate=0;var l='<div class="ui-grid-cell-contents">$<input type="number" style="width: 90%;" data-ng-model="row.entity[col.field]" /></div>';this.homesGridOptions={data:[],columnDefs:[{field:"homeNames",displayName:AppConfig.homeName,width:210},{field:"ownerNames",displayName:"Owners"},{field:"amountDue",displayName:"Amount Due",width:120,cellTemplate:l},{field:"balanceForward",displayName:"Balance Forward",width:140,cellTemplate:l},{field:"lateFee",displayName:"Late Fee",width:120,cellTemplate:l},{field:"total",displayName:"Total",width:90,cellTemplate:'<div class="ui-grid-cell-contents">{{ row.entity.amountDue + (row.entity.balanceForward || 0) + (row.entity.lateFee || 0) | currency }}</div>'}],enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableColumnMenus:!1,minRowsToShow:5,enableRowHeaderSelection:!0,multiSelect:!0,enableSelectAll:!0,onRegisterApi:function(e){r.gridApi=e;var t=function(){var t=e.selection.getSelectedRows();r.selectedEntries=t};e.selection.on.rowSelectionChanged(o,function(e){return t()}),e.selection.on.rowSelectionChangedBatch(o,function(e){return t()}),HtmlUtil.uiGridFixScroll()}}}return e.prototype.$onInit=function(){var e=this;this.authToken=this.siteInfo.authToken,this.isAdmin=this.siteInfo.userInfo.isAdmin,this.loadMailingInfo(),this.$scope.$on("wizard:stepChanged",function(t,i){e.activeStepIndex=i.index,1===e.activeStepIndex&&e.$timeout(function(){for(var t=0,i=e.selectedEntries;t<i.length;t++){var n=i[t];e.gridApi.selection.selectRow(n)}},250),2===e.activeStepIndex?window.setTimeout(function(){return document.getElementById("delivery-method-header").scrollIntoView(!0)},50):3===e.activeStepIndex&&(e.numEmailsToSend=_.filter(e.selectedEntries,function(e){return e.shouldSendEmail}).length,e.numPaperLettersToSend=_.filter(e.selectedEntries,function(e){return e.shouldSendPaperMail}).length)})},e.prototype.customizeNotes=function(e){e.overrideNotes=this.fullMailingInfo.notes||" "},e.prototype.uncustomizeNotes=function(e){e.overrideNotes=null},e.prototype.setAllDues=function(){var e=this;_.forEach(this.fullMailingInfo.mailingEntries,function(t){return t.amountDue=e.allDuesSetAmount})},e.prototype.getTotalDue=function(e){return e.amountDue-Math.abs(e.balanceForward||0)+(e.lateFee||0)},e.prototype.onShouldSendPaperMailChange=function(e){e.shouldSendPaperMail?this.testAddressRequiredFields(e):(e.isValidMailingAddress=e.validationMessage=null,this.numInvalidMailingAddresses=_.filter(this.selectedEntries,function(e){return!1===e.isValidMailingAddress}).length)},e.prototype.onAddressChanged=function(e){e.shouldSendPaperMail&&this.testAddressRequiredFields(e)},e.prototype.testAddressRequiredFields=function(e){var t=this;return e.isValidating=!0,e.isValidMailingAddress=null,e.validationMessage=null,this.$http.post("/api/Mailing/TestMailability",e.streetAddressObject).then(function(i){e.isValidating=!1,e.isValidMailingAddress=i.data.isValid,e.validationMessage=i.data.verificationMessage,t.numInvalidMailingAddresses=_.filter(t.selectedEntries,function(e){return!1===e.isValidMailingAddress}).length},function(t){e.isValidating=!1,e.isValidMailingAddress=!1,e.validatedAddress=null,e.validationMessage="Address validation failed: "+t.data.exceptionMessage})},e.prototype.validateAddress=function(e){e.isValidating=!0,e.isValidMailingAddress=null;var t="/api/Mailing/VerifyAddress?address="+encodeURIComponent(JSON.stringify(e.streetAddressObject));return this.$http.get(t).then(function(t){e.isValidating=!1,e.isValidMailingAddress=t.data.isValid,e.validationMessage=t.data.verificationMessage,e.isValidMailingAddress&&(e.validatedAddress=t.data.parsedStreetAddress.multiLiner)},function(t){e.isValidating=!1,e.isValidMailingAddress=!1,e.validatedAddress=null,e.validationMessage=t.data.exceptionMessage})},e.prototype.previewInvoice=function(e){var i=this,n=new t;n.invoiceTitleString=this.fullMailingInfo.invoiceTitleString,n.dueDateString=this.fullMailingInfo.dueDateString,n.duesLabel=this.fullMailingInfo.duesLabel,n.fromAddress=this.fullMailingInfo.fromStreetAddress,n.mailingInfo=e,n.notes=e.overrideNotes||this.fullMailingInfo.notes,this.isLoading=!0,e.wasPopUpBlocked=!1,this.$http.post("/api/Mailing/Preview/Invoice",n).then(function(t){i.isLoading=!1;var n="/api/Mailing/Preview/Invoice/"+t.data.previewId;n+="?ApiAuthToken="+i.authToken;var o=window.open(n,"_blank");e.wasPopUpBlocked=!o||o.closed||void 0===o.closed},function(e){i.isLoading=!1})},e.prototype.onFinishedWizard=function(){var e=this;if(0!==this.numPaperLettersToSend){var t=StripeCheckout.configure({key:"pk_live_fV2yERkfAyzoO9oWSfORh5iH",image:"/assets/images/icons/Icon-144.png",locale:"auto",email:this.siteInfo.userInfo.emailAddress,token:function(t){e.fullMailingInfo.stripeToken=t.id,e.submitFullMailingAfterCharge()}});this.isLoading=!0,t.open({name:"Community Ally",description:"Mailing "+this.numPaperLettersToSend+" invoice"+(1===this.numPaperLettersToSend?"":"s"),zipCode:!0,amount:this.numPaperLettersToSend*this.paperInvoiceDollars*100}),window.addEventListener("popstate",function(){t.close()})}else 0===this.numEmailsToSend?alert("No e-mails or paper letters selected to send."):this.submitFullMailingAfterCharge()},e.prototype.submitFullMailingAfterCharge=function(){var e=this;this.isLoading=!0,this.$http.post("/api/Mailing/Send/Invoice",this.fullMailingInfo).then(function(t){e.isLoading=!1;var i="Your invoices have been successfully sent"+(t.data.hadErrors?", but there were errors":"")+". You can view the status in the history tab.";alert(i),e.$location.path("/Mailing/History")},function(t){e.isLoading=!1,alert("There was a problem sending your mailing, none were sent and you were not charged. Error: "+t.data.exceptionMessage)})},e.prototype.loadMailingInfo=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Mailing/RecipientInfo").then(function(t){e.isLoading=!1,e.fullMailingInfo=t.data,e.homesGridOptions.data=t.data.mailingEntries,e.homesGridOptions.minRowsToShow=t.data.mailingEntries.length,e.homesGridOptions.virtualizationThreshold=t.data.mailingEntries.length,e.selectedEntries=_.clone(t.data.mailingEntries)})},e.prototype.scrollToFirstAddressError=function(){var e=_.find(this.selectedEntries,function(e){return!1===e.isValidMailingAddress});if(e){var t=_.indexOf(this.selectedEntries,e);if(-1!==t){document.getElementById("recipient-entry-"+t).scrollIntoView()}}},e.prototype.toggleAllSending=function(e){var t=this;if(0!==this.selectedEntries.length)if("email"===e)for(var i=!this.selectedEntries[0].shouldSendEmail,n=0;n<this.selectedEntries.length;++n)HtmlUtil.isNullOrWhitespace(this.selectedEntries[n].emailAddresses)||!this.selectedEntries[n].amountDue?this.selectedEntries[n].shouldSendEmail=!1:this.selectedEntries[n].shouldSendEmail=i;else{for(i=!this.selectedEntries[0].shouldSendPaperMail,n=0;n<this.selectedEntries.length;++n)this.selectedEntries[n].streetAddressObject&&this.selectedEntries[n].amountDue?this.selectedEntries[n].shouldSendPaperMail=i:this.selectedEntries[n].shouldSendPaperMail=!1;if(i){if(i&&this.selectedEntries.length>0){var o=_.clone(this.selectedEntries);this.numAddressesToBulkValidate=o.length;var s=function(){t.testAddressRequiredFields(o[0]).then(function(){for(o.splice(0,1);o.length>0&&!o[0].amountDue;)o.splice(0,1);t.numAddressesToBulkValidate=o.length,o.length>0&&s()})};s()}}else _.each(this.selectedEntries,function(e){return e.isValidMailingAddress=e.validationMessage=null}),this.numInvalidMailingAddresses=0}},e.$inject=["$http","SiteInfo","fellowResidents","WizardHandler","$scope","$timeout","$location"],e}());e.MailingInvoiceController=i}(Ally||(Ally={})),CA.angularApp.component("mailingInvoice",{templateUrl:"/ngApp/common/mailing/mailing-invoice.html",controller:Ally.MailingInvoiceController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.siteInfo=t,this.$routeParams=i,this.$cacheFactory=n,this.$rootScope=o,this.selectedView=null,this.selectedView=this.$routeParams.viewName||"Invoice"}return e.prototype.$onInit=function(){},e.$inject=["$http","SiteInfo","$routeParams","$cacheFactory","$rootScope"],e}();e.MailingParentController=t}(Ally||(Ally={})),CA.angularApp.component("mailingParent",{templateUrl:"/ngApp/common/mailing/mailing-parent.html",controller:Ally.MailingParentController});!function(e){var t=function(){return function(){}}();e.MaintenanceProject=t;var i=function(){return function(){}}(),n=function(){return function(){}}();e.VendorListItem=n;var o=function(){function n(e,t,i,o,s){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.maintenanceService=o,this.fellowResidents=s,this.isSiteManager=!1,this.shouldShowEditEquipmentModal=!1,this.shouldShowManageEquipmentModal=!1,this.maintenanceEntries=[],this.assigneeOptions=[],this.equipmentTypeOptions=_.map(n.AutocompleteEquipmentTypeOptions,function(e){return e.text}),this.equipmentLocationOptions=_.map(n.AutocompleteLocationOptions,function(e){return e.text}),this.maintenanceTodoListId=i.privateSiteInfo.maintenanceTodoListId}return n.prototype.$onInit=function(){var e=this;this.equipmentGridOptions={data:[],columnDefs:[{field:"name",displayName:"Name",cellTemplate:'<div class="ui-grid-cell-contents"><span class="text-link" data-ng-if="grid.appScope.$ctrl.isSiteManager" data-ng-click="grid.appScope.$ctrl.editEquipment( row.entity )">{{ row.entity.name }}</span><span data-ng-if="!grid.appScope.$ctrl.isSiteManager">{{ row.entity.name }}</span></div>'},{field:"type",displayName:"Type",width:150},{field:"installDate",displayName:"Installed",width:90,cellFilter:"date:'shortDate'",type:"date"},{field:"initialCost",displayName:"Cost",width:90,cellFilter:"currency",type:"number"},{field:"addedDateUtc",displayName:"Added",width:90,cellFilter:"date:'shortDate'",type:"date"}],multiSelect:!1,enableSorting:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableFullRowSelection:!1,enableColumnMenus:!1,enableRowHeaderSelection:!1,onRegisterApi:function(e){HtmlUtil.uiGridFixScroll()}},this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.fellowResidents.getResidents().then(function(t){return e.assigneeOptions=_.clone(t)}),this.loadEquipment().then(function(){return e.loadVendors()}).then(function(){return e.loadProjects()}).then(function(){return e.loadMaintenanceTodos()}).then(function(){return e.rebuildMaintenanceEntries()})},n.prototype.rebuildMaintenanceEntries=function(){var t=this;this.maintenanceEntries=[],_.forEach(this.projects,function(i){var n=new e.MaintenanceEntry;n.project=i,t.maintenanceEntries.push(n)}),_.forEach(this.maintenanceTodos.todoItems,function(i){var n=new e.MaintenanceEntry;n.todo=i,t.maintenanceEntries.push(n)}),this.maintenanceEntries=_.sortBy(this.maintenanceEntries,function(e){return e.getCreatedDate()}).reverse()},n.prototype.loadEquipment=function(){var e=this;return this.isLoading=!0,this.$http.get("/api/Maintenance/Equipment").then(function(t){e.isLoading=!1,e.equipmentOptions=t.data,e.equipmentGridOptions.data=JSON.parse(JSON.stringify(e.equipmentOptions));var o=new i;o.name="Add New...",o.equipmentId=n.EquipmentId_AddNew,e.equipmentOptions.push(o),_.forEach(e.equipmentOptions,function(e){e.typeTags=[{text:e.type}],e.locationTags=[{text:e.location}]}),e.editingProject&&e.editingProject.equipmentId===n.EquipmentId_AddNew&&e.equipmentOptions.length>0&&(e.editingProject.equipmentId=_.max(e.equipmentOptions,function(e){return e.equipmentId}).equipmentId)},function(t){e.isLoading=!1,alert("Failed to retrieve equipment: "+t.data.exceptionMessage)})},n.prototype.deleteEquipment=function(){var e=this;confirm("Are you sure you want to delete this equipment? This action cannot be undone.")&&(this.isLoading=!0,this.$http.delete("/api/Maintenance/Equipment/"+this.editingEquipment.equipmentId).then(function(){e.isLoading=!1,e.editingEquipment=null,e.shouldShowEditEquipmentModal=!1,e.loadEquipment().then(function(){return e.loadProjects()}).then(function(){return e.rebuildMaintenanceEntries()})},function(t){e.isLoading=!1,alert("Failed to delete the equipment: "+t.data.exceptionMessage)}))},n.prototype.loadVendors=function(){var e=this;return this.isLoading=!0,this.$http.get("/api/PreferredVendors/ListItems").then(function(t){e.isLoading=!1,e.vendorOptions=t.data},function(t){e.isLoading=!1,alert("Failed to retrieve vendors: "+t.data.exceptionMessage)})},n.prototype.onEquipmentSelectionChange=function(){this.editingProject.equipmentId===n.EquipmentId_AddNew&&this.openAddNewEquipment()},n.prototype.loadProjects=function(){var e=this;return this.isLoading=!0,this.maintenanceService.loadProjects().then(function(t){e.isLoading=!1,e.projects=t},function(t){e.isLoading=!1,alert("Failed to retrieve projects: "+t.exceptionMessage)})},n.prototype.loadMaintenanceTodos=function(){var e=this;return this.isLoading=!0,this.$http.get("/api/Todo/MaintenanceList").then(function(t){e.isLoading=!1,e.maintenanceTodos=t.data})},n.prototype.onProjectStartDateChange=function(){this.editingProject.endDate||(this.editingProject.endDate=this.editingProject.startDate)},n.prototype.openAddNewProject=function(){this.editingProject=new t,setTimeout(function(){return $("#project-title-text-box").focus()},100)},n.prototype.openAddNewEquipment=function(){this.shouldShowEditEquipmentModal=!0,this.editingEquipment=new i,setTimeout(function(){return $("#equipment-name-text-box").focus()},100)},n.prototype.saveProject=function(){var e=this;this.isLoading=!0;(this.editingProject.maintenanceProjectId?this.$http.put:this.$http.post)("/api/Maintenance/Project",this.editingProject).then(function(){e.isLoading=!1,e.editingProject=null,e.loadProjects().then(function(){return e.rebuildMaintenanceEntries()})},function(t){e.isLoading=!1,alert("Failed to save: "+t.data.exceptionMessage)})},n.prototype.onEntryTypeChange=function(i){"todo"===i?(this.editingTodo=new e.TodoItem,this.editingTodo.owningTodoListId=this.maintenanceTodoListId,this.selectedAssignee=[],this.editingProject&&(this.editingTodo.description=this.editingProject.title),this.editingProject=null,setTimeout(function(){return $("#edit-todo-name-text-box").focus()},50)):(this.editingProject=new t,this.editingTodo&&(this.editingProject.title=this.editingTodo.description),this.editingTodo=null,setTimeout(function(){return $("#project-title-text-box").focus()},50))},n.prototype.saveTodo=function(){var e=this;this.isLoading=!0,this.selectedAssignee&&this.selectedAssignee.length>0&&(this.editingTodo.assignedToUserId=this.selectedAssignee[0].userId);(this.editingTodo.todoItemId?this.$http.put:this.$http.post)("/api/Todo/Item",this.editingTodo).then(function(){e.isLoading=!1,e.editingTodo=null,e.selectedAssignee=[],e.loadMaintenanceTodos().then(function(){return e.rebuildMaintenanceEntries()})},function(t){e.isLoading=!1,alert("Failed to save: "+t.data.exceptionMessage)})},n.prototype.saveEquipment=function(){var e=this;this.isLoading=!0,this.editingEquipment.locationTags&&this.editingEquipment.locationTags.length>0?this.editingEquipment.location=this.editingEquipment.locationTags[0].text:this.editingEquipment.location=void 0;(this.editingEquipment.equipmentId?this.$http.put:this.$http.post)("/api/Maintenance/Equipment",this.editingEquipment).then(function(){e.isLoading=!1,e.shouldShowEditEquipmentModal=!1,e.loadEquipment()},function(t){e.isLoading=!1,alert("Failed to save: "+t.data.exceptionMessage)})},n.prototype.getEquipmentLocationAutocomplete=function(e){return HtmlUtil.isNullOrWhitespace(e)?n.AutocompleteLocationOptions:_.where(n.AutocompleteLocationOptions,function(t){return-1!==t.text.toLowerCase().indexOf(e.toLowerCase())})},n.prototype.getEquipmentTypeAutocomplete=function(e){return this.editingEquipment.typeTags&&this.editingEquipment.typeTags.length>0&&!HtmlUtil.isNullOrWhitespace(this.editingEquipment.typeTags[0].text)?[]:HtmlUtil.isNullOrWhitespace(e)?n.AutocompleteEquipmentTypeOptions:_.where(n.AutocompleteEquipmentTypeOptions,function(t){return-1!==t.text.toLowerCase().indexOf(e.toLowerCase())})},n.prototype.editEquipment=function(e){this.shouldShowEditEquipmentModal=!0,this.editingEquipment=_.clone(e),setTimeout(function(){return $("#equipment-name-text-box").focus()},100)},n.prototype.onEditEntry=function(e){var t=this;if(e.project)this.editProject(e.project);else{this.editingTodo=_.clone(e.todo);for(var i=0;i<this.assigneeOptions.length;++i)this.assigneeOptions[i].isSelectedAssignee=!1;var n=_.find(this.assigneeOptions,function(e){return e.userId===t.editingTodo.assignedToUserId});n?(n.isSelectedAssignee=!0,this.selectedAssignee=[n]):this.selectedAssignee=[],setTimeout(function(){return $("#edit-todo-name-text-box").focus()},100)}},n.prototype.onDeleteEntry=function(e){var t=this;confirm("Are you sure you want to delete this entry? This action cannot be undone.")&&(e.project?this.onDeleteProject(e.project):(this.isLoading=!0,this.$http.delete("/api/Todo/Item/"+e.todo.todoItemId).then(function(){t.isLoading=!1,t.loadMaintenanceTodos().then(function(){return t.rebuildMaintenanceEntries()})},function(e){t.isLoading=!1,alert("Failed to delete to-do: "+e.data.exceptionMessage)})))},n.prototype.editProject=function(e){this.editingProject=_.clone(e),setTimeout(function(){return $("#project-title-text-box").focus()},100)},n.prototype.onDeleteProject=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Maintenance/Project/"+e.maintenanceProjectId).then(function(){t.isLoading=!1,t.loadProjects().then(function(){return t.rebuildMaintenanceEntries()})},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)})},n.$inject=["$http","$rootScope","SiteInfo","maintenance","fellowResidents"],n.EquipmentId_AddNew=-5,n.AutocompleteLocationOptions=[{text:"Attic"},{text:"Back Yard"},{text:"Basement"},{text:"Front Yard"},{text:"Inside"},{text:"Kitchen"},{text:"Outside"},{text:"Side of Building"},{text:"Structural"}],n.AutocompleteEquipmentTypeOptions=[{text:"Appliance"},{text:"Deck"},{text:"Driveway"},{text:"HVAC"},{text:"Patio"},{text:"Plumbing"},{text:"Roof"},{text:"Siding"},{text:"Structural"}],n}();e.MaintenanceController=o}(Ally||(Ally={})),CA.angularApp.component("maintenance",{bindings:{},templateUrl:"/ngApp/common/maintenance.html",controller:Ally.MaintenanceController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.upcomingWork=[],this.recentProjects=[]}return e.prototype.$onInit=function(){this.loadProjects()},e.prototype.loadProjects=function(){var e=this;return this.isLoading=!0,this.$http.get("/api/Maintenance/Projects").then(function(t){e.isLoading=!1,e.recentProjects=_.take(t.data,3)},function(t){e.isLoading=!1,alert("Failed to retrieve projects: "+t.data.exceptionMessage)})},e.$inject=["$http","$rootScope","SiteInfo"],e}();e.MaintenanceWidgetController=t}(Ally||(Ally={})),CA.angularApp.component("maintenanceWidget",{templateUrl:"/ngApp/common/maintenance-widget.html",controller:Ally.MaintenanceWidgetController});!function(e){var t=function(){return function(){}}();e.SplitAddress=t;var i=function(){return function(){}}();e.GpsPoint=i;var n=function(){return function(){}}();e.GpsPolygon=n;var o=function(){return function(){}}();e.FullAddress=o;var s=function(){function e(){}return e.parseAddressComponents=function(e){for(var i=new t,n="",o="",s=0,a=e;s<a.length;s++){var r=a[s];-1!==r.types.indexOf("street_number")?n=r.short_name:-1!==r.types.indexOf("route")?o=r.short_name:-1!==r.types.indexOf("locality")?i.city=r.short_name:-1!==r.types.indexOf("administrative_area_level_1")?i.state=r.short_name:-1!==r.types.indexOf("postal_code")?i.zip=r.short_name:-1!==r.types.indexOf("country")&&(i.country=r.short_name)}return i.street=n+" "+o,i},e.gpsBoundsToGooglePoly=function(e){return _.map(e.vertices,function(e){return new google.maps.LatLng(e.lat,e.lon)})},e}();e.MapUtil=s}(Ally||(Ally={}));!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$rootScope=i,this.isLoading=!1,this.returnUrl="https://localtest.mycondoally.com/#!/Home"}return e.prototype.$onInit=function(){var e=this;null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0?this.assessmentAmount=this.siteInfo.userInfo.usersUnits[0].assessment:this.assessmentAmount=0,this.errorPayInfoText="Is the amount incorrect?",this.paymentInfo={paymentType:"other",amount:this.assessmentAmount,note:"",fundingType:null,paysFor:null};if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments&&this.recentPayments.length>0)for(this.recentPayments.length>6&&(this.recentPayments=this.recentPayments.slice(0,6));this.recentPayments.length<6;)this.recentPayments.push({});null!=this.siteInfo.privateSiteInfo.assessmentFrequency&&null!=this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())),setTimeout(function(){$("#btn_view_pay_history").click(function(){$("#pm_info").collapse("hide"),$("#payment_history").collapse("show")}),$("#btn_view_pay_info").click(function(){$("#payment_history").collapse("hide"),$("#pm_info").collapse("show")}),$(".hide").click(function(){$(this).parent().hide("")})},400),paypal.Button.render({env:"sandbox",commit:!0,style:{color:"gold",size:"medium"},client:{sandbox:null,production:"AW51-dH9dRrczrhVVf1kZyavtifN8z23Q0BTJwpWcTJQL6YoqGCTwOb0JfbCHTJIA_usIXAgrxwQ7osQ"},payment:function(t,i){return e.isLoading=!0,i.payment.create({payment:{transactions:[{amount:{total:e.paymentInfo.amount.toString(),currency:"USD"}}]}})},onAuthorize:function(t,i){return i.payment.execute().then(function(t){var i={PayPalCheckoutId:t.id,Memo:e.paymentInfo.note};e.isLoading=!0,e.$http.put("/api/OnlinePayment/SetMemo",i).then(function(t){e.isLoading=!1},function(t){e.isLoading=!1,alert("Failed to save: "+t.data.exceptionMessage)})})},onCancel:function(t,i){e.isLoading=!1},onError:function(t){e.isLoading=!1}},"#paypal-button")},e.prototype.onIncorrectPayDetails=function(){var e=this.assessmentAmount.toString();Math.round(this.assessmentAmount)!=this.assessmentAmount&&(e=this.assessmentAmount.toFixed(2));var t=e;this.knowsNextPayment&&HtmlUtil.isValidString(this.nextPaymentText)&&(t+="|"+this.nextPaymentText),this.$rootScope.$broadcast("prepAssessmentEmailToBoard",t)},e.prototype.getNextPaymentText=function(e,t){if(null==e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];if("month"===n.intervalName){i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]}else if("quarter"===n.intervalName){i=["Q1","Q2","Q3","Q4"][s.period-1]}else if("half-year"===n.intervalName){i=["First Half","Second Half"][s.period-1]}i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},e.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"==e?this.assessmentAmount:0,this.updatePaymentText()},e.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},e.$inject=["$http","SiteInfo","$rootScope"],e}();e.PayPalPaymentFormController=t}(Ally||(Ally={})),CA.angularApp.component("paypalPaymentForm",{templateUrl:"/ngApp/common/paypal-payment-form.html",controller:Ally.PayPalPaymentFormController});!function(e){var t=function(){function t(e,t){this.$http=e,this.siteInfo=t,this.isLoading=!1,this.isSiteManager=!1,this.isInEditMode=!1}return t.prototype.$onInit=function(){var t=this;this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.isAddForm=null==this.vendorItem,this.isAddForm&&(this.isInEditMode=!0,this.vendorItem=new e.PreferredVendor,this.editVendorItem=new e.PreferredVendor,window.setTimeout(function(){return t.hookupAddressAutocomplete()},500))},t.prototype.hookupAddressAutocomplete=function(){if("US"===this.siteInfo.privateSiteInfo.country||"CA"===this.siteInfo.privateSiteInfo.country){$(".mask-phone").mask("(999) 999-9999? x999",{autoclear:!1})}var t=void 0;if(this.siteInfo.publicSiteInfo.googleGpsPosition){t={bounds:new google.maps.Circle({center:this.siteInfo.publicSiteInfo.googleGpsPosition,radius:40234}).getBounds()}}var i=document.getElementById("vendor-"+(this.vendorItem.preferredVendorId||"")+"-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(i,t);var n=this;google.maps.event.addListener(this.addressAutocomplete,"place_changed",function(){var t=n.addressAutocomplete.getPlace();n.editVendorItem.fullAddress||(n.editVendorItem.fullAddress=new e.FullAddress),n.editVendorItem.fullAddress.oneLiner=t.formatted_address})},t.prototype.onSaveVendor=function(){var t=this;if(HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyName))alert("Please enter a company name");else if(this.editVendorItem.servicesTagArray&&0!==this.editVendorItem.servicesTagArray.length){HtmlUtil.isNullOrWhitespace(this.editVendorItem.companyWeb)||0!==this.editVendorItem.companyWeb.indexOf("http")&&(this.editVendorItem.companyWeb="http://"+this.editVendorItem.companyWeb);var i=null==this.editVendorItem.preferredVendorId?this.$http.post:this.$http.put;this.isLoading=!0;var n="";_.each(this.editVendorItem.servicesTagArray,function(e){n+="|"+e.text}),n+="|",this.editVendorItem.servicesProvided=n;var o=this;i("/api/PreferredVendors",this.editVendorItem).success(function(){o.isLoading=!1,t.isAddForm?(o.editVendorItem=new e.PreferredVendor,o.onAddNewVendor&&o.onAddNewVendor()):o.isInEditMode=!1,o.onParentDataNeedsRefresh&&o.onParentDataNeedsRefresh()}).error(function(e){o.isLoading=!1,alert("Failed to save the vendor information: "+e.exceptionMessage)})}else alert("Please enter at least one service provided")},t.prototype.onCancelEdit=function(){this.isInEditMode=!1},t.prototype.onEditItem=function(){this.editVendorItem=JSON.parse(JSON.stringify(this.vendorItem)),this.isInEditMode=!0;var e=this;window.setTimeout(function(){e.hookupAddressAutocomplete()},500)},t.prototype.deleteItem=function(){if(confirm("Are you sure you want to remove this vendor?")){this.isLoading=!0;var e=this;this.$http.delete("/api/PreferredVendors/"+this.vendorItem.preferredVendorId).success(function(){e.isLoading=!1,e.onParentDataNeedsRefresh&&e.onParentDataNeedsRefresh()}).error(function(t){e.isLoading=!1,alert("Failed to delete the vendor: "+t.exceptionMessage)})}},t.prototype.getServiceAutocomplete=function(e){return _.where(t.AutocompleteServiceOptions,function(t){return-1!==t.text.toLowerCase().indexOf(e.toLowerCase())})},t.$inject=["$http","SiteInfo"],t.AutocompleteServiceOptions=[{text:"Additions & Remodels"},{text:"Appliances"},{text:"Cabinets & Countertops"},{text:"Cleaning"},{text:"Concrete & Masonry"},{text:"Deck, Porch, & Gazebo"},{text:"Drywall & Insulation"},{text:"Electrical"},{text:"Fencing"},{text:"Flooring"},{text:"Garages"},{text:"Gutters"},{text:"Handy Man"},{text:"HVAC"},{text:"Landscaping, Lawn Care & Sprinklers"},{text:"Painting & Staining"},{text:"Pest Control"},{text:"Plumbing"},{text:"Remodeling"},{text:"Roofing"},{text:"Siding"},{text:"Snow Removal"},{text:"Solar Electric, Heating & Cooling"},{text:"Swimming Pools"},{text:"Windows & Doors"}],t}();e.PreferredVendorItemController=t}(Ally||(Ally={})),CA.angularApp.component("preferredVendorItem",{bindings:{vendorItem:"=?",onParentDataNeedsRefresh:"&?",onAddNewVendor:"&?"},templateUrl:"/ngApp/common/preferred-vendor-item.html",controller:Ally.PreferredVendorItemController});!function(e){var t=function(){return function(){this.fullAddress=new e.FullAddress}}();e.PreferredVendor=t;var i=function(){function e(e,i){this.$http=e,this.siteInfo=i,this.allVendors=[],this.filteredVendors=[],this.editVendor=new t,this.isLoading=!1,this.isSiteManager=!1,this.usedServiceTags=[],this.filterTags=[]}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.retrieveVendors()},e.prototype.retrieveVendors=function(){this.isLoading=!0;var e=this;this.$http.get("/api/PreferredVendors").success(function(t){e.isLoading=!1,e.allVendors=t,e.filteredVendors=t,e.usedServiceTags=[],_.each(e.allVendors,function(t){t.servicesTagArray=[],_.each(t.servicesProvidedSplit,function(e){return t.servicesTagArray.push({text:e})}),e.usedServiceTags=e.usedServiceTags.concat(t.servicesProvidedSplit),t.addedDateUtc=moment.utc(t.addedDateUtc).toDate()}),e.usedServiceTags=_.uniq(e.usedServiceTags),e.usedServiceTags.sort()})},e.prototype.onTagFilterToggle=function(e){var t=this.filterTags.indexOf(e);if(-1===t?this.filterTags.push(e):this.filterTags.splice(t,1),0===this.filterTags.length)this.filteredVendors=this.allVendors;else{this.filteredVendors=[];var i=this;_.each(this.allVendors,function(e){_.intersection(e.servicesProvidedSplit,i.filterTags).length>0&&i.filteredVendors.push(e)})}},e.prototype.onAddedNewVendor=function(){this.retrieveVendors()},e.$inject=["$http","SiteInfo"],e}();e.PreferredVendorsController=i}(Ally||(Ally={})),CA.angularApp.component("preferredVendors",{templateUrl:"/ngApp/common/preferred-vendors.html",controller:Ally.PreferredVendorsController});!function(e){var t=function(){function e(e,t){this.$http=e,this.siteInfo=t}return e.prototype.$onInit=function(){},e.prototype.onComponentChange=function(){this.onChange&&this.onChange()},e.$inject=["$http","SiteInfo"],e}();e.StreetAddressFormController=t}(Ally||(Ally={})),CA.angularApp.component("streetAddressForm",{bindings:{streetAddress:"=",onChange:"&"},templateUrl:"/ngApp/common/street-address-form.html",controller:Ally.StreetAddressFormController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.isSiteManager=!1,this.hideDocuments=!1,this.selectedView="docs"}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.hideDocuments=this.siteInfo.userInfo.isRenter&&!this.siteInfo.privateSiteInfo.rentersCanViewDocs,this.hideDocuments?this.selectedView="info":this.selectedView="docs"},e.$inject=["$http","SiteInfo","$cacheFactory"],e}();e.HoaInfoController=t}(Ally||(Ally={})),CA.angularApp.component("hoaInfo",{templateUrl:"/ngApp/hoa/member/HoaInfo.html",controller:Ally.HoaInfoController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.$cacheFactory=i,this.isSiteManager=!1}return e.prototype.$onInit=function(){this.isSiteManager=this.siteInfo.userInfo.isSiteManager},e.$inject=["$http","SiteInfo","$cacheFactory"],e}();e.HoaHomeController=t}(Ally||(Ally={})),CA.angularApp.component("hoaHome",{templateUrl:"/ngApp/hoa/member/Home.html",controller:Ally.HoaHomeController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.appCacheService=o}return e.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");HtmlUtil.getSubdomain(window.location.host);this.allyAppName=AppConfig.appName;if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments)for(this.recentPayments.length>6&&(this.recentPayments=this.recentPayments.slice(0,6)),this.numRecentPayments=this.recentPayments.length;this.recentPayments.length<6;)this.recentPayments.push({});this.messageObject={},null!==this.siteInfo.privateSiteInfo.assessmentFrequency&&null!==this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText())),this.refreshData()},e.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},e.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"===e?this.siteInfo.userInfo.assessmentAmount:0,this.updatePaymentText()},e.prototype.getNextPaymentText=function(e,t){if(null===e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];if("month"===n.intervalName){i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]}else if("quarter"===n.intervalName){i=["Q1","Q2","Q3","Q4"][s.period-1]}else if("half-year"===n.intervalName){i=["First Half","Second Half"][s.period-1]}i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},e.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},e.prototype.onIncorrectPayDetails=function(){this.messageObject.recipientType="board",this.knowsNextPayment?this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" will cover "+this.nextPaymentText+", but I believe that is incorrect. My records indicate my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+this.siteInfo.userInfo.assessmentAmount+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},e.prototype.refreshData=function(){HtmlUtil.getSubdomain(window.location.host);if(!1,"localnews"===this.homeRightColumnType){this.isLoading_LocalNews=!0;var e,t;"US"===this.siteInfo.privateSiteInfo.country?(e="https://localnewsally.org/api/LocalNews",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:this.siteInfo.publicSiteInfo.chicagoWard,zipCode:this.siteInfo.publicSiteInfo.zipCode,cityNeighborhood:this.siteInfo.publicSiteInfo.localNewsNeighborhoodQuery}):(e="https://localnewsally.org/api/LocalNews/International/MajorCity",t={clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",countryCode:this.siteInfo.privateSiteInfo.country,city:this.siteInfo.privateSiteInfo.groupAddress.city});var i=this;this.$http.get(e,{cache:!0,params:t}).then(function(e){i.localNews=e.data,i.isLoading_LocalNews=!1})}},e.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService"],e}();e.HomeGroupHomeController=t}(Ally||(Ally={})),CA.angularApp.component("homeGroupHome",{templateUrl:"/ngApp/home/home-group-home.html",controller:Ally.HomeGroupHomeController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.shouldShowWidget=!1}return e.prototype.$onInit=function(){this.retrieveInfo()},e.prototype.retrieveInfo=function(){var e=this;this.isLoading=!0,this.$http.get("/api/HomeValue/ZillowInfo").then(function(t){e.isLoading=!1,e.shouldShowWidget=!!t.data&&!!t.data.chartImageUri,e.shouldShowWidget&&(e.valueInfo=t.data)},function(t){e.isLoading=!1,e.shouldShowWidget=!1})},e.$inject=["$http","$rootScope","SiteInfo"],e}();e.HomeValueWidgetController=t}(Ally||(Ally={})),CA.angularApp.component("homeValueWidget",{templateUrl:"/ngApp/home/home-value-widget.html",controller:Ally.HomeValueWidgetController});!function(e){var t=function(){function e(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.isAdmin=!1}return e.prototype.$onInit=function(){},e.$inject=["$http","$rootScope","SiteInfo"],e}();e.HomeUsersController=t}(Ally||(Ally={})),CA.angularApp.component("homeUsers",{templateUrl:"/ngApp/home/manager/home-users.html",controller:Ally.HomeUsersController});!function(e){var t=function(){return function(){}}(),i=function(){return function(){}}();e.HomeInfo=i;var n=function(){return function(){this.signerUpInfo=new t,this.streetAddress="",this.homeInfo=new i}}(),o="Acres",s=function(){function t(e,t,i){this.$http=e,this.$scope=t,this.WizardHandler=i,this.lotSizeUnit=o,this.lotSquareUnits=0,this.signUpInfo=new n,this.isLoadingHomeInfo=!1,this.didLoadHomeInfo=!1,this.isLoading=!1,this.hideWizard=!1,this.hasAlreadyCheckedForHomeInfo=!1}return t.prototype.$onInit=function(){var e=this;this.$scope.$on("wizard:stepChanged",function(t,i){1===i.index&&e.retrieveHomeInfoForAddress()});setTimeout(function(){e.initMap()},300)},t.prototype.retrieveHomeInfoForAddress=function(){var e=this;if(!HtmlUtil.isNullOrWhitespace(this.signUpInfo.streetAddress)&&!this.hasAlreadyCheckedForHomeInfo){this.hasAlreadyCheckedForHomeInfo=!0;var t="/api/HomeSignUp/HomeInfo?streetAddress="+encodeURIComponent(this.signUpInfo.streetAddress);this.$http.get(t,{cache:!0}).then(function(t){t.data&&(e.signUpInfo.homeInfo=t.data,e.didLoadHomeInfo=!0,e.processLotSizeHint(e.signUpInfo.homeInfo.lotSquareFeet))})}},t.prototype.processLotSizeHint=function(e){e&&(e>43560?(this.lotSizeUnit=o,this.lotSquareUnits=e/43560,this.lotSquareUnits=parseFloat((Math.round(4*this.lotSquareUnits)/4).toFixed(2))):(this.lotSizeUnit="SquareFeet",this.lotSquareUnits=e))},t.prototype.initMap=function(){var t=document.getElementById("address-map");this.map=new google.maps.Map(t,{center:{lat:41.869638,lng:-87.657423},zoom:9}),this.mapMarker=new google.maps.Marker({map:this.map,anchorPoint:new google.maps.Point(41.969638,-87.657423),icon:"/assets/images/MapMarkers/MapMarker_Home.png",position:null});var i=document.getElementById("home-address-text-box");this.addressAutocomplete=new google.maps.places.Autocomplete(i),this.addressAutocomplete.bindTo("bounds",this.map);var n=this;this.addressAutocomplete.addListener("place_changed",function(){n.mapMarker.setVisible(!1);var t=n.addressAutocomplete.getPlace(),i=t.formatted_address;i.indexOf(", USA")===i.length-", USA".length&&(i=i.substring(0,i.length-", USA".length)),n.signUpInfo.streetAddress=i,n.selectedSplitAddress=e.MapUtil.parseAddressComponents(t.address_components),t.geometry&&n.centerMap(t.geometry),$("#association-name-text-box").focus()})},t.prototype.goNextStep=function(){this.WizardHandler.wizard().next()},t.prototype.onFinishedWizard=function(){this.isLoading=!0;var e=this;this.$http.post("/api/HomeSignUp",this.signUpInfo).then(function(t){e.isLoading=!1;var i=t.data;HtmlUtil.isNullOrWhitespace(i.errorMessage)?HtmlUtil.isNullOrWhitespace(i.createUrl)?(e.hideWizard=!0,e.resultMessage="Great work! We just sent you an e-mail with instructions on how access your new site."):window.location.href=i.createUrl:(alert("Failed to complete sign-up: "+i.errorMessage),i.stepIndex>=0&&e.WizardHandler.wizard().goTo(i.stepIndex))},function(t){e.isLoading=!1;var i=t.data.exceptionMessage?t.data.exceptionMessage:t.data;alert("Failed to complete sign-up: "+i)})},t.prototype.onHomeAddressChanged=function(){var e=this;HtmlUtil.geocodeAddress(this.signUpInfo.streetAddress,function(t,i){e.$scope.$apply(function(){if(i==google.maps.GeocoderStatus.OK){var n=t[0].formatted_address;n.indexOf(", USA")===n.length-", USA".length&&(n=n.substring(0,n.length-", USA".length)),e.signUpInfo.streetAddress=n,e.centerMap(t[0].geometry)}})})},t.prototype.centerMap=function(e){e.viewport?this.map.fitBounds(e.viewport):(this.map.setCenter(e.location),this.map.setZoom(17)),this.mapMarker.setPosition(e.location),this.mapMarker.setVisible(!0)},t.prototype.prepopulateHomeInfo=function(){if(this.selectedSplitAddress){this.isLoadingHomeInfo=!0;var e="/api/PropertyResearch/HomeInfo?street="+encodeURIComponent(this.selectedSplitAddress.street)+"&city="+encodeURIComponent(this.selectedSplitAddress.city)+"&state="+this.selectedSplitAddress.state+"&zip="+this.selectedSplitAddress.zip,t=this;this.$http.get(e).then(function(e){t.isLoadingHomeInfo=!1;var i=e.data;i&&(t.didLoadHomeInfo=!0,t.signUpInfo.homeInfo=i,t.processLotSizeHint(i.lotSquareFeet))},function(){t.isLoadingHomeInfo=!1})}},t.$inject=["$http","$scope","WizardHandler"],t}();e.HomeSignUpController=s}(Ally||(Ally={})),CA.angularApp.component("homeSignUp",{templateUrl:"/ngApp/home/public/home-sign-up.html",controller:Ally.HomeSignUpController});!function(e){var t=function(){function e(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$timeout=n,this.appCacheService=o}return e.prototype.$onInit=function(){this.welcomeMessage=this.siteInfo.privateSiteInfo.welcomeMessage,this.isFirstVisit=null===this.siteInfo.userInfo.lastLoginDateUtc,this.isSiteManager=this.siteInfo.userInfo.isSiteManager,this.showFirstVisitModal=this.isFirstVisit&&!this.$rootScope.hasClosedFirstVisitModal&&null===this.siteInfo.privateSiteInfo.siteLaunchedDateUtc,this.homeRightColumnType=this.siteInfo.privateSiteInfo.homeRightColumnType,this.homeRightColumnType||(this.homeRightColumnType="localnews");HtmlUtil.getSubdomain(window.location.host);this.allyAppName=AppConfig.appName;if(this.recentPayments=this.siteInfo.userInfo.recentPayments,this.recentPayments)for(this.recentPayments.length>6&&(this.recentPayments=this.recentPayments.slice(0,6)),this.numRecentPayments=this.recentPayments.length;this.recentPayments.length<6;)this.recentPayments.push({});this.messageObject={},null!==this.siteInfo.privateSiteInfo.assessmentFrequency&&null!==this.siteInfo.userInfo.usersUnits&&this.siteInfo.userInfo.usersUnits.length>0&&(this.paymentInfo.paymentType="periodic",this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled&&(this.knowsNextPayment=!0,this.errorPayInfoText="Is the amount or date incorrect?",this.nextPaymentText=this.getNextPaymentText(this.siteInfo.userInfo.usersUnits[0].nextAssessmentDue,this.siteInfo.privateSiteInfo.assessmentFrequency),this.updatePaymentText()))},e.prototype.updatePaymentText=function(){"periodic"===this.paymentInfo.paymentType&&this.siteInfo.privateSiteInfo.isPeriodicPaymentTrackingEnabled?HtmlUtil.isNullOrWhitespace(this.nextPaymentText)||(this.siteInfo.userInfo.usersUnits[0].includesLateFee?this.paymentInfo.note="Assessment payment with late fee for ":this.paymentInfo.note="Assessment payment for ",this.paymentInfo.note+=this.nextPaymentText):this.paymentInfo.note=""},e.prototype.onSelectPaymentType=function(e){this.paymentInfo.paymentType=e,this.paymentInfo.amount="periodic"===e?this.siteInfo.userInfo.assessmentAmount:0,this.updatePaymentText()},e.prototype.getNextPaymentText=function(e,t){if(null===e)return"";e.constructor!==Array&&(e=[e]);for(var i="",n=FrequencyIdToInfo(t),o=0;o<e.length;++o){var s=e[o];if("month"===n.intervalName){i=["January","February","March","April","May","June","July","August","September","October","November","December"][s.period-1]}else if("quarter"===n.intervalName){i=["Q1","Q2","Q3","Q4"][s.period-1]}else if("half-year"===n.intervalName){i=["First Half","Second Half"][s.period-1]}i+=" "+s.year,this.paymentInfo.paysFor=[s]}return i},e.prototype.hideFirstVisit=function(){this.$rootScope.hasClosedFirstVisitModal=!0,this.showFirstVisitModal=!1},e.prototype.onIncorrectPayDetails=function(){this.messageObject.recipientType="board",this.knowsNextPayment?this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" will cover "+this.nextPaymentText+", but I believe that is incorrect. My records indicate my next payment of $"+this.siteInfo.userInfo.assessmentAmount+" should pay for [INSERT PROPER DATE HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName:this.messageObject.message="Hello Boardmembers,\n\nOur association's home page says my assessment payment is $"+this.siteInfo.userInfo.assessmentAmount+", but I believe that is incorrect. My records indicate my assessment payments should be $[INSERT PROPER AMOUNT HERE]. What do you need from me to resolve the issue?\n\n- "+this.siteInfo.userInfo.firstName,document.getElementById("send-email-panel").scrollIntoView()},e.$inject=["$http","$rootScope","SiteInfo","$timeout","appCacheService"],e}();e.PtaGroupHomeController=t}(Ally||(Ally={})),CA.angularApp.component("ptaGroupHome",{templateUrl:"/ngApp/pta/pta-group-home.html",controller:Ally.PtaGroupHomeController});function ServiceBankInfoCtrl(e){}ServiceBankInfoCtrl.$inject=["$http"];function ServiceBusinessInfoCtrl(e){}ServiceBusinessInfoCtrl.$inject=["$http"];function ServiceJobsCtrl(e){}ServiceJobsCtrl.$inject=["$http"],CA.angularApp.directive("googleMapPolyEditor",["$http",function(e){return{scope:{editPolyVerts:"=",visiblePolys:"=",visiblePoints:"=",groupBoundsPoly:"=",mapCenter:"=",onMapEditorReady:"&",enableMapControls:"="},restrict:"E",replace:"true",templateUrl:"/ngApp/Services/GoogleMapPolyEditorTemplate.html",link:function(e,t,i){e.mapInfo={center:{lat:39.5,lng:-98.35},zoom:4,disableDefaultUI:!e.enableMapControls,mapTypeId:google.maps.MapTypeId.HYBRID,events:{tilesloaded:function(e,t,i){google.maps.event.clearListeners(e,"tilesloaded")}}},e.googlePolyToGpsBounds=function(e){return e=_.map(e,function(e){return{lat:e.lat(),lon:e.lng()}})},e.centerMapOnPoly=function(t){if(t&&0!==t.length){var i=new google.maps.LatLngBounds;_.map(t,function(e){i.extend(e)}),e.mapInstance.fitBounds(i)}},e.setGroupBounds=function(t){if(t){var i={paths:Ally.MapUtil.gpsBoundsToGooglePoly(t),map:e.mapInstance,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:1,fillColor:"#0000FF",fillOpacity:.15,zIndex:-1};e.activeShape&&e.activeShape.setMap(null),e.groupBoundsShape=new google.maps.Polygon(i)}else e.groupBoundsShape&&(e.groupBoundsShape.setMap(null),e.groupBoundsShape=null)},e.fitBoundsForPolys=function(){var t=new google.maps.LatLngBounds;(e.groupBoundsShape||e.currentVisiblePolys&&0!==e.currentVisiblePolys.length)&&(e.groupBoundsShape&&_.each(e.groupBoundsShape.getPath().getArray(),function(e){t.extend(e)}),_.each(e.currentVisiblePolys,function(e){_.each(e.getPath().getArray(),function(e){t.extend(e)})}),e.mapInstance.fitBounds(t))},e.fitBoundsForPoints=function(){if(e.currentVisiblePoints&&0!==e.currentVisiblePoints.length){var t=new google.maps.LatLngBounds;_.each(e.currentVisiblePoints,function(e){t.extend(e.position)}),e.mapInstance.fitBounds(t)}};var n=function(e){var t=function(e){return $("img[src$='"+e+"']")},i=this,n=t(i.btnDeleteImageUrl);if(0===n.length){var o=$("img[src$='http://maps.gstatic.com/mapfiles/undo_poly.png']");o.parent().css("height","21px !important"),o.parent().parent().append('<div style="overflow-x: hidden; overflow-y: hidden; position: absolute; width: 30px; height: 27px;top:21px;"><img src="'+i.btnDeleteImageUrl+'" class="deletePoly" style="height:auto; width:auto; position: absolute; left:0;"/></div>'),(n=t(i.btnDeleteImageUrl)).hover(function(){return $(this).css("left","-30px"),!1},function(){return $(this).css("left","0px"),!1}),n.mousedown(function(){return $(this).css("left","-60px"),!1})}i.btnDeleteClickHandler&&n.unbind("click",i.btnDeleteClickHandler),i.btnDeleteClickHandler=function(){return i.removeAt(e),!1},n.click(i.btnDeleteClickHandler)};e.currentVisiblePolys=[],e.currentVisiblePoints=[],e.onVisiblePolysChange=function(t){_.each(e.currentVisiblePolys,function(e){e.setMap(null)}),e.currentVisiblePolys=[],_.each(t,function(t){var i={paths:Ally.MapUtil.gpsBoundsToGooglePoly(t),clickable:"function"==typeof t.onClick,map:e.mapInstance,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.35},n=new google.maps.Polygon(i);n.polyInfo=t,t.mapShapeObject=n,e.currentVisiblePolys.push(n),i.clickable&&google.maps.event.addListener(n,"click",function(){n.polyInfo.onClick()})}),e.fitBoundsForPolys()},e.onVisiblePointsChange=function(t){_.each(e.currentVisiblePoints,function(e){e.setMap(null)}),e.currentVisiblePoints=[],_.each(t,function(t){var i=new google.maps.Marker({position:{lat:t.lat,lng:t.lon},map:e.mapInstance,title:t.fullAddress});i.pointSource=t,e.currentVisiblePoints.push(i),"function"==typeof t.onClick&&google.maps.event.addListener(i,"click",function(){i.pointSource.onClick()})}),e.fitBoundsForPoints()},e.onEditPolyChange=function(t){if(!t)return e.activeShape&&e.activeShape.setMap(null),void(e.activeShape=null);var i=_.map(t.vertices,function(e){return new google.maps.LatLng(e.lat,e.lon)});e.centerMapOnPoly(i);var o={paths:i,editable:!0,draggable:!0,clickable:!0,map:e.mapInstance,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35};e.activeShape&&e.activeShape.setMap(null),e.activeShape=new google.maps.Polygon(o);var s=function(){e.editPolyVerts.vertices=e.googlePolyToGpsBounds(e.activeShape.getPath().getArray())};return google.maps.event.addListener(e.activeShape.getPath(),"set_at",s),google.maps.event.addListener(e.activeShape.getPath(),"insert_at",s),function(e,t){var i=e.getPath();i.btnDeleteClickHandler={},i.btnDeleteImageUrl=t,google.maps.event.addListener(e.getPath(),"set_at",n),google.maps.event.addListener(e.getPath(),"insert_at",n)}(e.activeShape,"http://i.imgur.com/RUrKV.png"),e.activeShape},e.$watch("editPolyVerts",function(t){e.onEditPolyChange(t)}),e.$watch("visiblePolys",function(t){e.onVisiblePolysChange(t)}),e.$watch("visiblePoints",function(t){e.onVisiblePointsChange(t)}),e.$watch("groupBoundsPoly",function(t){e.setGroupBounds(t)}),e.$watch("mapCenter",function(t){t&&(t=new google.maps.LatLng(t.lat,t.lon),e.mapInstance.setCenter(t))}),e.mapInstance=new google.maps.Map($(t).children(".google-map-canvas")[0],e.mapInfo),e.onMapEditorReady&&e.onMapEditorReady({mapInstance:e.mapInstance}),google.maps.event.addListener(e.mapInstance,"click",function(t){var i={lat:t.latLng.lat(),lon:t.latLng.lng()},n={lat:t.latLng.lat()+.01,lon:t.latLng.lng()+.01},o=[i,{lat:n.lat,lon:i.lon},n,{lat:i.lat,lon:n.lon}];e.editPolyVerts&&(e.editPolyVerts.vertices=o),e.onEditPolyChange(e.editPolyVerts)})}}}]),angular.module("CondoAlly").directive("ngEnter",function(){return function(e,t,i){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(i.ngEnter,{event:t})}),t.preventDefault())})}}),angular.module("CondoAlly").directive("ngEscape",function(){return function(e,t,i){t.bind("keydown keypress",function(t){27===t.which&&(e.$apply(function(){e.$eval(i.ngEscape,{event:t})}),t.preventDefault())})}}),CA.angularApp.filter("iif",function(){return function(e,t,i){return e?t:i}}),CA.angularApp.filter("tel",function(){return function(e){if(!e)return"";var t=e.toString().trim().replace(/^\+/,"");if(t.match(/[^0-9]/))return e;var i,n,o;switch(t.length){case 7:i=1,n="",o=t;break;case 10:i=1,n=t.slice(0,3),o=t.slice(3);break;case 11:i=t[0],n=t.slice(1,4),o=t.slice(4);break;case 12:i=t.slice(0,3),n=t.slice(3,5),o=t.slice(5);break;default:return n="",e}return 1===i&&(i=""),o=o.slice(0,3)+"-"+o.slice(3),n.length>0&&(n="("+n+")"),(i+" "+n+" "+o).trim()}});!function(e){var t=function(){return function(){}}();e.ExceptionResult=t}(Ally||(Ally={}));var AppCacheService=function(){function e(){this.Key_WasLoggedIn403="wasLoggedIn403",this.Key_WasLoggedIn401="wasLoggedIn401",this.Key_AfterLoginRedirect="afterLoginRedirect",this.KeyPrefix="AppCacheService_"}return e.prototype.set=function(e,t){window.sessionStorage[this.KeyPrefix+e]=t},e.prototype.get=function(e){return window.sessionStorage[this.KeyPrefix+e]},e.prototype.clear=function(e){window.sessionStorage[this.KeyPrefix+e]=void 0,delete window.sessionStorage[this.KeyPrefix+e]},e.prototype.getAndClear=function(e){var t;return t=this.get(e),this.clear(e),t},e}();angular.module("CondoAlly").service("appCacheService",[AppCacheService]);!function(e){var t=function(){return function(){}}();e.CsvColumnDescriptor=t;function i(e){if(!e)return"";var t=e.toString();if(HtmlUtil.isNullOrWhitespace(t))return"";return(-1!==t.indexOf('"')||-1!==t.indexOf(",")||-1!==t.indexOf("\r")||-1!==t.indexOf("\n"))&&(t='"'+(t=t.replace('"','""'))+'"'),t}e.ValueToCsvValue=i;e.createCsvString=function(e,t){for(var n="",o=0;o<t.length;++o)o>0&&(n+=","),n+=i(t[o].headerText);for(var s=0;s<e.length;++s){n+="\n";for(var a=e[s],r=0;r<t.length;++r){r>0&&(n+=",");var l=t[r],d=a[l.fieldName];l.dataMapper&&(d=l.dataMapper(d)),n+=i(d)}}return n}}(Ally||(Ally={}));__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}();e.GroupEmailInfo=t;var i=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(e.SimpleUserEntry);e.FellowChtnResident=i;var n=function(){return function(){}}();e.CommitteeListingInfo=n;var o=function(){return function(){}}();e.UnitListing=o;var s=function(){return function(){}}();e.FellowResidents=s;var a=function(){function e(e,t,i){this.$http=e,this.$q=t,this.$cacheFactory=i}return e.prototype.getResidents=function(){var e=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(e){return e.data.residents},function(t){return e.$q.reject(t)})},e.prototype.getCommitteeMembers=function(e){return this.$http.get("/api/Committee/"+e+"/Members").then(function(e){return e.data},function(e){return this.$q.reject(e)})},e.prototype.isCommitteeMember=function(e,t){return this.$http.get("/api/Committee/"+e+"/IsMember",{cache:!0}).then(function(e){return e.data},function(e){return this.$q.reject(e)})},e.prototype.getByUnits=function(){var e=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(e){return e.data.byUnit},function(t){return e.$q.reject(t)})},e.prototype.getByUnitsAndResidents=function(){var e=this;return this.$http.get("/api/BuildingResidents",{cache:!0}).then(function(e){return e.data},function(t){return e.$q.reject(t)})},e.prototype.getGroupEmailObject=function(){return this.$http.get("/api/BuildingResidents/EmailGroups",{cache:!0}).then(function(e){return e.data},function(e){return this.$q.reject(e)})},e.prototype._setupGroupEmailObject=function(e,t){var i={};i={everyone:[],owners:[],renters:[],board:[],residentOwners:[],nonResidentOwners:[],residentOwnersAndRenters:[],propertyManagers:[],discussion:[]};for(var n=0;n<e.length;++n){var o=e[n],s=o.fullName+(o.hasEmail?"":"*");i.everyone.push(s);0!==o.boardPosition&&32!==o.boardPosition&&i.board.push(s),32===o.boardPosition&&i.propertyManagers.push(s),o.includeInDiscussionEmail&&i.discussion.push(s);for(var a=!1,r=!1,l=!1,d=0;d<o.homes.length;++d){var p=o.homes[d];if(!p.isRenter){a=!0;l=_.find(t,function(e){return e.unitId===p.unitId}).renters.length>0}p.isRenter&&(r=!0)}a&&(i.owners.push(s),l?i.nonResidentOwners.push(s):(i.residentOwners.push(s),i.residentOwnersAndRenters.push(s))),r&&(i.renters.push(s),i.residentOwnersAndRenters.push(s))}return 0===i.renters.length&&(i.residentOwners=[],i.residentOwnersAndRenters=[],i.nonResidentOwners=[]),i},e.prototype.sendMessage=function(e,t,i){var n={recipientUserId:e,messageBody:t,messageSubject:i};return this.$http.post("/api/BuildingResidents/SendMessage",n)},e.prototype.clearResidentCache=function(){this.$cacheFactory.get("$http").remove("/api/BuildingResidents"),this.$cacheFactory.get("$http").remove("/api/BuildingResidents/EmailGroups")},e.BoardPositionNames=[{id:0,name:"None"},{id:1,name:"President"},{id:2,name:"Treasurer"},{id:4,name:"Secretary"},{id:8,name:"Director/Member at Large"},{id:16,name:"Vice President"},{id:32,name:"Property Manager"},{id:64,name:"Secretary + Treasurer"}],e}();e.FellowResidentsService=a}(Ally||(Ally={})),angular.module("CondoAlly").service("fellowResidents",["$http","$q","$cacheFactory",Ally.FellowResidentsService]);!function(e){var t=function(){function e(e,t,i){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.isLoading=!1,this.shouldShowAdminControls=!1,this.digestFrequency=null}return e.prototype.$onInit=function(){this.shouldShowAdminControls=this.siteInfo.userInfo.isSiteManager,this.retrieveComments()},e.prototype.onTextAreaKeyDown=function(e,t){e.keyCode?e.keyCode:e.which;13==e.keyCode&&(e.preventDefault(),"new"===t?this.submitNewComment():"edit"===t?this.submitCommentEdit():"reply"===t&&this.submitReplyComment())},e.prototype.onChangeDigestFrequency=function(){var e=this;this.isLoading=!0;var t="/api/CommentThread/"+this.thread.commentThreadId+"/DigestFrequency/"+this.commentsState.digestFrequency;this.$http.put(t,null).then(function(){e.isLoading=!1},function(t){e.isLoading=!1,alert("Failed to change: "+t.data.exceptionMessage)})},e.prototype.retrieveComments=function(){var e=this;this.isLoading=!0,this.$http.get("/api/CommentThread/"+this.thread.commentThreadId+"/Comments").then(function(t){e.isLoading=!1,e.commentsState=t.data;var i=function(t){t.isMyComment=t.authorUserId===e.$rootScope.userInfo.userId,t.replies&&_.each(t.replies,i)};_.forEach(e.commentsState.comments,i),e.commentsState.comments=_.sortBy(e.commentsState.comments,function(e){return e.postDateUtc}).reverse()},function(t){e.isLoading=!1})},e.prototype.startReplyToComment=function(e){this.replyToCommentId=e.commentId,this.replyCommentText="",setTimeout(function(){return $(".reply-to-textarea").focus()},150)},e.prototype.startEditComment=function(e){this.editCommentId=e.commentId,this.editCommentText=e.commentText},e.prototype.deleteComment=function(e){var t=this,i="Are you sure you want to delete this comment?";1===this.commentsState.comments.length&&(i="Since there is only one comment, if you delete this comment you'll delete the thread. Are you sure you want to delete this comment?"),confirm(i)&&(this.isLoading=!0,this.$http.delete("/api/CommentThread/"+this.thread.commentThreadId+"/"+e.commentId).then(function(){t.isLoading=!1,1===t.commentsState.comments.length?(t.$rootScope.$broadcast("refreshCommentThreadList"),t.closeModal(!1)):t.retrieveComments()},function(e){t.isLoading=!1,alert("Failed to post comment: "+e.data.exceptionMessage)}))},e.prototype.archiveThread=function(e){var t=this;void 0===e&&(e=!0),this.isLoading=!0;var i="/api/CommentThread/Archive/"+this.thread.commentThreadId;e||(i="/api/CommentThread/Unarchive/"+this.thread.commentThreadId),this.$http.put(i,null).then(function(){t.isLoading=!1,t.$rootScope.$broadcast("refreshCommentThreadList"),t.closeModal(!1)},function(e){t.isLoading=!1,alert("Failed to archive: "+e.data.exceptionMessage)})},e.prototype.submitCommentEdit=function(){var e=this,t={commentId:this.editCommentId,newCommentText:this.editCommentText};this.isLoading=!0,this.$http.put("/api/CommentThread/"+this.thread.commentThreadId+"/EditComment",t).then(function(){e.isLoading=!1,e.editCommentId=-1,e.editCommentText="",e.retrieveComments()},function(t){e.isLoading=!1,alert("Failed to edit comment: "+t.data.exceptionMessage)})},e.prototype.submitReplyComment=function(){var e=this,t={replyToCommentId:this.replyToCommentId,commentText:this.replyCommentText};this.isLoading=!0,this.$http.put("/api/CommentThread/"+this.thread.commentThreadId+"/AddComment",t).then(function(t){e.isLoading=!1,e.replyToCommentId=-1,e.replyCommentText="",e.retrieveComments()},function(t){e.isLoading=!1,alert("Failed to add comment: "+t.data.exceptionMessage)})},e.prototype.submitNewComment=function(){var e=this,t={commentText:this.newCommentText};this.isLoading=!0,this.$http.put("/api/CommentThread/"+this.thread.commentThreadId+"/AddComment",t).then(function(t){e.isLoading=!1,e.newCommentText="",e.retrieveComments()},function(t){e.isLoading=!1,alert("Failed to add comment: "+t.data.exceptionMessage)})},e.prototype.closeModal=function(e){this.onClosed&&this.onClosed()},e.$inject=["$http","$rootScope","SiteInfo"],e}();e.GroupCommentThreadViewController=t}(Ally||(Ally={})),CA.angularApp.component("groupCommentThreadView",{bindings:{thread:"<",onClosed:"&"},templateUrl:"/ngApp/services/group-comment-thread-view.html",controller:Ally.GroupCommentThreadViewController});!function(e){var t=function(){return function(){}}();e.CommentThread=t;var i=function(){function e(e,t,i,n,o){this.$http=e,this.$rootScope=t,this.siteInfo=i,this.$scope=n,this.fellowResidents=o,this.isLoading=!1,this.viewingThread=null,this.showCreateNewModal=!1,this.showBoardOnly=!1,this.archivedThreads=null,this.canCreateThreads=!1,this.isDiscussionEmailEnabled=!0}return e.prototype.$onInit=function(){var e=this;this.canCreateThreads=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.canCreateThreads||(this.committeeId?this.fellowResidents.isCommitteeMember(this.committeeId,this.siteInfo.userInfo.userId).then(function(t){return e.canCreateThreads=t}):this.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads&&"everyone"!==this.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads?"board"===this.siteInfo.privateSiteInfo.whoCanCreateDiscussionThreads&&(this.canCreateThreads=this.siteInfo.userInfo.isSiteManager||0!==this.siteInfo.userInfo.boardPosition):this.canCreateThreads=!0),this.showBoardOnly=this.siteInfo.userInfo.isSiteManager||0!==this.siteInfo.userInfo.boardPosition,this.isDiscussionEmailEnabled=this.siteInfo.privateSiteInfo.isDiscussionEmailGroupEnabled,this.editComment={commentText:"",replyToCommentId:null},this.$scope.$on("refreshCommentThreadList",function(t,i){return e.refreshCommentThreads(!1)}),this.refreshCommentThreads(!1)},e.prototype.setDisplayCreateModal=function(e){this.showCreateNewModal=e,this.newThreadTitle="",this.newThreadBody="",this.newThreadIsBoardOnly=!1,this.newThreadIsReadOnly=!1,this.shouldSendNoticeForNewThread=!0,this.newThreadErrorMessage="",e&&setTimeout(function(){return $("#new-thread-title-text-box").focus()},100)},e.prototype.displayDiscussModal=function(e){this.viewingThread=e},e.prototype.hideDiscussModal=function(){this.viewingThread=null},e.prototype.onClickPin=function(e){var t=this;this.isLoading=!0,this.$http.put("/api/CommentThread/TogglePinned/"+e.commentThreadId,null).then(function(e){t.isLoading=!1,t.refreshCommentThreads()},function(e){t.isLoading=!1,alert("Failed to toggle: "+e.data.exceptionMessage)})},e.prototype.createNewThread=function(){var e=this;this.isLoading=!0,this.newThreadErrorMessage=null;var t={title:this.newThreadTitle,body:this.newThreadBody,isBoardOnly:this.newThreadIsBoardOnly,isReadOnly:this.newThreadIsReadOnly,shouldSendNotice:this.shouldSendNoticeForNewThread,committeeId:this.committeeId};this.$http.post("/api/CommentThread",t).then(function(t){e.isLoading=!1,e.showCreateNewModal=!1,e.refreshCommentThreads(!1)},function(t){e.isLoading=!1,e.newThreadErrorMessage=t.data.exceptionMessage})},e.prototype.refreshCommentThreads=function(e){var t=this;void 0===e&&(e=!1),this.isLoading=!0;var i="/api/CommentThread";e&&(i+="/Archived"),this.committeeId&&(i+="?committeeId="+this.committeeId),this.$http.get(i).then(function(i){t.isLoading=!1,i.data=_.sortBy(i.data,function(e){return e.pinnedDateUtc?e.pinnedDateUtc:moment(e.lastCommentDateUtc).subtract("years",100).toDate()}).reverse(),e?t.archivedThreads=i.data:(t.commentThreads=i.data,t.archivedThreads=null)},function(e){t.isLoading=!1})},e.$inject=["$http","$rootScope","SiteInfo","$scope","fellowResidents"],e}();e.GroupCommentThreadsController=i}(Ally||(Ally={})),CA.angularApp.component("groupCommentThreads",{bindings:{committeeId:"<?"},templateUrl:"/ngApp/services/group-comment-threads.html",controller:Ally.GroupCommentThreadsController});!function(e){var t=function(){return function(){}}();e.Comment=t;var i=function(){function e(e,t){this.$http=e,this.$rootScope=t,this.isLoading=!1,this.showDiscussModal=!1}return e.prototype.$onInit=function(){this.isQaSite=!1,this.threadId||(this.threadId="Home"),this.editComment={threadId:this.threadId,commentText:"",replyToCommentId:null},this.refreshComments()},e.prototype.displayDiscussModal=function(){this.showDiscussModal=!0},e.prototype.hideDiscussModal=function(){this.showDiscussModal=!1},e.prototype.refreshComments=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Comment?threadId="+this.threadId).then(function(t){e.isLoading=!1,e.commentList=t.data;var i=function(t){t.isMyComment=t.authorUserId===e.$rootScope.userInfo.userId,t.replies&&_.each(t.replies,i)};_.each(e.commentList,i)},function(t){e.isLoading=!1})},e.prototype.postComment=function(e){var t=this;this.isLoading=!0;var i=this.$http.post;"number"==typeof e.existingCommentId&&(i=this.$http.put),i("/api/Comment",e).then(function(){t.isLoading=!1,t.editComment={},t.showReplyBoxId=-1,t.refreshComments()},function(e){t.isLoading=!1,alert("Failed to post comment: "+e.data.exceptionMessage)})},e.prototype.onPostCommentClicked=function(){if(0!==this.editComment.commentText.length){var e={threadId:this.threadId,commentText:this.editComment.commentText,replyToCommentId:null,existingCommentId:this.editComment.existingCommentId};this.postComment(e)}},e.prototype.editMyComment=function(e){this.editComment={commentText:e.commentText,existingCommentId:e.commentId}},e.prototype.deleteMyComment=function(e){this.isLoading=!0,this.$http.delete("/api/Comment?commentId="+e.commentId).then(function(){this.isLoading=!1,this.refreshComments()},function(e){this.isLoading=!1;var t=e.data.exceptionMessage?e.data.exceptionMessage:e.data;alert("Failed to post comment: "+t)})},e.prototype.onPostReplyCommentClicked=function(){if(0!==this.editComment.replyText.length){var e={threadId:this.threadId,commentText:this.editComment.replyText,replyToCommentId:this.editComment.replyToCommentId};this.postComment(e)}},e.prototype.clickReplyToComment=function(e){this.showReplyBoxId=e,this.editComment={commentText:"",replyToCommentId:e}},e.$inject=["$http","$rootScope"],e}();e.GroupCommentsController=i}(Ally||(Ally={})),CA.angularApp.component("groupComments",{bindings:{threadId:"@?"},templateUrl:"/ngApp/services/group-comments.html",controller:Ally.GroupCommentsController});!function(e){var t=function(){function e(){}return e.convertStringsToDates=function(t){if($.isArray(t)&&e.convertDatesFromArray(t),e.isObject(t))for(var i in t){var n=t[i];if(e.isObject(n))e.convertStringsToDates(n);else if($.isArray(n))e.convertDatesFromArray(n);else if(e.isString(n)&&n.length>10&&e.dotNetTimeRegEx2.test(n)){var o;o=HtmlUtil.endsWith(i,"_UTC")||HtmlUtil.endsWith(i,"Utc")?e.serverUtcDateToLocal(n):new Date(n),t[i]=o}}},e.convertDatesFromArray=function(t){for(var i=0;i<t.length;i++){var n=t[i];e.isObject(n)?e.convertStringsToDates(n):e.isString(n)&&e.iso8601RegEx.test(n)&&(t[i]=new Date(n))}},e.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},e.serverUtcDateToLocal=function(e){return"string"!=typeof e?e:HtmlUtil.isNullOrWhitespace(e)?null:moment.utc(e).toDate()},e.showTooltip=function(e,t){$(e).qtip({style:{classes:"qtip-light qtip-shadow"},position:{my:"leftMiddle",at:"rightMiddle"},content:{text:t},events:{hide:function(e){$(e.originalEvent.currentTarget).qtip("destroy")}}}),$(e).qtip("show")},e.downloadCsv=function(t,i){e.downloadFile(t,i,"text/csv")},e.downloadXml=function(t,i){e.downloadFile(t,i,"text/xml")},e.downloadFile=function(e,t,i){if("undefined"!=typeof Blob){var n=document.createElement("a");document.body.appendChild(n),n.style.display="none";var o=new Blob([e],{type:i}),s=window.URL.createObjectURL(o);n.href=s,n.download=t,n.click(),window.URL.revokeObjectURL(s)}else{var a=encodeURI("data:"+i+";charset=utf-8,"+e),r=document.createElement("a");r.setAttribute("href",a),r.setAttribute("download",t),document.body.appendChild(r),r.click(),setTimeout(function(){document.body.removeChild(r)},500)}},e.startsWithNumber=function(e,t){if(void 0===t&&(t=!0),HtmlUtil.isNullOrWhitespace(e))return!1;t&&(e=e.trim());var i=e.search(/\s/);return-1===i&&(i=e.length),e=e.substring(0,i-1),HtmlUtil.isNumericString(e)},e.iso8601RegEx=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/,e.dotNetTimeRegEx2=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?$/,e}();e.HtmlUtil2=t;var i=function(){return function(){}}();e.ExceptionResult=i}(Ally||(Ally={}));!function(e){var t=function(){function e(){}return e.prototype.getTitle=function(){return this.project?this.project.title:this.todo.description},e.prototype.getTypeName=function(){return this.project?"Maintenance Record":"To-Do"},e.prototype.getAuthorName=function(){return this.project?this.project.creatorFullName:this.todo.addedByFullName},e.prototype.getCreatedDate=function(){return this.project?this.project.createDateUtc:this.todo.addedDateUtc},e}();e.MaintenanceEntry=t;var i=function(){function e(e,t,i){this.$http=e,this.$q=t,this.$cacheFactory=i}return e.prototype.loadProjects=function(){var e=this;return this.$http.get("/api/Maintenance/Projects").then(function(e){return e.data},function(t){return e.$q.reject(t.data)})},e}();e.MaintenanceService=i}(Ally||(Ally={})),angular.module("CondoAlly").service("maintenance",["$http","$q","$cacheFactory",Ally.MaintenanceService]);!function(e){var t=function(){function e(e,t,i){this.$rootScope=e,this.fellowResidents=t,this.shouldShowSendModal=!1,this.shouldShowButtons=!1,this.isSending=!1,this.messageBody="",this.messageSubject="",this.sendResultIsError=!1,this.messageSubject=i.userInfo.fullName+" has sent you a message via your "+AppConfig.appName+" site"}return e.prototype.$onInit=function(){},e.prototype.showSendModal=function(){this.shouldShowSendModal=!0,this.sendResultMessage="",this.shouldShowButtons=!0,setTimeout(function(){return document.getElementById("message-text-box").focus()},50)},e.prototype.hideModal=function(){this.shouldShowSendModal=!1,this.messageBody=""},e.prototype.sendMessage=function(){var e=this;this.shouldShowButtons=!1,this.isSending=!0,this.sendResultMessage="",this.fellowResidents.sendMessage(this.recipientInfo.userId,this.messageBody,this.messageSubject).then(function(t){e.isSending=!1,e.sendResultIsError=!1,e.messageBody="",e.sendResultMessage="Message sent successfully!"},function(t){e.shouldShowButtons=!0,e.isSending=!1,e.sendResultIsError=!0,e.sendResultMessage="Failed to send: "+t.data.exceptionMessage})},e.$inject=["$rootScope","fellowResidents","SiteInfo"],e}();e.SendMessageController=t}(Ally||(Ally={})),CA.angularApp.component("sendMessage",{bindings:{recipientInfo:"="},templateUrl:"/ngApp/services/send-message.html",controller:Ally.SendMessageController});__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(e){var t=function(){return function(){}}();e.UsersHome=t;var i=function(){return function(){}}();e.UserInfo=i;var n=function(){return function(){}}();e.PublicSiteInfo=n;var o=function(){return function(){}}();e.PrivateSiteInfo=o;var s=function(e){__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(o);e.ChtnPrivateSiteInfo=s;var a=function(){function t(){this.publicSiteInfo=new n,this.privateSiteInfo=new s,this.userInfo=new e.UserInfo,this.isLoggedIn=!1}return t.prototype.refreshSiteInfo=function(e,t,i){this._rootScope=e;var n=i.defer();e.isLoadingSite=!0;var o=this,s=function(t){e.isLoadingSite=!1,o.handleSiteInfo(t,e),n.resolve()},a=function(){e.isLoadingSite=!1,n.reject()};return t.get("/api/GroupSite").then(function(e){e.data&&!e.data.userInfo?o.xdLocalStorage.getItem("allyApiAuthToken").then(function(i){i&&HtmlUtil.isValidString(i.value)?(o.setAuthToken(i.value),t.get("/api/GroupSite").then(function(e){s(e.data)},a)):s(e.data)},function(){s(e.data)}):s(e.data)},a),n.promise},t.prototype.testIfIsNeutralPage=function(e){if(!HtmlUtil.startsWith(e,"#!/"))return!1;e="/"+e.substring("#!/".length);return"object"==typeof _.find(AppConfig.menu,function(t){return t.path===e})},t.prototype.handleSiteInfo=function(e,t){var i=HtmlUtil.getSubdomain(window.location.host);if(!this.authToken&&t.authToken&&this.setAuthToken(t.authToken),null===e||"null"===e){var n=null===i||"www"===i||"login"===i,o=this.testIfIsNeutralPage(window.location.hash);if(!n||!o)return void GlobalRedirect("https://login."+AppConfig.baseTld+"/#!/Login");(e={}).publicSiteInfo={bgImagePath:"",fullName:AppConfig.appName,siteLogo:"<span style='font-size: 22pt; color: #FFF;'>Welcome to "+AppConfig.appName+"</span>"}}t.publicSiteInfo=e.publicSiteInfo,this.publicSiteInfo=e.publicSiteInfo,this.publicSiteInfo.gpsPosition&&"undefined"!=typeof google&&(this.publicSiteInfo.googleGpsPosition=new google.maps.LatLng(this.publicSiteInfo.gpsPosition.lat,this.publicSiteInfo.gpsPosition.lon));var s=e.privateSiteInfo;if(s||(s={}),this.privateSiteInfo=s,document.title=this.publicSiteInfo.fullName,this.userInfo=e.userInfo,t.userInfo=e.userInfo,HtmlUtil.isLocalStorageAllowed()&&window.localStorage.setItem("siteInfo",angular.toJson(this.publicSiteInfo)),this.isLoggedIn=null!==t.userInfo&&void 0!==t.userInfo,t.isLoggedIn=this.isLoggedIn,HtmlUtil.isNullOrWhitespace(this.publicSiteInfo.bgImagePath)||$(document.documentElement).css("background-image","url("+t.bgImagePath+this.publicSiteInfo.bgImagePath+")"),this.isLoggedIn)"undefined"!=typeof $zopim&&$zopim(function(){$zopim.livechat.setName(t.userInfo.firstName+" "+t.userInfo.lastName),-1!==t.userInfo.emailAddress.indexOf("@")&&$zopim.livechat.setEmail(t.userInfo.emailAddress)}),t.isAdmin=t.userInfo.isAdmin,t.isSiteManager=t.userInfo.isSiteManager,"undefined"!=typeof analytics&&analytics.identify(t.userInfo.emailAddress,{name:t.userInfo.fullName});else{t.userInfo=null;if("#!/Login"!=window.location.hash&&!AppConfig.isPublicRoute(window.location.hash)){if(this.publicSiteInfo&&this.publicSiteInfo.baseUrl)return void(window.location.hash="#!/Login");GlobalRedirect(AppConfig.baseUrl+"#!/Login")}}this.publicSiteInfo.baseUrl&&"login"===i&&(null!==i&&i===this.publicSiteInfo.shortName||!HtmlUtil.isNullOrWhitespace(OverrideBaseApiPath)||GlobalRedirect(this.publicSiteInfo.baseUrl+"/#!/Home"))},t.prototype.setAuthToken=function(e){window.localStorage&&window.localStorage.setItem("ApiAuthToken",e),this._rootScope.authToken=e,this.xdLocalStorage.setItem("allyApiAuthToken",e).then(function(e){}),this.authToken=e},t.AlwaysDiscussDate=new Date(2018,7,1),t}();e.SiteInfoService=a;var r=function(){function e(){}return e.loginInit=function(e,t,i,n,o){var s=e.defer();return l.siteInfo.xdLocalStorage=o,l.isSiteInfoLoaded?s.resolve(l.siteInfo):l.siteInfo.refreshSiteInfo(i,t,e).then(function(){l.isSiteInfoLoaded=!0,i.isSiteInfoLoaded=!0,i.siteTitle={text:i.publicSiteInfo.siteTitleText},i.publicSiteInfo.siteLogo&&(i.siteTitle.logoHtml=n.trustAsHtml(i.publicSiteInfo.siteLogo)),i.onUpdateSiteTitleText=function(){analytics.track("updateSiteTitle"),t.put("/api/Settings",{siteTitle:i.siteTitle.text})},s.resolve(l.siteInfo)}),s.promise},e}();e.SiteInfoHelper=r;var l=function(){function t(){}return t.prototype.$get=function(){return t.isSiteInfoLoaded||console.log("Not yet loaded!"),t.siteInfo},t.isSiteInfoLoaded=!1,t.siteInfo=new e.SiteInfoService,t}();e.SiteInfoProvider=l}(Ally||(Ally={})),angular.module("CondoAlly").provider("SiteInfo",Ally.SiteInfoProvider);var Ally;!function(e){var t=function(){return function(){}}();e.TodoItem=t;var i=function(){return function(){}}();e.TodoList=i;var n=function(){function e(e,t,i){this.$http=e,this.siteInfo=t,this.fellowResidents=i,this.todoLists=[],this.isLoading=!1,this.newListName="",this.isFixedList=!1,this.shouldExpandTodoItemModal=!1,this.canManage=!1}return e.prototype.$onInit=function(){var e=this;this.isFixedList=!!this.fixedTodoListId,this.isFixedList?this.loadFixedTodoList():this.loadAllTodoLists(),this.canManage=this.siteInfo.userInfo.isAdmin||this.siteInfo.userInfo.isSiteManager,this.committee&&!this.canManage&&this.fellowResidents.isCommitteeMember(this.committee.committeeId,this.siteInfo.userInfo.userId).then(function(t){return e.canManage=t})},e.prototype.loadFixedTodoList=function(){var e=this;this.isLoading=!0,this.$http.get("/api/Todo/List/"+this.fixedTodoListId).then(function(t){e.isLoading=!1,e.todoLists=[t.data]})},e.prototype.loadAllTodoLists=function(){var e=this;this.isLoading=!0;var t="/api/Todo";this.committee&&(t="/api/Todo/ListsForCommittee/"+this.committee.committeeId),this.$http.get(t).then(function(t){e.isLoading=!1,e.todoLists=t.data})},e.prototype.onAddList=function(){var e=this;this.isLoading=!0;var t="/api/Todo/newList?listName="+encodeURIComponent(this.newListName);this.committee&&(t+="&committeeId="+this.committee.committeeId),this.$http.post(t,null).then(function(){e.isLoading=!1,e.newListName="",e.loadAllTodoLists()},function(t){e.isLoading=!1,alert("Failed to create: "+t.data.exceptionMessage)})},e.prototype.onAddItem=function(e){var t=this;this.isLoading=!0;var i="/api/Todo/newItem/"+e+"?description="+encodeURIComponent(this.newItemDescription);this.$http.post(i,null).then(function(e){t.isLoading=!1,t.newItemDescription="",t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to create: "+e.data.exceptionMessage)})},e.prototype.addNewItem=function(e){this.editTodoItem=new t,this.editTodoItem.owningTodoListId=e,this.committee&&(this.editTodoItem.owningTodoListId=e),this.shouldExpandTodoItemModal=!1,window.setTimeout(function(){return $("#edit-todo-name-text-box").focus()},100)},e.prototype.saveTodoItem=function(){var e=this;this.isLoading=!0;this.$http.post("/api/Todo/Item",this.editTodoItem).then(function(t){e.isLoading=!1,e.newItemDescription="",e.editTodoItem=null,e.loadAllTodoLists()},function(t){e.isLoading=!1,alert("Failed to create: "+t.data.exceptionMessage)})},e.prototype.onToggleComplete=function(e,t){var i=this;this.isLoading=!0,this.$http.put("/api/Todo/toggleComplete/"+e+"/"+t,null).then(function(e){i.isLoading=!1,i.loadAllTodoLists()},function(e){i.isLoading=!1,alert("Failed to toggle: "+e.data.exceptionMessage)})},e.prototype.deleteTodoItem=function(e){var t=this;this.isLoading=!0,this.$http.delete("/api/Todo/Item/"+e.todoItemId).then(function(e){t.isLoading=!1,t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)})},e.prototype.deleteTodoList=function(e){var t=this;e.todoItems.length>0&&!confirm("Are you sure you want to delete this list with active to-dos?")||(this.isLoading=!0,this.$http.delete("/api/Todo/List/"+e.todoListId).then(function(e){t.isLoading=!1,t.loadAllTodoLists()},function(e){t.isLoading=!1,alert("Failed to delete: "+e.data.exceptionMessage)}))},e.$inject=["$http","SiteInfo","fellowResidents"],e}();e.TodoListCtrl=n}(Ally||(Ally={})),CA.angularApp.component("todoList",{bindings:{fixedTodoListId:"<?",committee:"<?"},templateUrl:"/ngApp/services/todo-list.html",controller:Ally.TodoListCtrl});function ManageMembersCtrl(e,t,i,n,t){e.members=[],e.newMember={boardPosition:0,isRenter:!1},e.editUser=null,e.setEdit=function(t){if(e.sentWelcomeEmail=!1,null!==t){e.editUserForm.$setPristine();var i=jQuery.extend({},t);e.editUser=i,e.memberGridOptions.selectAll(!1),setTimeout("$( '#edit-user-first-text-box' ).focus();",100)}else e.editUser=null},e.onSendWelcome=function(){e.isSavingUser=!0,t.put("/api/Member/"+e.editUser.userId+"/SendWelcome").then(function(){e.isSavingUser=!1,e.sentWelcomeEmail=!0},function(){alert("Failed to send the welcome e-mail, please contact support if this problem persists."),e.isSavingUser=!1})};$resource("/api/Member",null,{update:{method:"PUT"}});var o={fields:["lastName"],directions:["asc"]},s=o;if(window.localStorage){var a=window.localStorage.getItem("memberSort");a&&(s=JSON.parse(a)),0===s.fields.length&&(s=o),n(function(){var t={fields:e.memberGridOptions.sortInfo.fields,directions:e.memberGridOptions.sortInfo.directions};window.localStorage.setItem("memberSort",JSON.stringify(t))},2e3)}e.memberGridOptions={data:"members",plugins:[new ngGridFlexibleHeightPlugin],columnDefs:[{field:"firstName",displayName:"First Name",cellClass:"resident-cell-first"},{field:"lastName",displayName:"Last Name",cellClass:"resident-cell-last"},{field:"email",displayName:"E-mail",cellClass:"resident-cell-email"},{field:"isSiteManager",displayName:"Admin",width:60,cellClass:"resident-cell-site-manager",cellTemplate:'<div style="text-align:center; padding-top: 8px;"><input type="checkbox" disabled="disabled" ng-checked="row.getProperty(col.field)"></div>'},{field:"phoneNumber",displayName:"Phone Number",width:150,cellClass:"resident-cell-phone",cellTemplate:'<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.getProperty(col.field) | tel }}</span></div>'}],afterSelectionChange:function(t){t.selected&&e.setEdit(t.entity)},sortInfo:s,multiSelect:!1},e.refresh=function(){e.isLoading=!0,t.get("/api/Member").then(function(t){e.members=t.data,_.forEach(e.members,function(e){e.fullName=e.firstName+" "+e.lastName,"string"==typeof e.email&&-1!==e.email.indexOf("@condoally.com")&&(e.email="")}),e.isLoading=!1})},e.onSaveMember=function(){if(null!=e.editUser&&($("#editUserForm").validate(),$("#editUserForm").valid())){e.isSavingUser=!0;var i=function(){e.editUser=null,e.isSavingUser=!1,e.refresh()},n=i;e.editUser.userId?t.put("/api/Member",e.editUser).then(i,n):t.post("/api/Member",e.editUser).then(i,n)}},e.OnAdminSetPassword=function(){var i={userName:e.adminSetPass_Username,password:e.adminSetPass_Password};t.post("/api/AdminHelper/SetPassword",i).then(function(t){e.adminSetPass_ResultMessage=t.data},function(){})},e.onDeleteMember=function(){confirm("Are you sure you want to remove this person from your neighborhood watch group?")&&t.delete("/api/Member",{userId:e.editUser.userId,unitId:e.editUser.unitId}).then(function(){e.editUser=null,e.refresh()})},e.onSendAllWelcome=function(){e.isLoading=!0,t.put("/api/Member?userId&action=launchsite").then(function(){e.isLoading=!1,e.sentWelcomeEmail=!0,e.allEmailsSent=!0},function(){alert("Failed to send welcome e-mail, please contact support if this problem persists."),e.isLoading=!1})},e.refresh()}ManageMembersCtrl.$inject=["$scope","$http","$rootScope","$interval","$http"];function WatchSettingsCtrl(e,t,i,n){var o=this;o.settings={},o.defaultBGImage=$(document.documentElement).css("background-image"),o.showQaButton="president@mycondoally.com"===t.userInfo.emailAddress;var s=i("/api/Settings",null,{update:{method:"PUT"}});o.refreshData=function(){o.isLoading=!0,o.settings=s.get(function(){o.isLoading=!1})},o.onSiteTitleChange=function(){o.isLoading=!0,s.update({siteTitle:o.settings.siteTitle},function(){location.reload(),o.isLoading=!1})},o.onWelcomeMessageUpdate=function(){o.isLoading=!0,s.update({welcomeMessage:o.settings.welcomeMessage},function(){n.privateSiteInfo.welcomeMessage=o.settings.welcomeMessage,o.isLoading=!1})},o.onImageClick=function(e){o.settings.bgImageFileName=e,SettingsJS._defaultBG=e,s.update({BGImageFileName:o.settings.bgImageFileName},function(){$(".test-bg-image").removeClass("test-bg-image-selected"),$("img[src='"+t.bgImagePath+e+"']").addClass("test-bg-image-selected"),o.isLoading=!1})},o.onImageHoverOver=function(e){$(document.documentElement).css("background-image","url("+t.bgImagePath+e+")")},o.onImageHoverOut=function(){"string"==typeof o.settings.bgImageFileName&&o.settings.bgImageFileName.length>0?$(document.documentElement).css("background-image","url("+t.bgImagePath+o.settings.bgImageFileName+")"):$(document.documentElement).css("background-image",o.defaultBGImage)},o.onQaDeleteSite=function(){e.get("/api/QA/DeleteThisAssociation").then(function(){location.reload()},function(e){alert("Failed to delete site: "+e.data.message)})},o.mapInstance=new google.maps.Map(document.getElementById("map-canvas"),o.mapInfo),o.refreshData()}WatchSettingsCtrl.$inject=["$http","$rootScope","$resource","SiteInfo"];function WatchCalendarCtrl(e,t,i,n,o){var s="YYYY-MM-DD";e.today=new Date;var a={height:600,editable:!1,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},viewRender:function(e,t){n.isSiteManager&&$(t).css("cursor","pointer")},dayClick:function(t){if(n.isSiteManager){var i=moment(moment.utc(t).format(s)).toDate();e.$apply(function(){e.setEditEvent({date:i,dateOnly:i,associatedUserIds:[]})})}},eventClick:function(t){e.$apply(function(){t.calendarEventObject&&e.setEditEvent(t.calendarEventObject,!0)})},eventRender:function(e,t){$(t).css("cursor","default"),$(t).qtip({style:{classes:"qtip-light qtip-shadow"},content:{text:e.fullDescription,title:e.toolTipTitle}})},eventSources:[{events:function(t,n,o,a){e.isLoadingCalendarEvents=!0;var r=t.format(s),l=n.format(s);i.get("/api/CalendarEvent?startDate="+r+"&endDate="+l).then(function(t){var i=[],n=t.data;e.isLoadingCalendarEvents=!1,_.each(n,function(e){e.timeOnly=moment.utc(e.date).format("h:mma"),e.dateOnly=e.date,"12:37am"==e.timeOnly&&(e.timeOnly="");var t=e.title;t.length>17&&(t=t.substring(0,17)+"...");var n="Posted by: "+e.authorName+"<br><p>"+e.title+"</p>";i.push({title:t,start:e.date.substring(0,10),toolTipTitle:"Event",fullDescription:n,calendarEventObject:e})}),a(i)},function(){e.isLoadingCalendarEvents=!1})}}]};$(document).ready(function(){$(".EditableEntry").editable("<%= Request.Url %>",{id:"EditEntryId",type:"textarea",cancel:"Cancel",submit:"Ok"}),$("#log-calendar").fullCalendar(a)}),e.onResidentClicked=function(t){_.contains(e.editEvent.associatedUserIds,t)?e.editEvent.associatedUserIds=_.without(e.editEvent.associatedUserIds,t):e.editEvent.associatedUserIds.push(t)},e.isUserAssociated=function(t){return!(!e.editEvent||!e.editEvent.associatedUserIds)&&_.contains(e.editEvent.associatedUserIds,t)},e.expandCalendarEventModel=function(){e.showExpandedCalendarEventModel=!0},e.setEditEvent=function(t,i){e.showExpandedCalendarEventModel=i||!1,e.editEvent=t,t&&setTimeout(function(){$("#calendar-event-title").focus()},10)},e.deleteCalendarEvent=function(t){confirm("Are you sure you want to remove this calendar event?")&&(e.isLoadingCalendarEvents=!0,i.delete("/api/CalendarEvent?eventId="+t).then(function(){e.isLoadingCalendarEvents=!1,e.editEvent=null,e.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){e.isLoadingCalendarEvents=!1,alert("Failed to delete the calendar event.")}))},e.saveCalendarEvent=function(){var t="";t="string"==typeof e.editEvent.timeOnly&&e.editEvent.timeOnly.length>1?moment.utc(e.editEvent.date).format(s)+" "+e.editEvent.timeOnly:moment.utc(e.editEvent.date).format(s)+" 12:37am",e.editEvent.date=moment.utc(t,s+" h:mma").toDate();var n;n=e.editEvent.eventId?i.put:i.post,e.isLoadingCalendarEvents=!0,n("/api/CalendarEvent",e.editEvent).then(function(){e.isLoadingCalendarEvents=!1,e.editEvent=null,e.onlyRefreshCalendarEvents=!0,$("#log-calendar").fullCalendar("refetchEvents")},function(){e.isLoadingCalendarEvents=!1})},e.onDeleteItem=function(t){confirm("Are you sure you want to delete this information?")&&(e.isLoading=!0,LogEntryResource.delete({logEntryId:t.logEntryId},function(){e.RetrieveItems()}))},$("#calendar-event-time").timepicker({scrollDefault:"10:00am"})}WatchCalendarCtrl.$inject=["$scope","$timeout","$http","$rootScope","$q"];function WatchHomeCtrl(e,t,i){var n=this,o=t("/api/Watch/Home"),s=t("https://localnewsally.org/api/LocalNews",null,{cache:!0});n.refreshData=function(){n.isLoading=!0,n.watchMembers=o.get(function(){n.isLoading=!1})},s.query({clientId:"1001A194-B686-4C45-80BC-ECC0BB4916B4",chicagoWard:i.publicSiteInfo.chicagoWard,zipCode:i.publicSiteInfo.zipCode,cityNeighborhood:i.publicSiteInfo.localNewsNeighborhoodQuery},function(e){n.localNews=e,n.isLoading_LocalNews=!1})}WatchHomeCtrl.$inject=["$rootScope","$resource","SiteInfo"];function WatchMembersCtrl(e,t,i){var n=this,o=t("/api/Watch/MemberList");n.refreshData=function(){n.isLoading=!0,n.memberList=o.query(function(){n.isLoading=!1,n.housePolys=function(e){var t=[],i=[];return _.each(e,function(e){e.houseGpsBounds&&(_.some(t,function(t){return t==e.addressId})||(t.push(e.addressId),i.push(e.houseGpsBounds)))}),i}(n.memberList)})},n.mapCenter=i.privateSiteInfo.gpsPosition,n.groupBounds=i.publicSiteInfo.gpsBounds,n.refreshData()}WatchMembersCtrl.$inject=["$rootScope","$resource","SiteInfo"];