<div class="page-subpage page-document-info info spinner-effect" data-ng-cloak>
    <h1 style="display: inline-block;">Maintenance</h1>
    <span class="text-link note-text" style="margin-left: 3em;" data-ng-click="$ctrl.shouldShowManageEquipmentModal = true">{{ $ctrl.isSiteManager ? "Manage" : "View" }} Equipment</span>
    <div class="loading-overlay" data-ng-show="$ctrl.isLoading"></div>

    <div style="text-align: right;">
        <button data-ng-if="$ctrl.isSiteManager" class="btn btn-primary" data-ng-click="$ctrl.openAddNewProject();" type="button">Add New Project</button>
    </div>

    <div id="maintenance-item-{{ $index }}" data-ng-repeat="project in $ctrl.projects">
        <h4 style="display: inline-block;" id="fmaintenance-item-title-{{ $index }}"> {{ project.title }}</h4>
        <div data-ng-show="$ctrl.isSiteManager" style="display: inline-block; font-size: small; margin-left: 9px;">
            <a href="javascript:void(0)" id="maintenance-item-edit-{{ $index }}-button" class="text-button" data-ng-click="$ctrl.editProject( project );">Edit</a>
            <a href="javascript:void(0)" id="maintenance-item-delete-{{ $index }}-button" class="text-button" data-ng-click="$ctrl.onDeleteProject( project );">Delete</a>
        </div>

        <div data-ng-if="project.startDate"><label style="font-weight:bold;">Project Date:</label>&nbsp;{{ project.startDate | date:'shortDate' }}<span data-ng-if="project.endDate && project.endDate.getTime() !== project.startDate.getTime()">&nbsp;- {{ project.endDate | date:'shortDate' }}</span></div>
        <div data-ng-if="project.cost"><label style="font-weight:bold;">Cost:</label>&nbsp;{{ project.cost | currency }}</div>
        <div data-ng-if="project.vendorCompanyName"><label style="font-weight:bold;">Vendor:</label>&nbsp;{{ project.vendorCompanyName }}</div>
        <div data-ng-if="project.equipmentName"><label style="font-weight:bold;">Equipment:</label>&nbsp;{{ project.equipmentName }}</div>
        <p id="maintenance-item-body-{{ $index }}" class="maintenance-item-body" style="white-space: pre-wrap;">
            {{ project.descriptionText }}
        </p>
        <br />
    </div>

    <span class="note-text" data-ng-if="$ctrl.projects.length === 0">There are no maintenace projects to display.</span>

    <div class="modal-container" data-ng-if="$ctrl.shouldShowEditProjectModal" data-ng-escape="$ctrl.shouldShowEditProjectModal = false">
        <div class="modal-overlay"></div>

        <form class="ca-modal-dialog modal-md">
            <div data-ng-show="$ctrl.isLoading" class="loading-overlay"></div>
            <span style="float: right;" class="close-x" data-ng-click="$ctrl.shouldShowEditProjectModal = false">&times;</span>
            <h2>{{ $ctrl.editingProject.maintenanceProjectId ? "Edit Maintenance Project" : "Add New Maintenace Project" }}</h2>

            <div class="form-group row">
                <label class="col-sm-3 col-xs-12">Name:</label>
                <div class="col-sm-9 col-xs-12">
                    <input id="project-title-text-box" class="form-control" type="text" data-ng-model="$ctrl.editingProject.title" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-xs-12">Equipment:</label>
                <div class="col-sm-9 col-xs-12">
                    <select data-ng-model="$ctrl.editingProject.equipmentId" data-ng-change="$ctrl.onEquipmentSelectionChange()" class="form-control" data-ng-options="eq.equipmentId as eq.name for eq in $ctrl.equipmentOptions">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group row" data-ng-if="$ctrl.vendorOptions.length > 0">
                <label class="col-sm-3 col-xs-12">Vendor:</label>
                <div class="col-sm-9 col-xs-12">
                    <select data-ng-model="$ctrl.editingProject.vendorId" class="form-control" data-ng-options="v.preferredVendorId as v.companyName for v in $ctrl.vendorOptions">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-xs-12">Notes:</label>
                <div class="col-sm-9 col-xs-12">
                    <textarea data-ng-model="$ctrl.editingProject.descriptionText" class="form-control" rows="4"></textarea>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-xs-12">Started On:</label>
                <div class="col-sm-9 col-xs-12">
                    <input type="text" class="form-control" data-ui-date="{changeYear: true, yearRange: '1980:+1'}" data-ng-change="$ctrl.onProjectStartDateChange()" data-ng-model="$ctrl.editingProject.startDate" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-xs-12">Finished On:</label>
                <div class="col-sm-9 col-xs-12">
                    <input type="text" class="form-control" data-ui-date="{changeYear: true, yearRange: '1980:+1'}" data-ng-model="$ctrl.editingProject.endDate" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-xs-12">Cost:</label>
                <div class="col-sm-9 col-xs-12">
                    $<input type="text" class="form-control" style="display: inline-block; width: 98%;" data-ng-model="$ctrl.editingProject.cost" />
                </div>
            </div>

            <div class="text-right">
                <button type="button" class="btn btn-primary" data-ng-click="$ctrl.saveProject()">Save</button>
            </div>

        </form>
    </div>


    <div class="modal-container" data-ng-if="$ctrl.shouldShowEditEquipmentModal" style="z-index: 721;" data-ng-escape="$ctrl.shouldShowEditEquipmentModal = false">
        <div class="modal-overlay"></div>

        <form class="ca-modal-dialog modal-sm" style="z-index: 723;">
            <div data-ng-show="$ctrl.isLoading" class="loading-overlay"></div>
            <span style="float: right;" class="close-x" data-ng-click="$ctrl.shouldShowEditEquipmentModal = false">&times;</span>
            <h2>{{ $ctrl.editingEquipment.equipmentId ? "Edit Equipment" : "Add New Equipment" }}</h2>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Name:</label>
                <div class="col-sm-8 col-xs-12">
                    <input id="equipment-name-text-box" type="text" class="form-control" data-ng-model="$ctrl.editingEquipment.name" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Type:</label>
                <div class="col-sm-8 col-xs-12">
                    <!--<tags-input style="width: 90%;" ng-model="$ctrl.editingEquipment.typeTags" data-max-tags="1" data-placeholder="" data-replace-spaces-with-dashes="false">
                        <auto-complete data-min-length="0" data-load-on-empty="true" data-load-on-focus="true" data-load-on-down-arrow="true" data-source="$ctrl.getEquipmentTypeAutocomplete($query)"></auto-complete>
                    </tags-input>-->
                    <select class="form-control" ng-model="$ctrl.editingEquipment.type" data-ng-options="o as o for o in $ctrl.equipmentTypeOptions">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Initial Cost:</label>
                <div class="col-sm-8 col-xs-12">
                    $<input type="text" class="form-control" style="display: inline-block; width: 97%;" data-ng-model="$ctrl.editingEquipment.initialCost" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Installed On:</label>
                <div class="col-sm-8 col-xs-12">
                    <input type="text" class="form-control" data-ui-date data-ng-model="$ctrl.editingEquipment.installDate" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Manufacturer:</label>
                <div class="col-sm-8 col-xs-12">
                    <input type="text" class="form-control" data-ng-model="$ctrl.editingEquipment.manufacturer" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Model #:</label>
                <div class="col-sm-8 col-xs-12">
                    <input type="text" class="form-control" data-ng-model="$ctrl.editingEquipment.modelNumber" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Serial #:</label>
                <div class="col-sm-8 col-xs-12">
                    <input type="text" class="form-control" data-ng-model="$ctrl.editingEquipment.serialNumber" />
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-xs-12">Location:</label>
                <div class="col-sm-8 col-xs-12">
                    <!--<tags-input style="width: 90%;" ng-model="$ctrl.editingEquipment.locationTags" data-max-tags="1" placeholder="" data-replace-spaces-with-dashes="false">
                        <auto-complete data-min-length="0" data-load-on-empty="true" data-load-on-focus="true" data-load-on-down-arrow="true" data-source="$ctrl.getEquipmentLocationAutocomplete($query)"></auto-complete>
                    </tags-input>-->
                    <select class="form-control" ng-model="$ctrl.editingEquipment.location" data-ng-options="o as o for o in $ctrl.equipmentLocationOptions">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="text-right">
                <button type="button" class="btn btn-primary" data-ng-click="$ctrl.saveEquipment()">Save</button>
            </div>

        </form>
    </div>


    <div class="modal-container" data-ng-if="$ctrl.shouldShowManageEquipmentModal" data-ng-escape="$ctrl.shouldShowManageEquipmentModal = false">
        <div class="modal-overlay"></div>

        <form class="ca-modal-dialog modal-lg">
            <div data-ng-show="$ctrl.isLoading" class="loading-overlay"></div>
            <span style="float: right;" class="close-x" data-ng-click="$ctrl.shouldShowManageEquipmentModal = false">&times;</span>
            <h2>{{ $ctrl.isSiteManager ? "Manage" : "View" }} Equipment</h2>
            <div style="text-align: right; margin-bottom: 5px;">
                <button data-ng-if="$ctrl.isSiteManager" class="btn btn-primary" data-ng-click="$ctrl.openAddNewEquipment();" type="button">Add New Equipment</button>
            </div>

            <div data-ui-grid="$ctrl.equipmentGridOptions"></div>
        </form>
    </div>
</div>
